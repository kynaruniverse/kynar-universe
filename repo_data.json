{
  "./next-env.d.ts": {
    "text": "/// <reference types=\"next\" />\n/// <reference types=\"next/image-types/global\" />\nimport \"./.next/types/routes.d.ts\";\n\n// NOTE: This file should not be edited\n// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.\n",
    "embedding": null
  },
  "./next.config.js": {
    "text": "/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  reactStrictMode: true,\n  poweredByHeader: false,\n  trailingSlash: false,\n\n  async redirects() {\n    return [\n      { source: '/login', destination: '/auth/login', permanent: true },\n      { source: '/signup', destination: '/auth/signup', permanent: true },\n    ];\n  },\n\n  images: {\n    deviceSizes: [320, 420, 768, 1024, 1200],\n    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\n    formats: ['image/webp', 'image/avif'], \n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: '*.supabase.co',\n        pathname: '/storage/v1/object/public/**',\n      },\n      {\n        protocol: 'https',\n        hostname: 'lemonsqueezy.imgix.net',\n        port: '',\n        pathname: '/**',\n      },\n    ],\n  },\n\n  experimental: {\n    optimizePackageImports: ['lucide-react', 'framer-motion', 'zustand', 'date-fns'],\n  },\n\n  async headers() {\n    return [\n      {\n        source: '/(.*)',\n        headers: [\n          { key: 'X-Content-Type-Options', value: 'nosniff' },\n          { key: 'X-Frame-Options', value: 'DENY' },\n          { key: 'X-XSS-Protection', value: '1; mode=block' },\n        ],\n      },\n    ];\n  },\n};\n\nmodule.exports = nextConfig;\n",
    "embedding": null
  },
  "./middleware.ts": {
    "text": "import { createServerClient, type CookieOptions } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\nimport { Database } from '@/lib/supabase/types'\n\nexport async function middleware(request: NextRequest) {\n  let response = NextResponse.next({ request })\n\n  const supabase = createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll: () => request.cookies.getAll(),\n        setAll: (cookiesToSet) => {\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\n          response = NextResponse.next({ request })\n          cookiesToSet.forEach(({ name, value, options }) => response.cookies.set(name, value, options))\n        },\n      },\n    }\n  )\n\n  const { data: { user } } = await supabase.auth.getUser()\n  const { pathname } = request.nextUrl\n  \n  if (pathname.startsWith('/api/webhooks')) return response\n\n  const isProtectedRoute = pathname.startsWith('/library') || pathname.startsWith('/account')\n  if (!user && isProtectedRoute) {\n    const url = request.nextUrl.clone()\n    url.pathname = '/auth/login'\n    url.searchParams.set('return_to', pathname)\n    return NextResponse.redirect(url)\n  }\n\n  return response\n}\n\nexport const config = {\n  matcher: ['/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'],\n}\n",
    "embedding": null
  },
  "./package.json": {
    "text": "{\n  \"name\": \"kynar-universe-v1-5\",\n  \"version\": \"1.5.0\",\n  \"private\": true,\n  \"description\": \"Kynar Universe: A calm, mobile-first digital ecosystem.\",\n  \"author\": \"Kynar Universe (UK)\",\n  \"engines\": {\n    \"node\": \">=20.10.0\",\n    \"npm\": \">=10.0.0\"\n  },\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"types\": \"tsc --noEmit\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\",\n    \"types:generate\": \"supabase gen types typescript --local > lib/supabase/types.ts\"\n  },\n  \"dependencies\": {\n    \"@lemonsqueezy/lemonsqueezy.js\": \"^4.0.0\",\n    \"@supabase/ssr\": \"^0.8.0\",\n    \"@supabase/supabase-js\": \"^2.94.0\",\n    \"canvas-confetti\": \"^1.9.3\",\n    \"class-variance-authority\": \"^0.7.1\",\n    \"clsx\": \"^2.1.1\",\n    \"date-fns\": \"^4.1.0\",\n    \"framer-motion\": \"^12.31.0\",\n    \"lucide-react\": \"^0.563.0\",\n    \"next\": \"16.1.6\",\n    \"react\": \"19.2.4\",\n    \"react-dom\": \"19.2.4\",\n    \"react-hot-toast\": \"^2.4.1\",\n    \"tailwind-merge\": \"^2.5.5\",\n    \"zustand\": \"^5.0.3\"\n  },\n  \"devDependencies\": {\n    \"@tailwindcss/forms\": \"^0.5.9\",\n    \"@tailwindcss/typography\": \"^0.5.15\",\n    \"@types/canvas-confetti\": \"^1.6.4\",\n    \"@types/node\": \"^20.17.6\",\n    \"@types/react\": \"^19.2.0\",\n    \"@types/react-dom\": \"^19.2.0\",\n    \"autoprefixer\": \"^10.4.20\",\n    \"eslint\": \"^9.14.0\",\n    \"eslint-config-next\": \"16.1.6\",\n    \"postcss\": \"^8.4.49\",\n    \"tailwindcss\": \"^3.4.14\",\n    \"tailwindcss-animate\": \"^1.0.7\",\n    \"typescript\": \"^5.7.0\"\n  }\n}\n",
    "embedding": null
  },
  "./.eslintrc.json": {
    "text": "{\n  \"extends\": \"next/core-web-vitals\"\n}\n",
    "embedding": null
  },
  "./repo_data.json": {
    "text": "{\n  \"./next-env.d.ts\": {\n    \"text\": \"/// <reference types=\\\"next\\\" />\\n/// <reference types=\\\"next/image-types/global\\\" />\\nimport \\\"./.next/types/routes.d.ts\\\";\\n\\n// NOTE: This file should not be edited\\n// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.\\n\",\n    \"embedding\": null\n  },\n  \"./next.config.js\": {\n    \"text\": \"/** @type {import('next').NextConfig} */\\nconst nextConfig = {\\n  reactStrictMode: true,\\n  poweredByHeader: false,\\n  trailingSlash: false,\\n\\n  async redirects() {\\n    return [\\n      { source: '/login', destination: '/auth/login', permanent: true },\\n      { source: '/signup', destination: '/auth/signup', permanent: true },\\n    ];\\n  },\\n\\n  images: {\\n    deviceSizes: [320, 420, 768, 1024, 1200],\\n    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\\n    formats: ['image/webp', 'image/avif'], \\n    remotePatterns: [\\n      {\\n        protocol: 'https',\\n        hostname: '*.supabase.co',\\n        pathname: '/storage/v1/object/public/**',\\n      },\\n      {\\n        protocol: 'https',\\n        hostname: 'lemonsqueezy.imgix.net',\\n        port: '',\\n        pathname: '/**',\\n      },\\n    ],\\n  },\\n\\n  experimental: {\\n    optimizePackageImports: ['lucide-react', 'framer-motion', 'zustand', 'date-fns'],\\n  },\\n\\n  async headers() {\\n    return [\\n      {\\n        source: '/(.*)',\\n        headers: [\\n          { key: 'X-Content-Type-Options', value: 'nosniff' },\\n          { key: 'X-Frame-Options', value: 'DENY' },\\n          { key: 'X-XSS-Protection', value: '1; mode=block' },\\n        ],\\n      },\\n    ];\\n  },\\n};\\n\\nmodule.exports = nextConfig;\\n\",\n    \"embedding\": null\n  },\n  \"./middleware.ts\": {\n    \"text\": \"import { createServerClient, type CookieOptions } from '@supabase/ssr'\\nimport { NextResponse, type NextRequest } from 'next/server'\\nimport { Database } from '@/lib/supabase/types'\\n\\nexport async function middleware(request: NextRequest) {\\n  let response = NextResponse.next({ request })\\n\\n  const supabase = createServerClient<Database>(\\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\\n    {\\n      cookies: {\\n        getAll: () => request.cookies.getAll(),\\n        setAll: (cookiesToSet) => {\\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\\n          response = NextResponse.next({ request })\\n          cookiesToSet.forEach(({ name, value, options }) => response.cookies.set(name, value, options))\\n        },\\n      },\\n    }\\n  )\\n\\n  const { data: { user } } = await supabase.auth.getUser()\\n  const { pathname } = request.nextUrl\\n  \\n  if (pathname.startsWith('/api/webhooks')) return response\\n\\n  const isProtectedRoute = pathname.startsWith('/library') || pathname.startsWith('/account')\\n  if (!user && isProtectedRoute) {\\n    const url = request.nextUrl.clone()\\n    url.pathname = '/auth/login'\\n    url.searchParams.set('return_to', pathname)\\n    return NextResponse.redirect(url)\\n  }\\n\\n  return response\\n}\\n\\nexport const config = {\\n  matcher: ['/((?!_next/static|_next/image|favicon.ico|.*\\\\\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'],\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./package.json\": {\n    \"text\": \"{\\n  \\\"name\\\": \\\"kynar-universe-v1-5\\\",\\n  \\\"version\\\": \\\"1.5.0\\\",\\n  \\\"private\\\": true,\\n  \\\"description\\\": \\\"Kynar Universe: A calm, mobile-first digital ecosystem.\\\",\\n  \\\"author\\\": \\\"Kynar Universe (UK)\\\",\\n  \\\"engines\\\": {\\n    \\\"node\\\": \\\">=20.10.0\\\",\\n    \\\"npm\\\": \\\">=10.0.0\\\"\\n  },\\n  \\\"scripts\\\": {\\n    \\\"dev\\\": \\\"next dev\\\",\\n    \\\"types\\\": \\\"tsc --noEmit\\\",\\n    \\\"build\\\": \\\"next build\\\",\\n    \\\"start\\\": \\\"next start\\\",\\n    \\\"lint\\\": \\\"next lint\\\",\\n    \\\"types:generate\\\": \\\"supabase gen types typescript --local > lib/supabase/types.ts\\\"\\n  },\\n  \\\"dependencies\\\": {\\n    \\\"@lemonsqueezy/lemonsqueezy.js\\\": \\\"^4.0.0\\\",\\n    \\\"@supabase/ssr\\\": \\\"^0.8.0\\\",\\n    \\\"@supabase/supabase-js\\\": \\\"^2.94.0\\\",\\n    \\\"canvas-confetti\\\": \\\"^1.9.3\\\",\\n    \\\"class-variance-authority\\\": \\\"^0.7.1\\\",\\n    \\\"clsx\\\": \\\"^2.1.1\\\",\\n    \\\"date-fns\\\": \\\"^4.1.0\\\",\\n    \\\"framer-motion\\\": \\\"^12.31.0\\\",\\n    \\\"lucide-react\\\": \\\"^0.563.0\\\",\\n    \\\"next\\\": \\\"16.1.6\\\",\\n    \\\"react\\\": \\\"19.2.4\\\",\\n    \\\"react-dom\\\": \\\"19.2.4\\\",\\n    \\\"react-hot-toast\\\": \\\"^2.4.1\\\",\\n    \\\"tailwind-merge\\\": \\\"^2.5.5\\\",\\n    \\\"zustand\\\": \\\"^5.0.3\\\"\\n  },\\n  \\\"devDependencies\\\": {\\n    \\\"@tailwindcss/forms\\\": \\\"^0.5.9\\\",\\n    \\\"@tailwindcss/typography\\\": \\\"^0.5.15\\\",\\n    \\\"@types/canvas-confetti\\\": \\\"^1.6.4\\\",\\n    \\\"@types/node\\\": \\\"^20.17.6\\\",\\n    \\\"@types/react\\\": \\\"^19.2.0\\\",\\n    \\\"@types/react-dom\\\": \\\"^19.2.0\\\",\\n    \\\"autoprefixer\\\": \\\"^10.4.20\\\",\\n    \\\"eslint\\\": \\\"^9.14.0\\\",\\n    \\\"eslint-config-next\\\": \\\"16.1.6\\\",\\n    \\\"postcss\\\": \\\"^8.4.49\\\",\\n    \\\"tailwindcss\\\": \\\"^3.4.14\\\",\\n    \\\"tailwindcss-animate\\\": \\\"^1.0.7\\\",\\n    \\\"typescript\\\": \\\"^5.7.0\\\"\\n  }\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./.eslintrc.json\": {\n    \"text\": \"{\\n  \\\"extends\\\": \\\"next/core-web-vitals\\\"\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./tsconfig.json\": {\n    \"text\": \"{\\n  \\\"compilerOptions\\\": {\\n    \\\"target\\\": \\\"ES2022\\\",\\n    \\\"lib\\\": [\\\"dom\\\", \\\"dom.iterable\\\", \\\"esnext\\\"],\\n    \\\"allowJs\\\": true,\\n    \\\"skipLibCheck\\\": true,\\n    \\\"strict\\\": true,\\n    \\\"noEmit\\\": true,\\n    \\\"esModuleInterop\\\": true,\\n    \\\"module\\\": \\\"esnext\\\",\\n    \\\"moduleResolution\\\": \\\"bundler\\\",\\n    \\\"resolveJsonModule\\\": true,\\n    \\\"isolatedModules\\\": true,\\n    \\\"jsx\\\": \\\"react-jsx\\\",\\n    \\\"incremental\\\": true,\\n    \\\"noImplicitAny\\\": true,\\n    \\\"noImplicitReturns\\\": true,\\n    \\\"noUnusedLocals\\\": true,\\n    \\\"noUnusedParameters\\\": true,\\n    \\\"forceConsistentCasingInFileNames\\\": true,\\n    \\\"plugins\\\": [{ \\\"name\\\": \\\"next\\\" }],\\n    \\\"paths\\\": {\\n      \\\"@/*\\\": [\\\"./*\\\"],\\n      \\\"@/types\\\": [\\\"./lib/supabase/types.ts\\\"] \\n    }\\n  },\\n  \\\"include\\\": [\\n    \\\"next-env.d.ts\\\", \\n    \\\".next/types/**/*.ts\\\",\\n    \\\".next/dev/types/**/*.ts\\\",\\n    \\\"app/**/*.ts\\\",\\n    \\\"app/**/*.tsx\\\",\\n    \\\"lib/**/*.ts\\\",\\n    \\\"lib/**/*.tsx\\\",\\n    \\\"components/**/*.ts\\\",\\n    \\\"components/**/*.tsx\\\"\\n  ],\\n  \\\"exclude\\\": [\\\"node_modules\\\", \\\".next\\\", \\\"out\\\", \\\"dist\\\"]\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./postcss.config.js\": {\n    \"text\": \"module.exports = {\\n  plugins: {\\n    tailwindcss: {},\\n    autoprefixer: {},\\n  },\\n};\",\n    \"embedding\": null\n  },\n  \"./tailwind.config.ts\": {\n    \"text\": \"import type { Config } from \\\"tailwindcss\\\";\\nimport typography from \\\"@tailwindcss/typography\\\";\\nimport forms from \\\"@tailwindcss/forms\\\";\\nimport animate from \\\"tailwindcss-animate\\\";\\n\\nconst config: Config = {\\n  darkMode: [\\\"class\\\"],\\n  content: [\\n    \\\"./app/**/*.{js,ts,jsx,tsx,mdx}\\\",\\n    \\\"./components/**/*.{js,ts,jsx,tsx,mdx}\\\",\\n    \\\"./lib/**/*.{js,ts,jsx,tsx,mdx}\\\",\\n  ],\\n  theme: {\\n    extend: {\\n      colors: {\\n        canvas: \\\"hsl(var(--canvas) / <alpha-value>)\\\",\\n        surface: \\\"hsl(var(--surface) / <alpha-value>)\\\",\\n        border: \\\"hsl(var(--border) / <alpha-value>)\\\",\\n        \\\"text-primary\\\": \\\"hsl(var(--text-primary) / <alpha-value>)\\\",\\n        \\\"text-secondary\\\": \\\"hsl(var(--text-secondary) / <alpha-value>)\\\",\\n        kyn: {\\n          green: {\\n            50: \\\"#F2F4F2\\\",\\n            100: \\\"#E6EAE5\\\",\\n            200: \\\"#C2CCC1\\\",\\n            500: \\\"hsl(var(--kyn-green) / <alpha-value>)\\\",\\n            600: \\\"#3D5140\\\",\\n            700: \\\"#2D3B2F\\\",\\n            900: \\\"#1A241B\\\",\\n          },\\n          caramel: {\\n            50: \\\"#FDFBF7\\\",\\n            100: \\\"#F7F1E6\\\",\\n            200: \\\"#E9DCC2\\\",\\n            500: \\\"hsl(var(--kyn-caramel) / <alpha-value>)\\\",\\n            600: \\\"#947234\\\",\\n            700: \\\"#755B29\\\",\\n            900: \\\"#453518\\\",\\n          },\\n          slate: {\\n            50: \\\"#F8FAFC\\\",\\n            100: \\\"#F1F5F9\\\",\\n            200: \\\"#E2E8F0\\\",\\n            300: \\\"#CBD5E1\\\",\\n            400: \\\"#94A3B8\\\",\\n            500: \\\"#64748B\\\",\\n            800: \\\"#1E293B\\\",\\n            900: \\\"hsl(var(--kyn-slate) / <alpha-value>)\\\",\\n          },\\n        },\\n      },\\n      fontFamily: {\\n        brand: [\\\"var(--font-brand)\\\", \\\"Plus Jakarta Sans\\\", \\\"sans-serif\\\"],\\n        ui: [\\\"var(--font-ui)\\\", \\\"Inter\\\", \\\"sans-serif\\\"],\\n      },\\n      spacing: {\\n        gutter: \\\"1.5rem\\\",\\n        inner: \\\"1.25rem\\\",\\n        section: \\\"5rem\\\",\\n      },\\n      borderRadius: {\\n        'kynar-sm': \\\"0.75rem\\\",\\n        'kynar': \\\"1.25rem\\\",\\n        \\\"kynar-lg\\\": \\\"2rem\\\",\\n        \\\"kynar-xl\\\": \\\"2.5rem\\\",\\n      },\\n      boxShadow: {\\n        \\\"kynar-soft\\\": \\\"0 10px 40px -15px rgba(0, 0, 0, 0.08)\\\",\\n        \\\"kynar-deep\\\": \\\"0 30px 70px -10px rgba(0, 0, 0, 0.2)\\\",\\n        \\\"kynar-inner\\\": \\\"inset 0 2px 4px 0 rgba(0, 0, 0, 0.05)\\\",\\n      },\\n      transitionTimingFunction: {\\n        \\\"kyn-drift\\\": \\\"cubic-bezier(0.16, 1, 0.3, 1)\\\",\\n      },\\n      animation: {\\n        \\\"portal-in\\\": \\\"portal-in 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards\\\",\\n        \\\"portal-out\\\": \\\"portal-out 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards\\\",\\n        \\\"fade-in\\\": \\\"fade-in 0.6s ease-out forwards\\\",\\n        \\\"breathe\\\": \\\"pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite\\\",\\n      },\\n      keyframes: {\\n        \\\"portal-in\\\": {\\n          \\\"0%\\\": { transform: \\\"scale(0.9) translateY(20px)\\\", opacity: \\\"0\\\", filter: \\\"blur(10px)\\\" },\\n          \\\"100%\\\": { transform: \\\"scale(1) translateY(0)\\\", opacity: \\\"1\\\", filter: \\\"blur(0)\\\" },\\n        },\\n        \\\"portal-out\\\": {\\n          \\\"0%\\\": { transform: \\\"scale(1) translateY(0)\\\", opacity: \\\"1\\\" },\\n          \\\"100%\\\": { transform: \\\"scale(0.95) translateY(10px)\\\", opacity: \\\"0\\\" },\\n        },\\n        \\\"fade-in\\\": {\\n          \\\"0%\\\": { opacity: \\\"0\\\" },\\n          \\\"100%\\\": { opacity: \\\"1\\\" },\\n        },\\n      },\\n    },\\n  },\\n  plugins: [\\n    typography,\\n    forms,\\n    animate,\\n  ],\\n};\\n\\nexport default config;\\n\",\n    \"embedding\": null\n  },\n  \"./scripts/test-webhook.js\": {\n    \"text\": \"const crypto = require('crypto');\\n\\n// Configuration\\nconst WEBHOOK_URL = 'http://localhost:3000/api/webhooks/checkout';\\nconst WEBHOOK_SECRET = 'your_test_secret'; // Match your .env.local\\n\\nasync function simulateWebhook() {\\n  const payload = {\\n    meta: { event_name: 'order_created' },\\n    data: {\\n      attributes: {\\n        variant_id: 'pri_01hs5xyz...', // Use an ID from your pricing.ts\\n        total: 5000,                   // Â£50.00 in cents\\n        user_email: 'test@kynar.com',\\n        custom_data: {\\n          product_id: 'PASTE_A_VALID_PRODUCT_UUID_HERE',\\n          user_id: 'PASTE_YOUR_AUTH_USER_UUID_HERE'\\n        }\\n      }\\n    }\\n  };\\n\\n  const body = JSON.stringify(payload);\\n  const hmac = crypto.createHmac('sha256', WEBHOOK_SECRET);\\n  const signature = hmac.update(body).digest('hex');\\n\\n  console.log('ðŸš€ Sending simulated webhook...');\\n\\n  const response = await fetch(WEBHOOK_URL, {\\n    method: 'POST',\\n    headers: {\\n      'Content-Type': 'application/json',\\n      'x-signature': signature\\n    },\\n    body\\n  });\\n\\n  const result = await response.json();\\n  console.log('Status:', response.status);\\n  console.log('Result:', result);\\n}\\n\\nsimulateWebhook();\\n\",\n    \"embedding\": null\n  },\n  \"./components/marketplace/OverlayWrapper.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\nimport { useEffect } from \\\"react\\\";\\nimport { useUIStore } from \\\"@/lib/store/ui\\\";\\nimport SelectionOverlay from \\\"./SelectionOverlay\\\";\\n\\nexport default function OverlayWrapper() {\\n  const isSelectionOpen = useUIStore((state) => state.isSelectionOpen);\\n  const isUserMenuOpen = useUIStore((state) => state.isUserMenuOpen);\\n  const closeSelection = useUIStore((state) => state.closeSelection);\\n  const closeAll = useUIStore((state) => state.closeAll);\\n\\n  useEffect(() => {\\n    const handleEscape = (e: KeyboardEvent) => {\\n      if (e.key === \\\"Escape\\\") {\\n        closeAll();\\n      }\\n    };\\n\\n    if (isSelectionOpen || isUserMenuOpen) {\\n      window.addEventListener(\\\"keydown\\\", handleEscape);\\n      document.body.style.overflow = \\\"hidden\\\";\\n    }\\n\\n    return () => {\\n      window.removeEventListener(\\\"keydown\\\", handleEscape);\\n      // Fixed: Setting to empty string is safer for CSS inheritance\\n      document.body.style.overflow = \\\"\\\";\\n    };\\n  }, [isSelectionOpen, isUserMenuOpen, closeAll]);\\n\\n  return (\\n    <>\\n      <SelectionOverlay \\n        isOpen={isSelectionOpen} \\n        onClose={closeSelection} \\n      />\\n    </>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./components/marketplace/SelectionOverlay.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\nimport { useEffect } from \\\"react\\\";\\nimport { X, ShoppingBag, Trash2, ArrowRight } from \\\"lucide-react\\\";\\nimport { useCartItems } from \\\"@/lib/cart/store\\\";\\nimport { getPriceFromId } from \\\"@/lib/marketplace/pricing\\\";\\nimport Link from \\\"next/link\\\";\\n\\ninterface SelectionOverlayProps {\\n  isOpen: boolean;\\n  onClose: () => void;\\n}\\n\\nexport default function SelectionOverlay({ isOpen, onClose }: SelectionOverlayProps) {\\n  const { items, count, totalPrice, removeItem } = useCartItems();\\n\\n  // Prevent background scrolling when overlay is open\\n  useEffect(() => {\\n    if (isOpen) {\\n      document.body.style.overflow = 'hidden';\\n    } else {\\n      document.body.style.overflow = 'unset';\\n    }\\n    return () => { document.body.style.overflow = 'unset'; };\\n  }, [isOpen]);\\n\\n  if (!isOpen) return null;\\n\\n  return (\\n    <div className=\\\"fixed inset-0 z-[100] flex items-center justify-center p-4 sm:p-6\\\">\\n      {/* Blurred Background Overlay - Fades in */}\\n      <div \\n        className=\\\"absolute inset-0 bg-kyn-slate-900/40 backdrop-blur-md animate-in fade-in duration-500\\\" \\n        onClick={onClose} \\n      />\\n\\n      {/* Centered Modal - Zooms in from the background */}\\n      <div className=\\\"relative w-full max-w-lg max-h-[90vh] border border-border bg-white rounded-[2.5rem] p-8 shadow-2xl animate-in zoom-in-95 fade-in slide-in-from-bottom-8 duration-300 flex flex-col overflow-hidden\\\">\\n        \\n        {/* Header */}\\n        <div className=\\\"flex items-center justify-between mb-8\\\">\\n          <div className=\\\"flex items-center gap-3\\\">\\n            <div className=\\\"flex h-12 w-12 items-center justify-center rounded-2xl bg-kyn-slate-900 text-white shadow-lg shadow-kyn-slate-900/20\\\">\\n              <ShoppingBag size={20} />\\n            </div>\\n            <div>\\n              <h3 className=\\\"font-brand text-2xl font-bold text-kyn-slate-900\\\">Selection</h3>\\n              <p className=\\\"font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\\\">\\n                {count} {count === 1 ? 'Item' : 'Items'} in Vault\\n              </p>\\n            </div>\\n          </div>\\n          <button \\n            onClick={onClose} \\n            className=\\\"p-2 rounded-full hover:bg-surface text-kyn-slate-400 hover:text-kyn-slate-900 transition-all\\\"\\n          >\\n            <X size={24} />\\n          </button>\\n        </div>\\n\\n        {/* Scrollable Items List */}\\n        <div className=\\\"flex-1 overflow-y-auto space-y-6 pr-2 custom-scrollbar\\\">\\n          {items.length === 0 ? (\\n            <div className=\\\"flex flex-col items-center justify-center py-16 text-center\\\">\\n              <div className=\\\"h-20 w-20 bg-surface rounded-full flex items-center justify-center mb-6 text-kyn-slate-200\\\">\\n                <ShoppingBag size={32} />\\n              </div>\\n              <p className=\\\"font-brand text-lg font-bold text-kyn-slate-900\\\">Your selection is empty</p>\\n              <p className=\\\"font-ui text-sm text-text-secondary mt-1 max-w-[200px]\\\">Visit the Store to acquire tools for your ecosystem.</p>\\n            </div>\\n          ) : (\\n            items.map((item) => {\\n              const itemPrice = getPriceFromId(item.price_id) ?? 0;\\n              \\n              return (\\n                <div key={item.id} className=\\\"flex gap-5 group items-center bg-surface/30 p-4 rounded-3xl border border-transparent hover:border-border hover:bg-surface/50 transition-all\\\">\\n                  <div className=\\\"h-16 w-16 rounded-2xl bg-white border border-border overflow-hidden flex-shrink-0 flex items-center justify-center text-kyn-slate-400 shadow-sm\\\">\\n                      <ShoppingBag size={20} />\\n                  </div>\\n                  \\n                  <div className=\\\"flex-1\\\">\\n                    <h4 className=\\\"font-brand font-bold text-kyn-slate-900 leading-tight\\\">\\n                      {item.title}\\n                    </h4>\\n                    <div className=\\\"flex items-center justify-between mt-1\\\">\\n                      <p className=\\\"text-kyn-green-600 font-ui font-bold text-sm\\\">\\n                        Â£{itemPrice.toFixed(2)}\\n                      </p>\\n                      <button \\n                        onClick={() => removeItem(item.id)} \\n                        className=\\\"text-kyn-slate-300 hover:text-red-500 transition-colors p-1\\\"\\n                      >\\n                        <Trash2 size={16} />\\n                      </button>\\n                    </div>\\n                  </div>\\n                </div>\\n              );\\n            })\\n          )}\\n        </div>\\n\\n        {/* Footer with Subtotal */}\\n        {items.length > 0 && (\\n          <div className=\\\"pt-8 mt-4 border-t border-border bg-white\\\">\\n            <div className=\\\"flex items-center justify-between mb-8\\\">\\n              <div>\\n                <span className=\\\"font-ui text-[10px] font-bold text-kyn-slate-400 uppercase tracking-widest block mb-1\\\">\\n                  Total Investment\\n                </span>\\n                <span className=\\\"font-brand text-3xl font-bold text-kyn-slate-900\\\">\\n                  Â£{totalPrice.toFixed(2)}\\n                </span>\\n              </div>\\n            </div>\\n            \\n            <Link \\n              href=\\\"/checkout\\\" \\n              onClick={onClose}\\n              className=\\\"w-full flex items-center justify-center gap-3 py-5 bg-kyn-slate-900 text-white rounded-[2rem] font-brand font-bold hover:bg-kyn-slate-800 transition-all active:scale-[0.98] shadow-2xl shadow-kyn-slate-900/20\\\"\\n            >\\n              Confirm Selection\\n              <ArrowRight size={18} />\\n            </Link>\\n          </div>\\n        )}\\n      </div>\\n    </div>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./components/marketplace/CelebrationTrigger.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\nimport { useEffect } from \\\"react\\\";\\nimport { triggerCelebration } from \\\"@/lib/utils/confetti\\\";\\n\\nexport function CelebrationTrigger() {\\n  useEffect(() => {\\n    // We provide x and y to satisfy the strict interface\\n    triggerCelebration({\\n      particleCount: 80,\\n      spread: 100,\\n      origin: { x: 0.5, y: 0.6 } \\n    });\\n  }, []);\\n  \\n  return null; // This component renders nothing but runs the effect\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./components/marketplace/FilterBar.tsx\": {\n    \"text\": \"/* KYNAR UNIVERSE: Filter Bar (v2.1) */\\n\\n\\\"use client\\\";\\n\\nimport { useState } from \\\"react\\\";\\nimport { useRouter, useSearchParams } from \\\"next/navigation\\\";\\nimport { SlidersHorizontal, X, RotateCcw, Check } from \\\"lucide-react\\\";\\nimport { WORLDS } from \\\"@/lib/supabase/types\\\";\\nimport { cn } from \\\"@/lib/utils\\\";\\n\\ninterface FilterBarProps {\\n  currentWorld?: string;\\n}\\n\\nexport const FilterBar = ({ currentWorld = \\\"All\\\" }: FilterBarProps) => {\\n  const [isOpen, setIsOpen] = useState(false);\\n  const router = useRouter();\\n  const searchParams = useSearchParams();\\n\\n  const setFilter = (key: string, value: string) => {\\n    const params = new URLSearchParams(searchParams.toString());\\n    if (value === \\\"All\\\") {\\n      params.delete(key);\\n    } else {\\n      params.set(key, value);\\n    }\\n    router.push(`/store?${params.toString()}`);\\n    setIsOpen(false);\\n  };\\n\\n  const resetFilters = () => {\\n    router.push('/store');\\n    setIsOpen(false);\\n  };\\n\\n  return (\\n    <div className=\\\"flex items-center justify-between\\\">\\n      <button \\n        onClick={() => setIsOpen(true)}\\n        className=\\\"flex items-center gap-2 text-[11px] font-bold uppercase tracking-widest text-kyn-slate-900 transition-opacity hover:opacity-70\\\"\\n      >\\n        <SlidersHorizontal size={14} /> Filters\\n      </button>\\n      \\n      <div className=\\\"flex items-center gap-2\\\">\\n        {currentWorld !== \\\"All\\\" && (\\n          <div className=\\\"h-1.5 w-1.5 rounded-full bg-kyn-green-500 animate-pulse\\\" />\\n        )}\\n        <span className=\\\"text-[10px] font-bold text-kyn-slate-400 uppercase tracking-widest\\\">\\n          {currentWorld}\\n        </span>\\n      </div>\\n\\n      {/* MOBILE DRAWER OVERLAY */}\\n      {isOpen && (\\n        <div className=\\\"fixed inset-0 z-[120] flex flex-col bg-canvas animate-in slide-in-from-right duration-500\\\">\\n          <div className=\\\"flex h-16 items-center justify-between px-gutter border-b border-border\\\">\\n            <h2 className=\\\"font-brand font-bold text-lg\\\">Refine Results</h2>\\n            <button \\n              onClick={() => setIsOpen(false)}\\n              className=\\\"p-2 text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\\\"\\n            >\\n              <X size={20} />\\n            </button>\\n          </div>\\n\\n          <div className=\\\"flex-1 overflow-y-auto p-8 space-y-8\\\">\\n            <div>\\n              <h3 className=\\\"text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-6\\\">Domains</h3>\\n              <div className=\\\"grid grid-cols-1 gap-3\\\">\\n                {/* \\\"All\\\" Option */}\\n                <button \\n                  onClick={() => setFilter('world', 'All')}\\n                  className={cn(\\n                    \\\"flex items-center justify-between p-4 border rounded-2xl text-sm font-ui transition-all\\\",\\n                    currentWorld === \\\"All\\\" \\n                      ? \\\"border-kyn-slate-900 bg-kyn-slate-900 text-white\\\" \\n                      : \\\"border-border bg-white text-kyn-slate-600 hover:border-kyn-slate-200\\\"\\n                  )}\\n                >\\n                  All Domains\\n                  {currentWorld === \\\"All\\\" && <Check size={14} />}\\n                </button>\\n\\n                {/* World Options */}\\n                {WORLDS.map((w: string) => (\\n                  <button \\n                    key={w} \\n                    onClick={() => setFilter('world', w)}\\n                    className={cn(\\n                      \\\"flex items-center justify-between p-4 border rounded-2xl text-sm font-ui transition-all\\\",\\n                      currentWorld === w \\n                        ? \\\"border-kyn-slate-900 bg-kyn-slate-900 text-white\\\" \\n                        : \\\"border-border bg-white text-kyn-slate-600 hover:border-kyn-slate-200\\\"\\n                    )}\\n                  >\\n                    {w}\\n                    {currentWorld === w && <Check size={14} />}\\n                  </button>\\n                ))}\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div className=\\\"p-8 border-t border-border bg-surface/50 flex gap-4\\\">\\n            <button \\n              onClick={resetFilters} \\n              className=\\\"flex-1 py-4 border border-border bg-white rounded-2xl transition-all active:scale-95 flex items-center justify-center\\\"\\n              title=\\\"Reset Filters\\\"\\n            >\\n              <RotateCcw size={18} className=\\\"text-kyn-slate-400\\\" />\\n            </button>\\n            <button \\n              onClick={() => setIsOpen(false)} \\n              className=\\\"flex-[3] py-4 bg-kyn-slate-900 text-white rounded-2xl font-brand text-sm font-bold shadow-lg shadow-kyn-slate-900/10 active:scale-95 transition-all\\\"\\n            >\\n              Close\\n            </button>\\n          </div>\\n        </div>\\n      )}\\n    </div>\\n  );\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./components/marketplace/AddToCartButton.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\n/**\\n * KYNAR UNIVERSE: Add To Cart Button (v2.3.2)\\n * Fix: Explicitly mapped to lib/supabase/types.ts per user file structure.\\n */\\n\\nimport { useState, useEffect, type MouseEvent } from \\\"react\\\";\\nimport { Plus, Check, Lock, Loader2 } from \\\"lucide-react\\\";\\nimport { useCartItems, useCartActions } from \\\"@/lib/cart/store\\\";\\nimport { useVault } from \\\"@/lib/store/vault\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\"; // Path verified\\nimport { cn, hapticFeedback } from \\\"@/lib/utils\\\";\\n\\ninterface AddToCartButtonProps {\\n  product: Product;\\n  className?: string;\\n}\\n\\nexport const AddToCartButton = ({ product, className }: AddToCartButtonProps) => {\\n  const [isAdding, setIsAdding] = useState(false);\\n  const [mounted, setMounted] = useState(false);\\n  \\n  const { items } = useCartItems();\\n  const { addItem } = useCartActions();\\n  const { isInVault } = useVault();\\n  \\n  useEffect(() => {\\n    setMounted(true);\\n  }, []);\\n  \\n  const isOwned = mounted ? isInVault(product.id) : false;\\n  const inCart = mounted ? items.some((item) => item.id === product.id) : false;\\n  \\n  const handleAdd = async (e: MouseEvent<HTMLButtonElement>) => {\\n    e.preventDefault();\\n    e.stopPropagation(); \\n    \\n    setIsAdding(true);\\n    hapticFeedback(\\\"light\\\");\\n    \\n    await new Promise((resolve) => setTimeout(resolve, 400));\\n    \\n    addItem(product);\\n    \\n    setIsAdding(false);\\n    hapticFeedback(\\\"success\\\");\\n  };\\n  \\n  if (!mounted) return <div className={cn(\\\"h-12 w-full rounded-xl bg-surface animate-pulse\\\", className)} />;\\n  \\n  if (isOwned) {\\n    return (\\n      <button \\n        disabled \\n        className={cn(\\\"flex w-full items-center justify-center gap-2 rounded-xl bg-kyn-green-50/50 py-3 font-brand text-sm font-bold text-kyn-green-600 cursor-not-allowed\\\", className)}\\n      >\\n        <Lock size={16} /> In Vault\\n      </button>\\n    );\\n  }\\n  \\n  if (inCart) {\\n    return (\\n      <button \\n        disabled \\n        className={cn(\\\"flex w-full items-center justify-center gap-2 rounded-xl bg-kyn-slate-100 py-3 font-brand text-sm font-bold text-kyn-slate-900 cursor-not-allowed\\\", className)}\\n      >\\n        <Check size={16} /> Selected\\n      </button>\\n    );\\n  }\\n  \\n  return (\\n    <button\\n      onClick={handleAdd}\\n      disabled={isAdding}\\n      className={cn(\\n        \\\"group flex w-full items-center justify-center gap-2 rounded-xl bg-kyn-slate-900 py-3 font-brand text-sm font-bold text-white transition-all hover:bg-black active:scale-[0.97] disabled:opacity-70\\\",\\n        className\\n      )}\\n    >\\n      {isAdding ? <Loader2 size={16} className=\\\"animate-spin\\\" /> : <Plus size={16} />}\\n      {isAdding ? \\\"Syncing...\\\" : \\\"Select\\\"}\\n    </button>\\n  );\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./components/marketplace/ProductCard.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Product Card (v1.6)\\n * Role: Primary Discovery & Acquisition unit.\\n * Philosophy: Dual-action - Explore (Link) vs. Select (Button).\\n * Optimization: Mobile-first responsive grid-safe layout; Next.js 15 Ready.\\n */\\n\\nimport Link from \\\"next/link\\\";\\nimport { ArrowUpRight, Compass } from \\\"lucide-react\\\";\\nimport { AddToCartButton } from \\\"./AddToCartButton\\\";\\nimport { formatGBP } from \\\"@/lib/utils\\\";\\nimport { getPriceFromId } from \\\"@/lib/marketplace/pricing\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\";\\nimport Image from \\\"next/image\\\";\\n\\n\\ninterface ProductCardProps {\\n  product: Product;\\n}\\n\\nexport const ProductCard = ({ product }: ProductCardProps) => {\\n  // Determine display price using the hardened Pricing Engine\\n  const priceValue = getPriceFromId(product.price_id);\\n  \\n  return (\\n    <article className=\\\"group relative flex flex-col animate-in fade-in slide-in-from-bottom-3 duration-700 ease-out\\\">\\n      \\n      {/* 1. Visual Stage: Narrative Exploration \\n          The 'aspect-[4/5]' ensures a consistent editorial feel across all screen sizes.\\n      */}\\n      <Link \\n        href={`/products/${product.slug}`} \\n        className=\\\"relative aspect-[4/5] w-full overflow-hidden rounded-3xl bg-surface border border-kyn-slate-50 transition-all duration-500 hover:shadow-kynar-soft\\\"\\n        aria-label={`View details for ${product.title}`}\\n      >\\n        {product.preview_image ? (\\n          <Image \\n            src={product.preview_image} \\n            alt={product.title} \\n            fill\\n            sizes=\\\"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw\\\"\\n            loading=\\\"lazy\\\"\\n            className=\\\"object-cover transition-transform duration-1000 ease-kyn-out group-hover:scale-105\\\"\\n          />\\n        ) : (\\n          <div className=\\\"flex h-full w-full items-center justify-center bg-kyn-slate-50 text-kyn-slate-200\\\">\\n            <Compass size={48} strokeWidth={1} />\\n          </div>\\n        )}\\n\\n\\n        {/* Discovery Overlay: Subtle atmospheric gradient for readability */}\\n        <div className=\\\"absolute inset-0 bg-gradient-to-t from-kyn-slate-900/40 via-transparent to-transparent opacity-0 transition-opacity duration-500 group-hover:opacity-100\\\" />\\n        \\n        {/* Floating Indicator: Signals depth to the user */}\\n        <div className=\\\"absolute right-4 top-4 flex h-10 w-10 items-center justify-center rounded-full bg-white/90 backdrop-blur-md text-kyn-slate-900 shadow-sm opacity-0 -translate-y-2 transition-all duration-500 group-hover:opacity-100 group-hover:translate-y-0\\\">\\n          <ArrowUpRight size={20} />\\n        </div>\\n\\n        {/* Grounded Price Badge */}\\n        <div className=\\\"absolute left-4 bottom-4 rounded-xl bg-kyn-slate-900/80 backdrop-blur-md px-3 py-1.5 font-brand text-[11px] font-bold text-white tracking-tight\\\">\\n          {priceValue === 0 ? \\\"Complimentary\\\" : formatGBP(priceValue)}\\n        </div>\\n      </Link>\\n\\n      {/* 2. Content & Acquisition Zone \\n          Decoupled from the main Link to prevent accidental navigation.\\n      */}\\n      <div className=\\\"mt-5 space-y-4 px-1\\\">\\n        <div className=\\\"flex flex-col\\\">\\n          <span className=\\\"font-ui text-[10px] font-bold uppercase tracking-[0.25em] text-kyn-slate-400\\\">\\n            {product.world || \\\"Universal\\\"} World\\n          </span>\\n          <h3 className=\\\"mt-1 font-brand text-lg font-bold text-kyn-slate-900 line-clamp-1\\\">\\n            {product.title}\\n          </h3>\\n        </div>\\n\\n        {/* Transactional Trigger \\n            Integrated with Cart Store, Haptics, and Micro-Celebrations.\\n        */}\\n        <div className=\\\"relative\\\">\\n          <AddToCartButton \\n            product={product} \\n            className=\\\"w-full !py-3.5 text-xs tracking-wider\\\" \\n          />\\n        </div>\\n      </div>\\n    </article>\\n  );\\n};\",\n    \"embedding\": null\n  },\n  \"./components/guides/ReadingProgressBar.tsx\": {\n    \"text\": \"\\\"use client\\\";\\nimport { useEffect, useState } from \\\"react\\\";\\n\\nexport const ReadingProgressBar = () => {\\n  const [progress, setProgress] = useState(0);\\n  \\n  useEffect(() => {\\n    // Guard: Prevent server-side execution\\n    if (typeof window === 'undefined') return;\\n\\n    const updateProgress = () => {\\n      const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;\\n      if (scrollHeight > 0) {\\n        setProgress((window.scrollY / scrollHeight) * 100);\\n      }\\n    };\\n    \\n    window.addEventListener(\\\"scroll\\\", updateProgress);\\n    // Initial check\\n    updateProgress();\\n    \\n    return () => window.removeEventListener(\\\"scroll\\\", updateProgress);\\n  }, []);\\n  \\n  return ( \\n    <div \\n      className=\\\"fixed bottom-0 left-0 h-1 bg-kyn-green-600 transition-all duration-150 z-50\\\"\\n      style={{ width: `${progress}%` }}\\n    />\\n  );\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./components/auth/AuthMessage.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Auth Feedback (v1.0)\\n * Role: Displaying session errors or registration success.\\n */\\n\\n\\\"use client\\\";\\nimport { useSearchParams } from \\\"next/navigation\\\";\\nimport { AlertCircle, CheckCircle2 } from \\\"lucide-react\\\";\\n\\nexport function AuthMessage() {\\n  const searchParams = useSearchParams();\\n  const error = searchParams.get(\\\"error\\\");\\n  const message = searchParams.get(\\\"message\\\");\\n\\n  if (!error && !message) return null;\\n\\n  return (\\n    <div className=\\\"mb-6 animate-in fade-in slide-in-from-top-2 duration-300\\\">\\n      {error && (\\n        <div className=\\\"flex items-center gap-3 rounded-xl border border-red-100 bg-red-50 p-4 text-red-700\\\">\\n          <AlertCircle size={18} />\\n          <p className=\\\"font-ui text-xs font-medium\\\">{error}</p>\\n        </div>\\n      )}\\n      {message && (\\n        <div className=\\\"flex items-center gap-3 rounded-xl border border-kyn-green-100 bg-kyn-green-50 p-4 text-kyn-green-700\\\">\\n          <CheckCircle2 size={18} />\\n          <p className=\\\"font-ui text-xs font-medium\\\">{message}</p>\\n        </div>\\n      )}\\n    </div>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./components/layout/Navigation.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\nimport { useState, useEffect } from \\\"react\\\";\\nimport Link from \\\"next/link\\\";\\nimport { usePathname } from \\\"next/navigation\\\";\\nimport { ShoppingBag, User, Compass, LayoutGrid } from \\\"lucide-react\\\";\\nimport { useCartItems } from \\\"@/lib/cart/store\\\";\\nimport { useUIStore } from \\\"@/lib/store/ui\\\";\\nimport { cn } from \\\"@/lib/utils\\\";\\n// Import the generated types to ensure the profile row is strictly typed\\nimport { Database } from \\\"@/lib/supabase/types\\\";\\n\\ntype Profile = Database['public']['Tables']['profiles']['Row'];\\n\\ninterface NavigationProps {\\n  initialProfile?: Profile | null; \\n}\\n\\nexport const Navigation = ({ initialProfile }: NavigationProps) => {\\n  const pathname = usePathname();\\n  const [mounted, setMounted] = useState(false);\\n  \\n  const { \\n    isSelectionOpen, \\n    openSelection, \\n    isUserMenuOpen, \\n    toggleUserMenu \\n  } = useUIStore();\\n  \\n  const { count } = useCartItems();\\n  \\n  // Prevent hydration mismatch for client-side state (cart count)\\n  useEffect(() => {\\n    setMounted(true);\\n  }, []);\\n  \\n  const navLinks = [\\n    { name: \\\"Store\\\", href: \\\"/store\\\", icon: Compass },\\n    { name: \\\"Library\\\", href: \\\"/library\\\", icon: LayoutGrid },\\n  ];\\n  \\n  return (\\n    <nav className=\\\"fixed bottom-0 left-0 z-[60] w-full border-t border-border bg-canvas/90 pb-safe-bottom backdrop-blur-xl md:hidden\\\">\\n      <div className=\\\"mx-auto flex h-16 max-w-screen-xl items-center justify-around px-gutter\\\">\\n        \\n        {/* DYNAMIC NAV LINKS */}\\n        {navLinks.map((link) => {\\n          const isActive = pathname === link.href && !isUserMenuOpen && !isSelectionOpen;\\n          const Icon = link.icon;\\n\\n          return (\\n            <Link\\n              key={link.href}\\n              href={link.href}\\n              className={cn(\\n                \\\"group relative flex flex-col items-center gap-1 transition-all active:scale-90\\\",\\n                isActive ? \\\"text-kyn-slate-900\\\" : \\\"text-kyn-slate-400\\\"\\n              )}\\n            >\\n              <Icon \\n                size={20} \\n                strokeWidth={isActive ? 2.5 : 2}\\n                className={cn(\\\"transition-colors\\\", isActive && \\\"text-kyn-green-600\\\")} \\n              />\\n              <span className=\\\"font-brand text-[9px] font-black uppercase tracking-[0.15em]\\\">\\n                {link.name}\\n              </span>\\n              {isActive && (\\n                <span className=\\\"absolute -bottom-1 h-1 w-1 rounded-full bg-kyn-green-500\\\" />\\n              )}\\n            </Link>\\n          );\\n        })}\\n\\n        {/* SELECTION / CART TRIGGER */}\\n        <button\\n          onClick={openSelection}\\n          className={cn(\\n            \\\"group relative flex flex-col items-center gap-1 transition-all active:scale-90 outline-none\\\",\\n            isSelectionOpen ? \\\"text-kyn-green-600\\\" : \\\"text-kyn-slate-400\\\"\\n          )}\\n        >\\n          <div className=\\\"relative\\\">\\n            <ShoppingBag size={20} strokeWidth={isSelectionOpen ? 2.5 : 2} />\\n            {mounted && count > 0 && (\\n              <span className=\\\"absolute -right-2.5 -top-1.5 flex h-4 w-4 animate-in zoom-in duration-300 items-center justify-center rounded-full bg-kyn-slate-900 font-ui text-[8px] font-bold text-white border-2 border-canvas\\\">\\n                {count}\\n              </span>\\n            )}\\n          </div>\\n          <span className=\\\"font-brand text-[9px] font-black uppercase tracking-[0.15em]\\\">\\n            Selection\\n          </span>\\n        </button>\\n\\n        {/* IDENTITY / USER MENU TRIGGER */}\\n        <button\\n          onClick={toggleUserMenu}\\n          className={cn(\\n            \\\"group relative flex flex-col items-center gap-1 transition-all active:scale-90 outline-none\\\",\\n            isUserMenuOpen ? \\\"text-kyn-slate-900\\\" : \\\"text-kyn-slate-400\\\"\\n          )}\\n        >\\n          <div className=\\\"relative\\\">\\n            <User size={20} strokeWidth={isUserMenuOpen ? 2.5 : 2} />\\n            \\n            {/* IDENTITY INDICATOR:\\n                Only shows if user is logged in (initialProfile exists), \\n                component is mounted, and menu is currently closed.\\n            */}\\n            {mounted && initialProfile && !isUserMenuOpen && (\\n              <span className=\\\"absolute -right-0.5 -top-0.5 h-1.5 w-1.5 rounded-full bg-kyn-green-500 ring-2 ring-canvas\\\" />\\n            )}\\n          </div>\\n          <span className=\\\"font-brand text-[9px] font-black uppercase tracking-[0.15em]\\\">\\n            Identity\\n          </span>\\n          {isUserMenuOpen && (\\n            <span className=\\\"absolute -bottom-1 h-1 w-1 rounded-full bg-kyn-slate-900\\\" />\\n          )}\\n        </button>\\n      </div>\\n    </nav>\\n  );\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./components/layout/UserMenu.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\nimport { useState, useEffect } from \\\"react\\\";\\nimport Link from \\\"next/link\\\";\\nimport { \\n  Shield, Library, Settings, LogOut, X, \\n  ArrowRight, Loader2, Mail, Lock, ChevronLeft \\n} from \\\"lucide-react\\\";\\nimport { login, signup, logout } from \\\"@/app/auth/actions\\\";\\nimport { AuthMessage } from \\\"../auth/AuthMessage\\\";\\nimport { useFormStatus } from \\\"react-dom\\\";\\nimport { Suspense } from \\\"react\\\";\\nimport { useUIStore } from \\\"@/lib/store/ui\\\";\\nimport { Database } from \\\"@/lib/supabase/types\\\";\\n\\n// Get the specific Row type for your profiles table\\ntype Profile = Database['public']['Tables']['profiles']['Row'];\\n\\nexport default function UserMenu({ user }: { user: Profile | null }) {\\n  const isOpen = useUIStore((state) => state.isUserMenuOpen);\\n  const closeUserMenu = useUIStore((state) => state.closeUserMenu);\\n  \\n  const [view, setView] = useState<'gateway' | 'login' | 'register' | 'user-menu'>(\\n    user ? 'user-menu' : 'gateway'\\n  );\\n\\n  useEffect(() => {\\n    if (user) setView('user-menu');\\n    else if (view === 'user-menu') setView('gateway');\\n  }, [user, view]);\\n\\n  if (!isOpen) return null;\\n\\n  const closeAll = () => {\\n    closeUserMenu();\\n    if (!user) setTimeout(() => setView('gateway'), 300);\\n  };\\n\\n  return (\\n    <div className=\\\"fixed inset-0 z-[200] flex items-center justify-center p-4 md:p-6\\\">\\n      \\n      <div \\n        className=\\\"absolute inset-0 bg-kyn-slate-900/60 backdrop-blur-md animate-in fade-in duration-500\\\" \\n        onClick={closeAll} \\n      />\\n\\n      <div className=\\\"relative w-full max-w-[400px] overflow-hidden rounded-[2.5rem] border border-white/20 bg-white p-8 shadow-2xl animate-in zoom-in-95 fade-in slide-in-from-bottom-8 duration-500 ease-out\\\">\\n        \\n        <div className=\\\"absolute left-8 top-8 flex items-center gap-4 z-10\\\">\\n          {view !== 'gateway' && view !== 'user-menu' && (\\n            <button \\n              onClick={() => setView('gateway')}\\n              className=\\\"flex h-8 w-8 items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:text-slate-900 transition-colors\\\"\\n            >\\n              <ChevronLeft size={18} />\\n            </button>\\n          )}\\n        </div>\\n\\n        <button \\n          onClick={closeAll} \\n          className=\\\"absolute right-8 top-8 flex h-8 w-8 items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:text-slate-900 transition-colors z-10\\\"\\n        >\\n          <X size={18} />\\n        </button>\\n\\n        <div className=\\\"mt-4\\\">\\n          <Suspense fallback={null}>\\n              <AuthMessage />\\n          </Suspense>\\n        </div>\\n\\n        {(!user && view === 'gateway') && (\\n            <div className=\\\"flex flex-col gap-4 py-4 animate-in fade-in slide-in-from-bottom-2 duration-300\\\">\\n              <div className=\\\"text-center mb-6\\\">\\n                  <h3 className=\\\"font-bold text-3xl text-slate-900 tracking-tight\\\">Access Portal</h3>\\n                  <p className=\\\"text-sm text-slate-500 mt-2\\\">Identify yourself to proceed.</p>\\n              </div>\\n              <button \\n                onClick={() => setView('login')} \\n                className=\\\"group w-full py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 transition-all active:scale-[0.98] flex items-center justify-center gap-2\\\"\\n              >\\n                Sign In <ArrowRight size={16} className=\\\"opacity-50 group-hover:translate-x-1 transition-transform\\\" />\\n              </button>\\n              <button \\n                onClick={() => setView('register')} \\n                className=\\\"w-full py-4 border border-slate-200 text-slate-900 rounded-2xl font-bold hover:bg-slate-50 transition-all active:scale-[0.98]\\\"\\n              >\\n                Register Identity\\n              </button>\\n            </div>\\n        )}\\n\\n        {view === 'login' && (\\n            <form action={login} className=\\\"space-y-5 animate-in fade-in slide-in-from-right-4 duration-300\\\">\\n              <div className=\\\"mb-6\\\">\\n                  <h3 className=\\\"text-2xl font-bold text-slate-900\\\">Sign In</h3>\\n                  <p className=\\\"text-xs text-slate-400 uppercase tracking-widest mt-1\\\">Initialize Session</p>\\n              </div>\\n              <div className=\\\"space-y-4\\\">\\n                  <div className=\\\"relative group\\\">\\n                    <Mail className=\\\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\\\" size={16} />\\n                    <input name=\\\"email\\\" type=\\\"email\\\" required placeholder=\\\"Email Address\\\" className=\\\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\\\" />\\n                  </div>\\n                  <div className=\\\"relative group\\\">\\n                    <Lock className=\\\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\\\" size={16} />\\n                    <input name=\\\"password\\\" type=\\\"password\\\" required placeholder=\\\"Access Key\\\" className=\\\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\\\" />\\n                  </div>\\n              </div>\\n              <SubmitButton label=\\\"Initialize Session\\\" />\\n            </form>\\n        )}\\n\\n        {view === 'register' && (\\n            <form action={signup} className=\\\"space-y-5 animate-in fade-in slide-in-from-right-4 duration-300\\\">\\n              <div className=\\\"mb-6\\\">\\n                  <h3 className=\\\"text-2xl font-bold text-slate-900\\\">Register</h3>\\n                  <p className=\\\"text-xs text-slate-400 uppercase tracking-widest mt-1\\\">Create Identity</p>\\n              </div>\\n              <div className=\\\"space-y-4\\\">\\n                  <div className=\\\"relative group\\\">\\n                    <Mail className=\\\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\\\" size={16} />\\n                    <input name=\\\"email\\\" type=\\\"email\\\" required placeholder=\\\"Email Address\\\" className=\\\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\\\" />\\n                  </div>\\n                  <div className=\\\"relative group\\\">\\n                    <Lock className=\\\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\\\" size={16} />\\n                    <input name=\\\"password\\\" type=\\\"password\\\" required placeholder=\\\"Create Password\\\" className=\\\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\\\" />\\n                  </div>\\n              </div>\\n              <SubmitButton label=\\\"Create Identity\\\" />\\n            </form>\\n        )}\\n\\n        {(user && view === 'user-menu') && (\\n            <div className=\\\"flex flex-col gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300\\\">\\n              <div className=\\\"mb-6 text-center\\\">\\n                  <p className=\\\"text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-1\\\">Identity Active</p>\\n                  <div className=\\\"inline-block px-4 py-1.5 rounded-full bg-slate-50 border border-slate-200\\\">\\n                    {/* Note: In your DB 'profiles' table, verify if email exists or use another field */}\\n                    <p className=\\\"font-bold text-slate-900 truncate max-w-[200px] text-sm\\\">{user?.id}</p>\\n                  </div>\\n              </div>\\n              \\n              <div className=\\\"grid grid-cols-1 gap-2\\\">\\n                <MenuButton href=\\\"/account\\\" icon={Shield} label=\\\"Account\\\" onClick={closeAll} />\\n                <MenuButton href=\\\"/library\\\" icon={Library} label=\\\"Library\\\" onClick={closeAll} />\\n                <MenuButton href=\\\"/account/settings\\\" icon={Settings} label=\\\"Settings\\\" onClick={closeAll} />\\n              </div>\\n\\n              <form action={logout} className=\\\"mt-4\\\">\\n                  <button type=\\\"submit\\\" className=\\\"w-full flex items-center justify-center gap-3 py-4 rounded-2xl bg-red-50 text-red-600 font-bold hover:bg-red-100 transition-colors active:scale-95\\\">\\n                    <LogOut size={18} /> Terminate Session\\n                  </button>\\n              </form>\\n            </div>\\n        )}\\n      </div>\\n    </div>\\n  );\\n}\\n\\nfunction SubmitButton({ label }: { label: string }) {\\n  const { pending } = useFormStatus();\\n  return (\\n    <button disabled={pending} type=\\\"submit\\\" className=\\\"w-full flex items-center justify-center gap-2 py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 transition-all disabled:opacity-70 active:scale-[0.98] shadow-lg shadow-slate-900/10\\\">\\n      {pending ? <Loader2 size={18} className=\\\"animate-spin\\\" /> : <>{label} <ArrowRight size={16} /></>}\\n    </button>\\n  );\\n}\\n\\nfunction MenuButton({ href, icon: Icon, label, onClick }: { href: string, icon: any, label: string, onClick: () => void }) {\\n  return (\\n    <Link href={href} onClick={onClick} className=\\\"flex items-center gap-4 px-6 py-4 rounded-2xl bg-slate-50 border border-transparent hover:border-slate-200 hover:bg-white text-slate-900 font-bold transition-all active:scale-[0.98]\\\">\\n      <Icon size={18} className=\\\"text-slate-400\\\" /> {label}\\n    </Link>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./components/layout/Breadcrumbs.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\n/* KYNAR UNIVERSE: components/layout/Breadcrumbs.tsx */\\n\\nimport Link from \\\"next/link\\\";\\nimport { ChevronRight } from \\\"lucide-react\\\";\\nimport { cn } from \\\"@/lib/utils\\\";\\n\\ninterface Path {\\n  label: string;\\n  href: string;\\n}\\n\\nexport const Breadcrumbs = ({ paths }: { paths: Path[] }) => {\\n  return (\\n    <nav className=\\\"flex items-center gap-2 overflow-x-auto no-scrollbar whitespace-nowrap px-gutter py-4 text-[11px] font-bold uppercase tracking-widest\\\">\\n      <Link \\n        href=\\\"/\\\" \\n        className=\\\"text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\\\"\\n      >\\n        Universe\\n      </Link>\\n      \\n      {paths.map((path, index) => (\\n        <div key={path.href} className=\\\"flex items-center gap-2\\\">\\n          <ChevronRight size={10} className=\\\"text-kyn-slate-300 shrink-0\\\" />\\n          <Link \\n            href={path.href} \\n            className={cn(\\n              \\\"transition-colors\\\",\\n              index === paths.length - 1 \\n                ? \\\"text-kyn-slate-900 cursor-default\\\" \\n                : \\\"text-kyn-slate-400 hover:text-kyn-slate-900\\\"\\n            )}\\n          >\\n            {path.label}\\n          </Link>\\n        </div>\\n      ))}\\n    </nav>\\n  );\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./components/layout/RealtimeListener.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\nimport { useVaultRealtime } from \\\"@/hooks/use-vault-realtime\\\";\\n\\nexport function RealtimeListener({ userId }: { userId: string | undefined }) {\\n  useVaultRealtime(userId);\\n  return null; // This component doesn't render anything, it just listens\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./components/layout/Footer.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\n/* KYNAR UNIVERSE: Final Anchor (v1.6) */\\n\\nimport Link from \\\"next/link\\\";\\nimport { Compass, ArrowUpRight } from \\\"lucide-react\\\";\\n\\nexport const Footer = () => {\\n  const currentYear = new Date().getFullYear();\\n\\n  return (\\n    <footer className=\\\"mt-auto border-t border-kyn-slate-50 bg-white px-gutter pt-20 pb-40 md:pb-20\\\">\\n      <div className=\\\"mx-auto max-w-screen-xl\\\">\\n        <div className=\\\"grid grid-cols-1 gap-16 md:grid-cols-4\\\">\\n          \\n          {/* Brand Philosophy Block */}\\n          <div className=\\\"md:col-span-2 space-y-6\\\">\\n            <Link href=\\\"/\\\" className=\\\"flex items-center gap-3 group w-fit\\\">\\n              <div className=\\\"flex h-10 w-10 items-center justify-center rounded-xl bg-kyn-slate-900 text-white transition-transform group-hover:rotate-12\\\">\\n                <Compass size={20} />\\n              </div>\\n              <span className=\\\"font-brand text-xl font-bold tracking-tighter text-kyn-slate-900\\\">\\n                KYNAR<span className=\\\"text-kyn-slate-400\\\">UNIVERSE</span>\\n              </span>\\n            </Link>\\n            <p className=\\\"font-ui text-sm text-text-secondary leading-relaxed max-w-sm\\\">\\n              Engineered for digital permanence. We build frameworks and tools \\n              designed to ground your creative and technical life in the UK and beyond.\\n            </p>\\n            <div className=\\\"flex items-center gap-2\\\">\\n              <div className=\\\"h-1.5 w-1.5 rounded-full bg-kyn-green-500 animate-pulse\\\" />\\n              <span className=\\\"font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\\\">\\n                System Active â€¢ London\\n              </span>\\n            </div>\\n          </div>\\n\\n          {/* Navigation Matrix */}\\n          <div className=\\\"grid grid-cols-2 gap-8 md:col-span-2\\\">\\n            <FooterGroup \\n              title=\\\"Explore\\\" \\n              links={[\\n                { label: 'Marketplace', href: '/store' },\\n                { label: 'Library', href: '/library' },\\n                { label: 'Briefings', href: '/guides' },\\n                { label: 'Changelog', href: '/updates' }\\n              ]} \\n            />\\n            <FooterGroup \\n              title=\\\"Identity\\\" \\n              links={[\\n                { label: 'Privacy Protocol', href: '/privacy' },\\n                { label: 'Terms of Service', href: '/terms' },\\n                { label: 'Support Gate', href: '/support' },\\n                { label: 'Account', href: '/account' }\\n              ]} \\n            />\\n          </div>\\n        </div>\\n\\n        {/* Bottom Bar: Copyright & Location */}\\n        <div className=\\\"mt-20 pt-8 border-t border-kyn-slate-50 flex flex-col md:flex-row justify-between items-start md:items-center gap-6\\\">\\n          <p className=\\\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400\\\">\\n            Â© {currentYear} Kynar Universe â€¢ Technical Integrity Reserved\\n          </p>\\n          \\n          <button \\n            onClick={() => typeof window.scrollTo({ top: 0, behavior: 'smooth' })}\\n            className=\\\"group flex items-center gap-2 font-brand text-[10px] font-bold uppercase tracking-widest text-kyn-slate-900 hover:text-kyn-green-600 transition-colors\\\"\\n          >\\n            Ascend to Top\\n            <ArrowUpRight size={14} className=\\\"transition-transform group-hover:-translate-y-0.5 group-hover:translate-x-0.5\\\" />\\n          </button>\\n        </div>\\n      </div>\\n    </footer>\\n  );\\n}\\n\\ninterface FooterGroupProps {\\n  title: string;\\n  links: { label: string; href: string; }[];\\n}\\n\\nfunction FooterGroup({ title, links }: FooterGroupProps) {\\n  return (\\n    <div className=\\\"flex flex-col gap-6\\\">\\n      <span className=\\\"font-brand text-[10px] font-black uppercase tracking-[0.2em] text-kyn-slate-900\\\">\\n        {title}\\n      </span>\\n      <nav className=\\\"flex flex-col gap-4\\\">\\n        {links.map(link => (\\n          <Link \\n            key={link.label} \\n            href={link.href} \\n            className=\\\"font-ui text-sm text-text-secondary hover:text-kyn-slate-900 hover:translate-x-1 transition-all duration-300\\\"\\n          >\\n            {link.label}\\n          </Link>\\n        ))}\\n      </nav>\\n    </div>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./components/layout/PresenceBar.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\nimport { useEffect, useState } from \\\"react\\\";\\nimport Link from \\\"next/link\\\";\\nimport { ShoppingBag, Fingerprint, User } from \\\"lucide-react\\\";\\nimport { cn } from \\\"@/lib/utils\\\";\\nimport { createClient } from \\\"@/lib/supabase/browser\\\";\\nimport { useCartItems } from \\\"@/lib/cart/store\\\";\\nimport { useUIStore } from \\\"@/lib/store/ui\\\";\\nimport { Database } from \\\"@/lib/supabase/types\\\";\\n\\ntype Profile = Database['public']['Tables']['profiles']['Row'];\\n\\ninterface PresenceBarProps {\\n  initialProfile?: Profile | null;\\n  context?: string; \\n}\\n\\nexport const PresenceBar = ({ initialProfile, context = \\\"Universe\\\" }: PresenceBarProps) => {\\n  const [profile, setProfile] = useState<Profile | null>(initialProfile || null);\\n  const [mounted, setMounted] = useState(false);\\n  \\n  const { openSelection, toggleUserMenu, isUserMenuOpen } = useUIStore();\\n  const { count } = useCartItems();\\n\\n  useEffect(() => {\\n    setMounted(true);\\n    const supabase = createClient();\\n    \\n    // Fixed: Explicitly typed parameters to satisfy build linting\\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (_event: any, session: any) => {\\n      if (session?.user) {\\n        const { data } = await supabase\\n          .from(\\\"profiles\\\")\\n          .select(\\\"*\\\")\\n          .eq(\\\"id\\\", session.user.id)\\n          .single();\\n        if (data) setProfile(data as Profile);\\n      } else {\\n        setProfile(null);\\n      }\\n    });\\n\\n    return () => subscription.unsubscribe();\\n  }, []); \\n\\n  const selectionCount = mounted ? count : 0;\\n  const isUserActive = mounted && profile;\\n\\n  return (\\n    <header className=\\\"sticky top-0 z-[70] flex h-16 items-center justify-between border-b border-border bg-canvas/80 px-gutter backdrop-blur-xl transition-all duration-500\\\">\\n      <Link href=\\\"/\\\" className=\\\"flex items-center gap-3 group\\\">\\n        <div className=\\\"flex h-7 w-7 items-center justify-center rounded bg-kyn-slate-900 text-white transition-transform group-hover:rotate-6 shadow-sm\\\">\\n          <Fingerprint size={14} strokeWidth={2.5} />\\n        </div>\\n        <span className=\\\"font-brand text-sm font-black uppercase tracking-[0.25em] text-kyn-slate-900\\\">\\n          KYNAR\\n        </span>\\n      </Link>\\n      \\n      <div className=\\\"flex items-center gap-2 md:gap-3\\\">\\n        <span className=\\\"hidden xs:block text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400 font-ui\\\">\\n          {context}\\n        </span>\\n        <div className=\\\"hidden xs:block h-3 w-[1px] bg-border mx-1\\\" />\\n\\n        <button \\n          onClick={openSelection}\\n          className={cn(\\n            \\\"relative flex h-10 w-10 items-center justify-center rounded-xl transition-all active:scale-95\\\",\\n            selectionCount > 0 \\n              ? \\\"bg-kyn-green-500 text-white shadow-lg shadow-kyn-green-500/20\\\" \\n              : \\\"bg-surface text-kyn-slate-400 border border-border hover:border-kyn-slate-200\\\"\\n          )}\\n        >\\n          <ShoppingBag size={16} strokeWidth={2.5} />\\n          {selectionCount > 0 && (\\n            <span className=\\\"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-kyn-slate-900 text-[8px] font-bold text-white border-2 border-canvas\\\">\\n              {selectionCount}\\n            </span>\\n          )}\\n        </button>\\n\\n        <button \\n          onClick={toggleUserMenu}\\n          className={cn(\\n            \\\"group relative flex h-10 w-10 items-center justify-center rounded-xl border transition-all active:scale-90\\\",\\n            isUserMenuOpen \\n              ? \\\"bg-kyn-slate-900 text-white border-kyn-slate-900 shadow-lg\\\" \\n              : \\\"bg-surface border-border text-kyn-slate-400 hover:border-kyn-slate-900/20\\\"\\n          )}\\n        >\\n          <User size={16} strokeWidth={2.5} />\\n          {isUserActive && (\\n            <span className=\\\"absolute right-2.5 top-2.5 flex h-1.5 w-1.5\\\">\\n              <span className=\\\"absolute inline-flex h-full w-full animate-ping rounded-full bg-kyn-green-400 opacity-75\\\"></span>\\n              <span className=\\\"relative inline-flex h-1.5 w-1.5 rounded-full bg-kyn-green-500\\\"></span>\\n            </span>\\n          )}\\n        </button>\\n      </div>\\n    </header>\\n  );\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./components/account/SettingsForm.tsx\": {\n    \"text\": \"// @ts-nocheck\\n\\\"use client\\\";\\n\\nimport { useState } from \\\"react\\\";\\nimport { createClient } from \\\"@/lib/supabase/browser\\\";\\nimport { User, Profile } from \\\"@/lib/supabase/types\\\";\\nimport { Loader2 } from \\\"lucide-react\\\";\\nimport { toast } from \\\"react-hot-toast\\\";\\n\\ninterface SettingsFormProps {\\n  user: User;\\n  profile: Profile;\\n}\\n\\nexport function SettingsForm({ user, profile }: SettingsFormProps) {\\n  const supabase = createClient();\\n  \\n  const [loading, setLoading] = useState(false);\\n  const [name, setName] = useState(profile.full_name ?? \\\"\\\");\\n  \\n  const handleUpdate = async () => {\\n    if (!name.trim()) {\\n      toast.error(\\\"Name cannot be empty\\\");\\n      return;\\n    }\\n    \\n    setLoading(true);\\n    \\n    const { error } = await supabase\\n      .from(\\\"profiles\\\")\\n      .update({\\n        full_name: name.trim(),\\n        updated_at: new Date().toISOString(),\\n      })\\n      .eq(\\\"id\\\", user.id);\\n    \\n    if (error) {\\n      toast.error(\\\"Update failed\\\");\\n      console.error(\\\"[SettingsForm] Update error:\\\", error.message);\\n    } else {\\n      toast.success(\\\"Profile synchronized\\\");\\n    }\\n    \\n    setLoading(false);\\n  };\\n  \\n  return (\\n    <div className=\\\"space-y-8\\\">\\n      <div className=\\\"space-y-4\\\">\\n        <label className=\\\"text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\\\">\\n          Full Identity\\n        </label>\\n        <input\\n          value={name}\\n          onChange={(e) => setName(e.target.value)}\\n          placeholder=\\\"Your full name\\\"\\n          className=\\\"w-full rounded-xl border border-border bg-white p-4 font-ui\\n                     focus:ring-2 focus:ring-kyn-green-500 outline-none transition-all\\\"\\n        />\\n      </div>\\n\\n      <button\\n        onClick={handleUpdate}\\n        disabled={loading}\\n        className=\\\"w-full flex items-center justify-center gap-3\\n                   bg-kyn-slate-900 text-white py-4 rounded-xl font-brand font-bold\\n                   hover:bg-black disabled:opacity-50 transition-all active:scale-[0.98]\\\"\\n      >\\n        {loading ? (\\n          <Loader2 className=\\\"h-5 w-5 animate-spin\\\" />\\n        ) : (\\n          \\\"Save Changes\\\"\\n        )}\\n      </button>\\n    </div>\\n  );\\n}\",\n    \"embedding\": null\n  },\n  \"./lib/utils.ts\": {\n    \"text\": \"import { type ClassValue, clsx } from \\\"clsx\\\";\\nimport { twMerge } from \\\"tailwind-merge\\\";\\n\\n/**\\n * Tailwind-safe class merger\\n */\\nexport function cn(...inputs: ClassValue[]): string {\\n  return twMerge(clsx(inputs));\\n}\\n\\n/**\\n * Centralized GBP Formatter\\n * Adjusted to 2 decimal places to match your store's pricing.\\n */\\nexport const formatGBP = (amount: number): string => {\\n  return new Intl.NumberFormat(\\\"en-GB\\\", {\\n    style: \\\"currency\\\",\\n    currency: \\\"GBP\\\",\\n    minimumFractionDigits: 2,\\n    maximumFractionDigits: 2,\\n  }).format(amount);\\n};\\n\\n/**\\n * iOS-Safe Haptics\\n */\\nexport const hapticFeedback = (\\n  intensity: \\\"light\\\" | \\\"medium\\\" | \\\"success\\\" = \\\"light\\\"\\n): void => {\\n  if (\\n    typeof window === \\\"undefined\\\" ||\\n    typeof navigator === \\\"undefined\\\" ||\\n    !navigator.vibrate\\n  ) {\\n    return;\\n  }\\n\\n  try {\\n    switch (intensity) {\\n      case \\\"light\\\":\\n        navigator.vibrate(10);\\n        break;\\n      case \\\"medium\\\":\\n        navigator.vibrate(20);\\n        break;\\n      case \\\"success\\\":\\n        navigator.vibrate([10, 30, 10]);\\n        break;\\n    }\\n  } catch {\\n    // Silent fail\\n  }\\n};\\n\\n/**\\n * Utility to lock scroll when Modals/Overlays are open\\n */\\nexport const lockScroll = (lock: boolean) => {\\n  if (typeof document === 'undefined') return;\\n  document.body.style.overflow = lock ? 'hidden' : 'unset';\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./lib/lemon-squeezy/checkout.ts\": {\n    \"text\": \"import { Product } from \\\"@/lib/supabase/types\\\";\\n\\ninterface CheckoutConfig {\\n  products: Product[];\\n  userEmail: string;\\n  userId: string;\\n  config ? : { redirectUrl ? : string };\\n  metadata ? : Record < string,\\n  any > ;\\n}\\n\\nexport async function generateCheckoutUrl({\\n  products,\\n  userEmail,\\n  userId,\\n  config,\\n  metadata\\n}: CheckoutConfig): Promise < string > {\\n  const API_KEY = process.env.LEMONSQUEEZY_API_KEY;\\n  const STORE_ID = process.env.LEMONSQUEEZY_STORE_ID;\\n  \\n  // Use Netlify's URL env var if available, fall back to public site URL\\n  const SITE_URL = process.env.URL || process.env.NEXT_PUBLIC_SITE_URL;\\n  \\n  if (!API_KEY || !STORE_ID || !SITE_URL) {\\n    throw new Error(\\\"Payment gateway or Site URL configuration missing.\\\");\\n  }\\n  \\n  const validProducts = products.filter(p => p.price_id && p.price_id !== \\\"0\\\");\\n  \\n  if (validProducts.length === 0) {\\n    throw new Error(\\\"No valid products with price IDs found for checkout.\\\");\\n  }\\n  \\n  const payload = {\\n    data: {\\n      type: \\\"checkouts\\\",\\n      attributes: {\\n        store_id: parseInt(STORE_ID),\\n        variant_id: parseInt(validProducts[0].price_id as string),\\n        checkout_data: {\\n          email: userEmail,\\n          custom: {\\n            user_id: userId,\\n            product_ids: validProducts.map(p => p.id).join(\\\",\\\"),\\n            ...metadata\\n          },\\n        },\\n        product_options: {\\n          redirect_url: config?.redirectUrl || `${SITE_URL}/checkout/success`,\\n        },\\n      },\\n    },\\n  };\\n  \\n  const response = await fetch(\\\"https://api.lemonsqueezy.com/v1/checkouts\\\", {\\n    method: \\\"POST\\\",\\n    headers: {\\n      \\\"Accept\\\": \\\"application/vnd.api+json\\\",\\n      \\\"Content-Type\\\": \\\"application/vnd.api+json\\\",\\n      \\\"Authorization\\\": `Bearer ${API_KEY}`\\n    },\\n    body: JSON.stringify(payload)\\n  });\\n  \\n  const result = await response.json();\\n  \\n  if (!response.ok) {\\n    console.error(\\\"Lemon Squeezy Error:\\\", result);\\n    throw new Error(result.errors?.[0]?.detail || \\\"Failed to generate checkout URL\\\");\\n  }\\n  \\n  return result.data.attributes.url;\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./lib/utils/confetti.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Grounded Celebration (v1.6)\\n * Role: Haptic-visual affirmation utility.\\n * Optimization: Next.js 15 Dynamic Loading + Reduced Motion Safety.\\n */\\n\\ninterface ConfettiOptions {\\n  particleCount?: number;\\n  spread?: number;\\n  origin?: { x?: number; y?: number };\\n  colors?: string[];\\n  ticks?: number;\\n}\\n\\n/**\\n * Triggers a calibrated celebration.\\n * Optimized for mobile-first performance via dynamic browser-only imports.\\n */\\nexport const triggerCelebration = async (\\n  options?: ConfettiOptions\\n): Promise<void> => {\\n  // Guard: Browser-only\\n  if (typeof window === \\\"undefined\\\") return;\\n  \\n  const { default: confetti } = await import(\\\"canvas-confetti\\\");\\n  \\n  const KYNAR_PALETTE = [\\n    \\\"#166534\\\", // Kyn-Green-700\\n    \\\"#C9A07D\\\", // Kyn-Caramel-500\\n    \\\"#0F172A\\\", // Kyn-Slate-900\\n    \\\"#F1F5F9\\\", // Kyn-Slate-100\\n  ];\\n  \\n  confetti({\\n    particleCount: options?.particleCount ?? 40,\\n    spread: options?.spread ?? 70,\\n    origin: options?.origin ?? { y: 0.7 },\\n    colors: options?.colors ?? KYNAR_PALETTE,\\n    ticks: options?.ticks ?? 200,\\n    zIndex: 100,\\n    disableForReducedMotion: true,\\n    gravity: 1.2,\\n    scalar: 0.8,\\n  });\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./lib/cart/store.ts\": {\n    \"text\": \"/* KYNAR UNIVERSE: lib/cart/store.ts */\\n\\\"use client\\\";\\nimport { create } from 'zustand';\\nimport { persist, createJSONStorage, type StateStorage } from 'zustand/middleware';\\nimport { Product } from '@/lib/supabase/types';\\nimport { getPriceFromId } from '../marketplace/pricing';\\nimport { useState, useEffect, useMemo } from 'react';\\n\\n// Define mock storage outside to avoid parsing errors in Turbopack\\nconst mockStorage: StateStorage = {\\n  getItem: () => null,\\n  setItem: () => {},\\n  removeItem: () => {},\\n};\\n\\ninterface CartState {\\n  items: Product[];\\n  isHydrated: boolean;\\n  addItem: (product: Product) => void;\\n  removeItem: (productId: string) => void;\\n  clearCart: () => void;\\n  isInCart: (productId: string) => boolean;\\n  setHydrated: (state: boolean) => void;\\n}\\n\\nexport const useCartStore = create<CartState>()(\\n  persist(\\n    (set, get) => ({\\n      items: [],\\n      isHydrated: false,\\n      addItem: (product: Product) => {\\n        const { items } = get();\\n        if (!items.some((item) => item.id === product.id)) {\\n          set({ items: [...items, product] });\\n        }\\n      },\\n      removeItem: (productId: string) => {\\n        set((state) => ({\\n          items: state.items.filter((item) => item.id !== productId)\\n        }));\\n      },\\n      clearCart: () => set({ items: [] }),\\n      isInCart: (productId: string) => get().items.some((item) => item.id === productId),\\n      setHydrated: (state: boolean) => set({ isHydrated: state }),\\n    }),\\n    {\\n      name: 'kynar-vault-session-v1.6',\\n      storage: createJSONStorage(() => \\n        typeof window !== 'undefined' ? window.localStorage : mockStorage\\n      ),\\n      onRehydrateStorage: () => (state) => state?.setHydrated(true),\\n    }\\n  )\\n);\\n\\nexport function useCartItems() {\\n  const items = useCartStore((state) => state.items);\\n  const isHydrated = useCartStore((state) => state.isHydrated);\\n  const removeItem = useCartStore((state) => state.removeItem);\\n  const [mounted, setMounted] = useState(false);\\n\\n  useEffect(() => {\\n    setMounted(true);\\n  }, []);\\n\\n  const totalPrice = useMemo(() => { \\n    return items.reduce((total, item) => { \\n      const price = getPriceFromId(item.price_id); \\n      return total + (price ?? 0);\\n    }, 0);\\n  }, [items]);\\n  \\n\\n  if (!mounted || !isHydrated) {\\n    return { \\n      items: [], \\n      count: 0, \\n      totalPrice: 0, \\n      isEmpty: true, \\n      removeItem, \\n      updateQuantity: () => {} \\n    };\\n  }\\n\\n  return { \\n    items, \\n    count: items.length, \\n    totalPrice, \\n    isEmpty: items.length === 0, \\n    removeItem,\\n    updateQuantity: () => {} \\n  };\\n}\\n\\nexport function useCartActions() {\\n  const addItem = useCartStore((state) => state.addItem);\\n  const removeItem = useCartStore((state) => state.removeItem);\\n  const clearCart = useCartStore((state) => state.clearCart);\\n  const isInCart = useCartStore((state) => state.isInCart);\\n\\n  return { addItem, removeItem, clearCart, isInCart };\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./lib/marketplace/pricing.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Pricing Engine (v2.1.1)\\n * Role: Deterministic mapping of Lemon Squeezy IDs to numeric values.\\n * Fix: Corrected environment check and enforced strict numeric returns.\\n */\\n\\n/**\\n * Registry of active Lemon Squeezy Price IDs and their GBP values.\\n */\\nconst PRICE_MAP: Record<string, number> = {\\n  // Free / Lead Magnets\\n  'free': 0,\\n  \\n  // Example Tiers\\n  'pri_01hs5xyz...': 5,   \\n  'pri_01hs6abc...': 12,  \\n  'pri_01hs7def...': 25,  \\n  'pri_01hs8ghi...': 45,  \\n};\\n\\nconst FALLBACK_PRICE = 0;\\n\\n/**\\n * IDENTITY: Resolves a Lemon Squeezy Price ID to a numeric value.\\n * Guaranteed to return a number to satisfy tsc --strict arithmetic.\\n */\\nexport function getPriceFromId(priceId: string | null | undefined): number {\\n  if (!priceId) return FALLBACK_PRICE;\\n  \\n  // Direct lookup using indexed access\\n  const price = PRICE_MAP[priceId];\\n\\n  if (price !== undefined) {\\n    return price;\\n  }\\n\\n  // Corrected Environment Check: Use NODE_ENV for build-stage logic\\n  if (process.env.NODE_ENV !== 'production') {\\n    console.warn(`[Pricing Engine] Unknown price_id: ${priceId}. Falling back to 0.`);\\n  }\\n\\n  return FALLBACK_PRICE;\\n}\\n\\n/**\\n * UTILITY: Checks if a product is free based on its ID.\\n */\\nexport function isProductFree(priceId: string | null | undefined): boolean {\\n  return getPriceFromId(priceId) === 0;\\n}\\n\\n/**\\n * SERVER/EDGE: Validation helper for secure checkout sessions.\\n */\\nexport function validatePriceMatch(priceId: string, claimedPrice: number): boolean {\\n  const actualPrice = getPriceFromId(priceId);\\n  return actualPrice === claimedPrice;\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./lib/store/vault.ts\": {\n    \"text\": \"/* KYNAR UNIVERSE: lib/store/vault.ts */\\n\\\"use client\\\";\\nimport { create } from 'zustand';\\nimport { persist, createJSONStorage, type StateStorage } from 'zustand/middleware';\\nimport { Product } from '@/lib/supabase/types';\\nimport { getPriceFromId } from '@/lib/marketplace/pricing';\\nimport { useState, useEffect } from 'react';\\n\\nconst mockStorage: StateStorage = {\\n  getItem: () => null,\\n  setItem: () => {},\\n  removeItem: () => {},\\n};\\n\\ninterface VaultState {\\n  items: Product[];\\n  _hasHydrated: boolean;\\n  addItem: (product: Product) => void;\\n  removeItem: (productId: string) => void;\\n  clearVault: () => void;\\n  setHasHydrated: (state: boolean) => void;\\n}\\n\\nexport const useVaultStore = create<VaultState>()(\\n  persist(\\n    (set, get) => ({\\n      items: [],\\n      _hasHydrated: false,\\n      setHasHydrated: (state) => set({ _hasHydrated: state }),\\n      addItem: (product) => {\\n        const { items } = get();\\n        if (items.some((item) => item.id === product.id)) return;\\n        set({ items: [...items, product] });\\n      },\\n      removeItem: (productId) => \\n        set((state) => ({\\n          items: state.items.filter((item) => item.id !== productId)\\n        })),\\n      clearVault: () => set({ items: [] }),\\n    }),\\n    {\\n      name: 'kynar-vault-storage',\\n      storage: createJSONStorage(() => \\n        typeof window !== 'undefined' ? window.localStorage : mockStorage\\n      ),\\n      onRehydrateStorage: () => (state) => {\\n        state?.setHasHydrated(true);\\n      },\\n    }\\n  )\\n);\\n\\nexport function useVault() {\\n  const items = useVaultStore((state) => state.items);\\n  const hasHydrated = useVaultStore((state) => state._hasHydrated);\\n  const addItem = useVaultStore((state) => state.addItem);\\n  const removeItem = useVaultStore((state) => state.removeItem);\\n  \\n  const [mounted, setMounted] = useState(false);\\n\\n  useEffect(() => {\\n    setMounted(true);\\n  }, []);\\n\\n  if (!mounted || !hasHydrated) {\\n    return {\\n      items: [],\\n      count: 0,\\n      totalValue: 0,\\n      addItem: (_p: Product) => {},\\n      removeItem: (_id: string) => {},\\n      isInVault: (_id: string) => false,\\n    };\\n  }\\n\\n  const totalValue = items.reduce((total, item) => {\\n    const price = getPriceFromId(item.price_id);\\n    return total + (price ?? 0);\\n  }, 0);\\n\\n  return {\\n    items,\\n    count: items.length,\\n    totalValue,\\n    addItem,\\n    removeItem,\\n    isInVault: (id: string) => items.some((item) => item.id === id),\\n  };\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./lib/store/ui.ts\": {\n    \"text\": \"import { create } from 'zustand';\\n\\ninterface UIState {\\n  isSelectionOpen: boolean;\\n  openSelection: () => void;\\n  closeSelection: () => void;\\n  isUserMenuOpen: boolean;\\n  toggleUserMenu: () => void;\\n  closeUserMenu: () => void;\\n  closeAll: () => void;\\n}\\n\\nexport const useUIStore = create<UIState>((set) => ({\\n  isSelectionOpen: false,\\n  isUserMenuOpen: false,\\n\\n  openSelection: () => set({ \\n    isSelectionOpen: true, \\n    isUserMenuOpen: false \\n  }),\\n\\n  closeSelection: () => set({ isSelectionOpen: false }),\\n\\n  toggleUserMenu: () => set((state) => ({ \\n    isUserMenuOpen: !state.isUserMenuOpen,\\n    isSelectionOpen: false \\n  })),\\n\\n  closeUserMenu: () => set({ isUserMenuOpen: false }),\\n\\n  closeAll: () => set({ \\n    isSelectionOpen: false, \\n    isUserMenuOpen: false \\n  }),\\n}));\\n\",\n    \"embedding\": null\n  },\n  \"./lib/content/productCopyExamples.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Calm Copy Templates (v1.6)\\n * Role: The Narrative Engine for the Marketplace.\\n * Guidelines: Plain UK English, no hype, no exclamation marks.\\n * Identity: Grounded, Utility-focused, Professional.\\n */\\n\\nexport interface ProductTemplate {\\n  title: string;\\n  tagline: string;\\n  whoItsFor: string;\\n  included: string[];\\n  philosophy: string;\\n  howItHelps: string;\\n  usage: string;\\n}\\n\\nexport const KYNAR_COPY_LIBRARY: Record<string, ProductTemplate> = {\\n  HOME_ORGANISER: {\\n    title: \\\"Digital Home Organiser\\\",\\n    tagline: \\\"A quiet space to coordinate your daily routines without the noise of typical productivity apps.\\\",\\n    whoItsFor: \\\"Designed for those who seek a simpler, more manual way to organise domestic life.\\\",\\n    included: [\\n      \\\"1 x Comprehensive PDF Guide (Print-ready)\\\",\\n      \\\"1 x Interactive Notion Template (Mobile-Optimised)\\\",\\n      \\\"Setup instructions for offline use\\\",\\n      \\\"Lifetime access to future versions\\\"\\n    ],\\n    philosophy: \\\"Digital life should support your physical reality, not distract from it. We avoid complex automations in favour of intentional, manual entry.\\\",\\n    howItHelps: \\\"By providing a fixed structure for your home data, it removes the 'blank page' anxiety of starting a new system. It focuses on clarity and calm retrieval.\\\",\\n    usage: \\\"Designed for a five-minute daily check-in. No notifications, no pressure. It works whenever you are ready.\\\"\\n  },\\n  \\n  BUDGET_TRACKER: {\\n    title: \\\"Mindful Budget Tracker\\\",\\n    tagline: \\\"A stripped-back financial tool focused on awareness and long-term decisions.\\\",\\n    whoItsFor: \\\"Ideal for those who find automated banking apps overwhelming or 'gamified'.\\\",\\n    included: [\\n      \\\"1 x Excel/Sheets Budgeting Framework\\\",\\n      \\\"1 x Digital Guide on Manual Tracking\\\",\\n      \\\"Monthly review protocols\\\",\\n      \\\"Multi-currency support\\\"\\n    ],\\n    philosophy: \\\"When you track money manually, you feel the weight of your spending. This is a tool for awareness, not just math. It encourages slow, deliberate financial decisions.\\\",\\n    howItHelps: \\\"It strips away the complexity of modern banking apps to show you the truth of your cash flow without the 'gamified' distractions.\\\",\\n    usage: \\\"Update once a week or after major transactions. High-performance utility for long-term stability.\\\"\\n  },\\n\\n  PROJECT_DASHBOARD: {\\n    title: \\\"Project Clarity Dashboard\\\",\\n    tagline: \\\"A minimal framework for moving projects from initial thought to finished reality.\\\",\\n    whoItsFor: \\\"Ideal for independent professionals who want to track progress without the pressure of streaks.\\\",\\n    included: [\\n      \\\"1 x Project Sequencing Framework\\\",\\n      \\\"1 x Visual Progress Board\\\",\\n      \\\"Archive protocols for finished work\\\",\\n      \\\"Native mobile layout\\\"\\n    ],\\n    philosophy: \\\"Projects should have a beginning and an end. This dashboard treats your work as a series of intentional sequences rather than a never-ending 'to-do' list.\\\",\\n    howItHelps: \\\"It provides a 'Single Source of Truth' for your active work, reducing the mental load of switching between different tasks.\\\",\\n    usage: \\\"Check in at the start and end of your work session. Keep your focus narrow and your output high.\\\"\\n  }\\n};\\n\\n/**\\n * Helper to generate full markdown description for Product Pages.\\n * Ensures hydration-safe rendering in prose components.\\n */\\nexport const generateFullDescription = (template: ProductTemplate): string => {\\n  return `\\n# Philosophy\\n${template.philosophy}\\n\\n# How it helps\\n${template.howItHelps}\\n\\n# Usage\\n${template.usage}\\n  `.trim();\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./lib/supabase/browser.ts\": {\n    \"text\": \"import { createBrowserClient } from '@supabase/ssr';\\nimport { Database } from './types';\\n\\nlet client: ReturnType<typeof createBrowserClient<Database>> | undefined;\\n\\nexport const createClient = () => {\\n  if (client) return client;\\n\\n  client = createBrowserClient<Database>(\\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\\n    {\\n      auth: {\\n        flowType: 'pkce',\\n        persistSession: true,\\n        detectSessionInUrl: true,\\n      },\\n    }\\n  );\\n\\n  return client;\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./lib/supabase/server.ts\": {\n    \"text\": \"// lib/supabase/server.ts\\nimport { createServerClient } from '@supabase/ssr'\\nimport { cookies } from 'next/headers'\\nimport { Database } from './types' // Ensure this path is correct\\n\\nexport async function createClient() {\\n  const cookieStore = await cookies()\\n\\n  return createServerClient<Database>(\\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\\n    {\\n      cookies: {\\n        getAll() { return cookieStore.getAll() },\\n        setAll(cookiesToSet) {\\n          try {\\n            cookiesToSet.forEach(({ name, value, options }) =>\\n              cookieStore.set(name, value, options)\\n            )\\n          } catch { /* Middleware handles this in RSC */ }\\n        },\\n      },\\n    }\\n  )\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./lib/supabase/client.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Unified Client Entry (v1.5)\\n * Redirects legacy imports to the evolved Browser Client.\\n */\\nexport { createClient } from './browser';\\n\",\n    \"embedding\": null\n  },\n  \"./lib/supabase/types.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Canonical Type System (v2.3)\\n * Fully aligned with generated Supabase schema + Next.js 15 logic\\n */\\n\\n/* -------------------------------------------------------------------------- */\\n/* 1. Custom App Enums & Consts                                               */\\n/* -------------------------------------------------------------------------- */\\n\\nexport const WORLDS = ['Home', 'Lifestyle', 'Tools'] as const;\\nexport type World = (typeof WORLDS)[number];\\n\\nexport const FILE_TYPES = ['PDF', 'Notion', 'Excel', 'PNG', 'ZIP', 'PWA'] as const;\\nexport type FileType = (typeof FILE_TYPES)[number];\\n\\nexport type GuideCategory = 'usage' | 'spotlight' | 'tips';\\n\\n/* -------------------------------------------------------------------------- */\\n/* 2. Database Schema (Unified with Supabase API Docs)                         */\\n/* -------------------------------------------------------------------------- */\\n\\nexport type Json =\\n  | string\\n  | number\\n  | boolean\\n  | null\\n  | { [key: string]: Json | undefined }\\n  | Json[];\\n\\nexport type Database = {\\n  public: {\\n    Tables: {\\n      guides: {\\n        Row: {\\n          author: string | null;\\n          category: string;\\n          content: string | null;\\n          created_at: string | null;\\n          excerpt: string | null;\\n          id: string;\\n          is_published: boolean | null;\\n          read_time_minutes: number | null;\\n          related_product_ids: string[] | null;\\n          slug: string;\\n          thumbnail_url: string | null;\\n          title: string;\\n          updated_at: string | null;\\n          world: string;\\n        };\\n        Insert: {\\n          author?: string | null;\\n          category: string;\\n          content?: string | null;\\n          created_at?: string | null;\\n          excerpt?: string | null;\\n          id?: string;\\n          is_published?: boolean | null;\\n          read_time_minutes?: number | null;\\n          related_product_ids?: string[] | null;\\n          slug: string;\\n          thumbnail_url?: string | null;\\n          title: string;\\n          updated_at?: string | null;\\n          world: string;\\n        };\\n        Update: {\\n          author?: string | null;\\n          category?: string;\\n          content?: string | null;\\n          created_at?: string | null;\\n          excerpt?: string | null;\\n          id?: string;\\n          is_published?: boolean | null;\\n          read_time_minutes?: number | null;\\n          related_product_ids?: string[] | null;\\n          slug?: string;\\n          thumbnail_url?: string | null;\\n          title?: string;\\n          updated_at?: string | null;\\n          world?: string;\\n        };\\n        Relationships: [];\\n      };\\n      products: {\\n        Row: {\\n          category: string | null;\\n          created_at: string | null;\\n          description: string | null;\\n          download_path: string | null;\\n          file_types: string[] | null;\\n          id: string;\\n          is_published: boolean | null;\\n          lemon_squeezy_id: string | null;\\n          metadata: Json | null;\\n          preview_image: string | null;\\n          price_id: string;\\n          short_description: string | null;\\n          slug: string;\\n          tags: string[] | null;\\n          title: string;\\n          updated_at: string | null;\\n          variant_id: string | null;\\n          world: string;\\n        };\\n        Insert: {\\n          category?: string | null;\\n          created_at?: string | null;\\n          description?: string | null;\\n          download_path?: string | null;\\n          file_types?: string[] | null;\\n          id?: string;\\n          is_published?: boolean | null;\\n          lemon_squeezy_id?: string | null;\\n          metadata?: Json | null;\\n          preview_image?: string | null;\\n          price_id: string;\\n          short_description?: string | null;\\n          slug: string;\\n          tags?: string[] | null;\\n          title: string;\\n          updated_at?: string | null;\\n          variant_id?: string | null;\\n          world: string;\\n        };\\n        Update: {\\n          category?: string | null;\\n          created_at?: string | null;\\n          description?: string | null;\\n          download_path?: string | null;\\n          file_types?: string[] | null;\\n          id?: string;\\n          is_published?: boolean | null;\\n          lemon_squeezy_id?: string | null;\\n          metadata?: Json | null;\\n          preview_image?: string | null;\\n          price_id?: string;\\n          short_description?: string | null;\\n          slug?: string;\\n          tags?: string[] | null;\\n          title?: string;\\n          updated_at?: string | null;\\n          variant_id?: string | null;\\n          world?: string;\\n        };\\n        Relationships: [];\\n      };\\n      profiles: {\\n        Row: {\\n          created_at: string | null;\\n          email: string;\\n          full_name: string | null;\\n          id: string;\\n          is_admin: boolean | null;\\n          updated_at: string | null;\\n        };\\n        Insert: {\\n          created_at?: string | null;\\n          email: string;\\n          full_name?: string | null;\\n          id: string;\\n          is_admin?: boolean | null;\\n          updated_at?: string | null;\\n        };\\n        Update: {\\n          created_at?: string | null;\\n          email?: string;\\n          full_name?: string | null;\\n          id?: string;\\n          is_admin?: boolean | null;\\n          updated_at?: string | null;\\n        };\\n        Relationships: [];\\n      };\\n      purchases: {\\n        Row: {\\n          id: string;\\n          lemon_squeezy_checkout_id: string | null;\\n          lemon_squeezy_order_id: string | null;\\n          product_id: string;\\n          purchase_date: string | null;\\n          status: string;\\n          user_email: string;\\n          user_id: string | null;\\n        };\\n        Insert: {\\n          id?: string;\\n          lemon_squeezy_checkout_id?: string | null;\\n          lemon_squeezy_order_id?: string | null;\\n          product_id: string;\\n          purchase_date?: string | null;\\n          status: string;\\n          user_email: string;\\n          user_id?: string | null;\\n        };\\n        Update: {\\n          id?: string;\\n          lemon_squeezy_checkout_id?: string | null;\\n          lemon_squeezy_order_id?: string | null;\\n          product_id?: string;\\n          purchase_date?: string | null;\\n          status?: string;\\n          user_email?: string;\\n          user_id?: string | null;\\n        };\\n        Relationships: [\\n          {\\n            foreignKeyName: \\\"purchases_product_id_fkey\\\";\\n            columns: [\\\"product_id\\\"];\\n            isOneToOne: false;\\n            referencedRelation: \\\"products\\\";\\n            referencedColumns: [\\\"id\\\"];\\n          }\\n        ];\\n      };\\n      user_library: {\\n        Row: {\\n          acquired_at: string | null;\\n          id: string;\\n          order_id: string | null;\\n          price_id: string | null;\\n          product_id: string;\\n          purchase_price: number | null;\\n          purchased_at: string | null;\\n          source: string | null;\\n          status: string | null;\\n          user_id: string;\\n        };\\n        Insert: {\\n          acquired_at?: string | null;\\n          id?: string;\\n          order_id?: string | null;\\n          price_id?: string | null;\\n          product_id: string;\\n          purchase_price?: number | null;\\n          purchased_at?: string | null;\\n          source?: string | null;\\n          status?: string | null;\\n          user_id: string;\\n        };\\n        Update: {\\n          acquired_at?: string | null;\\n          id?: string;\\n          order_id?: string | null;\\n          price_id?: string | null;\\n          product_id?: string;\\n          purchase_price?: number | null;\\n          purchased_at?: string | null;\\n          source?: string | null;\\n          status?: string | null;\\n          user_id?: string;\\n        };\\n        Relationships: [\\n          {\\n            foreignKeyName: \\\"fk_product\\\";\\n            columns: [\\\"product_id\\\"];\\n            isOneToOne: false;\\n            referencedRelation: \\\"products\\\";\\n            referencedColumns: [\\\"id\\\"];\\n          },\\n          {\\n            foreignKeyName: \\\"user_library_product_id_fkey\\\";\\n            columns: [\\\"product_id\\\"];\\n            isOneToOne: false;\\n            referencedRelation: \\\"products\\\";\\n            referencedColumns: [\\\"id\\\"];\\n          }\\n        ];\\n      };\\n      webhook_events: {\\n        Row: {\\n          created_at: string | null;\\n          error_message: string | null;\\n          event_id: string;\\n          event_name: string;\\n          id: string;\\n          payload: Json;\\n          status: string | null;\\n          updated_at: string | null;\\n        };\\n        Insert: {\\n          created_at?: string | null;\\n          error_message?: string | null;\\n          event_id: string;\\n          event_name: string;\\n          id?: string;\\n          payload: Json;\\n          status?: string | null;\\n          updated_at?: string | null;\\n        };\\n        Update: {\\n          created_at?: string | null;\\n          error_message?: string | null;\\n          event_id?: string;\\n          event_name?: string;\\n          id?: string;\\n          payload?: Json;\\n          status?: string | null;\\n          updated_at?: string | null;\\n        };\\n        Relationships: [];\\n      };\\n    };\\n    Enums: {\\n      audit_action: \\\"CREATE_PRODUCT\\\" | \\\"UPDATE_PRODUCT\\\" | \\\"DELETE_PRODUCT\\\" | \\\"SAVE_PRODUCT\\\" | \\\"UPDATE_SETTINGS\\\" | \\\"MANUAL_REFUND\\\";\\n      world_type: \\\"home\\\" | \\\"lifestyle\\\" | \\\"tools\\\";\\n    };\\n  };\\n};\\n\\n/* -------------------------------------------------------------------------- */\\n/* 3. Helper Aliases (Strict Extraction)                                       */\\n/* -------------------------------------------------------------------------- */\\n\\ntype DefaultSchema = Database['public'];\\n\\nexport type Tables<\\n  T extends keyof DefaultSchema['Tables']\\n> = DefaultSchema['Tables'][T]['Row'];\\n\\nexport type TablesInsert<\\n  T extends keyof DefaultSchema['Tables']\\n> = DefaultSchema['Tables'][T]['Insert'];\\n\\nexport type TablesUpdate<\\n  T extends keyof DefaultSchema['Tables']\\n> = DefaultSchema['Tables'][T]['Update'];\\n\\n/* -------------------------------------------------------------------------- */\\n/* 4. Domain-Specific UI Aliases                                              */\\n/* -------------------------------------------------------------------------- */\\n\\nexport type Product = Tables<'products'>;\\nexport type Profile = Tables<'profiles'>;\\nexport type Guide = Tables<'guides'>;\\nexport type Purchase = Tables<'purchases'>;\\nexport type WebhookEvent = Tables<'webhook_events'>;\\n\\n// Extended type for components that fetch the related product object\\nexport type UserLibrary = Tables<'user_library'> & { \\n  product?: Product;\\n};\\n\\n// Generic User for auth-specific components\\nexport type User = {\\n  id: string;\\n  email?: string;\\n};\\n\",\n    \"embedding\": null\n  },\n  \"./lib/supabase/helpers.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Supabase Data Helpers (v2.4)\\n * Evolution: Build-Safe Type Handling & Error Suppression\\n */\\n\\nimport { createClient } from './server';\\nimport { Product, World, Profile } from './types';\\n\\nexport interface FilterOptions {\\n  world?: World | 'All';\\n  sort?: 'newest' | 'alphabetical';\\n}\\n\\n/**\\n * IDENTITY: Fetches the profile for the current user.\\n * Explicitly typed to satisfy strict Row/Profile alignment.\\n */\\nexport async function getUserProfile(): Promise<Profile | null> {\\n  const supabase = await createClient();\\n  \\n  // Destructure with explicit null-check to avoid auth context errors\\n  const { data: { user } } = await supabase.auth.getUser();\\n  if (!user) return null;\\n\\n  const { data, error } = await supabase\\n    .from('profiles')\\n    .select('*')\\n    .eq('id', user.id)\\n    .maybeSingle();\\n\\n  if (error) {\\n    console.error('[Helpers] Profile fetch error:', error.message);\\n    return null;\\n  }\\n\\n  return data as Profile | null;\\n}\\n\\n/**\\n * OWNERSHIP: Validates if the current user owns a specific product.\\n * Returns boolean for UI logic.\\n */\\nexport async function checkOwnership(productId: string): Promise<boolean> {\\n  const supabase = await createClient();\\n  \\n  const { data: { user } } = await supabase.auth.getUser();\\n  if (!user) return false;\\n\\n  const { data, error } = await supabase\\n    .from('user_library')\\n    .select('id')\\n    .eq('user_id', user.id)\\n    .eq('product_id', productId)\\n    .maybeSingle();\\n\\n  return !!data && !error;\\n}\\n\\n/**\\n * DISCOVERY: Optimized product retrieval.\\n * Logic: Maps 'All' world selection to a broad query.\\n */\\nexport async function getFilteredProducts(options: FilterOptions): Promise<Product[]> {\\n  const supabase = await createClient();\\n  \\n  let query = supabase\\n    .from('products')\\n    .select('*')\\n    .eq('is_published', true);\\n\\n  // Apply World Filter: Convert 'Lifestyle' -> 'lifestyle' for DB Enum match\\n  if (options.world && options.world !== 'All') {\\n    query = query.eq('world', options.world.toLowerCase()); \\n  }\\n\\n  // Apply Sorting\\n  if (options.sort === 'alphabetical') {\\n    query = query.order('title', { ascending: true });\\n  } else {\\n    query = query.order('created_at', { ascending: false });\\n  }\\n\\n  const { data, error } = await query;\\n\\n  if (error) {\\n    console.error('[Helpers] Product fetch error:', error.message);\\n    return [];\\n  }\\n\\n  return (data as Product[]) || [];\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./hooks/use-vault-realtime.ts\": {\n    \"text\": \"\\\"use client\\\";\\n\\n/**\\n * KYNAR UNIVERSE: Realtime Vault Sync Hook (v1.5)\\n * Path: hooks/use-vault-realtime.ts\\n * Role: Listens for library acquisitions and triggers server-side refreshes.\\n */\\n\\nimport { useEffect } from 'react';\\nimport { useRouter } from 'next/navigation';\\nimport { createClient } from '@/lib/supabase/browser';\\nimport { UserLibrary } from '@/lib/supabase/types';\\n\\nexport function useVaultRealtime(userId: string | undefined) {\\n  const supabase = createClient();\\n  const router = useRouter();\\n\\n  useEffect(() => {\\n    // Exit if no user is authenticated to prevent channel errors\\n    if (!userId) return;\\n\\n    const channel = supabase\\n      .channel(`vault_sync_${userId}`)\\n      .on(\\n        'postgres_changes',\\n        {\\n          event: 'INSERT',\\n          schema: 'public',\\n          table: 'user_library',\\n          filter: `user_id=eq.${userId}`,\\n        },\\n        (payload: { new: UserLibrary }) => {\\n          console.log('[Realtime] Asset synchronized:', payload.new.product_id);\\n          \\n          /**\\n           * router.refresh() invalidates the Client Component cache \\n           * and re-fetches Server Components (like your Vault grid).\\n           */\\n          router.refresh();\\n        }\\n      )\\n      .subscribe();\\n\\n    return () => {\\n      // Clean up the channel on unmount to prevent memory leaks\\n      supabase.removeChannel(channel);\\n    };\\n  }, [userId, supabase, router]);\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/globals.css\": {\n    \"text\": \"@tailwind base;\\n@tailwind components;\\n@tailwind utilities;\\n\\n@layer base {\\n  :root {\\n    --canvas: 40 12% 97%;\\n    --surface: 210 20% 98%;\\n    --border: 214 32% 91%;\\n    --kyn-green: 142 71% 45%;\\n    --kyn-caramel: 38 48% 39%;\\n    --kyn-slate: 215 25% 15%;\\n    --text-primary: 215 25% 7%;\\n    --text-secondary: 215 16% 47%;\\n    \\n    /* Mobile Safe Zones */\\n    --safe-bottom: env(safe-area-inset-bottom, 1.5rem);\\n    --safe-top: env(safe-area-inset-top, 0px);\\n    \\n    /* Easing Evolved: \\\"The Drift\\\" */\\n    --ease-kyn-out: cubic-bezier(0.16, 1, 0.3, 1);\\n  }\\n\\n  * {\\n    @apply border-border;\\n    -webkit-tap-highlight-color: transparent;\\n  }\\n\\n  html, body {\\n    @apply bg-canvas text-text-primary;\\n    font-feature-settings: \\\"cv02\\\", \\\"cv03\\\", \\\"cv04\\\", \\\"cv11\\\";\\n    line-height: 1.6;\\n    overflow-x: hidden;\\n    width: 100%;\\n    position: relative;\\n    min-height: 100svh;\\n    scroll-behavior: smooth;\\n  }\\n\\n  /* Fixed: Selection logic moved out of @apply to pass Turbopack build */\\n  ::selection {\\n    background-color: hsl(var(--kyn-green) / 0.15);\\n    color: inherit;\\n  }\\n}\\n\\n@layer components {\\n  /* High-end blur for portals */\\n  .portal-backdrop {\\n    @apply fixed inset-0 z-[190] bg-kyn-slate-900 backdrop-blur-md;\\n    background-color: hsl(var(--kyn-slate) / 0.4); /* Manual override for safety */\\n    transition: backdrop-filter 0.5s var(--ease-kyn-out), background-color 0.5s var(--ease-kyn-out);\\n  }\\n\\n  /* Glassmorphism Surface */\\n  .kynar-glass {\\n    @apply bg-white/70 backdrop-blur-xl border border-white/20 shadow-kynar-soft;\\n  }\\n\\n  .calm-transition {\\n    transition: all 0.6s var(--ease-kyn-out);\\n    will-change: transform, opacity, filter;\\n  }\\n\\n  .kynar-card {\\n    @apply calm-transition rounded-kynar-lg border border-border bg-surface hover:shadow-kynar-soft;\\n  }\\n\\n  /* Padding for bottom-docked nav */\\n  .pt-safe-top { \\n    padding-top: var(--safe-top); \\n  }\\n  .pb-safe-bottom { \\n    padding-bottom: var(--safe-bottom); \\n  }\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/layout.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Root Architecture (v2.3)\\n * Path: app/layout.tsx\\n * Evolution: Strict Type-Safe Profile Injection & Layout Fluidity\\n */\\n\\nimport type { Metadata, Viewport } from \\\"next\\\";\\nimport { Inter, Plus_Jakarta_Sans } from \\\"next/font/google\\\";\\nimport \\\"./globals.css\\\";\\n\\n// Component Imports\\nimport { PresenceBar } from \\\"@/components/layout/PresenceBar\\\";\\nimport { Footer } from \\\"@/components/layout/Footer\\\";\\nimport { Navigation } from \\\"@/components/layout/Navigation\\\"; \\nimport { getUserProfile } from \\\"@/lib/supabase/helpers\\\";\\nimport { Toaster } from \\\"react-hot-toast\\\";\\nimport { cn } from \\\"@/lib/utils\\\";\\nimport OverlayWrapper from \\\"@/components/marketplace/OverlayWrapper\\\";\\nimport UserMenu from \\\"@/components/layout/UserMenu\\\";\\n\\n// Type Imports - Explicitly aligning with your definitive types.ts\\nimport { Profile } from \\\"@/lib/supabase/types\\\";\\n\\nconst inter = Inter({ subsets: [\\\"latin\\\"], variable: \\\"--font-ui\\\", display: 'swap' });\\nconst jakarta = Plus_Jakarta_Sans({ subsets: [\\\"latin\\\"], variable: \\\"--font-brand\\\", display: 'swap' });\\n\\nexport const viewport: Viewport = {\\n  width: 'device-width',\\n  initialScale: 1,\\n  maximumScale: 1,\\n  viewportFit: 'cover',\\n  themeColor: '#FAF9F6',\\n};\\n\\nexport const metadata: Metadata = {\\n  title: {\\n    template: '%s | KYNAR',\\n    default: 'KYNAR | Home â€¢ Lifestyle â€¢ Tools',\\n  },\\n  description: \\\"A calm, mobile-first digital ecosystem.\\\",\\n  metadataBase: new URL('https://kynaruniverse.com'),\\n};\\n\\nexport default async function RootLayout({ children }: { children: React.ReactNode }) {\\n  /** * FIXED: Lowercase 'profile' to match variable usage across the tree.\\n   * Type is explicitly set to Profile | null based on types.ts.\\n   */\\n  const profile: Profile | null = await getUserProfile();\\n\\n  return (\\n    <html lang=\\\"en\\\" className={cn(inter.variable, jakarta.variable, \\\"antialiased\\\")}>\\n      <body className=\\\"bg-canvas text-text-primary overflow-x-hidden\\\">\\n        \\n        {/* MODAL LAYER: Managed via global useUIStore */}\\n        <UserMenu user={profile} />\\n        <OverlayWrapper />\\n\\n        {/* FEEDBACK LAYER */}\\n        <Toaster \\n          position=\\\"bottom-center\\\" \\n          toastOptions={{\\n            style: {\\n              borderRadius: '1.25rem',\\n              background: '#1A241B',\\n              color: '#fff',\\n              fontFamily: 'var(--font-brand)',\\n              fontSize: '13px',\\n              fontWeight: '600',\\n              padding: '12px 20px',\\n              border: '1px solid rgba(255,255,255,0.1)'\\n            },\\n          }}\\n        />\\n\\n        {/* TEXTURE LAYER: Analog Grain Overlay */}\\n        <div \\n          className=\\\"pointer-events-none fixed inset-0 z-[1] h-full w-full opacity-[0.015] will-change-transform\\\" \\n          aria-hidden=\\\"true\\\"\\n          style={{ \\n            backgroundImage: `url(\\\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E\\\")`,\\n          }}\\n        />\\n\\n        {/* CONTENT LAYER */}\\n        <div className=\\\"relative z-10 flex min-h-screen flex-col\\\">\\n          {/* Ensure prop names match component definitions (initialProfile vs user) */}\\n          <PresenceBar initialProfile={profile} />\\n          \\n          <main className=\\\"flex-grow pt-safe-top pb-24 md:pb-0\\\">\\n            {children}\\n          </main>\\n\\n          <Footer />\\n          \\n          {/* MOBILE NAVIGATION: Anchored to viewport bottom */}\\n          <Navigation initialProfile={profile} />\\n        </div>\\n      </body>\\n    </html>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: The Universe Gate (v1.5)\\n * Role: The primary entry point and world-selection portal.\\n * Optimization: Mobile-first ergonomic grid & Next.js 16 Server-First architecture.\\n */\\n\\nimport Link from \\\"next/link\\\";\\nimport { Sparkles, ArrowRight, Globe, Compass, Box } from \\\"lucide-react\\\";\\nimport { WORLDS, World } from \\\"@/lib/supabase/types\\\";\\n\\ninterface WorldMeta {\\n  name: World;\\n  slug: string;\\n  color: string;\\n  icon: React.ReactNode;\\n  desc: string;\\n}\\n\\nexport default function UniverseGate() {\\n  // Mapping the canonical WORLDS enum to visual metadata\\n  const worlds: WorldMeta[] = [\\n    { \\n      name: WORLDS[0], // \\\"Home\\\"\\n      slug: \\\"home\\\", \\n      color: \\\"bg-kyn-green-500\\\", \\n      icon: <Box size={20} />,\\n      desc: \\\"Order in your physical space and domestic architecture.\\\" \\n    },\\n    { \\n      name: WORLDS[1], // \\\"Lifestyle\\\"\\n      slug: \\\"lifestyle\\\", \\n      color: \\\"bg-kyn-caramel-500\\\", \\n      icon: <Sparkles size={20} />,\\n      desc: \\\"Refined daily routines and personal digital sophistication.\\\" \\n    },\\n    { \\n      name: WORLDS[2], // \\\"Tools\\\"\\n      slug: \\\"tools\\\", \\n      color: \\\"bg-kyn-slate-500\\\", \\n      icon: <Compass size={20} />,\\n      desc: \\\"High-performance clarity for your professional projects.\\\" \\n    },\\n  ];\\n\\n  return (\\n    <main className=\\\"relative flex min-h-[90vh] flex-col items-center justify-center px-gutter py-12 md:py-24 overflow-hidden\\\">\\n      \\n      {/* Atmospheric Background Element */}\\n      <div className=\\\"absolute top-1/2 left-1/2 -z-10 h-[500px] w-[500px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-kyn-green-50/30 blur-[120px]\\\" />\\n\\n      {/* Brand Header */}\\n      <header className=\\\"text-center animate-in fade-in slide-in-from-top-4 duration-1000\\\">\\n        <div className=\\\"mb-6 flex justify-center\\\">\\n          <div className=\\\"inline-flex items-center gap-2 rounded-full bg-white border border-border px-4 py-1.5 shadow-sm\\\">\\n            <Globe size={14} className=\\\"text-kyn-green-500 animate-spin-slow\\\" />\\n            <span className=\\\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-text-secondary\\\">\\n              Central Hub Active\\n            </span>\\n          </div>\\n        </div>\\n\\n        <h1 className=\\\"font-brand text-5xl font-bold tracking-tight text-kyn-slate-900 md:text-7xl lg:text-8xl\\\">\\n          Kynar <span className=\\\"text-text-secondary font-medium italic\\\">Universe</span>\\n        </h1>\\n        \\n        <p className=\\\"mt-8 mx-auto max-w-lg text-lg text-text-secondary font-ui leading-relaxed md:text-xl\\\">\\n          A calm digital ecosystem for useful tools that help you \\n          <span className=\\\"text-kyn-slate-900 font-medium\\\"> organise, reflect, and create.</span>\\n        </p>\\n      </header>\\n\\n      {/* World Selection Grid */}\\n      <nav className=\\\"mt-16 w-full max-w-5xl animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-200\\\">\\n        <div className=\\\"grid gap-6 md:grid-cols-3\\\">\\n          {worlds.map((world) => (\\n            <Link \\n              key={world.slug} \\n              href={`/${world.slug}`}\\n              className=\\\"group relative flex flex-col items-start rounded-3xl border border-border bg-white p-8 text-left transition-all hover:border-kyn-green-400/50 hover:shadow-kynar-soft active:scale-[0.97]\\\"\\n            >\\n              <div className={`mb-6 flex h-10 w-10 items-center justify-center rounded-xl ${world.color} text-white shadow-lg shadow-current/10 group-hover:scale-110 transition-transform`}>\\n                {world.icon}\\n              </div>\\n              \\n              <h3 className=\\\"font-brand text-2xl font-bold text-kyn-slate-900\\\">\\n                {world.name}\\n              </h3>\\n              \\n              <p className=\\\"mt-3 font-ui text-sm leading-relaxed text-text-secondary\\\">\\n                {world.desc}\\n              </p>\\n              \\n              <div className=\\\"mt-8 flex items-center gap-2 text-[11px] font-bold uppercase tracking-widest text-kyn-slate-400 group-hover:text-kyn-green-600 transition-colors\\\">\\n                Explore World \\n                <ArrowRight size={14} className=\\\"transition-transform group-hover:translate-x-1\\\" />\\n              </div>\\n            </Link>\\n          ))}\\n        </div>\\n      </nav>\\n\\n      {/* Secondary Discovery */}\\n      <footer className=\\\"mt-20 flex flex-col items-center gap-6 animate-in fade-in duration-1000 delay-500\\\">\\n        <div className=\\\"h-px w-12 bg-border\\\" />\\n        <Link \\n          href=\\\"/store\\\" \\n          className=\\\"group flex items-center gap-3 font-brand text-sm font-bold uppercase tracking-[0.25em] text-text-secondary hover:text-kyn-green-600 transition-colors\\\"\\n        >\\n          Browse the Marketplace\\n          <span className=\\\"h-px w-0 bg-kyn-green-600 transition-all group-hover:w-8\\\" />\\n        </Link>\\n      </footer>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/api/webhooks/lemon-squeezy/route.ts\": {\n    \"text\": \"import { NextResponse } from 'next/server';\\nimport { headers } from 'next/headers';\\nimport crypto from 'crypto';\\nimport { createClient } from '@/lib/supabase/server';\\nimport type { Json } from '@/lib/supabase/types';\\n\\ninterface LemonSqueezyPayload {\\n  meta: { event_name: string };\\n  data: {\\n    id: string;\\n    attributes: {\\n      custom_data?: {\\n        user_id?: string;\\n        product_id?: string;\\n      };\\n    };\\n  };\\n}\\n\\nconst WEBHOOK_SECRET = process.env.LEMONSQUEEZY_WEBHOOK_SECRET || '';\\n\\nexport async function POST(req: Request) {\\n  const rawBody = await req.text();\\n  const headerList = await headers();\\n  const signature = headerList.get('x-signature') || '';\\n\\n  const hmac = crypto.createHmac('sha256', WEBHOOK_SECRET);\\n  const digest = hmac.update(rawBody).digest('hex');\\n\\n  if (signature !== digest) {\\n    return NextResponse.json({ error: 'Invalid signature' }, { status: 401 });\\n  }\\n\\n  const payload = JSON.parse(rawBody) as LemonSqueezyPayload;\\n  const eventId = `${payload.meta.event_name}_${payload.data.id}`;\\n  const eventName = payload.meta.event_name;\\n  \\n  const supabase = await createClient();\\n\\n  // BYPASS: Casting the query to 'any' allows the build to pass \\n  // when the local types.ts is missing these new tables.\\n  const { data: existingEvent } = await (supabase\\n    .from('webhook_events')\\n    .select('id')\\n    .eq('event_id', eventId)\\n    .maybeSingle() as any);\\n\\n  if (existingEvent) {\\n    return NextResponse.json({ message: 'Event already processed' }, { status: 200 });\\n  }\\n\\n  // LOG EVENT\\n  await (supabase.from('webhook_events').insert({\\n    event_id: eventId,\\n    event_name: eventName,\\n    payload: payload as unknown as Json,\\n    status: 'pending'\\n  }) as any);\\n\\n  if (eventName === 'order_created') {\\n    try {\\n      const { user_id: userId, product_id: productId } = payload.data.attributes.custom_data || {};\\n      if (!userId || !productId) throw new Error(\\\"Missing custom_data\\\");\\n\\n      // FULFILLMENT\\n      const { error: fulfillmentError } = await (supabase\\n        .from('user_library')\\n        .insert({\\n          user_id: userId,\\n          product_id: productId,\\n          order_id: payload.data.id,\\n          source: 'lemon-squeezy',\\n          status: 'active',\\n          acquired_at: new Date().toISOString()\\n        }) as any);\\n\\n      if (fulfillmentError) throw fulfillmentError;\\n\\n      await (supabase\\n        .from('webhook_events')\\n        .update({ status: 'processed', updated_at: new Date().toISOString() })\\n        .eq('event_id', eventId) as any);\\n\\n    } catch (err: any) {\\n      console.error(`[Webhook Critical] ${eventId}:`, err.message);\\n      \\n      await (supabase\\n        .from('webhook_events')\\n        .update({ \\n          status: 'failed', \\n          error_message: err.message, \\n          updated_at: new Date().toISOString() \\n        })\\n        .eq('event_id', eventId) as any);\\n\\n      return NextResponse.json({ error: 'Fulfillment failed' }, { status: 500 });\\n    }\\n  }\\n\\n  return NextResponse.json({ received: true }, { status: 200 });\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/api/download/[id]/route.ts\": {\n    \"text\": \"import { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { NextResponse } from \\\"next/server\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\";\\n\\ninterface LibraryJoin {\\n  product_id: string;\\n  products: Product | null;\\n}\\n\\nexport async function GET(_req: Request, { params }: { params: Promise<{ id: string }> }) {\\n  const { id: productId } = await params;\\n  const supabase = await createClient();\\n  const { data: { user } } = await supabase.auth.getUser();\\n\\n  if (!user) return new NextResponse(\\\"Unauthorized\\\", { status: 401 });\\n\\n  const { data, error } = await supabase\\n    .from(\\\"user_library\\\")\\n    .select(`product_id, products (*)`)\\n    .eq(\\\"user_id\\\", user.id)\\n    .eq(\\\"product_id\\\", productId)\\n    .maybeSingle() as unknown as { data: LibraryJoin | null; error: any };\\n\\n  if (error || !data?.products?.download_path) return new NextResponse(\\\"Forbidden\\\", { status: 403 });\\n\\n  const { data: signedUrl } = await supabase.storage\\n    .from(\\\"vault\\\")\\n    .createSignedUrl(data.products.download_path, 60);\\n\\n  return NextResponse.redirect(signedUrl?.signedUrl || '');\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/library/layout.tsx\": {\n    \"text\": \"/* KYNAR UNIVERSE: Library Layout (v1.2) app/library/layout.tsx */\\n\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { PresenceBar } from \\\"@/components/layout/PresenceBar\\\";\\nimport { ShieldCheck } from \\\"lucide-react\\\";\\n\\ninterface LibraryLayoutProps {\\n  children: React.ReactNode;\\n}\\n\\nexport default function LibraryLayout({ children }: LibraryLayoutProps) {\\n  return (\\n    <div className=\\\"relative flex min-h-screen flex-col bg-canvas selection:bg-kyn-green-100\\\">\\n      \\n      {/* Auth Context Bar: Global Identity */}\\n      <PresenceBar />\\n\\n      {/* Secure Handrail: Primary Navigation Context */}\\n      <nav \\n        className=\\\"sticky top-0 z-40 w-full border-b border-border bg-canvas/80 backdrop-blur-xl\\\"\\n        aria-label=\\\"Library Navigation\\\"\\n      >\\n        <div className=\\\"mx-auto max-w-screen-xl px-gutter\\\">\\n          <div className=\\\"flex h-14 items-center justify-between md:h-20\\\">\\n            <Breadcrumbs \\n              paths={[\\n                { label: \\\"Universe Hub\\\", href: \\\"/\\\" },\\n                { label: \\\"The Vault\\\", href: \\\"/library\\\" }\\n              ]} \\n            />\\n            \\n            <div className=\\\"hidden md:flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-text-secondary\\\">\\n              <ShieldCheck size={14} className=\\\"text-kyn-green-500\\\" />\\n              Secure Vault Access\\n            </div>\\n          </div>\\n        </div>\\n      </nav>\\n\\n      <main className=\\\"relative z-10 flex-1 overflow-x-hidden pb-safe-bottom\\\">\\n        {children}\\n      </main>\\n\\n      {/* Library Background Pattern: Fixed context indicator */}\\n      <div \\n        className=\\\"pointer-events-none fixed inset-0 z-0 opacity-[0.03]\\\" \\n        aria-hidden=\\\"true\\\"\\n        style={{ \\n          backgroundImage: `url(\\\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231A241B' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\\\")`,\\n        }}\\n      />\\n    </div>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/library/page.tsx\": {\n    \"text\": \"import { Metadata } from \\\"next\\\";\\nimport Image from 'next/image';\\nimport Link from 'next/link';\\nimport { redirect } from \\\"next/navigation\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { Download, BookOpen, ShieldCheck, Clock, ChevronRight } from \\\"lucide-react\\\";\\nimport { UserLibrary } from \\\"@/lib/supabase/types\\\";\\nimport { RealtimeListener } from \\\"@/components/layout/RealtimeListener\\\";\\n\\nexport const metadata: Metadata = {\\n  title: \\\"The Vault | Your Collection\\\",\\n  description: \\\"A permanent archive of your acquired digital assets.\\\",\\n};\\n\\nexport default async function LibraryPage() {\\n  const supabase = await createClient();\\n  \\n  const { data: { user: authUser } } = await supabase.auth.getUser();\\n  if (!authUser) redirect(\\\"/auth/login?return_to=/library\\\");\\n  \\n  // RLS (Phase 02) now secures this query automatically\\n  const { data: rawItems, error } = await (supabase\\n    .from('user_library')\\n    .select(`\\n      id,\\n      acquired_at,\\n      status,\\n      product_id,\\n      product:products (\\n        id,\\n        title,\\n        short_description,\\n        world,\\n        slug,\\n        preview_image \\n      )\\n    `)\\n    .eq('user_id', authUser.id)\\n    .order('acquired_at', { ascending: false }) as any);\\n  \\n  if (error) {\\n    console.error(\\\"[Vault] Sync error:\\\", error.message);\\n  }\\n  \\n  const items = (rawItems || []).map((item: any) => ({\\n    ...item,\\n    product: item.product || {}\\n  })) as UserLibrary[];\\n  \\n  return (\\n    <div className=\\\"max-w-screen-xl mx-auto px-gutter\\\">\\n      {/* PHASE 03: The Bridge */}\\n      <RealtimeListener userId={authUser.id} />\\n\\n      <header className=\\\"py-16 md:py-24\\\">\\n        <h1 className=\\\"font-brand text-4xl font-bold text-kyn-slate-900 tracking-tight md:text-6xl\\\">\\n          Your Collection\\n        </h1>\\n        <p className=\\\"font-ui text-base text-text-secondary mt-6 max-w-md\\\">\\n          Your permanent archive. Verified assets, secured for life.\\n        </p>\\n      </header>\\n\\n      <section className=\\\"pb-24\\\">\\n        {items.length === 0 ? (\\n          <div className=\\\"flex flex-col items-center justify-center py-32 text-center border border-dashed border-border rounded-[2.5rem] bg-surface/50\\\">\\n            <ShieldCheck size={40} className=\\\"text-kyn-slate-200 mb-8\\\" strokeWidth={1} />\\n            <h2 className=\\\"font-brand text-xl font-bold text-text-primary\\\">The Vault is Quiet</h2>\\n            <p className=\\\"font-ui text-sm text-text-secondary mt-3 mb-10\\\">\\n              You haven&apos;t added any technical assets to your universe yet.\\n            </p>\\n            <Link href=\\\"/store\\\" className=\\\"button-primary group\\\">\\n              Explore Hub\\n              <ChevronRight size={16} className=\\\"ml-2 transition-transform group-hover:translate-x-1\\\" />\\n            </Link>\\n          </div>\\n        ) : (\\n          <div className=\\\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10\\\">\\n            {items.map((item) => (\\n              <article \\n                key={item.id} \\n                className=\\\"group flex flex-col bg-white border border-border rounded-[2rem] overflow-hidden hover:shadow-kynar-deep transition-all duration-700 animate-in fade-in slide-in-from-bottom-4\\\"\\n              >\\n                <div className=\\\"aspect-[16/10] bg-kyn-slate-50 relative overflow-hidden\\\">\\n                  {item.product?.preview_image ? (\\n                    <Image \\n                      src={item.product.preview_image} \\n                      alt={item.product.title || \\\"Asset\\\"}\\n                      fill\\n                      sizes=\\\"(max-width: 768px) 100vw, 33vw\\\"\\n                      className=\\\"object-cover group-hover:scale-105 transition-transform duration-1000\\\"\\n                    />\\n                  ) : (\\n                    <div className=\\\"absolute inset-0 flex items-center justify-center text-kyn-slate-100\\\">\\n                      <ShieldCheck size={64} strokeWidth={0.5} />\\n                    </div>\\n                  )}\\n                </div>\\n\\n                <div className=\\\"p-8 flex-1 flex flex-col\\\">\\n                  <div className=\\\"flex items-center gap-2 mb-4\\\">\\n                    <Clock size={12} className=\\\"text-kyn-green-600\\\" />\\n                    <span className=\\\"text-[10px] font-bold text-kyn-slate-400 uppercase tracking-widest\\\">\\n                      Index Date: {item.acquired_at ? new Date(item.acquired_at).toLocaleDateString() : 'N/A'}\\n                    </span>\\n                  </div>\\n                  \\n                  <h3 className=\\\"font-brand text-2xl font-bold text-kyn-slate-900 mb-3\\\">\\n                    {item.product?.title || \\\"Unknown Asset\\\"}\\n                  </h3>\\n                  \\n                  <div className=\\\"mt-auto space-y-4\\\">\\n                    <Link \\n                      href={`/api/download/${item.product_id}`}\\n                      className=\\\"flex items-center justify-center gap-3 w-full bg-kyn-slate-900 py-4 rounded-2xl text-white font-brand text-xs font-bold uppercase tracking-widest hover:bg-black transition-all\\\"\\n                    >\\n                      <Download size={16} />\\n                      Access Assets\\n                    </Link>\\n                    \\n                    <Link\\n                      href={`/guides/${item.product?.slug}`}\\n                      className=\\\"flex items-center justify-center gap-2 w-full py-2 font-brand text-[10px] font-black text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors uppercase tracking-[0.2em]\\\"\\n                    >\\n                      <BookOpen size={14} />\\n                      Technical Guide\\n                    </Link>\\n                  </div>\\n                </div>\\n              </article>\\n            ))}\\n          </div>\\n        )}\\n      </section>\\n    </div>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/guides/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Briefings Archive (v1.6)\\n * Role: Central repository for all world intelligence.\\n * Fully aligned with canonical types.ts and Next.js 15.\\n */\\n\\nimport { Metadata } from \\\"next\\\";\\nimport Link from \\\"next/link\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { Compass, Clock, ArrowRight } from \\\"lucide-react\\\";\\nimport { Guide } from \\\"@/lib/supabase/types\\\";\\n\\nexport const metadata: Metadata = {\\n  title: \\\"Briefings | Kynar Universe Intelligence\\\",\\n  description: \\\"Explore the technical and narrative architecture of the Kynar Universe.\\\",\\n};\\n\\nexport default async function GuidesPage() {\\n  const supabase = await createClient();\\n  \\n  /**\\n   * Data Retrieval: Server-Side\\n   * Using explicit casting to Guide[] for alignment with types.ts\\n   */\\n  const { data, error } = await supabase\\n    .from(\\\"guides\\\")\\n    .select(\\\"*\\\")\\n    .eq(\\\"is_published\\\", true) // Ensuring only public intelligence is visible\\n    .order(\\\"created_at\\\", { ascending: false });\\n  \\n  if (error) {\\n    console.error(\\\"[Briefings] Fetch failure:\\\", error.message);\\n  }\\n  \\n  const guides = (data as Guide[]) ?? [];\\n  \\n  const breadcrumbPaths = [\\n    { label: \\\"Universe\\\", href: \\\"/\\\" },\\n    { label: \\\"Briefings\\\", href: \\\"/guides\\\" },\\n  ];\\n  \\n  return (\\n    <main className=\\\"min-h-screen bg-canvas pb-32\\\">\\n      {/* Handrail: Navigation */}\\n      <nav className=\\\"border-b border-kyn-slate-50 bg-white/50 backdrop-blur-md px-gutter\\\">\\n        <div className=\\\"mx-auto max-w-screen-xl flex h-14 items-center\\\">\\n          <Breadcrumbs paths={breadcrumbPaths} />\\n        </div>\\n      </nav>\\n\\n      <section className=\\\"mx-auto max-w-screen-xl px-gutter pt-12 md:pt-20\\\">\\n        {/* Header: Narrative Context */}\\n        <header className=\\\"max-w-screen-md mb-16 animate-in fade-in slide-in-from-bottom-4 duration-700\\\">\\n          <h1 className=\\\"font-brand text-4xl font-bold tracking-tight text-kyn-slate-900 md:text-6xl\\\">\\n            Intelligence Briefings\\n          </h1>\\n          <p className=\\\"mt-6 font-ui text-base leading-relaxed text-text-secondary md:text-lg\\\">\\n            A collection of technical frameworks, world-building records, and operational guides designed to ground your digital experience.\\n          </p>\\n        </header>\\n\\n        {/* The Archive Grid */}\\n        {guides.length > 0 ? (\\n          <div className=\\\"grid grid-cols-1 gap-y-10 md:grid-cols-2 md:gap-x-12 lg:grid-cols-3\\\">\\n            {guides.map((guide, index) => (\\n              <Link\\n                key={guide.id}\\n                href={`/guides/${guide.slug}`}\\n                className=\\\"group flex flex-col animate-in fade-in slide-in-from-bottom-6 duration-1000 fill-mode-both\\\"\\n                style={{ animationDelay: `${index * 100}ms` }}\\n              >\\n                {/* Visual Anchor */}\\n                <div className=\\\"relative aspect-[16/9] w-full overflow-hidden rounded-3xl bg-surface border border-kyn-slate-100 transition-all duration-500 group-hover:shadow-kynar-soft group-hover:border-kyn-slate-200\\\">\\n                  <div className=\\\"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-kyn-slate-50 to-white text-kyn-slate-200\\\">\\n                    <Compass\\n                      size={48}\\n                      strokeWidth={1}\\n                      className=\\\"transition-transform duration-700 group-hover:rotate-12 group-hover:scale-110\\\"\\n                    />\\n                  </div>\\n\\n                  {/* Category Badge */}\\n                  <div className=\\\"absolute left-4 top-4 rounded-full bg-white/90 backdrop-blur-sm px-3 py-1 text-[10px] font-bold uppercase tracking-widest text-kyn-slate-900 shadow-sm\\\">\\n                    {guide.category}\\n                  </div>\\n                </div>\\n\\n                {/* Metadata & Title */}\\n                <div className=\\\"mt-6 flex flex-col flex-1\\\">\\n                  <div className=\\\"flex items-center gap-3 font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\\\">\\n                    <span className=\\\"flex items-center gap-1\\\">\\n                      <Clock size={12} className=\\\"text-kyn-green-600\\\" />\\n                      {guide.read_time_minutes ?? 5} Min Read\\n                    </span>\\n                    <span>â€¢</span>\\n                    <span>\\n                      {guide.created_at \\n                        ? new Date(guide.created_at).toLocaleDateString(\\\"en-GB\\\", {\\n                            month: \\\"short\\\",\\n                            year: \\\"numeric\\\",\\n                          })\\n                        : \\\"Recent\\\"}\\n                    </span>\\n                  </div>\\n\\n                  <h3 className=\\\"mt-3 font-brand text-xl font-bold text-kyn-slate-900 group-hover:text-black transition-colors\\\">\\n                    {guide.title}\\n                  </h3>\\n\\n                  <p className=\\\"mt-3 font-ui text-sm leading-relaxed text-text-secondary line-clamp-2\\\">\\n                    {guide.excerpt ??\\n                      \\\"Technical briefing and narrative exploration regarding this sector of the Kynar Universe.\\\"}\\n                  </p>\\n\\n                  <div className=\\\"mt-auto pt-6 flex items-center gap-2 font-brand text-xs font-bold uppercase tracking-widest text-kyn-slate-900\\\">\\n                    Explore Briefing\\n                    <ArrowRight\\n                      size={14}\\n                      className=\\\"transition-transform group-hover:translate-x-1\\\"\\n                    />\\n                  </div>\\n                </div>\\n              </Link>\\n            ))}\\n          </div>\\n        ) : (\\n          /* Reassured Empty State */\\n          <div className=\\\"rounded-[2.5rem] bg-surface border border-dashed border-kyn-slate-200 py-32 text-center\\\">\\n            <div className=\\\"mx-auto flex h-16 w-16 items-center justify-center rounded-2xl bg-kyn-slate-50 text-kyn-slate-300\\\">\\n              <Compass size={32} />\\n            </div>\\n            <p className=\\\"mt-6 font-brand text-sm font-bold text-kyn-slate-900\\\">\\n              Archive Currently Indexing\\n            </p>\\n            <p className=\\\"mt-2 font-ui text-xs text-kyn-slate-400\\\">\\n              Briefings will appear here as they are cleared for release.\\n            </p>\\n          </div>\\n        )}\\n      </section>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/guides/[slug]/loading.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Guide Briefing Skeleton (v2.0)\\n * Role: Editorial Reassured State.\\n * Alignment: Next.js 15 Partial Prerendering (PPR) & Canonical Design System.\\n */\\n\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { cn } from \\\"@/lib/utils\\\";\\n\\nexport default function GuideLoading() {\\n  // Staggered animation utility to prevent a \\\"flashing\\\" wall of content\\n  const pulseClass = \\\"animate-pulse bg-kyn-slate-100/80\\\";\\n\\n  return (\\n    <article className=\\\"min-h-screen bg-canvas pb-32 animate-in fade-in duration-500 ease-out\\\">\\n      <div className=\\\"max-w-screen-md mx-auto px-gutter\\\">\\n        \\n        {/* Navigation Handrail */}\\n        <div className=\\\"py-6\\\">\\n          <Breadcrumbs\\n            paths={[\\n              { label: \\\"Universe\\\", href: \\\"/\\\" },\\n              { label: \\\"Briefings\\\", href: \\\"/guides\\\" },\\n            ]}\\n          />\\n        </div>\\n\\n        <header className=\\\"py-12 md:py-24\\\">\\n          {/* Metadata Chips: Category & Time */}\\n          <div className=\\\"flex items-center gap-4 mb-10\\\">\\n            <div className={cn(\\\"h-8 w-24 rounded-full\\\", pulseClass)} />\\n            <div className={cn(\\\"h-4 w-16 rounded-full\\\", pulseClass)} />\\n          </div>\\n\\n          {/* Headline Skeleton: Narrative Establishment */}\\n          <div className=\\\"space-y-4 mb-12\\\">\\n            <div className={cn(\\\"h-12 w-full rounded-xl\\\", pulseClass)} />\\n            <div className={cn(\\\"h-12 w-3/4 rounded-xl\\\", pulseClass)} />\\n          </div>\\n\\n          {/* Authority Bar: Verified Source Placeholder */}\\n          <div className=\\\"flex items-center gap-5 py-10 border-y border-kyn-slate-50\\\">\\n            <div className={cn(\\\"h-14 w-14 rounded-2xl\\\", pulseClass)} />\\n            <div className=\\\"flex-1 space-y-3\\\">\\n              <div className={cn(\\\"h-4 w-40 rounded\\\", pulseClass)} />\\n              <div className={cn(\\\"h-3 w-28 rounded opacity-50\\\", pulseClass)} />\\n            </div>\\n          </div>\\n        </header>\\n\\n        {/* Narrative Core Skeleton: Content Blocks */}\\n        <div className=\\\"space-y-12 pt-6\\\">\\n          <div className=\\\"space-y-4\\\">\\n            <div className={cn(\\\"h-4 w-full rounded\\\", pulseClass)} />\\n            <div className={cn(\\\"h-4 w-full rounded\\\", pulseClass)} />\\n            <div className={cn(\\\"h-4 w-11/12 rounded\\\", pulseClass)} />\\n            <div className={cn(\\\"h-4 w-4/5 rounded\\\", pulseClass)} />\\n          </div>\\n\\n          {/* Media Placeholder: Hero Asset simulation */}\\n          <div\\n            className={cn(\\n              \\\"aspect-video w-full rounded-[2.5rem] bg-kyn-slate-50 border border-kyn-slate-100/50\\\",\\n              pulseClass\\n            )}\\n          />\\n\\n          <div className=\\\"space-y-4\\\">\\n            <div className={cn(\\\"h-4 w-full rounded\\\", pulseClass)} />\\n            <div className={cn(\\\"h-4 w-full rounded\\\", pulseClass)} />\\n            <div className={cn(\\\"h-4 w-2/3 rounded\\\", pulseClass)} />\\n          </div>\\n        </div>\\n      </div>\\n    </article>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/guides/[slug]/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Guide Vessel (v2.0)\\n * Role: Premium intelligence briefing.\\n * Fully aligned with canonical types.ts, Next.js 15 Async Params, and casting protocols.\\n */\\n\\nimport { Metadata } from \\\"next\\\";\\nimport { notFound } from \\\"next/navigation\\\";\\nimport Link from \\\"next/link\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { ReadingProgressBar } from \\\"@/components/guides/ReadingProgressBar\\\";\\nimport { Clock, ArrowLeft, ShieldCheck, Share2 } from \\\"lucide-react\\\";\\nimport { Guide } from \\\"@/lib/supabase/types\\\";\\n\\ninterface GuidePageProps {\\n  params: Promise<{ slug: string }>;\\n}\\n\\nexport async function generateMetadata(\\n  { params }: GuidePageProps\\n): Promise<Metadata> {\\n  const { slug } = await params;\\n  const supabase = await createClient();\\n\\n  const { data } = await supabase\\n    .from(\\\"guides\\\")\\n    .select(\\\"title, excerpt\\\")\\n    .eq(\\\"slug\\\", slug)\\n    .single();\\n\\n  const guide = data as Pick<Guide, \\\"title\\\" | \\\"excerpt\\\"> | null;\\n\\n  if (!guide) {\\n    return {\\n      title: \\\"Briefing Not Found | Kynar Intelligence\\\",\\n    };\\n  }\\n\\n  return {\\n    title: `${guide.title} | Kynar Intelligence`,\\n    description:\\n      guide.excerpt ??\\n      \\\"Official intelligence briefing from the Kynar Universe archive.\\\",\\n  };\\n}\\n\\nexport default async function GuidePage({ params }: GuidePageProps) {\\n  const { slug } = await params;\\n  const supabase = await createClient();\\n\\n  const { data, error } = await supabase\\n    .from(\\\"guides\\\")\\n    .select(\\\"*\\\")\\n    .eq(\\\"slug\\\", slug)\\n    .single();\\n\\n  if (error || !data) notFound();\\n\\n  // Explicitly cast to the Guide type from our canonical types.ts\\n  const guide = data as Guide;\\n  const displayAuthor = guide.author || \\\"Kynar Universe\\\";\\n\\n  const breadcrumbPaths = [\\n    { label: \\\"Universe\\\", href: \\\"/\\\" },\\n    { label: \\\"Briefings\\\", href: \\\"/guides\\\" },\\n    { label: guide.title, href: `/guides/${guide.slug}` },\\n  ];\\n\\n  return (\\n    <main className=\\\"min-h-screen bg-canvas pb-32 selection:bg-kyn-green-100/50\\\">\\n      {/* Handrail: Structural Context */}\\n      <nav className=\\\"sticky top-0 z-40 border-b border-kyn-slate-50 bg-canvas/80 backdrop-blur-xl px-gutter\\\">\\n        <div className=\\\"mx-auto max-w-screen-md flex h-14 items-center justify-between\\\">\\n          <Breadcrumbs paths={breadcrumbPaths} />\\n          <button\\n            type=\\\"button\\\"\\n            className=\\\"text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors p-2 -mr-2\\\"\\n            aria-label=\\\"Share briefing\\\"\\n          >\\n            <Share2 size={18} />\\n          </button>\\n        </div>\\n      </nav>\\n\\n      <article className=\\\"mx-auto max-w-screen-md px-gutter animate-in fade-in slide-in-from-bottom-4 duration-1000\\\">\\n        {/* Header: Narrative Establishment */}\\n        <header className=\\\"py-12 md:py-24\\\">\\n          <div className=\\\"flex items-center gap-4 mb-10 text-[10px] font-bold uppercase tracking-[0.25em] text-kyn-slate-400\\\">\\n            <span className=\\\"rounded-full border border-kyn-slate-100 bg-white px-3.5 py-2 text-kyn-slate-900 shadow-sm\\\">\\n              {guide.category}\\n            </span>\\n            <span className=\\\"flex items-center gap-1.5\\\">\\n              <Clock size={12} className=\\\"text-kyn-green-600\\\" />\\n              {guide.read_time_minutes ?? 5} Min Read\\n            </span>\\n          </div>\\n\\n          <h1 className=\\\"font-brand text-4xl font-bold tracking-tight text-kyn-slate-900 md:text-6xl lg:text-7xl leading-[1.05]\\\">\\n            {guide.title}\\n          </h1>\\n\\n          {/* Authority Anchor */}\\n          <div className=\\\"mt-12 flex items-center gap-5 border-y border-kyn-slate-50 py-10\\\">\\n            <div className=\\\"flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-kyn-slate-900 font-brand text-lg font-bold text-white shadow-xl\\\">\\n              {displayAuthor[0]}\\n            </div>\\n            <div>\\n              <p className=\\\"font-brand text-sm font-bold uppercase tracking-wider text-kyn-slate-900\\\">\\n                {displayAuthor}\\n              </p>\\n              <div className=\\\"mt-1 flex items-center gap-2 font-ui text-xs text-kyn-slate-400\\\">\\n                <ShieldCheck size={14} className=\\\"text-kyn-green-600\\\" />\\n                <span>Verified Intelligence Source</span>\\n              </div>\\n            </div>\\n          </div>\\n        </header>\\n\\n        {/* Content: Markdown Render Layer */}\\n        <section\\n          className=\\\"prose prose-slate prose-base md:prose-lg max-w-none\\n            prose-headings:font-brand prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-kyn-slate-900\\n            prose-p:font-ui prose-p:leading-[1.8] prose-p:text-text-secondary prose-p:mb-8\\n            prose-strong:text-kyn-slate-900 prose-a:text-kyn-green-700 prose-a:font-bold prose-a:no-underline hover:prose-a:underline\\n            prose-img:rounded-3xl prose-img:shadow-2xl prose-img:border prose-img:border-kyn-slate-100\\n            prose-blockquote:border-l-kyn-green-500 prose-blockquote:bg-kyn-slate-50/50 prose-blockquote:py-2 prose-blockquote:px-6 prose-blockquote:rounded-r-2xl\\\"\\n        >\\n          <div\\n            dangerouslySetInnerHTML={{\\n              __html: guide.content ?? \\\"\\\",\\n            }}\\n          />\\n        </section>\\n\\n        {/* Exit: Return to Discovery */}\\n        <footer className=\\\"mt-32 rounded-[2.5rem] bg-surface border border-kyn-slate-100 p-10 md:p-16 text-center\\\">\\n          <blockquote className=\\\"font-brand text-xl md:text-2xl font-medium text-kyn-slate-900 mb-12 italic leading-relaxed\\\">\\n            &quot;True professional mastery begins with the acquisition of quiet knowledge.&quot;\\n          </blockquote>\\n\\n          <Link\\n            href=\\\"/guides\\\"\\n            className=\\\"group inline-flex items-center gap-3 rounded-2xl bg-kyn-slate-900 px-10 py-5 font-brand text-sm font-bold text-white transition-all active:scale-[0.97] shadow-xl hover:bg-black\\\"\\n          >\\n            <ArrowLeft size={18} className=\\\"transition-transform group-hover:-translate-x-1\\\" />\\n            Back to Briefings\\n          </Link>\\n        </footer>\\n      </article>\\n\\n      {/* Persistence: Visual Progress Feedback */}\\n      <ReadingProgressBar />\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(worlds)/lifestyle/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: World Landing (Lifestyle) v2.0\\n * Fully aligned with canonical types.ts and Supabase v2.\\n */\\n\\nimport { Metadata } from \\\"next\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { ProductCard } from \\\"@/components/marketplace/ProductCard\\\";\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { Sparkles, Wind, Sun, Coffee } from \\\"lucide-react\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\";\\n\\nexport const metadata: Metadata = {\\n  title: \\\"Lifestyle World | Kynar Universe\\\",\\n  description: \\\"Curated tools for elegant living and personal digital sophistication.\\\",\\n};\\n\\nexport default async function LifestyleWorldPage() {\\n  const supabase = await createClient();\\n  \\n  // 1. Fetching Warm Data (Server-Side)\\n  // Aligned with Supabase v2 casting and the canonical 'Lifestyle' enum value\\n  const { data, error } = await supabase\\n    .from(\\\"products\\\")\\n    .select(\\\"*\\\")\\n    .eq(\\\"world\\\", \\\"Lifestyle\\\")\\n    .eq(\\\"is_published\\\", true)\\n    .order(\\\"created_at\\\", { ascending: false });\\n  \\n  if (error) {\\n    console.error(\\\"[Lifestyle World] Fetch failure:\\\", error.message);\\n  }\\n  \\n  // Strongly type products using the alias from types.ts\\n  const products = (data as Product[]) ?? [];\\n  \\n  const breadcrumbPaths = [\\n    { label: \\\"Universe Hub\\\", href: \\\"/\\\" },\\n    { label: \\\"Lifestyle\\\", href: \\\"/lifestyle\\\" },\\n  ];\\n  \\n  return (\\n    <main className=\\\"min-h-screen bg-canvas pb-safe-bottom animate-in fade-in duration-700\\\">\\n      {/* Handrail: Structural Context */}\\n      <div className=\\\"px-gutter pt-6\\\">\\n        <Breadcrumbs paths={breadcrumbPaths} />\\n      </div>\\n\\n      {/* Narrative Hero: Personal Sanctuary Management */}\\n      <header className=\\\"px-gutter pt-16 pb-20 text-center md:pt-28 md:pb-32\\\">\\n        <div className=\\\"mx-auto max-w-3xl\\\">\\n          <div className=\\\"mb-10 flex justify-center\\\">\\n            <div className=\\\"relative group\\\">\\n              <div className=\\\"flex h-20 w-20 items-center justify-center rounded-full bg-kyn-caramel-50 border border-kyn-caramel-100 text-kyn-caramel-600 shadow-kynar-soft transition-all duration-500 group-hover:rotate-12\\\">\\n                <Wind size={32} strokeWidth={1.5} />\\n              </div>\\n              <div className=\\\"absolute -right-1 -top-1 flex h-7 w-7 items-center justify-center rounded-full bg-white border border-border text-kyn-caramel-500 shadow-sm\\\">\\n                <Sun size={14} />\\n              </div>\\n            </div>\\n          </div>\\n          \\n          <h1 className=\\\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl italic\\\">\\n            Lifestyle World\\n          </h1>\\n          <p className=\\\"mt-8 font-ui text-lg leading-relaxed text-text-secondary md:text-xl\\\">\\n            A sector dedicated to the rituals of focus and well-being. Tools for \\n            those who treat their digital habits as an art form.\\n          </p>\\n        </div>\\n      </header>\\n\\n      {/* Grid Controls */}\\n      <section className=\\\"px-gutter\\\">\\n        <div className=\\\"mx-auto max-w-screen-xl\\\">\\n          <div className=\\\"mb-10 flex items-center justify-between border-b border-border pb-6\\\">\\n            <div className=\\\"flex items-center gap-3 text-kyn-caramel-600\\\">\\n              <Coffee size={18} strokeWidth={2} />\\n              <h2 className=\\\"font-brand text-sm font-bold uppercase tracking-[0.2em] text-text-primary\\\">\\n                The Selection\\n              </h2>\\n            </div>\\n            <span className=\\\"font-ui text-[11px] font-bold uppercase tracking-widest text-text-secondary\\\">\\n              {products.length} Objects Harmonized\\n            </span>\\n          </div>\\n\\n          {/* Product Matrix */}\\n          {products.length > 0 ? (\\n            <div className=\\\"grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3\\\">\\n              {products.map((product) => (\\n                <ProductCard key={product.id} product={product} />\\n              ))}\\n            </div>\\n          ) : (\\n            <div className=\\\"flex flex-col items-center justify-center py-32 text-center rounded-[2.5rem] border-2 border-dashed border-kyn-caramel-100 bg-kyn-caramel-50/20\\\">\\n              <Sparkles className=\\\"mb-4 text-kyn-caramel-300\\\" size={32} strokeWidth={1} />\\n              <p className=\\\"font-ui text-sm text-text-secondary italic\\\">\\n                The Lifestyle sector is currently being refined.<br />\\n                New arrivals are being harmonized.\\n              </p>\\n            </div>\\n          )}\\n        </div>\\n      </section>\\n\\n      {/* Philosophy: The Choice of Removal */}\\n      <footer className=\\\"mt-40 bg-kyn-caramel-50/30 border-t border-kyn-caramel-100 px-gutter py-24\\\">\\n        <div className=\\\"mx-auto max-w-2xl text-center\\\">\\n          <h3 className=\\\"font-brand text-2xl font-bold text-text-primary italic\\\">\\n            &quot;Sophistication is found in what we choose to remove.&quot;\\n          </h3>\\n          <p className=\\\"mt-6 font-ui text-base leading-loose text-text-secondary\\\">\\n            In the Lifestyle World, we prioritize digital objects that offer \\n            mental clarity and aesthetic joy. No clutter. No subscriptions. \\n            Just permanent, beautiful utility.\\n          </p>\\n        </div>\\n      </footer>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(worlds)/tools/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: World Landing (Tools) v2.0\\n * Fully aligned with canonical types.ts and Supabase v2.\\n */\\n\\nimport { Metadata } from \\\"next\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { ProductCard } from \\\"@/components/marketplace/ProductCard\\\";\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { Cpu, Zap, Hammer, ShieldCheck } from \\\"lucide-react\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\";\\n\\nexport const metadata: Metadata = {\\n  title: \\\"Tools World | Kynar Technical Hub\\\",\\n  description: \\\"High-performance digital assets engineered for speed and reliability.\\\",\\n};\\n\\nexport default async function ToolsWorldPage() {\\n  const supabase = await createClient();\\n  \\n  // 1. Data Retrieval with explicit casting for Supabase v2\\n  const { data, error } = await supabase\\n    .from(\\\"products\\\")\\n    .select(\\\"*\\\")\\n    .eq(\\\"world\\\", \\\"Tools\\\")\\n    .eq(\\\"is_published\\\", true)\\n    .order(\\\"created_at\\\", { ascending: false });\\n  \\n  if (error) {\\n    console.error(\\\"[Tools World] Database Error:\\\", error.message);\\n  }\\n  \\n  // Strongly type products using the alias from types.ts\\n  const products = (data as Product[]) ?? [];\\n  \\n  const breadcrumbPaths = [\\n    { label: \\\"Universe Hub\\\", href: \\\"/\\\" },\\n    { label: \\\"Tools Sector\\\", href: \\\"/tools\\\" },\\n  ];\\n  \\n  return (\\n    <main className=\\\"min-h-screen bg-canvas pb-safe-bottom animate-in fade-in duration-700\\\">\\n      {/* Handrail: Structural Context */}\\n      <div className=\\\"px-gutter pt-6\\\">\\n        <Breadcrumbs paths={breadcrumbPaths} />\\n      </div>\\n\\n      {/* Narrative Hero: Technical Identity */}\\n      <header className=\\\"px-gutter pt-16 pb-20 text-center md:pt-28 md:pb-32\\\">\\n        <div className=\\\"mx-auto max-w-3xl\\\">\\n          <div className=\\\"mb-10 flex justify-center\\\">\\n            <div className=\\\"relative group\\\">\\n              <div className=\\\"flex h-20 w-20 items-center justify-center rounded-full bg-kyn-slate-900 text-white shadow-2xl transition-all duration-500 group-hover:scale-105\\\">\\n                <Cpu size={32} strokeWidth={1.5} className=\\\"animate-pulse\\\" />\\n              </div>\\n              <div className=\\\"absolute -right-1 -top-1 flex h-7 w-7 items-center justify-center rounded-full bg-kyn-green-500 text-white shadow-sm border-2 border-canvas\\\">\\n                <Zap size={12} fill=\\\"currentColor\\\" />\\n              </div>\\n            </div>\\n          </div>\\n          \\n          <h1 className=\\\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl uppercase\\\">\\n            Tools World\\n          </h1>\\n          <p className=\\\"mt-8 font-ui text-lg leading-relaxed text-text-secondary md:text-xl\\\">\\n            A technical sector for high-leverage components. Engineered for \\n            professionals who require architectural stability in their digital stack.\\n          </p>\\n        </div>\\n      </header>\\n\\n      {/* Product Matrix */}\\n      <section className=\\\"px-gutter\\\">\\n        <div className=\\\"mx-auto max-w-screen-xl\\\">\\n          <div className=\\\"mb-10 flex items-center justify-between border-b border-border pb-6\\\">\\n            <div className=\\\"flex items-center gap-3\\\">\\n              <Hammer size={18} className=\\\"text-kyn-slate-400\\\" />\\n              <h2 className=\\\"font-brand text-sm font-bold uppercase tracking-[0.2em] text-text-primary\\\">\\n                Technical Repository\\n              </h2>\\n            </div>\\n            <span className=\\\"font-ui text-[11px] font-bold uppercase tracking-widest text-text-secondary\\\">\\n              {products.length} Assets Indexed\\n            </span>\\n          </div>\\n\\n          {products.length > 0 ? (\\n            <div className=\\\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\\\">\\n              {products.map((product) => (\\n                <ProductCard key={product.id} product={product} />\\n              ))}\\n            </div>\\n          ) : (\\n            <div className=\\\"py-24 text-center border-2 border-dashed border-border rounded-[2rem] bg-surface/50\\\">\\n              <p className=\\\"font-ui text-sm text-kyn-slate-400 italic\\\">\\n                The technical repository is currently being indexed.\\n              </p>\\n            </div>\\n          )}\\n        </div>\\n      </section>\\n\\n      {/* Standards Footer */}\\n      <footer className=\\\"mt-40 px-gutter py-24 bg-kyn-slate-900 text-white text-center rounded-t-[3rem] shadow-2xl\\\">\\n        <div className=\\\"max-w-2xl mx-auto\\\">\\n          <ShieldCheck className=\\\"mx-auto mb-8 text-kyn-green-400\\\" size={32} strokeWidth={1} />\\n          <h3 className=\\\"font-brand text-2xl font-bold uppercase tracking-widest\\\">Kynar Standards</h3>\\n          <p className=\\\"mt-6 font-ui text-sm text-kyn-slate-400 leading-relaxed max-w-md mx-auto italic\\\">\\n            &quot;Performance is the baseline. Autonomy is the goal.&quot;\\n          </p>\\n        </div>\\n      </footer>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(worlds)/home/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: World Landing (Home) v2.0\\n * Fully aligned with canonical types.ts and Supabase v2.\\n */\\n\\nimport { Metadata } from \\\"next\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { ProductCard } from \\\"@/components/marketplace/ProductCard\\\";\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { Home as HomeIcon, Sparkles, ShieldCheck, Leaf } from \\\"lucide-react\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\";\\n\\nexport const metadata: Metadata = {\\n  title: \\\"Home World | Kynar Universe\\\",\\n  description: \\\"Curated tools for domestic order and personal sanctuary management.\\\",\\n};\\n\\nexport default async function HomeWorldPage() {\\n  const supabase = await createClient();\\n  \\n  // 1. Fetching Grounded Data\\n  // Note: .from<Product> is a legacy pattern; we select and cast for modern Supabase-js v2 clarity\\n  const { data, error } = await supabase\\n    .from(\\\"products\\\")\\n    .select(\\\"*\\\")\\n    .eq(\\\"world\\\", \\\"Home\\\")\\n    .eq(\\\"is_published\\\", true)\\n    .order(\\\"created_at\\\", { ascending: false });\\n  \\n  if (error) {\\n    console.error(\\\"[HomeWorld] Database Fetch Error:\\\", error.message);\\n  }\\n  \\n  // Strongly type products using the alias from types.ts\\n  const products = (data as Product[]) ?? [];\\n  \\n  const breadcrumbPaths = [\\n    { label: \\\"Universe Hub\\\", href: \\\"/\\\" },\\n    { label: \\\"Home World\\\", href: \\\"/home\\\" },\\n  ];\\n  \\n  return (\\n    <main className=\\\"min-h-screen bg-canvas pb-safe-bottom animate-in fade-in duration-700\\\">\\n      {/* Handrail: Top-level navigation context */}\\n      <div className=\\\"px-gutter pt-6\\\">\\n        <Breadcrumbs paths={breadcrumbPaths} />\\n      </div>\\n\\n      {/* Narrative Hero: Focused Sector Identity */}\\n      <header className=\\\"px-gutter pt-16 pb-20 text-center md:pt-28 md:pb-32\\\">\\n        <div className=\\\"mx-auto max-w-3xl\\\">\\n          <div className=\\\"mb-10 flex justify-center\\\">\\n            <div className=\\\"relative\\\">\\n              <div className=\\\"flex h-20 w-20 items-center justify-center rounded-full bg-kyn-green-50 border border-kyn-green-100 text-kyn-green-600 shadow-kynar-soft transition-transform hover:scale-105 duration-500\\\">\\n                <HomeIcon size={32} strokeWidth={1.5} />\\n              </div>\\n              <div className=\\\"absolute -right-1 -top-1 flex h-7 w-7 items-center justify-center rounded-full bg-white border border-border text-kyn-green-500 shadow-sm\\\">\\n                <Leaf size={14} />\\n              </div>\\n            </div>\\n          </div>\\n          \\n          <h1 className=\\\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl\\\">\\n            The Home World\\n          </h1>\\n          <p className=\\\"mt-8 font-ui text-lg leading-relaxed text-text-secondary md:text-xl\\\">\\n            A curated sector for the architecture of daily life. From domestic \\n            inventory to family legacy planningâ€”tools built for permanence.\\n          </p>\\n        </div>\\n      </header>\\n\\n      {/* Grid Controls */}\\n      <section className=\\\"px-gutter\\\">\\n        <div className=\\\"mx-auto max-w-screen-xl\\\">\\n          <div className=\\\"mb-10 flex items-center justify-between border-b border-border pb-6\\\">\\n            <div className=\\\"flex items-center gap-3\\\">\\n              <div className=\\\"h-2 w-2 rounded-full bg-kyn-green-500 animate-pulse\\\" />\\n              <h2 className=\\\"font-brand text-sm font-bold uppercase tracking-[0.2em] text-text-primary\\\">\\n                The Collection\\n              </h2>\\n            </div>\\n            <span className=\\\"font-ui text-[11px] font-bold uppercase tracking-widest text-text-secondary\\\">\\n              {products.length} Assets Available\\n            </span>\\n          </div>\\n\\n          {/* Optimized Product Matrix */}\\n          {products.length > 0 ? (\\n            <div className=\\\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\\\">\\n              {products.map((product) => (\\n                <ProductCard key={product.id} product={product} />\\n              ))}\\n            </div>\\n          ) : (\\n            <div className=\\\"flex flex-col items-center justify-center py-32 text-center rounded-[2rem] border-2 border-dashed border-border bg-surface/40\\\">\\n              <Sparkles className=\\\"mb-4 text-kyn-slate-300\\\" size={32} strokeWidth={1} />\\n              <p className=\\\"font-ui text-sm text-text-secondary\\\">\\n                The Home World is currently being harmonized.<br />\\n                New additions arriving soon.\\n              </p>\\n            </div>\\n          )}\\n        </div>\\n      </section>\\n\\n      {/* World Philosophy Footer */}\\n      <footer className=\\\"mt-40 bg-surface border-t border-border px-gutter py-24\\\">\\n        <div className=\\\"mx-auto max-w-2xl text-center\\\">\\n          <div className=\\\"mb-8 inline-flex h-12 w-12 items-center justify-center rounded-full bg-white border border-border text-kyn-green-600 shadow-sm\\\">\\n            <ShieldCheck size={20} />\\n          </div>\\n          <h3 className=\\\"font-brand text-2xl font-bold text-text-primary\\\">The Kynar Promise</h3>\\n          <blockquote className=\\\"mt-6 font-ui text-base leading-loose text-text-secondary italic\\\">\\n            &quot;We believe the digital foundation of your home should be as stable as \\n            the physical one. Every tool here is selected for its lack of noise \\n            and its commitment to your long-term autonomy.&quot;\\n          </blockquote>\\n        </div>\\n      </footer>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/auth/actions.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Unified Auth Actions (v1.2.1)\\n * Fix: Removed unused 'origin' variable to satisfy TypeScript build.\\n */\\n\\n\\\"use server\\\";\\n\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { redirect } from \\\"next/navigation\\\";\\n\\nexport async function login(formData: FormData) {\\n  const supabase = await createClient();\\n  const email = formData.get(\\\"email\\\") as string;\\n  const password = formData.get(\\\"password\\\") as string;\\n\\n  // We don't need 'origin' here unless we are doing complex dynamic callbacks\\n  const { error } = await supabase.auth.signInWithPassword({ email, password });\\n\\n  if (error) {\\n    return redirect(`?error=${encodeURIComponent(error.message)}`);\\n  }\\n\\n  return redirect(\\\"/library\\\");\\n}\\n\\nexport async function signup(formData: FormData) {\\n  const supabase = await createClient();\\n  const email = formData.get(\\\"email\\\") as string;\\n  const password = formData.get(\\\"password\\\") as string;\\n\\n  const { error } = await supabase.auth.signUp({\\n    email,\\n    password,\\n    options: {\\n      emailRedirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}/auth/callback`,\\n    },\\n  });\\n\\n  if (error) {\\n    return redirect(`?error=${encodeURIComponent(error.message)}`);\\n  }\\n\\n  return redirect(`?message=${encodeURIComponent(\\\"Check your email to confirm registration.\\\")}`);\\n}\\n\\nexport async function logout() {\\n  const supabase = await createClient();\\n  await supabase.auth.signOut();\\n  return redirect(\\\"/\\\");\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/auth/login/page.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n \\n/**\\n * KYNAR UNIVERSE: Authentication Gateway (v1.1)\\n * Role: Entry point for protected sectors (Library & Account).\\n * Features: Error/Success messaging & dynamic loading states.\\n */\\n\\nimport Link from \\\"next/link\\\";\\nimport { Suspense } from \\\"react\\\";\\nimport { useFormStatus } from \\\"react-dom\\\";\\nimport { Compass, ShieldCheck, ArrowRight, Loader2 } from \\\"lucide-react\\\";\\nimport { login } from \\\"../actions\\\";\\nimport { AuthMessage } from \\\"@/components/auth/AuthMessage\\\";\\n\\nexport default function LoginPage() {\\n  return (\\n    <main className=\\\"relative min-h-[80vh] flex items-center justify-center px-gutter py-20\\\">\\n      {/* Background Glow */}\\n      <div className=\\\"absolute top-1/2 left-1/2 -z-10 h-[400px] w-[400px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-kyn-green-50/50 blur-[100px]\\\" />\\n\\n      <div className=\\\"w-full max-w-md\\\">\\n        {/* Brand Identity */}\\n        <div className=\\\"text-center mb-10\\\">\\n          <div className=\\\"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-kyn-slate-900 text-white mb-6\\\">\\n            <Compass size={24} />\\n          </div>\\n          <h1 className=\\\"font-brand text-3xl font-bold text-kyn-slate-900 tracking-tight\\\">\\n            Access Portal\\n          </h1>\\n          <p className=\\\"mt-2 font-ui text-sm text-text-secondary\\\">\\n            Enter your credentials to access the Vault.\\n          </p>\\n        </div>\\n\\n        {/* Login Card */}\\n        <div className=\\\"bg-white border border-border rounded-[2rem] p-8 shadow-kynar-soft\\\">\\n          \\n          {/* Feedback Messages (Error/Success) */}\\n          <Suspense fallback={<div className=\\\"h-10 mb-6 bg-surface animate-pulse rounded-xl\\\" />}>\\n            <AuthMessage />\\n          </Suspense>\\n\\n          <form action={login} className=\\\"space-y-6\\\">\\n            <div>\\n              <label className=\\\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-2\\\">\\n                Email Address\\n              </label>\\n              <input \\n                name=\\\"email\\\"\\n                type=\\\"email\\\"\\n                required\\n                placeholder=\\\"identity@kynar.uk\\\"\\n                className=\\\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:outline-none focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all\\\"\\n              />\\n            </div>\\n\\n            <div>\\n              <div className=\\\"flex justify-between items-center mb-2\\\">\\n                <label className=\\\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\\\">\\n                  Access Key\\n                </label>\\n              </div>\\n              <input \\n                name=\\\"password\\\"\\n                type=\\\"password\\\"\\n                required\\n                placeholder=\\\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\\\"\\n                className=\\\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:outline-none focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all\\\"\\n              />\\n            </div>\\n\\n            <SubmitButton />\\n          </form>\\n\\n          <div className=\\\"mt-8 pt-6 border-t border-border flex flex-col gap-4 text-center\\\">\\n            <p className=\\\"font-ui text-xs text-text-secondary\\\">\\n              Don&apos;t have an identity record? \\n              <Link href=\\\"/auth/signup\\\" className=\\\"ml-1 text-kyn-slate-900 font-bold hover:text-kyn-green-600 transition-colors\\\">\\n                Register here\\n              </Link>\\n            </p>\\n          </div>\\n        </div>\\n\\n        {/* Security Footnote */}\\n        <div className=\\\"mt-8 flex items-center justify-center gap-2 text-kyn-slate-400\\\">\\n          <ShieldCheck size={14} />\\n          <span className=\\\"font-ui text-[10px] font-bold uppercase tracking-widest\\\">\\n            End-to-End Encryption Active\\n          </span>\\n        </div>\\n      </div>\\n    </main>\\n  );\\n}\\n\\n/**\\n * Sub-component to handle loading state via useFormStatus\\n */\\nfunction SubmitButton() {\\n  const { pending } = useFormStatus();\\n\\n  return (\\n    <button \\n      type=\\\"submit\\\"\\n      disabled={pending}\\n      className=\\\"group w-full flex items-center justify-center gap-2 py-4 bg-kyn-slate-900 text-white font-brand font-bold rounded-xl hover:bg-kyn-slate-800 transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed\\\"\\n    >\\n      {pending ? (\\n        <>\\n          <Loader2 size={18} className=\\\"animate-spin\\\" />\\n          Authenticating...\\n        </>\\n      ) : (\\n        <>\\n          Initialize Session\\n          <ArrowRight size={16} className=\\\"group-hover:translate-x-1 transition-transform\\\" />\\n        </>\\n      )}\\n    </button>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/auth/callback/route.ts\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Identity Resolution (v2.1)\\n * Role: Exchanging the temporary PKCE code for a persistent user session.\\n * Fully aligned with Next.js 16 and Production URL resolution.\\n */\\n\\nimport { NextResponse } from 'next/server';\\nimport { createClient } from '@/lib/supabase/server';\\n\\nexport async function GET(request: Request) {\\n  const { searchParams, origin } = new URL(request.url);\\n  const code = searchParams.get('code');\\n  const next = searchParams.get('next') ?? '/library';\\n  /**\\n   * Production URL Resolution\\n   * Ensuring redirects function across local, preview (Netlify), and production.\\n   */\\n  const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || \\n                  process.env.URL || \\n                  origin;\\n  if (code) {\\n    const supabase = await createClient();\\n    // Exchange the PKCE code for a session\\n    const { error } = await supabase.auth.exchangeCodeForSession(code);\\n    if (!error) {\\n      // Identity confirmed. Constructing absolute path for the Vault.\\n      const target = new URL(next, siteUrl);\\n      \\n      // We use a 303 See Other redirect to ensure a GET request is used on the next hop\\n      return NextResponse.redirect(target.toString(), 303);\\n    }\\n    \\n    console.error(\\\"[Auth Callback] Exchange Error:\\\", error.message);\\n  }\\n\\n  // Fallback: If code is missing or exchange fails, return to logic with context\\n  const fallback = new URL('/auth/login?error=link-invalid', siteUrl);\\n  return NextResponse.redirect(fallback.toString(), 303);\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/auth/signup/page.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n /**\\n * KYNAR UNIVERSE: Identity Registration (v1.1)\\n * Role: Creating new records in the Universe.\\n * Features: Error/Success messaging & dynamic loading states via useFormStatus.\\n */\\n\\nimport Link from \\\"next/link\\\";\\nimport { Suspense } from \\\"react\\\";\\nimport { useFormStatus } from \\\"react-dom\\\";\\nimport { Compass, ArrowRight, Loader2 } from \\\"lucide-react\\\";\\nimport { signup } from \\\"../actions\\\";\\nimport { AuthMessage } from \\\"@/components/auth/AuthMessage\\\";\\n\\nexport default function SignupPage() {\\n  return (\\n    <main className=\\\"relative min-h-[80vh] flex items-center justify-center px-gutter py-20\\\">\\n      {/* Background Glow */}\\n      <div className=\\\"absolute top-1/2 left-1/2 -z-10 h-[400px] w-[400px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-kyn-caramel-50/50 blur-[100px]\\\" />\\n\\n      <div className=\\\"w-full max-w-md\\\">\\n        {/* Brand Identity */}\\n        <div className=\\\"text-center mb-10\\\">\\n          <div className=\\\"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-kyn-slate-900 text-white mb-6\\\">\\n            <Compass size={24} />\\n          </div>\\n          <h1 className=\\\"font-brand text-3xl font-bold text-kyn-slate-900 tracking-tight\\\">\\n            Create Identity\\n          </h1>\\n          <p className=\\\"mt-2 font-ui text-sm text-text-secondary\\\">\\n            Begin your journey in the Kynar ecosystem.\\n          </p>\\n        </div>\\n\\n        {/* Signup Card */}\\n        <div className=\\\"bg-white border border-border rounded-[2rem] p-8 shadow-kynar-soft\\\">\\n          \\n          {/* Feedback Messages (Error/Success) */}\\n          <Suspense fallback={<div className=\\\"h-10 mb-6 bg-surface animate-pulse rounded-xl\\\" />}>\\n            <AuthMessage />\\n          </Suspense>\\n\\n          <form action={signup} className=\\\"space-y-6\\\">\\n            <div>\\n              <label className=\\\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-2\\\">\\n                Email Address\\n              </label>\\n              <input \\n                name=\\\"email\\\" \\n                type=\\\"email\\\" \\n                required \\n                placeholder=\\\"identity@kynar.uk\\\" \\n                className=\\\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all outline-none\\\" \\n              />\\n            </div>\\n\\n            <div>\\n              <label className=\\\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-2\\\">\\n                Access Key (Password)\\n              </label>\\n              <input \\n                name=\\\"password\\\" \\n                type=\\\"password\\\" \\n                required \\n                placeholder=\\\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\\\" \\n                className=\\\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all outline-none\\\" \\n              />\\n            </div>\\n\\n            <SubmitButton />\\n          </form>\\n\\n          <div className=\\\"mt-8 pt-6 border-t border-border text-center\\\">\\n            <p className=\\\"font-ui text-xs text-text-secondary\\\">\\n              Already have an identity? \\n              <Link href=\\\"/auth/login\\\" className=\\\"ml-1 text-kyn-slate-900 font-bold hover:text-kyn-green-600 transition-colors\\\">\\n                Login here\\n              </Link>\\n            </p>\\n          </div>\\n        </div>\\n      </div>\\n    </main>\\n  );\\n}\\n\\n/**\\n * Sub-component to handle loading state via useFormStatus\\n */\\nfunction SubmitButton() {\\n  const { pending } = useFormStatus();\\n\\n  return (\\n    <button \\n      type=\\\"submit\\\" \\n      disabled={pending}\\n      className=\\\"group w-full flex items-center justify-center gap-2 py-4 bg-kyn-slate-900 text-white font-brand font-bold rounded-xl hover:bg-kyn-slate-800 transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed\\\"\\n    >\\n      {pending ? (\\n        <>\\n          <Loader2 size={18} className=\\\"animate-spin\\\" />\\n          Registering...\\n        </>\\n      ) : (\\n        <>\\n          Register Identity\\n          <ArrowRight size={16} className=\\\"group-hover:translate-x-1 transition-transform\\\" />\\n        </>\\n      )}\\n    </button>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/layout.tsx\": {\n    \"text\": \"/* KYNAR UNIVERSE: Marketplace Layout (v1.6) app/(marketplace)layout.tsx */\\n\\n\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\n\\ninterface MarketplaceLayoutProps {\\n  children: React.ReactNode;\\n}\\n\\nexport default function MarketplaceLayout({ children }: MarketplaceLayoutProps) {\\n  return (\\n    <div className=\\\"relative flex min-h-screen flex-col bg-canvas selection:bg-kyn-green-100\\\">\\n      \\n      {/* Transactional Handrail */}\\n      <nav \\n        className=\\\"sticky top-0 z-40 w-full border-b border-kyn-slate-50 bg-canvas/80 backdrop-blur-xl\\\"\\n        aria-label=\\\"Marketplace Navigation\\\"\\n      >\\n        <div className=\\\"mx-auto max-w-screen-xl px-gutter\\\">\\n          <div className=\\\"flex h-14 items-center md:h-20\\\">\\n            <Breadcrumbs \\n              paths={[\\n                { label: \\\"Universe Hub\\\", href: \\\"/\\\" },\\n                { label: \\\"Marketplace\\\", href: \\\"/store\\\" }\\n              ]} \\n            />\\n          </div>\\n        </div>\\n      </nav>\\n\\n      <main className=\\\"flex-1 overflow-x-hidden\\\">\\n        <div className=\\\"animate-in fade-in duration-500\\\">\\n          {children}\\n        </div>\\n      </main>\\n\\n      {/* Mobile Fade */}\\n      <aside className=\\\"pointer-events-none fixed bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-canvas to-transparent md:hidden z-30\\\" />\\n    </div>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/checkout/loading.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Checkout Loading (v1.5)\\n * Role: The \\\"Calm Bridge\\\" - Reassured transition to external gateway.\\n * Aligned with: UX Canon Section 1 (Reassured State) & Design System Section 11.\\n */\\n\\nimport { ShieldCheck, Lock } from \\\"lucide-react\\\";\\n\\nexport default function CheckoutLoading() {\\n  return (\\n    <main className=\\\"flex min-h-[80vh] flex-col items-center justify-center px-gutter text-center animate-in fade-in duration-500\\\">\\n      \\n      {/* Structural Loading Anchor - Design System Section 11 */}\\n      <div className=\\\"relative mb-12 flex items-center justify-center\\\">\\n        {/* Outer Atmospheric Ring */}\\n        <div className=\\\"h-24 w-24 rounded-full border border-kyn-slate-100/50 bg-surface shadow-kynar-soft\\\" />\\n        \\n        {/* Active Processing Ring */}\\n        <div className=\\\"absolute h-24 w-24 animate-spin rounded-full border-2 border-transparent border-t-kyn-green-600\\\" />\\n        \\n        {/* Core Security Identifier */}\\n        <div className=\\\"absolute flex h-12 w-12 items-center justify-center rounded-full bg-kyn-slate-900 text-white shadow-lg\\\">\\n          <Lock size={18} strokeWidth={2.5} />\\n        </div>\\n      </div>\\n      \\n      {/* Narrative Reassurance */}\\n      <div className=\\\"max-w-xs space-y-4\\\">\\n        <h2 className=\\\"font-brand text-2xl font-bold tracking-tight text-kyn-slate-900 md:text-3xl\\\">\\n          Securing your <br /> <span className=\\\"italic\\\">connection.</span>\\n        </h2>\\n        <p className=\\\"font-ui text-sm leading-relaxed text-text-secondary md:text-base\\\">\\n          Please wait a moment while we prepare your secure handoff to the vault gateway.\\n        </p>\\n      </div>\\n\\n      {/* Security Status Bar - Design System Section 19.3 */}\\n      <div className=\\\"mt-16 flex flex-col items-center gap-6\\\">\\n        <div className=\\\"flex items-center gap-2.5 rounded-full bg-white border border-border px-5 py-2.5 shadow-sm\\\">\\n          <span className=\\\"relative flex h-2 w-2\\\">\\n            <span className=\\\"animate-ping absolute inline-flex h-full w-full rounded-full bg-kyn-green-400 opacity-75\\\"></span>\\n            <span className=\\\"relative inline-flex rounded-full h-2 w-2 bg-kyn-green-500\\\"></span>\\n          </span>\\n          <span className=\\\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-500\\\">\\n            Encrypted Handoff Active\\n          </span>\\n        </div>\\n\\n        <div className=\\\"flex items-center gap-2 text-kyn-slate-300\\\">\\n          <ShieldCheck size={14} />\\n          <span className=\\\"font-ui text-[9px] uppercase tracking-widest\\\">\\n            PCI-DSS Level 1 Compliant\\n          </span>\\n        </div>\\n      </div>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/checkout/page.tsx\": {\n    \"text\": \"import { redirect } from \\\"next/navigation\\\";\\nimport { generateCheckoutUrl } from \\\"@/lib/lemon-squeezy/checkout\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\";\\n\\ninterface CheckoutPageProps {\\n  searchParams: Promise<{ items?: string }>;\\n}\\n\\nexport default async function CheckoutPage({\\n  searchParams,\\n}: CheckoutPageProps) {\\n  // 1. Resolve searchParams before accessing keys (Next.js 15+ Requirement)\\n  const params = await searchParams;\\n  const rawItems = params.items;\\n\\n  const supabase = await createClient();\\n  const { data: { user } } = await supabase.auth.getUser();\\n\\n  if (!user) {\\n    redirect(\\\"/auth/login?return_to=/cart\\\");\\n  }\\n\\n  if (!rawItems) redirect(\\\"/cart\\\");\\n\\n  let productIds: string[] = [];\\n  try {\\n    productIds = JSON.parse(decodeURIComponent(rawItems));\\n  } catch (e) {\\n    console.error(\\\"Selection Parse Error:\\\", e);\\n    redirect(\\\"/cart?error=invalid_selection\\\");\\n  }\\n\\n  // 2. Fetch products - Keep 'as any' specifically for the query chain to pass linting\\n  const { data: products, error } = await (supabase\\n    .from(\\\"products\\\")\\n    .select(\\\"id, title, price_id, slug, lemon_squeezy_id\\\")\\n    .in(\\\"id\\\", productIds) as any);\\n\\n  if (error || !products || products.length === 0) {\\n    console.error(\\\"Verification Error:\\\", error);\\n    redirect(\\\"/cart?error=verification_failed\\\");\\n  }\\n\\n  const checkoutUrl = await generateCheckoutUrl({\\n    products: products as Product[],\\n    userId: user.id,\\n    userEmail: user.email ?? \\\"\\\",\\n  });\\n\\n  if (checkoutUrl) {\\n    redirect(checkoutUrl);\\n  } else {\\n    redirect(\\\"/cart?error=gateway_timeout\\\");\\n  }\\n\\n  return (\\n    <main className=\\\"flex min-h-[85vh] w-full flex-col items-center justify-center px-gutter bg-canvas text-center\\\">\\n      <div className=\\\"max-w-xs animate-in fade-in slide-in-from-bottom-8 duration-1000\\\">\\n        <h1 className=\\\"font-brand text-2xl font-bold tracking-tight text-kyn-slate-900 uppercase\\\">\\n          Preparing Acquisition\\n        </h1>\\n        <p className=\\\"mt-4 font-ui text-[11px] uppercase tracking-[0.2em] leading-relaxed text-kyn-slate-400\\\">\\n          Initializing secure checkout for your vault selection.\\n        </p>\\n      </div>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/checkout/success/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Acquisition Success (v1.6)\\n * Role: Post-purchase \\\"Vault Opening\\\" experience.\\n */\\n\\nimport Link from \\\"next/link\\\";\\nimport { ShieldCheck, Library } from \\\"lucide-react\\\";\\nimport { CelebrationTrigger } from \\\"@/components/marketplace/CelebrationTrigger\\\";\\n\\nexport default function CheckoutSuccessPage() {\\n  return (\\n    <main className=\\\"min-h-[90vh] flex flex-col items-center justify-center bg-canvas px-gutter\\\">\\n      {/* This runs on the client once the page mounts */}\\n      <CelebrationTrigger />\\n\\n      <div className=\\\"max-w-md w-full text-center space-y-8 animate-in fade-in slide-in-from-bottom-10 duration-1000\\\">\\n        <div className=\\\"mx-auto h-24 w-24 rounded-[2rem] bg-kyn-green-500/10 flex items-center justify-center text-kyn-green-600\\\">\\n          <ShieldCheck size={48} strokeWidth={1.5} />\\n        </div>\\n\\n        <div className=\\\"space-y-4\\\">\\n          <h1 className=\\\"font-brand text-4xl font-bold text-kyn-slate-900 tracking-tight\\\">\\n            Acquisition Secured\\n          </h1>\\n          <p className=\\\"font-ui text-base text-text-secondary leading-relaxed\\\">\\n            Your technical assets have been successfully registered to your identity. \\n            The Kynar Vault is now synchronized.\\n          </p>\\n        </div>\\n\\n        <div className=\\\"flex flex-col gap-4 pt-4\\\">\\n          <Link \\n            href=\\\"/library\\\" \\n            className=\\\"flex items-center justify-center gap-3 w-full py-5 bg-kyn-slate-900 text-white rounded-2xl font-brand text-sm font-black uppercase tracking-widest hover:bg-black transition-all active:scale-[0.98]\\\"\\n          >\\n            <Library size={18} />\\n            Enter My Library\\n          </Link>\\n          \\n          <Link \\n            href=\\\"/\\\" \\n            className=\\\"font-brand text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\\\"\\n          >\\n            Return to Hub\\n          </Link>\\n        </div>\\n      </div>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/checkout/error/page.tsx\": {\n    \"text\": \"\\\"use client\\\";\\n\\n/**\\n * KYNAR UNIVERSE: Checkout Error (v1.5)\\n * Role: Grounded recovery and technical reassurance.\\n * Alignment: UX Canon Section 1 (Reassured State) & Design System 3.3.\\n */\\n\\nimport { useEffect, useState } from \\\"react\\\";\\nimport Link from \\\"next/link\\\";\\nimport { useRouter } from \\\"next/navigation\\\";\\nimport { MoveLeft, RefreshCw, LifeBuoy, AlertCircle } from \\\"lucide-react\\\";\\n\\nexport default function CheckoutErrorPage() {\\n  const router = useRouter();\\n  const [mounted, setMounted] = useState(false);\\n\\n  // 1. Prevent Hydration Mismatch for Client-Only Logic\\n  useEffect(() => {\\n    setMounted(true);\\n  }, []);\\n\\n  if (!mounted) return null;\\n\\n  return (\\n    <main className=\\\"flex min-h-[85vh] flex-col items-center justify-center px-gutter text-center selection:bg-kyn-caramel-100\\\">\\n      \\n      {/* Visual Anchor: Caramel Alert Palette (Design System 3.3) */}\\n      <div className=\\\"animate-in fade-in zoom-in-95 duration-700 ease-out flex flex-col items-center\\\">\\n        <div className=\\\"relative mb-10\\\">\\n          <div className=\\\"flex h-24 w-24 items-center justify-center rounded-full bg-kyn-caramel-50 border border-kyn-caramel-100 shadow-kynar-soft\\\">\\n            <div className=\\\"flex h-14 w-14 items-center justify-center rounded-full bg-white text-kyn-caramel-600 shadow-sm\\\">\\n              <LifeBuoy className=\\\"h-7 w-7 animate-spin-slow\\\" strokeWidth={1.5} />\\n            </div>\\n          </div>\\n          <div className=\\\"absolute -right-1 -top-1 rounded-full bg-white p-2 shadow-sm border border-border\\\">\\n            <AlertCircle size={16} className=\\\"text-kyn-caramel-500\\\" />\\n          </div>\\n        </div>\\n\\n        <header className=\\\"max-w-md space-y-6\\\">\\n          <h1 className=\\\"font-brand text-3xl font-bold tracking-tight text-kyn-slate-900 md:text-5xl\\\">\\n            Connection <span className=\\\"italic\\\">Interrupted.</span>\\n          </h1>\\n          <p className=\\\"font-ui text-base leading-relaxed text-text-secondary px-4 md:text-lg\\\">\\n            We couldn&apos;t establish a secure link to the gateway. Your selection remains safely stored in your vault.\\n          </p>\\n        </header>\\n\\n        {/* Action Zone: Tactical Recovery Actions */}\\n        <div className=\\\"mt-12 flex w-full max-w-sm flex-col gap-4\\\">\\n          <button \\n            onClick={() => router.refresh()}\\n            className=\\\"group flex items-center justify-center gap-3 rounded-2xl bg-kyn-slate-900 py-5 font-brand text-base font-bold text-white transition-all hover:bg-black active:scale-[0.97] shadow-xl\\\"\\n          >\\n            <RefreshCw className=\\\"h-5 w-5 transition-transform group-hover:rotate-180 duration-700\\\" />\\n            Try Connection Again\\n          </button>\\n\\n          <Link \\n            href=\\\"/cart\\\"\\n            className=\\\"flex items-center justify-center gap-3 rounded-2xl border border-border bg-white py-5 font-brand text-base font-bold text-kyn-slate-900 transition-all hover:bg-surface active:scale-[0.97]\\\"\\n          >\\n            <MoveLeft className=\\\"h-4 w-4\\\" />\\n            Back to Selection\\n          </Link>\\n        </div>\\n\\n        {/* Technical Metadata: Troubleshooting Layer */}\\n        <footer className=\\\"mt-24 flex flex-col items-center gap-4\\\">\\n          <div className=\\\"h-px w-10 bg-border\\\" />\\n          <div className=\\\"space-y-1\\\">\\n            <p className=\\\"font-ui text-[10px] font-bold uppercase tracking-[0.3em] text-kyn-slate-400\\\">\\n              System Status: Pending Re-entry\\n            </p>\\n            <p className=\\\"font-ui text-[9px] text-kyn-caramel-600/60 uppercase tracking-widest\\\">\\n              Error Hash: KY-GATEWAY-01-SECURE\\n            </p>\\n          </div>\\n        </footer>\\n      </div>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/products/[slug]/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Product Page (v2.2)\\n * Final Build Fix: Applied type-casting to Supabase queries to bypass \\n * the 'never' type error in Next.js 16/Turbopack production builds.\\n */\\n\\nimport { notFound } from \\\"next/navigation\\\";\\nimport Image from \\\"next/image\\\";\\nimport Link from \\\"next/link\\\";\\nimport { Metadata } from \\\"next\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { getPriceFromId } from \\\"@/lib/marketplace/pricing\\\"; \\nimport { formatGBP } from \\\"@/lib/utils\\\"; \\nimport { AddToCartButton } from \\\"@/components/marketplace/AddToCartButton\\\";\\nimport { Product } from \\\"@/lib/supabase/types\\\";\\nimport { ShieldCheck, Download, Zap, Landmark } from \\\"lucide-react\\\";\\n\\ninterface ProductPageProps {\\n  params: Promise<{ slug: string }>;\\n}\\n\\n/**\\n * SEO: Dynamic Metadata Generation\\n * Using 'as any' on the query to prevent the 'Property title does not exist on type never' \\n * error during the Netlify build process.\\n */\\nexport async function generateMetadata(\\n  { params }: ProductPageProps\\n): Promise<Metadata> {\\n  const { slug } = await params;\\n  const supabase = await createClient();\\n\\n  // FIX: Force type to avoid 'never' inference during build\\n  const { data: product } = await (supabase\\n    .from(\\\"products\\\")\\n    .select(\\\"title, short_description\\\")\\n    .eq(\\\"slug\\\", slug)\\n    .maybeSingle() as any);\\n\\n  return {\\n    title: product?.title\\n      ? `${product.title} | Kynar Universe`\\n      : \\\"Product | Hub\\\",\\n    description:\\n      product?.short_description ?? \\\"Explore this digital asset in the Kynar Universe.\\\",\\n  };\\n}\\n\\nexport default async function ProductPage({ params }: ProductPageProps) {\\n  const { slug } = await params;\\n  const supabase = await createClient();\\n\\n  // Parallel fetch for Product and Auth state\\n  // FIX: Applied 'as any' to ensure the build doesn't crash on type-checking\\n  const [\\n    { data: productData },\\n    { data: authData },\\n  ] = await Promise.all([\\n    (supabase\\n      .from(\\\"products\\\")\\n      .select(\\\"*\\\")\\n      .eq(\\\"slug\\\", slug)\\n      .single() as any),\\n    supabase.auth.getUser(),\\n  ]);\\n\\n  if (!productData) notFound();\\n\\n  const product = productData as Product;\\n  const user = authData?.user;\\n\\n  // Ownership Check for the Vault\\n  const { data: ownership } = user\\n    ? await (supabase\\n        .from(\\\"user_library\\\")\\n        .select(\\\"id\\\")\\n        .eq(\\\"user_id\\\", user.id)\\n        .eq(\\\"product_id\\\", product.id)\\n        .maybeSingle() as any)\\n    : { data: null };\\n\\n  const price = getPriceFromId(product.price_id);\\n\\n  const breadcrumbPaths = [\\n    { label: \\\"The Hub\\\", href: \\\"/store\\\" },\\n    {\\n      label: product.world || \\\"Universal\\\",\\n      href: `/store?world=${product.world}`,\\n    },\\n    {\\n      label: product.title,\\n      href: `/products/${product.slug}`,\\n    },\\n  ];\\n\\n  return (\\n    <main className=\\\"min-h-screen bg-canvas pb-32 animate-in fade-in duration-1000\\\">\\n      <div className=\\\"max-w-screen-xl mx-auto px-gutter pt-8\\\">\\n        <Breadcrumbs paths={breadcrumbPaths} />\\n      </div>\\n\\n      <section className=\\\"max-w-screen-xl mx-auto px-gutter mt-8 lg:mt-16\\\">\\n        <div className=\\\"grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20\\\">\\n          \\n          {/* Left Column: Visuals and Technical Content */}\\n          <div className=\\\"lg:col-span-7 space-y-8\\\">\\n            <div className=\\\"group relative aspect-[16/10] w-full overflow-hidden rounded-3xl border border-border bg-surface shadow-kynar-soft\\\">\\n              <Image\\n                src={product.preview_image || \\\"/assets/placeholder.jpg\\\"}\\n                alt={product.title}\\n                fill\\n                priority\\n                className=\\\"object-cover transition-transform duration-700 group-hover:scale-105\\\"\\n              />\\n            </div>\\n\\n            <div className=\\\"hidden lg:block\\\">\\n              <h2 className=\\\"font-brand text-2xl font-bold text-kyn-slate-900 mb-6\\\">\\n                Technical Architecture\\n              </h2>\\n              <div\\n                className=\\\"prose prose-slate max-w-none font-ui text-text-secondary leading-relaxed\\\"\\n                dangerouslySetInnerHTML={{\\n                  __html: product.description || \\\"\\\",\\n                }}\\n              />\\n            </div>\\n          </div>\\n\\n          {/* Right Column: Transactional Sticky Sidebar */}\\n          <div className=\\\"lg:col-span-5\\\">\\n            <div className=\\\"sticky top-24 space-y-8\\\">\\n              <div>\\n                <span className=\\\"font-ui text-[10px] font-bold uppercase tracking-[0.3em] text-kyn-slate-400\\\">\\n                  Sector: {product.world || \\\"Universal\\\"}\\n                </span>\\n                <h1 className=\\\"font-brand mt-4 text-4xl font-bold tracking-tight text-kyn-slate-900 md:text-5xl\\\">\\n                  {product.title}\\n                </h1>\\n              </div>\\n\\n              <div className=\\\"rounded-2xl border border-border bg-surface p-8 shadow-kynar-soft transition-all hover:shadow-kynar-deep\\\">\\n                <div className=\\\"flex items-center justify-between mb-8\\\">\\n                  <div>\\n                    <p className=\\\"font-ui text-[10px] font-bold uppercase tracking-wider text-kyn-slate-400\\\">\\n                      Fixed Value\\n                    </p>\\n                    <p className=\\\"font-brand text-3xl font-bold text-kyn-slate-900\\\">\\n                      {price === 0 ? \\\"Complimentary\\\" : formatGBP(price)}\\n                    </p>\\n                  </div>\\n                  <Zap size={24} className=\\\"text-kyn-green-600\\\" fill=\\\"currentColor\\\" />\\n                </div>\\n\\n                {ownership ? (\\n                  <Link\\n                    href=\\\"/library\\\"\\n                    className=\\\"flex w-full items-center justify-center gap-3 rounded-xl bg-kyn-green-600 py-4 font-brand text-sm font-bold text-white hover:bg-kyn-green-700 transition-all active:scale-[0.98]\\\"\\n                  >\\n                    <Landmark size={18} />\\n                    In Your Vault\\n                  </Link>\\n                ) : (\\n                  <AddToCartButton product={product} />\\n                )}\\n\\n                <div className=\\\"mt-6 flex items-center gap-3 text-[11px] font-ui text-text-secondary\\\">\\n                  <ShieldCheck size={14} className=\\\"text-kyn-green-500\\\" />\\n                  <span>Verified Asset. One-time acquisition.</span>\\n                </div>\\n              </div>\\n\\n              {/* Format Tags (Notion, PDF, etc) */}\\n              {Array.isArray(product.file_types) && product.file_types.length > 0 && (\\n                <div className=\\\"space-y-4 pt-4\\\">\\n                  <h3 className=\\\"font-brand text-xs font-bold uppercase tracking-widest text-kyn-slate-900\\\">\\n                    Format Integrity\\n                  </h3>\\n                  <ul className=\\\"grid grid-cols-2 gap-3\\\">\\n                    {(product.file_types as string[]).map((ft) => (\\n                      <li key={ft} className=\\\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white border border-border font-ui text-[11px] text-kyn-slate-600\\\">\\n                        <Download size={12} className=\\\"text-kyn-slate-400\\\" />\\n                        {ft}\\n                      </li>\\n                    ))}\\n                  </ul>\\n                </div>\\n              )}\\n            </div>\\n          </div>\\n        </div>\\n      </section>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/cart/page.tsx\": {\n    \"text\": \"/* KYNAR UNIVERSE: app/(marketplace)/cart/page.tsx */\\n\\n\\\"use client\\\";\\n\\nimport { useState, useEffect } from \\\"react\\\";\\nimport Link from \\\"next/link\\\";\\nimport { Trash2, ArrowRight, ShoppingBag, ChevronLeft } from \\\"lucide-react\\\";\\nimport { useCartItems, useCartActions } from \\\"@/lib/cart/store\\\";\\nimport { getPriceFromId } from \\\"@/lib/marketplace/pricing\\\";\\nimport { formatGBP, hapticFeedback } from \\\"@/lib/utils\\\";\\n\\nexport default function CartPage() {\\n  const [mounted, setMounted] = useState(false);\\n  \\n  const { items, count, isEmpty } = useCartItems();\\n  const { removeItem, clearCart } = useCartActions();\\n\\n  // 1. Prevent Hydration Mismatch\\n  useEffect(() => {\\n    setMounted(true);\\n  }, []);\\n\\n  // 2. Calculate totals safe from SSR mismatch & undefined pricing\\n  const totalPrice = mounted \\n    ? items.reduce((sum, item) => {\\n        const price = getPriceFromId(item.price_id);\\n        return sum + (price ?? 0);\\n      }, 0)\\n    : 0;\\n\\n  // Loading State / SSR Placeholder\\n  if (!mounted) {\\n    return (\\n      <div className=\\\"mx-auto max-w-2xl px-gutter py-24\\\">\\n        <div className=\\\"h-8 w-48 animate-pulse rounded-lg bg-surface mb-8\\\" />\\n        <div className=\\\"space-y-4\\\">\\n          {[1, 2].map((i) => (\\n            <div key={i} className=\\\"h-24 w-full animate-pulse rounded-2xl bg-surface\\\" />\\n          ))}\\n        </div>\\n      </div>\\n    );\\n  }\\n\\n  // Empty State\\n  if (isEmpty) {\\n    return (\\n      <div className=\\\"flex min-h-[70vh] flex-col items-center justify-center px-gutter text-center animate-in fade-in duration-700\\\">\\n        <div className=\\\"mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-surface text-kyn-slate-200\\\">\\n          <ShoppingBag size={32} />\\n        </div>\\n        <h1 className=\\\"font-brand text-xl font-bold text-kyn-slate-900 uppercase tracking-widest\\\">Selection Empty</h1>\\n        <p className=\\\"mt-2 font-ui text-[11px] uppercase tracking-[0.2em] text-kyn-slate-400\\\">Your vault awaits new additions.</p>\\n        <Link \\n          href=\\\"/store\\\" \\n          className=\\\"mt-10 rounded-xl bg-kyn-slate-900 px-10 py-4 font-brand text-[10px] font-black uppercase tracking-[0.2em] text-white transition-all active:scale-95 shadow-xl shadow-kyn-slate-900/10\\\"\\n        >\\n          Explore Store\\n        </Link>\\n      </div>\\n    );\\n  }\\n\\n  return (\\n    <div className=\\\"mx-auto max-w-2xl px-gutter py-12 pb-48 animate-in fade-in slide-in-from-bottom-4 duration-1000\\\">\\n      {/* Header */}\\n      <header className=\\\"mb-12 flex items-end justify-between\\\">\\n        <div>\\n          <Link href=\\\"/store\\\" className=\\\"group mb-4 flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\\\">\\n            <ChevronLeft size={14} className=\\\"transition-transform group-hover:-translate-x-1\\\" />\\n            Continue Browsing\\n          </Link>\\n          <h1 className=\\\"font-brand text-sm font-black uppercase tracking-[0.3em] text-kyn-slate-900\\\">\\n            Selection Terminal\\n          </h1>\\n        </div>\\n        <button \\n          onClick={() => { hapticFeedback('medium'); clearCart(); }}\\n          className=\\\"text-[10px] font-bold uppercase tracking-widest text-red-400 hover:text-red-600 transition-colors\\\"\\n        >\\n          Reset All\\n        </button>\\n      </header>\\n\\n      {/* Item List */}\\n      <div className=\\\"space-y-3\\\">\\n        {items.map((product) => {\\n          const price = getPriceFromId(product.price_id) ?? 0;\\n          \\n          return (\\n            <div \\n              key={product.id} \\n              className=\\\"group flex items-center gap-6 rounded-3xl border border-border bg-white p-5 transition-all hover:border-kyn-slate-200 hover:shadow-kynar-soft\\\"\\n            >\\n              <div className=\\\"flex-1 min-w-0\\\">\\n                <span className=\\\"font-ui text-[9px] font-bold uppercase tracking-[0.25em] text-kyn-slate-400\\\">\\n                  {product.world}\\n                </span>\\n                <h3 className=\\\"truncate font-brand text-lg font-bold text-kyn-slate-900 mt-0.5\\\">\\n                  {product.title}\\n                </h3>\\n              </div>\\n\\n              <div className=\\\"flex items-center gap-6\\\">\\n                <p className=\\\"font-brand text-sm font-bold text-kyn-slate-900\\\">\\n                  {price === 0 ? \\\"Free\\\" : formatGBP(price)}\\n                </p>\\n                <button \\n                  onClick={() => { hapticFeedback('light'); removeItem(product.id); }}\\n                  className=\\\"p-2 text-kyn-slate-200 hover:text-red-500 transition-colors\\\"\\n                  aria-label=\\\"Remove item\\\"\\n                >\\n                  <Trash2 size={18} />\\n                </button>\\n              </div>\\n            </div>\\n          );\\n        })}\\n      </div>\\n\\n      {/* Checkout Summary Footer */}\\n      <footer className=\\\"fixed bottom-24 left-0 z-40 w-full px-gutter md:bottom-12\\\">\\n        <div className=\\\"mx-auto max-w-2xl rounded-[2.5rem] bg-kyn-slate-900 p-8 shadow-2xl shadow-kyn-slate-900/20 text-white\\\">\\n          <div className=\\\"mb-6 flex items-center justify-between border-b border-white/10 pb-6\\\">\\n            <div>\\n              <p className=\\\"text-[10px] font-bold uppercase tracking-[0.2em] text-white/40 mb-1\\\">Total Commitment</p>\\n              <p className=\\\"font-brand text-3xl font-bold\\\">{formatGBP(totalPrice)}</p>\\n            </div>\\n            <div className=\\\"text-right\\\">\\n              <p className=\\\"text-[10px] font-bold uppercase tracking-[0.2em] text-white/40 mb-1\\\">Units</p>\\n              <p className=\\\"font-brand text-3xl font-bold\\\">{count}</p>\\n            </div>\\n          </div>\\n          \\n          <button \\n            onClick={() => hapticFeedback('success')}\\n            className=\\\"group flex w-full items-center justify-center gap-4 rounded-2xl bg-kyn-green-500 py-5 font-brand text-xs font-black uppercase tracking-[0.2em] text-white transition-all hover:bg-kyn-green-600 active:scale-[0.98] shadow-lg shadow-kyn-green-500/20\\\"\\n          >\\n            Initiate Acquisition\\n            <ArrowRight size={18} className=\\\"transition-transform group-hover:translate-x-1\\\" />\\n          </button>\\n        </div>\\n      </footer>\\n    </div>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/store/loading.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: The Hub Loading State (v1.6)\\n * Role: A \\\"Calm\\\" bridge that eliminates layout shift (CLS).\\n * Design: High-fidelity skeletons matching the ProductCard anatomy.\\n */\\n\\nexport default function StoreLoading() {\\n  const skeletons = Array.from({ length: 6 });\\n\\n  return (\\n    <main className=\\\"min-h-screen bg-canvas pb-32\\\">\\n      {/* Header Skeleton */}\\n      <header className=\\\"py-16 md:py-24 text-center border-b border-border bg-surface/30 px-gutter\\\">\\n        <div className=\\\"max-w-3xl mx-auto flex flex-col items-center space-y-6\\\">\\n          <div className=\\\"h-10 w-48 md:h-14 md:w-64 animate-pulse rounded-xl bg-kyn-slate-200/60\\\" />\\n          <div className=\\\"space-y-3 w-full flex flex-col items-center px-4\\\">\\n            <div className=\\\"h-3 w-full max-w-lg animate-pulse rounded-full bg-kyn-slate-100\\\" />\\n            <div className=\\\"h-3 w-3/4 max-w-sm animate-pulse rounded-full bg-kyn-slate-100/60\\\" />\\n          </div>\\n        </div>\\n      </header>\\n\\n      <div className=\\\"max-w-screen-xl mx-auto px-gutter pt-20\\\">\\n        <div className=\\\"grid grid-cols-1 gap-y-12 gap-x-8 sm:grid-cols-2 lg:grid-cols-3\\\">\\n          {skeletons.map((_, i) => (\\n            <div \\n              key={i} \\n              className=\\\"overflow-hidden rounded-[2rem] border border-border bg-white\\\"\\n            >\\n              {/* Aspect Ratio Box (16:10) */}\\n              <div className=\\\"aspect-[16/10] w-full animate-pulse bg-kyn-slate-100\\\" />\\n              \\n              <div className=\\\"p-8 space-y-6\\\">\\n                <div className=\\\"space-y-3\\\">\\n                  <div className=\\\"flex justify-between items-start\\\">\\n                    <div className=\\\"h-6 w-2/3 animate-pulse rounded-lg bg-kyn-slate-200/70\\\" />\\n                    <div className=\\\"h-6 w-12 animate-pulse rounded-lg bg-kyn-slate-200/50\\\" />\\n                  </div>\\n                  <div className=\\\"h-3 w-full animate-pulse rounded-md bg-kyn-slate-100\\\" />\\n                  <div className=\\\"h-3 w-4/5 animate-pulse rounded-md bg-kyn-slate-100/60\\\" />\\n                </div>\\n\\n                <div className=\\\"flex justify-between items-center pt-2\\\">\\n                  <div className=\\\"flex gap-2\\\">\\n                    <div className=\\\"h-4 w-10 animate-pulse rounded bg-kyn-slate-100\\\" />\\n                    <div className=\\\"h-4 w-10 animate-pulse rounded bg-kyn-slate-100\\\" />\\n                  </div>\\n                  <div className=\\\"h-10 w-24 animate-pulse rounded-xl bg-kyn-slate-900/10\\\" />\\n                </div>\\n              </div>\\n            </div>\\n          ))}\\n        </div>\\n      </div>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/(marketplace)/store/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: The Marketplace Hub (v2.3)\\n * Fix: Resolved Async searchParams for Next.js 15+ and Netlify build.\\n */\\n\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { ProductCard } from \\\"@/components/marketplace/ProductCard\\\";\\nimport { FilterBar } from \\\"@/components/marketplace/FilterBar\\\";\\nimport { Product, World, WORLDS } from \\\"@/lib/supabase/types\\\";\\nimport { Box, Sparkles } from \\\"lucide-react\\\";\\n\\ninterface StorePageProps {\\n  searchParams: Promise<{ world?: string; sort?: string }>;\\n}\\n\\nexport default async function StorePage({ searchParams }: StorePageProps) {\\n  // 1. Properly await searchParams for Next.js 15 production build\\n  const params = await searchParams;\\n  \\n  // 2. Validate the world against the constant for runtime safety\\n  const activeWorld = params.world as World | undefined;\\n  \\n  const supabase = await createClient();\\n  \\n  let query = supabase\\n    .from(\\\"products\\\")\\n    .select(\\\"*\\\")\\n    .eq(\\\"is_published\\\", true);\\n  \\n  // 3. World validation using type-casting for Postgres Enum compatibility\\n  if (activeWorld && (WORLDS as unknown as string[]).includes(activeWorld)) {\\n    query = query.eq(\\\"world\\\", activeWorld as string);\\n  }\\n  \\n  const { data: products, error } = await query.order(\\\"created_at\\\", { ascending: false });\\n  \\n  if (error || !products) {\\n    return (\\n      <div className=\\\"flex min-h-[50vh] items-center justify-center font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\\\">\\n        Connection to the hub interrupted. Please refresh.\\n      </div>\\n    );\\n  }\\n  \\n  return (\\n    <main className=\\\"pb-32\\\">\\n      <header className=\\\"relative overflow-hidden border-b border-border bg-surface/50 py-16 md:py-24 px-gutter\\\">\\n        <div className=\\\"relative z-10 mx-auto max-w-3xl text-center\\\">\\n          <div className=\\\"mb-6 inline-flex items-center gap-2 rounded-full bg-white border border-border px-4 py-1.5 font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-500 shadow-sm\\\">\\n            <Sparkles size={12} className=\\\"text-kyn-green-500\\\" />\\n            Permanent Acquisitions\\n          </div>\\n          <h1 className=\\\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl\\\">\\n            The Hub\\n          </h1>\\n          <p className=\\\"mt-6 font-ui text-base md:text-lg text-text-secondary leading-relaxed\\\">\\n            A curated collection of permanent digital assets. <br className=\\\"hidden md:block\\\" />\\n            Designed for a grounded life, secured for the long term.\\n          </p>\\n        </div>\\n      </header>\\n\\n      <div className=\\\"max-w-screen-xl mx-auto px-gutter\\\">\\n        {/* Filter Bar Zone */}\\n        <div className=\\\"sticky top-14 md:top-20 z-30 py-6 bg-canvas/90 backdrop-blur-md mb-8 border-b border-border/50\\\">\\n          <FilterBar currentWorld={activeWorld ?? \\\"All\\\"} />\\n        </div>\\n\\n        {/* Product Grid */}\\n        {products.length > 0 ? (\\n          <div className=\\\"grid grid-cols-1 gap-y-12 gap-x-8 sm:grid-cols-2 lg:grid-cols-3 animate-in fade-in duration-1000\\\">\\n            {products.map((product: Product) => (\\n              <ProductCard key={product.id} product={product} />\\n            ))}\\n          </div>\\n        ) : (\\n          <div className=\\\"flex flex-col items-center justify-center py-32 text-center rounded-[2.5rem] border border-dashed border-border bg-surface/50\\\">\\n            <Box size={32} className=\\\"text-kyn-slate-200 mb-4\\\" />\\n            <h2 className=\\\"font-brand text-lg font-bold text-text-primary uppercase tracking-widest\\\">Sector Empty</h2>\\n            <p className=\\\"mt-2 font-ui text-[11px] uppercase tracking-[0.2em] text-kyn-slate-400\\\">No products found in this world yet.</p>\\n          </div>\\n        )}\\n      </div>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/account/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Account Dashboard (v2.3)\\n * Evolution: Added Auth Guarding and Type-Safe Layout\\n */\\n\\nimport Link from \\\"next/link\\\";\\nimport { redirect } from \\\"next/navigation\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\nimport { logout } from \\\"../auth/actions\\\";\\n\\nexport default async function AccountPage() {\\n  const supabase = await createClient();\\n  const { data: { user } } = await supabase.auth.getUser();\\n\\n  // If no session exists, bounce to login\\n  if (!user) redirect(\\\"/auth/login?return_to=/account\\\");\\n\\n  return (\\n    <main className=\\\"max-w-screen-xl mx-auto px-gutter py-20\\\">\\n      <div className=\\\"flex flex-col md:flex-row md:items-center justify-between gap-6 mb-12\\\">\\n        <div>\\n          <h1 className=\\\"font-brand text-4xl font-bold text-kyn-slate-900 tracking-tight\\\">Your Account</h1>\\n          <p className=\\\"mt-2 text-text-secondary font-ui max-w-sm\\\">\\n            Manage your presence and verified credentials in the Kynar Universe.\\n          </p>\\n        </div>\\n        \\n        <form action={logout}>\\n          <button \\n            type=\\\"submit\\\" \\n            className=\\\"px-6 py-3 border border-red-100 text-red-600 rounded-2xl hover:bg-red-50 font-brand text-xs font-bold uppercase tracking-widest transition-all active:scale-95\\\"\\n          >\\n            Terminate Session\\n          </button>\\n        </form>\\n      </div>\\n\\n      <div className=\\\"grid gap-6\\\">\\n        <Link \\n          href=\\\"/account/settings\\\" \\n          className=\\\"group p-8 border border-border rounded-[2.5rem] hover:border-kyn-green-500 transition-all duration-500 bg-white shadow-kynar-soft hover:shadow-kynar-deep\\\"\\n        >\\n          <h2 className=\\\"font-brand text-xl font-bold group-hover:text-kyn-green-600 transition-colors\\\">Identity Settings â†’</h2>\\n          <p className=\\\"text-text-secondary text-sm mt-2 font-ui\\\">Update your security protocols and profile details.</p>\\n        </Link>\\n      </div>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  },\n  \"./app/account/settings/page.tsx\": {\n    \"text\": \"/**\\n * KYNAR UNIVERSE: Settings Page (v2.4)\\n * Evolution: Strict Schema Alignment & Build Error Resolution\\n */\\n\\nimport { getUserProfile } from \\\"@/lib/supabase/helpers\\\";\\nimport { SettingsForm } from \\\"@/components/account/SettingsForm\\\";\\nimport { Breadcrumbs } from \\\"@/components/layout/Breadcrumbs\\\";\\nimport { ShieldCheck, Info } from \\\"lucide-react\\\";\\nimport { User, Profile } from \\\"@/lib/supabase/types\\\"; \\nimport { redirect } from \\\"next/navigation\\\";\\nimport { createClient } from \\\"@/lib/supabase/server\\\";\\n\\nexport default async function SettingsPage() {\\n  const supabase = await createClient();\\n  const { data: { user: authUser } } = await supabase.auth.getUser();\\n  \\n  if (!authUser) redirect(\\\"/auth/login\\\");\\n\\n  // Create a clean User object for the form\\n  const user: User = {\\n    id: authUser.id,\\n    email: authUser.email\\n  };\\n\\n  // Fetch the real profile from the DB\\n  const fetchedProfile = await getUserProfile();\\n  \\n  /**\\n   * EVOLUTION: Strict Type Alignment\\n   * 1. Removed 'avatar_url' (not in types.ts)\\n   * 2. Added 'is_admin' (required by types.ts)\\n   */\\n  const profile: Profile = fetchedProfile ?? {\\n    id: authUser.id,\\n    email: authUser.email ?? \\\"\\\",\\n    full_name: \\\"\\\",\\n    is_admin: false,\\n    created_at: new Date().toISOString(),\\n    updated_at: new Date().toISOString()\\n  };\\n  \\n  const breadcrumbPaths = [\\n    { label: \\\"Account\\\", href: \\\"/account\\\" },\\n    { label: \\\"Settings\\\", href: \\\"/account/settings\\\" },\\n  ];\\n  \\n  return (\\n    <main className=\\\"mx-auto max-w-2xl pb-32 animate-in fade-in duration-700 ease-out\\\">\\n      <div className=\\\"px-gutter pt-8\\\">\\n        <Breadcrumbs paths={breadcrumbPaths} />\\n      </div>\\n\\n      <header className=\\\"px-gutter py-12 md:py-20\\\">\\n        <h1 className=\\\"font-brand text-3xl font-bold tracking-tight text-text-primary md:text-4xl\\\">\\n          Account Settings\\n        </h1>\\n        <p className=\\\"font-ui mt-3 text-base text-text-secondary leading-relaxed max-w-md\\\">\\n          Maintain your identity and digital preferences within the Kynar Universe.\\n        </p>\\n      </header>\\n\\n      <section className=\\\"px-gutter\\\">\\n        <div className=\\\"rounded-[2rem] border border-border bg-white p-6 md:p-10 shadow-kynar-soft\\\">\\n          {/* FIXED: Passing both props to resolve TS2741 build error */}\\n          <SettingsForm user={user} profile={profile} />\\n        </div>\\n\\n        <div className=\\\"mt-12 border-t border-border pt-8 text-center\\\">\\n          <div className=\\\"flex justify-center mb-4 text-kyn-slate-300\\\">\\n            <ShieldCheck size={24} strokeWidth={1} />\\n          </div>\\n          <p className=\\\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400\\\">\\n            Digital Autonomy Support\\n          </p>\\n          <a\\n            href=\\\"mailto:support@kynaruniverse.com\\\"\\n            className=\\\"mt-4 inline-block font-brand text-sm font-bold text-kyn-slate-900 underline underline-offset-8 decoration-kyn-green-200 hover:decoration-kyn-green-500 transition-all\\\"\\n          >\\n            support@kynaruniverse.com\\n          </a>\\n        </div>\\n      </section>\\n\\n      <section className=\\\"mt-12 px-gutter\\\">\\n        <div className=\\\"flex gap-4 p-6 rounded-2xl bg-kyn-green-50/30 border border-kyn-green-100/50\\\">\\n          <div className=\\\"shrink-0 text-kyn-green-600\\\">\\n            <Info size={20} />\\n          </div>\\n          <p className=\\\"font-ui text-[13px] leading-relaxed text-kyn-green-900/70\\\">\\n            Your session is secured via <strong>PKCE encryption</strong>. Your identity data is encrypted at rest and never shared with third-party trackers.\\n          </p>\\n        </div>\\n      </section>\\n    </main>\\n  );\\n}\\n\",\n    \"embedding\": null\n  }\n}",
    "embedding": null
  },
  "./tsconfig.json": {
    "text": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"allowJs\": true,\n    \"skipLibCheck\": true,\n    \"strict\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"module\": \"esnext\",\n    \"moduleResolution\": \"bundler\",\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"jsx\": \"react-jsx\",\n    \"incremental\": true,\n    \"noImplicitAny\": true,\n    \"noImplicitReturns\": true,\n    \"noUnusedLocals\": true,\n    \"noUnusedParameters\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"plugins\": [{ \"name\": \"next\" }],\n    \"paths\": {\n      \"@/*\": [\"./*\"],\n      \"@/types\": [\"./lib/supabase/types.ts\"] \n    }\n  },\n  \"include\": [\n    \"next-env.d.ts\", \n    \".next/types/**/*.ts\",\n    \".next/dev/types/**/*.ts\",\n    \"app/**/*.ts\",\n    \"app/**/*.tsx\",\n    \"lib/**/*.ts\",\n    \"lib/**/*.tsx\",\n    \"components/**/*.ts\",\n    \"components/**/*.tsx\"\n  ],\n  \"exclude\": [\"node_modules\", \".next\", \"out\", \"dist\"]\n}\n",
    "embedding": null
  },
  "./postcss.config.js": {
    "text": "module.exports = {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n};",
    "embedding": null
  },
  "./tailwind.config.ts": {
    "text": "import type { Config } from \"tailwindcss\";\nimport typography from \"@tailwindcss/typography\";\nimport forms from \"@tailwindcss/forms\";\nimport animate from \"tailwindcss-animate\";\n\nconst config: Config = {\n  darkMode: [\"class\"],\n  content: [\n    \"./app/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./components/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./lib/**/*.{js,ts,jsx,tsx,mdx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        canvas: \"hsl(var(--canvas) / <alpha-value>)\",\n        surface: \"hsl(var(--surface) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        \"text-primary\": \"hsl(var(--text-primary) / <alpha-value>)\",\n        \"text-secondary\": \"hsl(var(--text-secondary) / <alpha-value>)\",\n        kyn: {\n          green: {\n            50: \"#F2F4F2\",\n            100: \"#E6EAE5\",\n            200: \"#C2CCC1\",\n            500: \"hsl(var(--kyn-green) / <alpha-value>)\",\n            600: \"#3D5140\",\n            700: \"#2D3B2F\",\n            900: \"#1A241B\",\n          },\n          caramel: {\n            50: \"#FDFBF7\",\n            100: \"#F7F1E6\",\n            200: \"#E9DCC2\",\n            500: \"hsl(var(--kyn-caramel) / <alpha-value>)\",\n            600: \"#947234\",\n            700: \"#755B29\",\n            900: \"#453518\",\n          },\n          slate: {\n            50: \"#F8FAFC\",\n            100: \"#F1F5F9\",\n            200: \"#E2E8F0\",\n            300: \"#CBD5E1\",\n            400: \"#94A3B8\",\n            500: \"#64748B\",\n            800: \"#1E293B\",\n            900: \"hsl(var(--kyn-slate) / <alpha-value>)\",\n          },\n        },\n      },\n      fontFamily: {\n        brand: [\"var(--font-brand)\", \"Plus Jakarta Sans\", \"sans-serif\"],\n        ui: [\"var(--font-ui)\", \"Inter\", \"sans-serif\"],\n      },\n      spacing: {\n        gutter: \"1.5rem\",\n        inner: \"1.25rem\",\n        section: \"5rem\",\n      },\n      borderRadius: {\n        'kynar-sm': \"0.75rem\",\n        'kynar': \"1.25rem\",\n        \"kynar-lg\": \"2rem\",\n        \"kynar-xl\": \"2.5rem\",\n      },\n      boxShadow: {\n        \"kynar-soft\": \"0 10px 40px -15px rgba(0, 0, 0, 0.08)\",\n        \"kynar-deep\": \"0 30px 70px -10px rgba(0, 0, 0, 0.2)\",\n        \"kynar-inner\": \"inset 0 2px 4px 0 rgba(0, 0, 0, 0.05)\",\n      },\n      transitionTimingFunction: {\n        \"kyn-drift\": \"cubic-bezier(0.16, 1, 0.3, 1)\",\n      },\n      animation: {\n        \"portal-in\": \"portal-in 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards\",\n        \"portal-out\": \"portal-out 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards\",\n        \"fade-in\": \"fade-in 0.6s ease-out forwards\",\n        \"breathe\": \"pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite\",\n      },\n      keyframes: {\n        \"portal-in\": {\n          \"0%\": { transform: \"scale(0.9) translateY(20px)\", opacity: \"0\", filter: \"blur(10px)\" },\n          \"100%\": { transform: \"scale(1) translateY(0)\", opacity: \"1\", filter: \"blur(0)\" },\n        },\n        \"portal-out\": {\n          \"0%\": { transform: \"scale(1) translateY(0)\", opacity: \"1\" },\n          \"100%\": { transform: \"scale(0.95) translateY(10px)\", opacity: \"0\" },\n        },\n        \"fade-in\": {\n          \"0%\": { opacity: \"0\" },\n          \"100%\": { opacity: \"1\" },\n        },\n      },\n    },\n  },\n  plugins: [\n    typography,\n    forms,\n    animate,\n  ],\n};\n\nexport default config;\n",
    "embedding": null
  },
  "./scripts/test-webhook.js": {
    "text": "const crypto = require('crypto');\n\n// Configuration\nconst WEBHOOK_URL = 'http://localhost:3000/api/webhooks/checkout';\nconst WEBHOOK_SECRET = 'your_test_secret'; // Match your .env.local\n\nasync function simulateWebhook() {\n  const payload = {\n    meta: { event_name: 'order_created' },\n    data: {\n      attributes: {\n        variant_id: 'pri_01hs5xyz...', // Use an ID from your pricing.ts\n        total: 5000,                   // Â£50.00 in cents\n        user_email: 'test@kynar.com',\n        custom_data: {\n          product_id: 'PASTE_A_VALID_PRODUCT_UUID_HERE',\n          user_id: 'PASTE_YOUR_AUTH_USER_UUID_HERE'\n        }\n      }\n    }\n  };\n\n  const body = JSON.stringify(payload);\n  const hmac = crypto.createHmac('sha256', WEBHOOK_SECRET);\n  const signature = hmac.update(body).digest('hex');\n\n  console.log('ðŸš€ Sending simulated webhook...');\n\n  const response = await fetch(WEBHOOK_URL, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'x-signature': signature\n    },\n    body\n  });\n\n  const result = await response.json();\n  console.log('Status:', response.status);\n  console.log('Result:', result);\n}\n\nsimulateWebhook();\n",
    "embedding": null
  },
  "./components/marketplace/OverlayWrapper.tsx": {
    "text": "\"use client\";\n\nimport { useEffect } from \"react\";\nimport { useUIStore } from \"@/lib/store/ui\";\nimport SelectionOverlay from \"./SelectionOverlay\";\n\nexport default function OverlayWrapper() {\n  const isSelectionOpen = useUIStore((state) => state.isSelectionOpen);\n  const isUserMenuOpen = useUIStore((state) => state.isUserMenuOpen);\n  const closeSelection = useUIStore((state) => state.closeSelection);\n  const closeAll = useUIStore((state) => state.closeAll);\n\n  useEffect(() => {\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        closeAll();\n      }\n    };\n\n    if (isSelectionOpen || isUserMenuOpen) {\n      window.addEventListener(\"keydown\", handleEscape);\n      document.body.style.overflow = \"hidden\";\n    }\n\n    return () => {\n      window.removeEventListener(\"keydown\", handleEscape);\n      // Fixed: Setting to empty string is safer for CSS inheritance\n      document.body.style.overflow = \"\";\n    };\n  }, [isSelectionOpen, isUserMenuOpen, closeAll]);\n\n  return (\n    <>\n      <SelectionOverlay \n        isOpen={isSelectionOpen} \n        onClose={closeSelection} \n      />\n    </>\n  );\n}\n",
    "embedding": null
  },
  "./components/marketplace/SelectionOverlay.tsx": {
    "text": "\"use client\";\n\nimport { useEffect } from \"react\";\nimport { X, ShoppingBag, Trash2, ArrowRight } from \"lucide-react\";\nimport { useCartItems } from \"@/lib/cart/store\";\nimport { getPriceFromId } from \"@/lib/marketplace/pricing\";\nimport Link from \"next/link\";\n\ninterface SelectionOverlayProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function SelectionOverlay({ isOpen, onClose }: SelectionOverlayProps) {\n  const { items, count, totalPrice, removeItem } = useCartItems();\n\n  // Prevent background scrolling when overlay is open\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n    } else {\n      document.body.style.overflow = 'unset';\n    }\n    return () => { document.body.style.overflow = 'unset'; };\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 sm:p-6\">\n      {/* Blurred Background Overlay - Fades in */}\n      <div \n        className=\"absolute inset-0 bg-kyn-slate-900/40 backdrop-blur-md animate-in fade-in duration-500\" \n        onClick={onClose} \n      />\n\n      {/* Centered Modal - Zooms in from the background */}\n      <div className=\"relative w-full max-w-lg max-h-[90vh] border border-border bg-white rounded-[2.5rem] p-8 shadow-2xl animate-in zoom-in-95 fade-in slide-in-from-bottom-8 duration-300 flex flex-col overflow-hidden\">\n        \n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex h-12 w-12 items-center justify-center rounded-2xl bg-kyn-slate-900 text-white shadow-lg shadow-kyn-slate-900/20\">\n              <ShoppingBag size={20} />\n            </div>\n            <div>\n              <h3 className=\"font-brand text-2xl font-bold text-kyn-slate-900\">Selection</h3>\n              <p className=\"font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\">\n                {count} {count === 1 ? 'Item' : 'Items'} in Vault\n              </p>\n            </div>\n          </div>\n          <button \n            onClick={onClose} \n            className=\"p-2 rounded-full hover:bg-surface text-kyn-slate-400 hover:text-kyn-slate-900 transition-all\"\n          >\n            <X size={24} />\n          </button>\n        </div>\n\n        {/* Scrollable Items List */}\n        <div className=\"flex-1 overflow-y-auto space-y-6 pr-2 custom-scrollbar\">\n          {items.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n              <div className=\"h-20 w-20 bg-surface rounded-full flex items-center justify-center mb-6 text-kyn-slate-200\">\n                <ShoppingBag size={32} />\n              </div>\n              <p className=\"font-brand text-lg font-bold text-kyn-slate-900\">Your selection is empty</p>\n              <p className=\"font-ui text-sm text-text-secondary mt-1 max-w-[200px]\">Visit the Store to acquire tools for your ecosystem.</p>\n            </div>\n          ) : (\n            items.map((item) => {\n              const itemPrice = getPriceFromId(item.price_id) ?? 0;\n              \n              return (\n                <div key={item.id} className=\"flex gap-5 group items-center bg-surface/30 p-4 rounded-3xl border border-transparent hover:border-border hover:bg-surface/50 transition-all\">\n                  <div className=\"h-16 w-16 rounded-2xl bg-white border border-border overflow-hidden flex-shrink-0 flex items-center justify-center text-kyn-slate-400 shadow-sm\">\n                      <ShoppingBag size={20} />\n                  </div>\n                  \n                  <div className=\"flex-1\">\n                    <h4 className=\"font-brand font-bold text-kyn-slate-900 leading-tight\">\n                      {item.title}\n                    </h4>\n                    <div className=\"flex items-center justify-between mt-1\">\n                      <p className=\"text-kyn-green-600 font-ui font-bold text-sm\">\n                        Â£{itemPrice.toFixed(2)}\n                      </p>\n                      <button \n                        onClick={() => removeItem(item.id)} \n                        className=\"text-kyn-slate-300 hover:text-red-500 transition-colors p-1\"\n                      >\n                        <Trash2 size={16} />\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              );\n            })\n          )}\n        </div>\n\n        {/* Footer with Subtotal */}\n        {items.length > 0 && (\n          <div className=\"pt-8 mt-4 border-t border-border bg-white\">\n            <div className=\"flex items-center justify-between mb-8\">\n              <div>\n                <span className=\"font-ui text-[10px] font-bold text-kyn-slate-400 uppercase tracking-widest block mb-1\">\n                  Total Investment\n                </span>\n                <span className=\"font-brand text-3xl font-bold text-kyn-slate-900\">\n                  Â£{totalPrice.toFixed(2)}\n                </span>\n              </div>\n            </div>\n            \n            <Link \n              href=\"/checkout\" \n              onClick={onClose}\n              className=\"w-full flex items-center justify-center gap-3 py-5 bg-kyn-slate-900 text-white rounded-[2rem] font-brand font-bold hover:bg-kyn-slate-800 transition-all active:scale-[0.98] shadow-2xl shadow-kyn-slate-900/20\"\n            >\n              Confirm Selection\n              <ArrowRight size={18} />\n            </Link>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n",
    "embedding": null
  },
  "./components/marketplace/CelebrationTrigger.tsx": {
    "text": "\"use client\";\n\nimport { useEffect } from \"react\";\nimport { triggerCelebration } from \"@/lib/utils/confetti\";\n\nexport function CelebrationTrigger() {\n  useEffect(() => {\n    // We provide x and y to satisfy the strict interface\n    triggerCelebration({\n      particleCount: 80,\n      spread: 100,\n      origin: { x: 0.5, y: 0.6 } \n    });\n  }, []);\n  \n  return null; // This component renders nothing but runs the effect\n}\n",
    "embedding": null
  },
  "./components/marketplace/FilterBar.tsx": {
    "text": "/* KYNAR UNIVERSE: Filter Bar (v2.1) */\n\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { SlidersHorizontal, X, RotateCcw, Check } from \"lucide-react\";\nimport { WORLDS } from \"@/lib/supabase/types\";\nimport { cn } from \"@/lib/utils\";\n\ninterface FilterBarProps {\n  currentWorld?: string;\n}\n\nexport const FilterBar = ({ currentWorld = \"All\" }: FilterBarProps) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const router = useRouter();\n  const searchParams = useSearchParams();\n\n  const setFilter = (key: string, value: string) => {\n    const params = new URLSearchParams(searchParams.toString());\n    if (value === \"All\") {\n      params.delete(key);\n    } else {\n      params.set(key, value);\n    }\n    router.push(`/store?${params.toString()}`);\n    setIsOpen(false);\n  };\n\n  const resetFilters = () => {\n    router.push('/store');\n    setIsOpen(false);\n  };\n\n  return (\n    <div className=\"flex items-center justify-between\">\n      <button \n        onClick={() => setIsOpen(true)}\n        className=\"flex items-center gap-2 text-[11px] font-bold uppercase tracking-widest text-kyn-slate-900 transition-opacity hover:opacity-70\"\n      >\n        <SlidersHorizontal size={14} /> Filters\n      </button>\n      \n      <div className=\"flex items-center gap-2\">\n        {currentWorld !== \"All\" && (\n          <div className=\"h-1.5 w-1.5 rounded-full bg-kyn-green-500 animate-pulse\" />\n        )}\n        <span className=\"text-[10px] font-bold text-kyn-slate-400 uppercase tracking-widest\">\n          {currentWorld}\n        </span>\n      </div>\n\n      {/* MOBILE DRAWER OVERLAY */}\n      {isOpen && (\n        <div className=\"fixed inset-0 z-[120] flex flex-col bg-canvas animate-in slide-in-from-right duration-500\">\n          <div className=\"flex h-16 items-center justify-between px-gutter border-b border-border\">\n            <h2 className=\"font-brand font-bold text-lg\">Refine Results</h2>\n            <button \n              onClick={() => setIsOpen(false)}\n              className=\"p-2 text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\"\n            >\n              <X size={20} />\n            </button>\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto p-8 space-y-8\">\n            <div>\n              <h3 className=\"text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-6\">Domains</h3>\n              <div className=\"grid grid-cols-1 gap-3\">\n                {/* \"All\" Option */}\n                <button \n                  onClick={() => setFilter('world', 'All')}\n                  className={cn(\n                    \"flex items-center justify-between p-4 border rounded-2xl text-sm font-ui transition-all\",\n                    currentWorld === \"All\" \n                      ? \"border-kyn-slate-900 bg-kyn-slate-900 text-white\" \n                      : \"border-border bg-white text-kyn-slate-600 hover:border-kyn-slate-200\"\n                  )}\n                >\n                  All Domains\n                  {currentWorld === \"All\" && <Check size={14} />}\n                </button>\n\n                {/* World Options */}\n                {WORLDS.map((w: string) => (\n                  <button \n                    key={w} \n                    onClick={() => setFilter('world', w)}\n                    className={cn(\n                      \"flex items-center justify-between p-4 border rounded-2xl text-sm font-ui transition-all\",\n                      currentWorld === w \n                        ? \"border-kyn-slate-900 bg-kyn-slate-900 text-white\" \n                        : \"border-border bg-white text-kyn-slate-600 hover:border-kyn-slate-200\"\n                    )}\n                  >\n                    {w}\n                    {currentWorld === w && <Check size={14} />}\n                  </button>\n                ))}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"p-8 border-t border-border bg-surface/50 flex gap-4\">\n            <button \n              onClick={resetFilters} \n              className=\"flex-1 py-4 border border-border bg-white rounded-2xl transition-all active:scale-95 flex items-center justify-center\"\n              title=\"Reset Filters\"\n            >\n              <RotateCcw size={18} className=\"text-kyn-slate-400\" />\n            </button>\n            <button \n              onClick={() => setIsOpen(false)} \n              className=\"flex-[3] py-4 bg-kyn-slate-900 text-white rounded-2xl font-brand text-sm font-bold shadow-lg shadow-kyn-slate-900/10 active:scale-95 transition-all\"\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n",
    "embedding": null
  },
  "./components/marketplace/AddToCartButton.tsx": {
    "text": "\"use client\";\n\n/**\n * KYNAR UNIVERSE: Add To Cart Button (v2.3.2)\n * Fix: Explicitly mapped to lib/supabase/types.ts per user file structure.\n */\n\nimport { useState, useEffect, type MouseEvent } from \"react\";\nimport { Plus, Check, Lock, Loader2 } from \"lucide-react\";\nimport { useCartItems, useCartActions } from \"@/lib/cart/store\";\nimport { useVault } from \"@/lib/store/vault\";\nimport { Product } from \"@/lib/supabase/types\"; // Path verified\nimport { cn, hapticFeedback } from \"@/lib/utils\";\n\ninterface AddToCartButtonProps {\n  product: Product;\n  className?: string;\n}\n\nexport const AddToCartButton = ({ product, className }: AddToCartButtonProps) => {\n  const [isAdding, setIsAdding] = useState(false);\n  const [mounted, setMounted] = useState(false);\n  \n  const { items } = useCartItems();\n  const { addItem } = useCartActions();\n  const { isInVault } = useVault();\n  \n  useEffect(() => {\n    setMounted(true);\n  }, []);\n  \n  const isOwned = mounted ? isInVault(product.id) : false;\n  const inCart = mounted ? items.some((item) => item.id === product.id) : false;\n  \n  const handleAdd = async (e: MouseEvent<HTMLButtonElement>) => {\n    e.preventDefault();\n    e.stopPropagation(); \n    \n    setIsAdding(true);\n    hapticFeedback(\"light\");\n    \n    await new Promise((resolve) => setTimeout(resolve, 400));\n    \n    addItem(product);\n    \n    setIsAdding(false);\n    hapticFeedback(\"success\");\n  };\n  \n  if (!mounted) return <div className={cn(\"h-12 w-full rounded-xl bg-surface animate-pulse\", className)} />;\n  \n  if (isOwned) {\n    return (\n      <button \n        disabled \n        className={cn(\"flex w-full items-center justify-center gap-2 rounded-xl bg-kyn-green-50/50 py-3 font-brand text-sm font-bold text-kyn-green-600 cursor-not-allowed\", className)}\n      >\n        <Lock size={16} /> In Vault\n      </button>\n    );\n  }\n  \n  if (inCart) {\n    return (\n      <button \n        disabled \n        className={cn(\"flex w-full items-center justify-center gap-2 rounded-xl bg-kyn-slate-100 py-3 font-brand text-sm font-bold text-kyn-slate-900 cursor-not-allowed\", className)}\n      >\n        <Check size={16} /> Selected\n      </button>\n    );\n  }\n  \n  return (\n    <button\n      onClick={handleAdd}\n      disabled={isAdding}\n      className={cn(\n        \"group flex w-full items-center justify-center gap-2 rounded-xl bg-kyn-slate-900 py-3 font-brand text-sm font-bold text-white transition-all hover:bg-black active:scale-[0.97] disabled:opacity-70\",\n        className\n      )}\n    >\n      {isAdding ? <Loader2 size={16} className=\"animate-spin\" /> : <Plus size={16} />}\n      {isAdding ? \"Syncing...\" : \"Select\"}\n    </button>\n  );\n};\n",
    "embedding": null
  },
  "./components/marketplace/ProductCard.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Product Card (v1.6)\n * Role: Primary Discovery & Acquisition unit.\n * Philosophy: Dual-action - Explore (Link) vs. Select (Button).\n * Optimization: Mobile-first responsive grid-safe layout; Next.js 15 Ready.\n */\n\nimport Link from \"next/link\";\nimport { ArrowUpRight, Compass } from \"lucide-react\";\nimport { AddToCartButton } from \"./AddToCartButton\";\nimport { formatGBP } from \"@/lib/utils\";\nimport { getPriceFromId } from \"@/lib/marketplace/pricing\";\nimport { Product } from \"@/lib/supabase/types\";\nimport Image from \"next/image\";\n\n\ninterface ProductCardProps {\n  product: Product;\n}\n\nexport const ProductCard = ({ product }: ProductCardProps) => {\n  // Determine display price using the hardened Pricing Engine\n  const priceValue = getPriceFromId(product.price_id);\n  \n  return (\n    <article className=\"group relative flex flex-col animate-in fade-in slide-in-from-bottom-3 duration-700 ease-out\">\n      \n      {/* 1. Visual Stage: Narrative Exploration \n          The 'aspect-[4/5]' ensures a consistent editorial feel across all screen sizes.\n      */}\n      <Link \n        href={`/products/${product.slug}`} \n        className=\"relative aspect-[4/5] w-full overflow-hidden rounded-3xl bg-surface border border-kyn-slate-50 transition-all duration-500 hover:shadow-kynar-soft\"\n        aria-label={`View details for ${product.title}`}\n      >\n        {product.preview_image ? (\n          <Image \n            src={product.preview_image} \n            alt={product.title} \n            fill\n            sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw\"\n            loading=\"lazy\"\n            className=\"object-cover transition-transform duration-1000 ease-kyn-out group-hover:scale-105\"\n          />\n        ) : (\n          <div className=\"flex h-full w-full items-center justify-center bg-kyn-slate-50 text-kyn-slate-200\">\n            <Compass size={48} strokeWidth={1} />\n          </div>\n        )}\n\n\n        {/* Discovery Overlay: Subtle atmospheric gradient for readability */}\n        <div className=\"absolute inset-0 bg-gradient-to-t from-kyn-slate-900/40 via-transparent to-transparent opacity-0 transition-opacity duration-500 group-hover:opacity-100\" />\n        \n        {/* Floating Indicator: Signals depth to the user */}\n        <div className=\"absolute right-4 top-4 flex h-10 w-10 items-center justify-center rounded-full bg-white/90 backdrop-blur-md text-kyn-slate-900 shadow-sm opacity-0 -translate-y-2 transition-all duration-500 group-hover:opacity-100 group-hover:translate-y-0\">\n          <ArrowUpRight size={20} />\n        </div>\n\n        {/* Grounded Price Badge */}\n        <div className=\"absolute left-4 bottom-4 rounded-xl bg-kyn-slate-900/80 backdrop-blur-md px-3 py-1.5 font-brand text-[11px] font-bold text-white tracking-tight\">\n          {priceValue === 0 ? \"Complimentary\" : formatGBP(priceValue)}\n        </div>\n      </Link>\n\n      {/* 2. Content & Acquisition Zone \n          Decoupled from the main Link to prevent accidental navigation.\n      */}\n      <div className=\"mt-5 space-y-4 px-1\">\n        <div className=\"flex flex-col\">\n          <span className=\"font-ui text-[10px] font-bold uppercase tracking-[0.25em] text-kyn-slate-400\">\n            {product.world || \"Universal\"} World\n          </span>\n          <h3 className=\"mt-1 font-brand text-lg font-bold text-kyn-slate-900 line-clamp-1\">\n            {product.title}\n          </h3>\n        </div>\n\n        {/* Transactional Trigger \n            Integrated with Cart Store, Haptics, and Micro-Celebrations.\n        */}\n        <div className=\"relative\">\n          <AddToCartButton \n            product={product} \n            className=\"w-full !py-3.5 text-xs tracking-wider\" \n          />\n        </div>\n      </div>\n    </article>\n  );\n};",
    "embedding": null
  },
  "./components/guides/ReadingProgressBar.tsx": {
    "text": "\"use client\";\nimport { useEffect, useState } from \"react\";\n\nexport const ReadingProgressBar = () => {\n  const [progress, setProgress] = useState(0);\n  \n  useEffect(() => {\n    // Guard: Prevent server-side execution\n    if (typeof window === 'undefined') return;\n\n    const updateProgress = () => {\n      const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;\n      if (scrollHeight > 0) {\n        setProgress((window.scrollY / scrollHeight) * 100);\n      }\n    };\n    \n    window.addEventListener(\"scroll\", updateProgress);\n    // Initial check\n    updateProgress();\n    \n    return () => window.removeEventListener(\"scroll\", updateProgress);\n  }, []);\n  \n  return ( \n    <div \n      className=\"fixed bottom-0 left-0 h-1 bg-kyn-green-600 transition-all duration-150 z-50\"\n      style={{ width: `${progress}%` }}\n    />\n  );\n};\n",
    "embedding": null
  },
  "./components/auth/AuthMessage.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Auth Feedback (v1.0)\n * Role: Displaying session errors or registration success.\n */\n\n\"use client\";\nimport { useSearchParams } from \"next/navigation\";\nimport { AlertCircle, CheckCircle2 } from \"lucide-react\";\n\nexport function AuthMessage() {\n  const searchParams = useSearchParams();\n  const error = searchParams.get(\"error\");\n  const message = searchParams.get(\"message\");\n\n  if (!error && !message) return null;\n\n  return (\n    <div className=\"mb-6 animate-in fade-in slide-in-from-top-2 duration-300\">\n      {error && (\n        <div className=\"flex items-center gap-3 rounded-xl border border-red-100 bg-red-50 p-4 text-red-700\">\n          <AlertCircle size={18} />\n          <p className=\"font-ui text-xs font-medium\">{error}</p>\n        </div>\n      )}\n      {message && (\n        <div className=\"flex items-center gap-3 rounded-xl border border-kyn-green-100 bg-kyn-green-50 p-4 text-kyn-green-700\">\n          <CheckCircle2 size={18} />\n          <p className=\"font-ui text-xs font-medium\">{message}</p>\n        </div>\n      )}\n    </div>\n  );\n}\n",
    "embedding": null
  },
  "./components/layout/Navigation.tsx": {
    "text": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { ShoppingBag, User, Compass, LayoutGrid } from \"lucide-react\";\nimport { useCartItems } from \"@/lib/cart/store\";\nimport { useUIStore } from \"@/lib/store/ui\";\nimport { cn } from \"@/lib/utils\";\n// Import the generated types to ensure the profile row is strictly typed\nimport { Database } from \"@/lib/supabase/types\";\n\ntype Profile = Database['public']['Tables']['profiles']['Row'];\n\ninterface NavigationProps {\n  initialProfile?: Profile | null; \n}\n\nexport const Navigation = ({ initialProfile }: NavigationProps) => {\n  const pathname = usePathname();\n  const [mounted, setMounted] = useState(false);\n  \n  const { \n    isSelectionOpen, \n    openSelection, \n    isUserMenuOpen, \n    toggleUserMenu \n  } = useUIStore();\n  \n  const { count } = useCartItems();\n  \n  // Prevent hydration mismatch for client-side state (cart count)\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n  \n  const navLinks = [\n    { name: \"Store\", href: \"/store\", icon: Compass },\n    { name: \"Library\", href: \"/library\", icon: LayoutGrid },\n  ];\n  \n  return (\n    <nav className=\"fixed bottom-0 left-0 z-[60] w-full border-t border-border bg-canvas/90 pb-safe-bottom backdrop-blur-xl md:hidden\">\n      <div className=\"mx-auto flex h-16 max-w-screen-xl items-center justify-around px-gutter\">\n        \n        {/* DYNAMIC NAV LINKS */}\n        {navLinks.map((link) => {\n          const isActive = pathname === link.href && !isUserMenuOpen && !isSelectionOpen;\n          const Icon = link.icon;\n\n          return (\n            <Link\n              key={link.href}\n              href={link.href}\n              className={cn(\n                \"group relative flex flex-col items-center gap-1 transition-all active:scale-90\",\n                isActive ? \"text-kyn-slate-900\" : \"text-kyn-slate-400\"\n              )}\n            >\n              <Icon \n                size={20} \n                strokeWidth={isActive ? 2.5 : 2}\n                className={cn(\"transition-colors\", isActive && \"text-kyn-green-600\")} \n              />\n              <span className=\"font-brand text-[9px] font-black uppercase tracking-[0.15em]\">\n                {link.name}\n              </span>\n              {isActive && (\n                <span className=\"absolute -bottom-1 h-1 w-1 rounded-full bg-kyn-green-500\" />\n              )}\n            </Link>\n          );\n        })}\n\n        {/* SELECTION / CART TRIGGER */}\n        <button\n          onClick={openSelection}\n          className={cn(\n            \"group relative flex flex-col items-center gap-1 transition-all active:scale-90 outline-none\",\n            isSelectionOpen ? \"text-kyn-green-600\" : \"text-kyn-slate-400\"\n          )}\n        >\n          <div className=\"relative\">\n            <ShoppingBag size={20} strokeWidth={isSelectionOpen ? 2.5 : 2} />\n            {mounted && count > 0 && (\n              <span className=\"absolute -right-2.5 -top-1.5 flex h-4 w-4 animate-in zoom-in duration-300 items-center justify-center rounded-full bg-kyn-slate-900 font-ui text-[8px] font-bold text-white border-2 border-canvas\">\n                {count}\n              </span>\n            )}\n          </div>\n          <span className=\"font-brand text-[9px] font-black uppercase tracking-[0.15em]\">\n            Selection\n          </span>\n        </button>\n\n        {/* IDENTITY / USER MENU TRIGGER */}\n        <button\n          onClick={toggleUserMenu}\n          className={cn(\n            \"group relative flex flex-col items-center gap-1 transition-all active:scale-90 outline-none\",\n            isUserMenuOpen ? \"text-kyn-slate-900\" : \"text-kyn-slate-400\"\n          )}\n        >\n          <div className=\"relative\">\n            <User size={20} strokeWidth={isUserMenuOpen ? 2.5 : 2} />\n            \n            {/* IDENTITY INDICATOR:\n                Only shows if user is logged in (initialProfile exists), \n                component is mounted, and menu is currently closed.\n            */}\n            {mounted && initialProfile && !isUserMenuOpen && (\n              <span className=\"absolute -right-0.5 -top-0.5 h-1.5 w-1.5 rounded-full bg-kyn-green-500 ring-2 ring-canvas\" />\n            )}\n          </div>\n          <span className=\"font-brand text-[9px] font-black uppercase tracking-[0.15em]\">\n            Identity\n          </span>\n          {isUserMenuOpen && (\n            <span className=\"absolute -bottom-1 h-1 w-1 rounded-full bg-kyn-slate-900\" />\n          )}\n        </button>\n      </div>\n    </nav>\n  );\n};\n",
    "embedding": null
  },
  "./components/layout/UserMenu.tsx": {
    "text": "\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { \n  Shield, Library, Settings, LogOut, X, \n  ArrowRight, Loader2, Mail, Lock, ChevronLeft \n} from \"lucide-react\";\nimport { login, signup, logout } from \"@/app/auth/actions\";\nimport { AuthMessage } from \"../auth/AuthMessage\";\nimport { useFormStatus } from \"react-dom\";\nimport { Suspense } from \"react\";\nimport { useUIStore } from \"@/lib/store/ui\";\nimport { Database } from \"@/lib/supabase/types\";\n\n// Get the specific Row type for your profiles table\ntype Profile = Database['public']['Tables']['profiles']['Row'];\n\nexport default function UserMenu({ user }: { user: Profile | null }) {\n  const isOpen = useUIStore((state) => state.isUserMenuOpen);\n  const closeUserMenu = useUIStore((state) => state.closeUserMenu);\n  \n  const [view, setView] = useState<'gateway' | 'login' | 'register' | 'user-menu'>(\n    user ? 'user-menu' : 'gateway'\n  );\n\n  useEffect(() => {\n    if (user) setView('user-menu');\n    else if (view === 'user-menu') setView('gateway');\n  }, [user, view]);\n\n  if (!isOpen) return null;\n\n  const closeAll = () => {\n    closeUserMenu();\n    if (!user) setTimeout(() => setView('gateway'), 300);\n  };\n\n  return (\n    <div className=\"fixed inset-0 z-[200] flex items-center justify-center p-4 md:p-6\">\n      \n      <div \n        className=\"absolute inset-0 bg-kyn-slate-900/60 backdrop-blur-md animate-in fade-in duration-500\" \n        onClick={closeAll} \n      />\n\n      <div className=\"relative w-full max-w-[400px] overflow-hidden rounded-[2.5rem] border border-white/20 bg-white p-8 shadow-2xl animate-in zoom-in-95 fade-in slide-in-from-bottom-8 duration-500 ease-out\">\n        \n        <div className=\"absolute left-8 top-8 flex items-center gap-4 z-10\">\n          {view !== 'gateway' && view !== 'user-menu' && (\n            <button \n              onClick={() => setView('gateway')}\n              className=\"flex h-8 w-8 items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:text-slate-900 transition-colors\"\n            >\n              <ChevronLeft size={18} />\n            </button>\n          )}\n        </div>\n\n        <button \n          onClick={closeAll} \n          className=\"absolute right-8 top-8 flex h-8 w-8 items-center justify-center rounded-full bg-slate-50 text-slate-400 hover:text-slate-900 transition-colors z-10\"\n        >\n          <X size={18} />\n        </button>\n\n        <div className=\"mt-4\">\n          <Suspense fallback={null}>\n              <AuthMessage />\n          </Suspense>\n        </div>\n\n        {(!user && view === 'gateway') && (\n            <div className=\"flex flex-col gap-4 py-4 animate-in fade-in slide-in-from-bottom-2 duration-300\">\n              <div className=\"text-center mb-6\">\n                  <h3 className=\"font-bold text-3xl text-slate-900 tracking-tight\">Access Portal</h3>\n                  <p className=\"text-sm text-slate-500 mt-2\">Identify yourself to proceed.</p>\n              </div>\n              <button \n                onClick={() => setView('login')} \n                className=\"group w-full py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 transition-all active:scale-[0.98] flex items-center justify-center gap-2\"\n              >\n                Sign In <ArrowRight size={16} className=\"opacity-50 group-hover:translate-x-1 transition-transform\" />\n              </button>\n              <button \n                onClick={() => setView('register')} \n                className=\"w-full py-4 border border-slate-200 text-slate-900 rounded-2xl font-bold hover:bg-slate-50 transition-all active:scale-[0.98]\"\n              >\n                Register Identity\n              </button>\n            </div>\n        )}\n\n        {view === 'login' && (\n            <form action={login} className=\"space-y-5 animate-in fade-in slide-in-from-right-4 duration-300\">\n              <div className=\"mb-6\">\n                  <h3 className=\"text-2xl font-bold text-slate-900\">Sign In</h3>\n                  <p className=\"text-xs text-slate-400 uppercase tracking-widest mt-1\">Initialize Session</p>\n              </div>\n              <div className=\"space-y-4\">\n                  <div className=\"relative group\">\n                    <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\" size={16} />\n                    <input name=\"email\" type=\"email\" required placeholder=\"Email Address\" className=\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\" />\n                  </div>\n                  <div className=\"relative group\">\n                    <Lock className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\" size={16} />\n                    <input name=\"password\" type=\"password\" required placeholder=\"Access Key\" className=\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\" />\n                  </div>\n              </div>\n              <SubmitButton label=\"Initialize Session\" />\n            </form>\n        )}\n\n        {view === 'register' && (\n            <form action={signup} className=\"space-y-5 animate-in fade-in slide-in-from-right-4 duration-300\">\n              <div className=\"mb-6\">\n                  <h3 className=\"text-2xl font-bold text-slate-900\">Register</h3>\n                  <p className=\"text-xs text-slate-400 uppercase tracking-widest mt-1\">Create Identity</p>\n              </div>\n              <div className=\"space-y-4\">\n                  <div className=\"relative group\">\n                    <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\" size={16} />\n                    <input name=\"email\" type=\"email\" required placeholder=\"Email Address\" className=\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\" />\n                  </div>\n                  <div className=\"relative group\">\n                    <Lock className=\"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-slate-900 transition-colors\" size={16} />\n                    <input name=\"password\" type=\"password\" required placeholder=\"Create Password\" className=\"w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 bg-slate-50 text-sm focus:border-slate-900 focus:ring-4 focus:ring-slate-900/5 outline-none transition-all\" />\n                  </div>\n              </div>\n              <SubmitButton label=\"Create Identity\" />\n            </form>\n        )}\n\n        {(user && view === 'user-menu') && (\n            <div className=\"flex flex-col gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300\">\n              <div className=\"mb-6 text-center\">\n                  <p className=\"text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-1\">Identity Active</p>\n                  <div className=\"inline-block px-4 py-1.5 rounded-full bg-slate-50 border border-slate-200\">\n                    {/* Note: In your DB 'profiles' table, verify if email exists or use another field */}\n                    <p className=\"font-bold text-slate-900 truncate max-w-[200px] text-sm\">{user?.id}</p>\n                  </div>\n              </div>\n              \n              <div className=\"grid grid-cols-1 gap-2\">\n                <MenuButton href=\"/account\" icon={Shield} label=\"Account\" onClick={closeAll} />\n                <MenuButton href=\"/library\" icon={Library} label=\"Library\" onClick={closeAll} />\n                <MenuButton href=\"/account/settings\" icon={Settings} label=\"Settings\" onClick={closeAll} />\n              </div>\n\n              <form action={logout} className=\"mt-4\">\n                  <button type=\"submit\" className=\"w-full flex items-center justify-center gap-3 py-4 rounded-2xl bg-red-50 text-red-600 font-bold hover:bg-red-100 transition-colors active:scale-95\">\n                    <LogOut size={18} /> Terminate Session\n                  </button>\n              </form>\n            </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction SubmitButton({ label }: { label: string }) {\n  const { pending } = useFormStatus();\n  return (\n    <button disabled={pending} type=\"submit\" className=\"w-full flex items-center justify-center gap-2 py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 transition-all disabled:opacity-70 active:scale-[0.98] shadow-lg shadow-slate-900/10\">\n      {pending ? <Loader2 size={18} className=\"animate-spin\" /> : <>{label} <ArrowRight size={16} /></>}\n    </button>\n  );\n}\n\nfunction MenuButton({ href, icon: Icon, label, onClick }: { href: string, icon: any, label: string, onClick: () => void }) {\n  return (\n    <Link href={href} onClick={onClick} className=\"flex items-center gap-4 px-6 py-4 rounded-2xl bg-slate-50 border border-transparent hover:border-slate-200 hover:bg-white text-slate-900 font-bold transition-all active:scale-[0.98]\">\n      <Icon size={18} className=\"text-slate-400\" /> {label}\n    </Link>\n  );\n}\n",
    "embedding": null
  },
  "./components/layout/Breadcrumbs.tsx": {
    "text": "\"use client\";\n\n/* KYNAR UNIVERSE: components/layout/Breadcrumbs.tsx */\n\nimport Link from \"next/link\";\nimport { ChevronRight } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface Path {\n  label: string;\n  href: string;\n}\n\nexport const Breadcrumbs = ({ paths }: { paths: Path[] }) => {\n  return (\n    <nav className=\"flex items-center gap-2 overflow-x-auto no-scrollbar whitespace-nowrap px-gutter py-4 text-[11px] font-bold uppercase tracking-widest\">\n      <Link \n        href=\"/\" \n        className=\"text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\"\n      >\n        Universe\n      </Link>\n      \n      {paths.map((path, index) => (\n        <div key={path.href} className=\"flex items-center gap-2\">\n          <ChevronRight size={10} className=\"text-kyn-slate-300 shrink-0\" />\n          <Link \n            href={path.href} \n            className={cn(\n              \"transition-colors\",\n              index === paths.length - 1 \n                ? \"text-kyn-slate-900 cursor-default\" \n                : \"text-kyn-slate-400 hover:text-kyn-slate-900\"\n            )}\n          >\n            {path.label}\n          </Link>\n        </div>\n      ))}\n    </nav>\n  );\n};\n",
    "embedding": null
  },
  "./components/layout/RealtimeListener.tsx": {
    "text": "\"use client\";\n\nimport { useVaultRealtime } from \"@/hooks/use-vault-realtime\";\n\nexport function RealtimeListener({ userId }: { userId: string | undefined }) {\n  useVaultRealtime(userId);\n  return null; // This component doesn't render anything, it just listens\n}\n",
    "embedding": null
  },
  "./components/layout/Footer.tsx": {
    "text": "\"use client\";\n\n/* KYNAR UNIVERSE: Final Anchor (v1.6) */\n\nimport Link from \"next/link\";\nimport { Compass, ArrowUpRight } from \"lucide-react\";\n\nexport const Footer = () => {\n  const currentYear = new Date().getFullYear();\n\n  return (\n    <footer className=\"mt-auto border-t border-kyn-slate-50 bg-white px-gutter pt-20 pb-40 md:pb-20\">\n      <div className=\"mx-auto max-w-screen-xl\">\n        <div className=\"grid grid-cols-1 gap-16 md:grid-cols-4\">\n          \n          {/* Brand Philosophy Block */}\n          <div className=\"md:col-span-2 space-y-6\">\n            <Link href=\"/\" className=\"flex items-center gap-3 group w-fit\">\n              <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-kyn-slate-900 text-white transition-transform group-hover:rotate-12\">\n                <Compass size={20} />\n              </div>\n              <span className=\"font-brand text-xl font-bold tracking-tighter text-kyn-slate-900\">\n                KYNAR<span className=\"text-kyn-slate-400\">UNIVERSE</span>\n              </span>\n            </Link>\n            <p className=\"font-ui text-sm text-text-secondary leading-relaxed max-w-sm\">\n              Engineered for digital permanence. We build frameworks and tools \n              designed to ground your creative and technical life in the UK and beyond.\n            </p>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"h-1.5 w-1.5 rounded-full bg-kyn-green-500 animate-pulse\" />\n              <span className=\"font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\">\n                System Active â€¢ London\n              </span>\n            </div>\n          </div>\n\n          {/* Navigation Matrix */}\n          <div className=\"grid grid-cols-2 gap-8 md:col-span-2\">\n            <FooterGroup \n              title=\"Explore\" \n              links={[\n                { label: 'Marketplace', href: '/store' },\n                { label: 'Library', href: '/library' },\n                { label: 'Briefings', href: '/guides' },\n                { label: 'Changelog', href: '/updates' }\n              ]} \n            />\n            <FooterGroup \n              title=\"Identity\" \n              links={[\n                { label: 'Privacy Protocol', href: '/privacy' },\n                { label: 'Terms of Service', href: '/terms' },\n                { label: 'Support Gate', href: '/support' },\n                { label: 'Account', href: '/account' }\n              ]} \n            />\n          </div>\n        </div>\n\n        {/* Bottom Bar: Copyright & Location */}\n        <div className=\"mt-20 pt-8 border-t border-kyn-slate-50 flex flex-col md:flex-row justify-between items-start md:items-center gap-6\">\n          <p className=\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400\">\n            Â© {currentYear} Kynar Universe â€¢ Technical Integrity Reserved\n          </p>\n          \n          <button \n            onClick={() => typeof window.scrollTo({ top: 0, behavior: 'smooth' })}\n            className=\"group flex items-center gap-2 font-brand text-[10px] font-bold uppercase tracking-widest text-kyn-slate-900 hover:text-kyn-green-600 transition-colors\"\n          >\n            Ascend to Top\n            <ArrowUpRight size={14} className=\"transition-transform group-hover:-translate-y-0.5 group-hover:translate-x-0.5\" />\n          </button>\n        </div>\n      </div>\n    </footer>\n  );\n}\n\ninterface FooterGroupProps {\n  title: string;\n  links: { label: string; href: string; }[];\n}\n\nfunction FooterGroup({ title, links }: FooterGroupProps) {\n  return (\n    <div className=\"flex flex-col gap-6\">\n      <span className=\"font-brand text-[10px] font-black uppercase tracking-[0.2em] text-kyn-slate-900\">\n        {title}\n      </span>\n      <nav className=\"flex flex-col gap-4\">\n        {links.map(link => (\n          <Link \n            key={link.label} \n            href={link.href} \n            className=\"font-ui text-sm text-text-secondary hover:text-kyn-slate-900 hover:translate-x-1 transition-all duration-300\"\n          >\n            {link.label}\n          </Link>\n        ))}\n      </nav>\n    </div>\n  );\n}\n",
    "embedding": null
  },
  "./components/layout/PresenceBar.tsx": {
    "text": "\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { ShoppingBag, Fingerprint, User } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { createClient } from \"@/lib/supabase/browser\";\nimport { useCartItems } from \"@/lib/cart/store\";\nimport { useUIStore } from \"@/lib/store/ui\";\nimport { Database } from \"@/lib/supabase/types\";\n\ntype Profile = Database['public']['Tables']['profiles']['Row'];\n\ninterface PresenceBarProps {\n  initialProfile?: Profile | null;\n  context?: string; \n}\n\nexport const PresenceBar = ({ initialProfile, context = \"Universe\" }: PresenceBarProps) => {\n  const [profile, setProfile] = useState<Profile | null>(initialProfile || null);\n  const [mounted, setMounted] = useState(false);\n  \n  const { openSelection, toggleUserMenu, isUserMenuOpen } = useUIStore();\n  const { count } = useCartItems();\n\n  useEffect(() => {\n    setMounted(true);\n    const supabase = createClient();\n    \n    // Fixed: Explicitly typed parameters to satisfy build linting\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (_event: any, session: any) => {\n      if (session?.user) {\n        const { data } = await supabase\n          .from(\"profiles\")\n          .select(\"*\")\n          .eq(\"id\", session.user.id)\n          .single();\n        if (data) setProfile(data as Profile);\n      } else {\n        setProfile(null);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []); \n\n  const selectionCount = mounted ? count : 0;\n  const isUserActive = mounted && profile;\n\n  return (\n    <header className=\"sticky top-0 z-[70] flex h-16 items-center justify-between border-b border-border bg-canvas/80 px-gutter backdrop-blur-xl transition-all duration-500\">\n      <Link href=\"/\" className=\"flex items-center gap-3 group\">\n        <div className=\"flex h-7 w-7 items-center justify-center rounded bg-kyn-slate-900 text-white transition-transform group-hover:rotate-6 shadow-sm\">\n          <Fingerprint size={14} strokeWidth={2.5} />\n        </div>\n        <span className=\"font-brand text-sm font-black uppercase tracking-[0.25em] text-kyn-slate-900\">\n          KYNAR\n        </span>\n      </Link>\n      \n      <div className=\"flex items-center gap-2 md:gap-3\">\n        <span className=\"hidden xs:block text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400 font-ui\">\n          {context}\n        </span>\n        <div className=\"hidden xs:block h-3 w-[1px] bg-border mx-1\" />\n\n        <button \n          onClick={openSelection}\n          className={cn(\n            \"relative flex h-10 w-10 items-center justify-center rounded-xl transition-all active:scale-95\",\n            selectionCount > 0 \n              ? \"bg-kyn-green-500 text-white shadow-lg shadow-kyn-green-500/20\" \n              : \"bg-surface text-kyn-slate-400 border border-border hover:border-kyn-slate-200\"\n          )}\n        >\n          <ShoppingBag size={16} strokeWidth={2.5} />\n          {selectionCount > 0 && (\n            <span className=\"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-kyn-slate-900 text-[8px] font-bold text-white border-2 border-canvas\">\n              {selectionCount}\n            </span>\n          )}\n        </button>\n\n        <button \n          onClick={toggleUserMenu}\n          className={cn(\n            \"group relative flex h-10 w-10 items-center justify-center rounded-xl border transition-all active:scale-90\",\n            isUserMenuOpen \n              ? \"bg-kyn-slate-900 text-white border-kyn-slate-900 shadow-lg\" \n              : \"bg-surface border-border text-kyn-slate-400 hover:border-kyn-slate-900/20\"\n          )}\n        >\n          <User size={16} strokeWidth={2.5} />\n          {isUserActive && (\n            <span className=\"absolute right-2.5 top-2.5 flex h-1.5 w-1.5\">\n              <span className=\"absolute inline-flex h-full w-full animate-ping rounded-full bg-kyn-green-400 opacity-75\"></span>\n              <span className=\"relative inline-flex h-1.5 w-1.5 rounded-full bg-kyn-green-500\"></span>\n            </span>\n          )}\n        </button>\n      </div>\n    </header>\n  );\n};\n",
    "embedding": null
  },
  "./components/account/SettingsForm.tsx": {
    "text": "// @ts-nocheck\n\"use client\";\n\nimport { useState } from \"react\";\nimport { createClient } from \"@/lib/supabase/browser\";\nimport { User, Profile } from \"@/lib/supabase/types\";\nimport { Loader2 } from \"lucide-react\";\nimport { toast } from \"react-hot-toast\";\n\ninterface SettingsFormProps {\n  user: User;\n  profile: Profile;\n}\n\nexport function SettingsForm({ user, profile }: SettingsFormProps) {\n  const supabase = createClient();\n  \n  const [loading, setLoading] = useState(false);\n  const [name, setName] = useState(profile.full_name ?? \"\");\n  \n  const handleUpdate = async () => {\n    if (!name.trim()) {\n      toast.error(\"Name cannot be empty\");\n      return;\n    }\n    \n    setLoading(true);\n    \n    const { error } = await supabase\n      .from(\"profiles\")\n      .update({\n        full_name: name.trim(),\n        updated_at: new Date().toISOString(),\n      })\n      .eq(\"id\", user.id);\n    \n    if (error) {\n      toast.error(\"Update failed\");\n      console.error(\"[SettingsForm] Update error:\", error.message);\n    } else {\n      toast.success(\"Profile synchronized\");\n    }\n    \n    setLoading(false);\n  };\n  \n  return (\n    <div className=\"space-y-8\">\n      <div className=\"space-y-4\">\n        <label className=\"text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\">\n          Full Identity\n        </label>\n        <input\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          placeholder=\"Your full name\"\n          className=\"w-full rounded-xl border border-border bg-white p-4 font-ui\n                     focus:ring-2 focus:ring-kyn-green-500 outline-none transition-all\"\n        />\n      </div>\n\n      <button\n        onClick={handleUpdate}\n        disabled={loading}\n        className=\"w-full flex items-center justify-center gap-3\n                   bg-kyn-slate-900 text-white py-4 rounded-xl font-brand font-bold\n                   hover:bg-black disabled:opacity-50 transition-all active:scale-[0.98]\"\n      >\n        {loading ? (\n          <Loader2 className=\"h-5 w-5 animate-spin\" />\n        ) : (\n          \"Save Changes\"\n        )}\n      </button>\n    </div>\n  );\n}",
    "embedding": null
  },
  "./lib/utils.ts": {
    "text": "import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\n/**\n * Tailwind-safe class merger\n */\nexport function cn(...inputs: ClassValue[]): string {\n  return twMerge(clsx(inputs));\n}\n\n/**\n * Centralized GBP Formatter\n * Adjusted to 2 decimal places to match your store's pricing.\n */\nexport const formatGBP = (amount: number): string => {\n  return new Intl.NumberFormat(\"en-GB\", {\n    style: \"currency\",\n    currency: \"GBP\",\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  }).format(amount);\n};\n\n/**\n * iOS-Safe Haptics\n */\nexport const hapticFeedback = (\n  intensity: \"light\" | \"medium\" | \"success\" = \"light\"\n): void => {\n  if (\n    typeof window === \"undefined\" ||\n    typeof navigator === \"undefined\" ||\n    !navigator.vibrate\n  ) {\n    return;\n  }\n\n  try {\n    switch (intensity) {\n      case \"light\":\n        navigator.vibrate(10);\n        break;\n      case \"medium\":\n        navigator.vibrate(20);\n        break;\n      case \"success\":\n        navigator.vibrate([10, 30, 10]);\n        break;\n    }\n  } catch {\n    // Silent fail\n  }\n};\n\n/**\n * Utility to lock scroll when Modals/Overlays are open\n */\nexport const lockScroll = (lock: boolean) => {\n  if (typeof document === 'undefined') return;\n  document.body.style.overflow = lock ? 'hidden' : 'unset';\n};\n",
    "embedding": null
  },
  "./lib/lemon-squeezy/checkout.ts": {
    "text": "import { Product } from \"@/lib/supabase/types\";\n\ninterface CheckoutConfig {\n  products: Product[];\n  userEmail: string;\n  userId: string;\n  config ? : { redirectUrl ? : string };\n  metadata ? : Record < string,\n  any > ;\n}\n\nexport async function generateCheckoutUrl({\n  products,\n  userEmail,\n  userId,\n  config,\n  metadata\n}: CheckoutConfig): Promise < string > {\n  const API_KEY = process.env.LEMONSQUEEZY_API_KEY;\n  const STORE_ID = process.env.LEMONSQUEEZY_STORE_ID;\n  \n  // Use Netlify's URL env var if available, fall back to public site URL\n  const SITE_URL = process.env.URL || process.env.NEXT_PUBLIC_SITE_URL;\n  \n  if (!API_KEY || !STORE_ID || !SITE_URL) {\n    throw new Error(\"Payment gateway or Site URL configuration missing.\");\n  }\n  \n  const validProducts = products.filter(p => p.price_id && p.price_id !== \"0\");\n  \n  if (validProducts.length === 0) {\n    throw new Error(\"No valid products with price IDs found for checkout.\");\n  }\n  \n  const payload = {\n    data: {\n      type: \"checkouts\",\n      attributes: {\n        store_id: parseInt(STORE_ID),\n        variant_id: parseInt(validProducts[0].price_id as string),\n        checkout_data: {\n          email: userEmail,\n          custom: {\n            user_id: userId,\n            product_ids: validProducts.map(p => p.id).join(\",\"),\n            ...metadata\n          },\n        },\n        product_options: {\n          redirect_url: config?.redirectUrl || `${SITE_URL}/checkout/success`,\n        },\n      },\n    },\n  };\n  \n  const response = await fetch(\"https://api.lemonsqueezy.com/v1/checkouts\", {\n    method: \"POST\",\n    headers: {\n      \"Accept\": \"application/vnd.api+json\",\n      \"Content-Type\": \"application/vnd.api+json\",\n      \"Authorization\": `Bearer ${API_KEY}`\n    },\n    body: JSON.stringify(payload)\n  });\n  \n  const result = await response.json();\n  \n  if (!response.ok) {\n    console.error(\"Lemon Squeezy Error:\", result);\n    throw new Error(result.errors?.[0]?.detail || \"Failed to generate checkout URL\");\n  }\n  \n  return result.data.attributes.url;\n}\n",
    "embedding": null
  },
  "./lib/utils/confetti.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Grounded Celebration (v1.6)\n * Role: Haptic-visual affirmation utility.\n * Optimization: Next.js 15 Dynamic Loading + Reduced Motion Safety.\n */\n\ninterface ConfettiOptions {\n  particleCount?: number;\n  spread?: number;\n  origin?: { x?: number; y?: number };\n  colors?: string[];\n  ticks?: number;\n}\n\n/**\n * Triggers a calibrated celebration.\n * Optimized for mobile-first performance via dynamic browser-only imports.\n */\nexport const triggerCelebration = async (\n  options?: ConfettiOptions\n): Promise<void> => {\n  // Guard: Browser-only\n  if (typeof window === \"undefined\") return;\n  \n  const { default: confetti } = await import(\"canvas-confetti\");\n  \n  const KYNAR_PALETTE = [\n    \"#166534\", // Kyn-Green-700\n    \"#C9A07D\", // Kyn-Caramel-500\n    \"#0F172A\", // Kyn-Slate-900\n    \"#F1F5F9\", // Kyn-Slate-100\n  ];\n  \n  confetti({\n    particleCount: options?.particleCount ?? 40,\n    spread: options?.spread ?? 70,\n    origin: options?.origin ?? { y: 0.7 },\n    colors: options?.colors ?? KYNAR_PALETTE,\n    ticks: options?.ticks ?? 200,\n    zIndex: 100,\n    disableForReducedMotion: true,\n    gravity: 1.2,\n    scalar: 0.8,\n  });\n};\n",
    "embedding": null
  },
  "./lib/cart/store.ts": {
    "text": "/* KYNAR UNIVERSE: lib/cart/store.ts */\n\"use client\";\nimport { create } from 'zustand';\nimport { persist, createJSONStorage, type StateStorage } from 'zustand/middleware';\nimport { Product } from '@/lib/supabase/types';\nimport { getPriceFromId } from '../marketplace/pricing';\nimport { useState, useEffect, useMemo } from 'react';\n\n// Define mock storage outside to avoid parsing errors in Turbopack\nconst mockStorage: StateStorage = {\n  getItem: () => null,\n  setItem: () => {},\n  removeItem: () => {},\n};\n\ninterface CartState {\n  items: Product[];\n  isHydrated: boolean;\n  addItem: (product: Product) => void;\n  removeItem: (productId: string) => void;\n  clearCart: () => void;\n  isInCart: (productId: string) => boolean;\n  setHydrated: (state: boolean) => void;\n}\n\nexport const useCartStore = create<CartState>()(\n  persist(\n    (set, get) => ({\n      items: [],\n      isHydrated: false,\n      addItem: (product: Product) => {\n        const { items } = get();\n        if (!items.some((item) => item.id === product.id)) {\n          set({ items: [...items, product] });\n        }\n      },\n      removeItem: (productId: string) => {\n        set((state) => ({\n          items: state.items.filter((item) => item.id !== productId)\n        }));\n      },\n      clearCart: () => set({ items: [] }),\n      isInCart: (productId: string) => get().items.some((item) => item.id === productId),\n      setHydrated: (state: boolean) => set({ isHydrated: state }),\n    }),\n    {\n      name: 'kynar-vault-session-v1.6',\n      storage: createJSONStorage(() => \n        typeof window !== 'undefined' ? window.localStorage : mockStorage\n      ),\n      onRehydrateStorage: () => (state) => state?.setHydrated(true),\n    }\n  )\n);\n\nexport function useCartItems() {\n  const items = useCartStore((state) => state.items);\n  const isHydrated = useCartStore((state) => state.isHydrated);\n  const removeItem = useCartStore((state) => state.removeItem);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const totalPrice = useMemo(() => { \n    return items.reduce((total, item) => { \n      const price = getPriceFromId(item.price_id); \n      return total + (price ?? 0);\n    }, 0);\n  }, [items]);\n  \n\n  if (!mounted || !isHydrated) {\n    return { \n      items: [], \n      count: 0, \n      totalPrice: 0, \n      isEmpty: true, \n      removeItem, \n      updateQuantity: () => {} \n    };\n  }\n\n  return { \n    items, \n    count: items.length, \n    totalPrice, \n    isEmpty: items.length === 0, \n    removeItem,\n    updateQuantity: () => {} \n  };\n}\n\nexport function useCartActions() {\n  const addItem = useCartStore((state) => state.addItem);\n  const removeItem = useCartStore((state) => state.removeItem);\n  const clearCart = useCartStore((state) => state.clearCart);\n  const isInCart = useCartStore((state) => state.isInCart);\n\n  return { addItem, removeItem, clearCart, isInCart };\n}\n",
    "embedding": null
  },
  "./lib/marketplace/pricing.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Pricing Engine (v2.1.1)\n * Role: Deterministic mapping of Lemon Squeezy IDs to numeric values.\n * Fix: Corrected environment check and enforced strict numeric returns.\n */\n\n/**\n * Registry of active Lemon Squeezy Price IDs and their GBP values.\n */\nconst PRICE_MAP: Record<string, number> = {\n  // Free / Lead Magnets\n  'free': 0,\n  \n  // Example Tiers\n  'pri_01hs5xyz...': 5,   \n  'pri_01hs6abc...': 12,  \n  'pri_01hs7def...': 25,  \n  'pri_01hs8ghi...': 45,  \n};\n\nconst FALLBACK_PRICE = 0;\n\n/**\n * IDENTITY: Resolves a Lemon Squeezy Price ID to a numeric value.\n * Guaranteed to return a number to satisfy tsc --strict arithmetic.\n */\nexport function getPriceFromId(priceId: string | null | undefined): number {\n  if (!priceId) return FALLBACK_PRICE;\n  \n  // Direct lookup using indexed access\n  const price = PRICE_MAP[priceId];\n\n  if (price !== undefined) {\n    return price;\n  }\n\n  // Corrected Environment Check: Use NODE_ENV for build-stage logic\n  if (process.env.NODE_ENV !== 'production') {\n    console.warn(`[Pricing Engine] Unknown price_id: ${priceId}. Falling back to 0.`);\n  }\n\n  return FALLBACK_PRICE;\n}\n\n/**\n * UTILITY: Checks if a product is free based on its ID.\n */\nexport function isProductFree(priceId: string | null | undefined): boolean {\n  return getPriceFromId(priceId) === 0;\n}\n\n/**\n * SERVER/EDGE: Validation helper for secure checkout sessions.\n */\nexport function validatePriceMatch(priceId: string, claimedPrice: number): boolean {\n  const actualPrice = getPriceFromId(priceId);\n  return actualPrice === claimedPrice;\n}\n",
    "embedding": null
  },
  "./lib/store/vault.ts": {
    "text": "/* KYNAR UNIVERSE: lib/store/vault.ts */\n\"use client\";\nimport { create } from 'zustand';\nimport { persist, createJSONStorage, type StateStorage } from 'zustand/middleware';\nimport { Product } from '@/lib/supabase/types';\nimport { getPriceFromId } from '@/lib/marketplace/pricing';\nimport { useState, useEffect } from 'react';\n\nconst mockStorage: StateStorage = {\n  getItem: () => null,\n  setItem: () => {},\n  removeItem: () => {},\n};\n\ninterface VaultState {\n  items: Product[];\n  _hasHydrated: boolean;\n  addItem: (product: Product) => void;\n  removeItem: (productId: string) => void;\n  clearVault: () => void;\n  setHasHydrated: (state: boolean) => void;\n}\n\nexport const useVaultStore = create<VaultState>()(\n  persist(\n    (set, get) => ({\n      items: [],\n      _hasHydrated: false,\n      setHasHydrated: (state) => set({ _hasHydrated: state }),\n      addItem: (product) => {\n        const { items } = get();\n        if (items.some((item) => item.id === product.id)) return;\n        set({ items: [...items, product] });\n      },\n      removeItem: (productId) => \n        set((state) => ({\n          items: state.items.filter((item) => item.id !== productId)\n        })),\n      clearVault: () => set({ items: [] }),\n    }),\n    {\n      name: 'kynar-vault-storage',\n      storage: createJSONStorage(() => \n        typeof window !== 'undefined' ? window.localStorage : mockStorage\n      ),\n      onRehydrateStorage: () => (state) => {\n        state?.setHasHydrated(true);\n      },\n    }\n  )\n);\n\nexport function useVault() {\n  const items = useVaultStore((state) => state.items);\n  const hasHydrated = useVaultStore((state) => state._hasHydrated);\n  const addItem = useVaultStore((state) => state.addItem);\n  const removeItem = useVaultStore((state) => state.removeItem);\n  \n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  if (!mounted || !hasHydrated) {\n    return {\n      items: [],\n      count: 0,\n      totalValue: 0,\n      addItem: (_p: Product) => {},\n      removeItem: (_id: string) => {},\n      isInVault: (_id: string) => false,\n    };\n  }\n\n  const totalValue = items.reduce((total, item) => {\n    const price = getPriceFromId(item.price_id);\n    return total + (price ?? 0);\n  }, 0);\n\n  return {\n    items,\n    count: items.length,\n    totalValue,\n    addItem,\n    removeItem,\n    isInVault: (id: string) => items.some((item) => item.id === id),\n  };\n}\n",
    "embedding": null
  },
  "./lib/store/ui.ts": {
    "text": "import { create } from 'zustand';\n\ninterface UIState {\n  isSelectionOpen: boolean;\n  openSelection: () => void;\n  closeSelection: () => void;\n  isUserMenuOpen: boolean;\n  toggleUserMenu: () => void;\n  closeUserMenu: () => void;\n  closeAll: () => void;\n}\n\nexport const useUIStore = create<UIState>((set) => ({\n  isSelectionOpen: false,\n  isUserMenuOpen: false,\n\n  openSelection: () => set({ \n    isSelectionOpen: true, \n    isUserMenuOpen: false \n  }),\n\n  closeSelection: () => set({ isSelectionOpen: false }),\n\n  toggleUserMenu: () => set((state) => ({ \n    isUserMenuOpen: !state.isUserMenuOpen,\n    isSelectionOpen: false \n  })),\n\n  closeUserMenu: () => set({ isUserMenuOpen: false }),\n\n  closeAll: () => set({ \n    isSelectionOpen: false, \n    isUserMenuOpen: false \n  }),\n}));\n",
    "embedding": null
  },
  "./lib/content/productCopyExamples.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Calm Copy Templates (v1.6)\n * Role: The Narrative Engine for the Marketplace.\n * Guidelines: Plain UK English, no hype, no exclamation marks.\n * Identity: Grounded, Utility-focused, Professional.\n */\n\nexport interface ProductTemplate {\n  title: string;\n  tagline: string;\n  whoItsFor: string;\n  included: string[];\n  philosophy: string;\n  howItHelps: string;\n  usage: string;\n}\n\nexport const KYNAR_COPY_LIBRARY: Record<string, ProductTemplate> = {\n  HOME_ORGANISER: {\n    title: \"Digital Home Organiser\",\n    tagline: \"A quiet space to coordinate your daily routines without the noise of typical productivity apps.\",\n    whoItsFor: \"Designed for those who seek a simpler, more manual way to organise domestic life.\",\n    included: [\n      \"1 x Comprehensive PDF Guide (Print-ready)\",\n      \"1 x Interactive Notion Template (Mobile-Optimised)\",\n      \"Setup instructions for offline use\",\n      \"Lifetime access to future versions\"\n    ],\n    philosophy: \"Digital life should support your physical reality, not distract from it. We avoid complex automations in favour of intentional, manual entry.\",\n    howItHelps: \"By providing a fixed structure for your home data, it removes the 'blank page' anxiety of starting a new system. It focuses on clarity and calm retrieval.\",\n    usage: \"Designed for a five-minute daily check-in. No notifications, no pressure. It works whenever you are ready.\"\n  },\n  \n  BUDGET_TRACKER: {\n    title: \"Mindful Budget Tracker\",\n    tagline: \"A stripped-back financial tool focused on awareness and long-term decisions.\",\n    whoItsFor: \"Ideal for those who find automated banking apps overwhelming or 'gamified'.\",\n    included: [\n      \"1 x Excel/Sheets Budgeting Framework\",\n      \"1 x Digital Guide on Manual Tracking\",\n      \"Monthly review protocols\",\n      \"Multi-currency support\"\n    ],\n    philosophy: \"When you track money manually, you feel the weight of your spending. This is a tool for awareness, not just math. It encourages slow, deliberate financial decisions.\",\n    howItHelps: \"It strips away the complexity of modern banking apps to show you the truth of your cash flow without the 'gamified' distractions.\",\n    usage: \"Update once a week or after major transactions. High-performance utility for long-term stability.\"\n  },\n\n  PROJECT_DASHBOARD: {\n    title: \"Project Clarity Dashboard\",\n    tagline: \"A minimal framework for moving projects from initial thought to finished reality.\",\n    whoItsFor: \"Ideal for independent professionals who want to track progress without the pressure of streaks.\",\n    included: [\n      \"1 x Project Sequencing Framework\",\n      \"1 x Visual Progress Board\",\n      \"Archive protocols for finished work\",\n      \"Native mobile layout\"\n    ],\n    philosophy: \"Projects should have a beginning and an end. This dashboard treats your work as a series of intentional sequences rather than a never-ending 'to-do' list.\",\n    howItHelps: \"It provides a 'Single Source of Truth' for your active work, reducing the mental load of switching between different tasks.\",\n    usage: \"Check in at the start and end of your work session. Keep your focus narrow and your output high.\"\n  }\n};\n\n/**\n * Helper to generate full markdown description for Product Pages.\n * Ensures hydration-safe rendering in prose components.\n */\nexport const generateFullDescription = (template: ProductTemplate): string => {\n  return `\n# Philosophy\n${template.philosophy}\n\n# How it helps\n${template.howItHelps}\n\n# Usage\n${template.usage}\n  `.trim();\n};\n",
    "embedding": null
  },
  "./lib/supabase/browser.ts": {
    "text": "import { createBrowserClient } from '@supabase/ssr';\nimport { Database } from './types';\n\nlet client: ReturnType<typeof createBrowserClient<Database>> | undefined;\n\nexport const createClient = () => {\n  if (client) return client;\n\n  client = createBrowserClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      auth: {\n        flowType: 'pkce',\n        persistSession: true,\n        detectSessionInUrl: true,\n      },\n    }\n  );\n\n  return client;\n};\n",
    "embedding": null
  },
  "./lib/supabase/server.ts": {
    "text": "// lib/supabase/server.ts\nimport { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\nimport { Database } from './types' // Ensure this path is correct\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() { return cookieStore.getAll() },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch { /* Middleware handles this in RSC */ }\n        },\n      },\n    }\n  )\n}\n",
    "embedding": null
  },
  "./lib/supabase/client.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Unified Client Entry (v1.5)\n * Redirects legacy imports to the evolved Browser Client.\n */\nexport { createClient } from './browser';\n",
    "embedding": null
  },
  "./lib/supabase/types.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Canonical Type System (v2.3)\n * Fully aligned with generated Supabase schema + Next.js 15 logic\n */\n\n/* -------------------------------------------------------------------------- */\n/* 1. Custom App Enums & Consts                                               */\n/* -------------------------------------------------------------------------- */\n\nexport const WORLDS = ['Home', 'Lifestyle', 'Tools'] as const;\nexport type World = (typeof WORLDS)[number];\n\nexport const FILE_TYPES = ['PDF', 'Notion', 'Excel', 'PNG', 'ZIP', 'PWA'] as const;\nexport type FileType = (typeof FILE_TYPES)[number];\n\nexport type GuideCategory = 'usage' | 'spotlight' | 'tips';\n\n/* -------------------------------------------------------------------------- */\n/* 2. Database Schema (Unified with Supabase API Docs)                         */\n/* -------------------------------------------------------------------------- */\n\nexport type Json =\n  | string\n  | number\n  | boolean\n  | null\n  | { [key: string]: Json | undefined }\n  | Json[];\n\nexport type Database = {\n  public: {\n    Tables: {\n      guides: {\n        Row: {\n          author: string | null;\n          category: string;\n          content: string | null;\n          created_at: string | null;\n          excerpt: string | null;\n          id: string;\n          is_published: boolean | null;\n          read_time_minutes: number | null;\n          related_product_ids: string[] | null;\n          slug: string;\n          thumbnail_url: string | null;\n          title: string;\n          updated_at: string | null;\n          world: string;\n        };\n        Insert: {\n          author?: string | null;\n          category: string;\n          content?: string | null;\n          created_at?: string | null;\n          excerpt?: string | null;\n          id?: string;\n          is_published?: boolean | null;\n          read_time_minutes?: number | null;\n          related_product_ids?: string[] | null;\n          slug: string;\n          thumbnail_url?: string | null;\n          title: string;\n          updated_at?: string | null;\n          world: string;\n        };\n        Update: {\n          author?: string | null;\n          category?: string;\n          content?: string | null;\n          created_at?: string | null;\n          excerpt?: string | null;\n          id?: string;\n          is_published?: boolean | null;\n          read_time_minutes?: number | null;\n          related_product_ids?: string[] | null;\n          slug?: string;\n          thumbnail_url?: string | null;\n          title?: string;\n          updated_at?: string | null;\n          world?: string;\n        };\n        Relationships: [];\n      };\n      products: {\n        Row: {\n          category: string | null;\n          created_at: string | null;\n          description: string | null;\n          download_path: string | null;\n          file_types: string[] | null;\n          id: string;\n          is_published: boolean | null;\n          lemon_squeezy_id: string | null;\n          metadata: Json | null;\n          preview_image: string | null;\n          price_id: string;\n          short_description: string | null;\n          slug: string;\n          tags: string[] | null;\n          title: string;\n          updated_at: string | null;\n          variant_id: string | null;\n          world: string;\n        };\n        Insert: {\n          category?: string | null;\n          created_at?: string | null;\n          description?: string | null;\n          download_path?: string | null;\n          file_types?: string[] | null;\n          id?: string;\n          is_published?: boolean | null;\n          lemon_squeezy_id?: string | null;\n          metadata?: Json | null;\n          preview_image?: string | null;\n          price_id: string;\n          short_description?: string | null;\n          slug: string;\n          tags?: string[] | null;\n          title: string;\n          updated_at?: string | null;\n          variant_id?: string | null;\n          world: string;\n        };\n        Update: {\n          category?: string | null;\n          created_at?: string | null;\n          description?: string | null;\n          download_path?: string | null;\n          file_types?: string[] | null;\n          id?: string;\n          is_published?: boolean | null;\n          lemon_squeezy_id?: string | null;\n          metadata?: Json | null;\n          preview_image?: string | null;\n          price_id?: string;\n          short_description?: string | null;\n          slug?: string;\n          tags?: string[] | null;\n          title?: string;\n          updated_at?: string | null;\n          variant_id?: string | null;\n          world?: string;\n        };\n        Relationships: [];\n      };\n      profiles: {\n        Row: {\n          created_at: string | null;\n          email: string;\n          full_name: string | null;\n          id: string;\n          is_admin: boolean | null;\n          updated_at: string | null;\n        };\n        Insert: {\n          created_at?: string | null;\n          email: string;\n          full_name?: string | null;\n          id: string;\n          is_admin?: boolean | null;\n          updated_at?: string | null;\n        };\n        Update: {\n          created_at?: string | null;\n          email?: string;\n          full_name?: string | null;\n          id?: string;\n          is_admin?: boolean | null;\n          updated_at?: string | null;\n        };\n        Relationships: [];\n      };\n      purchases: {\n        Row: {\n          id: string;\n          lemon_squeezy_checkout_id: string | null;\n          lemon_squeezy_order_id: string | null;\n          product_id: string;\n          purchase_date: string | null;\n          status: string;\n          user_email: string;\n          user_id: string | null;\n        };\n        Insert: {\n          id?: string;\n          lemon_squeezy_checkout_id?: string | null;\n          lemon_squeezy_order_id?: string | null;\n          product_id: string;\n          purchase_date?: string | null;\n          status: string;\n          user_email: string;\n          user_id?: string | null;\n        };\n        Update: {\n          id?: string;\n          lemon_squeezy_checkout_id?: string | null;\n          lemon_squeezy_order_id?: string | null;\n          product_id?: string;\n          purchase_date?: string | null;\n          status?: string;\n          user_email?: string;\n          user_id?: string | null;\n        };\n        Relationships: [\n          {\n            foreignKeyName: \"purchases_product_id_fkey\";\n            columns: [\"product_id\"];\n            isOneToOne: false;\n            referencedRelation: \"products\";\n            referencedColumns: [\"id\"];\n          }\n        ];\n      };\n      user_library: {\n        Row: {\n          acquired_at: string | null;\n          id: string;\n          order_id: string | null;\n          price_id: string | null;\n          product_id: string;\n          purchase_price: number | null;\n          purchased_at: string | null;\n          source: string | null;\n          status: string | null;\n          user_id: string;\n        };\n        Insert: {\n          acquired_at?: string | null;\n          id?: string;\n          order_id?: string | null;\n          price_id?: string | null;\n          product_id: string;\n          purchase_price?: number | null;\n          purchased_at?: string | null;\n          source?: string | null;\n          status?: string | null;\n          user_id: string;\n        };\n        Update: {\n          acquired_at?: string | null;\n          id?: string;\n          order_id?: string | null;\n          price_id?: string | null;\n          product_id?: string;\n          purchase_price?: number | null;\n          purchased_at?: string | null;\n          source?: string | null;\n          status?: string | null;\n          user_id?: string;\n        };\n        Relationships: [\n          {\n            foreignKeyName: \"fk_product\";\n            columns: [\"product_id\"];\n            isOneToOne: false;\n            referencedRelation: \"products\";\n            referencedColumns: [\"id\"];\n          },\n          {\n            foreignKeyName: \"user_library_product_id_fkey\";\n            columns: [\"product_id\"];\n            isOneToOne: false;\n            referencedRelation: \"products\";\n            referencedColumns: [\"id\"];\n          }\n        ];\n      };\n      webhook_events: {\n        Row: {\n          created_at: string | null;\n          error_message: string | null;\n          event_id: string;\n          event_name: string;\n          id: string;\n          payload: Json;\n          status: string | null;\n          updated_at: string | null;\n        };\n        Insert: {\n          created_at?: string | null;\n          error_message?: string | null;\n          event_id: string;\n          event_name: string;\n          id?: string;\n          payload: Json;\n          status?: string | null;\n          updated_at?: string | null;\n        };\n        Update: {\n          created_at?: string | null;\n          error_message?: string | null;\n          event_id?: string;\n          event_name?: string;\n          id?: string;\n          payload?: Json;\n          status?: string | null;\n          updated_at?: string | null;\n        };\n        Relationships: [];\n      };\n    };\n    Enums: {\n      audit_action: \"CREATE_PRODUCT\" | \"UPDATE_PRODUCT\" | \"DELETE_PRODUCT\" | \"SAVE_PRODUCT\" | \"UPDATE_SETTINGS\" | \"MANUAL_REFUND\";\n      world_type: \"home\" | \"lifestyle\" | \"tools\";\n    };\n  };\n};\n\n/* -------------------------------------------------------------------------- */\n/* 3. Helper Aliases (Strict Extraction)                                       */\n/* -------------------------------------------------------------------------- */\n\ntype DefaultSchema = Database['public'];\n\nexport type Tables<\n  T extends keyof DefaultSchema['Tables']\n> = DefaultSchema['Tables'][T]['Row'];\n\nexport type TablesInsert<\n  T extends keyof DefaultSchema['Tables']\n> = DefaultSchema['Tables'][T]['Insert'];\n\nexport type TablesUpdate<\n  T extends keyof DefaultSchema['Tables']\n> = DefaultSchema['Tables'][T]['Update'];\n\n/* -------------------------------------------------------------------------- */\n/* 4. Domain-Specific UI Aliases                                              */\n/* -------------------------------------------------------------------------- */\n\nexport type Product = Tables<'products'>;\nexport type Profile = Tables<'profiles'>;\nexport type Guide = Tables<'guides'>;\nexport type Purchase = Tables<'purchases'>;\nexport type WebhookEvent = Tables<'webhook_events'>;\n\n// Extended type for components that fetch the related product object\nexport type UserLibrary = Tables<'user_library'> & { \n  product?: Product;\n};\n\n// Generic User for auth-specific components\nexport type User = {\n  id: string;\n  email?: string;\n};\n",
    "embedding": null
  },
  "./lib/supabase/helpers.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Supabase Data Helpers (v2.4)\n * Evolution: Build-Safe Type Handling & Error Suppression\n */\n\nimport { createClient } from './server';\nimport { Product, World, Profile } from './types';\n\nexport interface FilterOptions {\n  world?: World | 'All';\n  sort?: 'newest' | 'alphabetical';\n}\n\n/**\n * IDENTITY: Fetches the profile for the current user.\n * Explicitly typed to satisfy strict Row/Profile alignment.\n */\nexport async function getUserProfile(): Promise<Profile | null> {\n  const supabase = await createClient();\n  \n  // Destructure with explicit null-check to avoid auth context errors\n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return null;\n\n  const { data, error } = await supabase\n    .from('profiles')\n    .select('*')\n    .eq('id', user.id)\n    .maybeSingle();\n\n  if (error) {\n    console.error('[Helpers] Profile fetch error:', error.message);\n    return null;\n  }\n\n  return data as Profile | null;\n}\n\n/**\n * OWNERSHIP: Validates if the current user owns a specific product.\n * Returns boolean for UI logic.\n */\nexport async function checkOwnership(productId: string): Promise<boolean> {\n  const supabase = await createClient();\n  \n  const { data: { user } } = await supabase.auth.getUser();\n  if (!user) return false;\n\n  const { data, error } = await supabase\n    .from('user_library')\n    .select('id')\n    .eq('user_id', user.id)\n    .eq('product_id', productId)\n    .maybeSingle();\n\n  return !!data && !error;\n}\n\n/**\n * DISCOVERY: Optimized product retrieval.\n * Logic: Maps 'All' world selection to a broad query.\n */\nexport async function getFilteredProducts(options: FilterOptions): Promise<Product[]> {\n  const supabase = await createClient();\n  \n  let query = supabase\n    .from('products')\n    .select('*')\n    .eq('is_published', true);\n\n  // Apply World Filter: Convert 'Lifestyle' -> 'lifestyle' for DB Enum match\n  if (options.world && options.world !== 'All') {\n    query = query.eq('world', options.world.toLowerCase()); \n  }\n\n  // Apply Sorting\n  if (options.sort === 'alphabetical') {\n    query = query.order('title', { ascending: true });\n  } else {\n    query = query.order('created_at', { ascending: false });\n  }\n\n  const { data, error } = await query;\n\n  if (error) {\n    console.error('[Helpers] Product fetch error:', error.message);\n    return [];\n  }\n\n  return (data as Product[]) || [];\n}\n",
    "embedding": null
  },
  "./hooks/use-vault-realtime.ts": {
    "text": "\"use client\";\n\n/**\n * KYNAR UNIVERSE: Realtime Vault Sync Hook (v1.5)\n * Path: hooks/use-vault-realtime.ts\n * Role: Listens for library acquisitions and triggers server-side refreshes.\n */\n\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { createClient } from '@/lib/supabase/browser';\nimport { UserLibrary } from '@/lib/supabase/types';\n\nexport function useVaultRealtime(userId: string | undefined) {\n  const supabase = createClient();\n  const router = useRouter();\n\n  useEffect(() => {\n    // Exit if no user is authenticated to prevent channel errors\n    if (!userId) return;\n\n    const channel = supabase\n      .channel(`vault_sync_${userId}`)\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'user_library',\n          filter: `user_id=eq.${userId}`,\n        },\n        (payload: { new: UserLibrary }) => {\n          console.log('[Realtime] Asset synchronized:', payload.new.product_id);\n          \n          /**\n           * router.refresh() invalidates the Client Component cache \n           * and re-fetches Server Components (like your Vault grid).\n           */\n          router.refresh();\n        }\n      )\n      .subscribe();\n\n    return () => {\n      // Clean up the channel on unmount to prevent memory leaks\n      supabase.removeChannel(channel);\n    };\n  }, [userId, supabase, router]);\n}\n",
    "embedding": null
  },
  "./app/globals.css": {
    "text": "@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  :root {\n    --canvas: 40 12% 97%;\n    --surface: 210 20% 98%;\n    --border: 214 32% 91%;\n    --kyn-green: 142 71% 45%;\n    --kyn-caramel: 38 48% 39%;\n    --kyn-slate: 215 25% 15%;\n    --text-primary: 215 25% 7%;\n    --text-secondary: 215 16% 47%;\n    \n    /* Mobile Safe Zones */\n    --safe-bottom: env(safe-area-inset-bottom, 1.5rem);\n    --safe-top: env(safe-area-inset-top, 0px);\n    \n    /* Easing Evolved: \"The Drift\" */\n    --ease-kyn-out: cubic-bezier(0.16, 1, 0.3, 1);\n  }\n\n  * {\n    @apply border-border;\n    -webkit-tap-highlight-color: transparent;\n  }\n\n  html, body {\n    @apply bg-canvas text-text-primary;\n    font-feature-settings: \"cv02\", \"cv03\", \"cv04\", \"cv11\";\n    line-height: 1.6;\n    overflow-x: hidden;\n    width: 100%;\n    position: relative;\n    min-height: 100svh;\n    scroll-behavior: smooth;\n  }\n\n  /* Fixed: Selection logic moved out of @apply to pass Turbopack build */\n  ::selection {\n    background-color: hsl(var(--kyn-green) / 0.15);\n    color: inherit;\n  }\n}\n\n@layer components {\n  /* High-end blur for portals */\n  .portal-backdrop {\n    @apply fixed inset-0 z-[190] bg-kyn-slate-900 backdrop-blur-md;\n    background-color: hsl(var(--kyn-slate) / 0.4); /* Manual override for safety */\n    transition: backdrop-filter 0.5s var(--ease-kyn-out), background-color 0.5s var(--ease-kyn-out);\n  }\n\n  /* Glassmorphism Surface */\n  .kynar-glass {\n    @apply bg-white/70 backdrop-blur-xl border border-white/20 shadow-kynar-soft;\n  }\n\n  .calm-transition {\n    transition: all 0.6s var(--ease-kyn-out);\n    will-change: transform, opacity, filter;\n  }\n\n  .kynar-card {\n    @apply calm-transition rounded-kynar-lg border border-border bg-surface hover:shadow-kynar-soft;\n  }\n\n  /* Padding for bottom-docked nav */\n  .pt-safe-top { \n    padding-top: var(--safe-top); \n  }\n  .pb-safe-bottom { \n    padding-bottom: var(--safe-bottom); \n  }\n}\n",
    "embedding": null
  },
  "./app/layout.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Root Architecture (v2.3)\n * Path: app/layout.tsx\n * Evolution: Strict Type-Safe Profile Injection & Layout Fluidity\n */\n\nimport type { Metadata, Viewport } from \"next\";\nimport { Inter, Plus_Jakarta_Sans } from \"next/font/google\";\nimport \"./globals.css\";\n\n// Component Imports\nimport { PresenceBar } from \"@/components/layout/PresenceBar\";\nimport { Footer } from \"@/components/layout/Footer\";\nimport { Navigation } from \"@/components/layout/Navigation\"; \nimport { getUserProfile } from \"@/lib/supabase/helpers\";\nimport { Toaster } from \"react-hot-toast\";\nimport { cn } from \"@/lib/utils\";\nimport OverlayWrapper from \"@/components/marketplace/OverlayWrapper\";\nimport UserMenu from \"@/components/layout/UserMenu\";\n\n// Type Imports - Explicitly aligning with your definitive types.ts\nimport { Profile } from \"@/lib/supabase/types\";\n\nconst inter = Inter({ subsets: [\"latin\"], variable: \"--font-ui\", display: 'swap' });\nconst jakarta = Plus_Jakarta_Sans({ subsets: [\"latin\"], variable: \"--font-brand\", display: 'swap' });\n\nexport const viewport: Viewport = {\n  width: 'device-width',\n  initialScale: 1,\n  maximumScale: 1,\n  viewportFit: 'cover',\n  themeColor: '#FAF9F6',\n};\n\nexport const metadata: Metadata = {\n  title: {\n    template: '%s | KYNAR',\n    default: 'KYNAR | Home â€¢ Lifestyle â€¢ Tools',\n  },\n  description: \"A calm, mobile-first digital ecosystem.\",\n  metadataBase: new URL('https://kynaruniverse.com'),\n};\n\nexport default async function RootLayout({ children }: { children: React.ReactNode }) {\n  /** * FIXED: Lowercase 'profile' to match variable usage across the tree.\n   * Type is explicitly set to Profile | null based on types.ts.\n   */\n  const profile: Profile | null = await getUserProfile();\n\n  return (\n    <html lang=\"en\" className={cn(inter.variable, jakarta.variable, \"antialiased\")}>\n      <body className=\"bg-canvas text-text-primary overflow-x-hidden\">\n        \n        {/* MODAL LAYER: Managed via global useUIStore */}\n        <UserMenu user={profile} />\n        <OverlayWrapper />\n\n        {/* FEEDBACK LAYER */}\n        <Toaster \n          position=\"bottom-center\" \n          toastOptions={{\n            style: {\n              borderRadius: '1.25rem',\n              background: '#1A241B',\n              color: '#fff',\n              fontFamily: 'var(--font-brand)',\n              fontSize: '13px',\n              fontWeight: '600',\n              padding: '12px 20px',\n              border: '1px solid rgba(255,255,255,0.1)'\n            },\n          }}\n        />\n\n        {/* TEXTURE LAYER: Analog Grain Overlay */}\n        <div \n          className=\"pointer-events-none fixed inset-0 z-[1] h-full w-full opacity-[0.015] will-change-transform\" \n          aria-hidden=\"true\"\n          style={{ \n            backgroundImage: `url(\"data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E\")`,\n          }}\n        />\n\n        {/* CONTENT LAYER */}\n        <div className=\"relative z-10 flex min-h-screen flex-col\">\n          {/* Ensure prop names match component definitions (initialProfile vs user) */}\n          <PresenceBar initialProfile={profile} />\n          \n          <main className=\"flex-grow pt-safe-top pb-24 md:pb-0\">\n            {children}\n          </main>\n\n          <Footer />\n          \n          {/* MOBILE NAVIGATION: Anchored to viewport bottom */}\n          <Navigation initialProfile={profile} />\n        </div>\n      </body>\n    </html>\n  );\n}\n",
    "embedding": null
  },
  "./app/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: The Universe Gate (v1.5)\n * Role: The primary entry point and world-selection portal.\n * Optimization: Mobile-first ergonomic grid & Next.js 16 Server-First architecture.\n */\n\nimport Link from \"next/link\";\nimport { Sparkles, ArrowRight, Globe, Compass, Box } from \"lucide-react\";\nimport { WORLDS, World } from \"@/lib/supabase/types\";\n\ninterface WorldMeta {\n  name: World;\n  slug: string;\n  color: string;\n  icon: React.ReactNode;\n  desc: string;\n}\n\nexport default function UniverseGate() {\n  // Mapping the canonical WORLDS enum to visual metadata\n  const worlds: WorldMeta[] = [\n    { \n      name: WORLDS[0], // \"Home\"\n      slug: \"home\", \n      color: \"bg-kyn-green-500\", \n      icon: <Box size={20} />,\n      desc: \"Order in your physical space and domestic architecture.\" \n    },\n    { \n      name: WORLDS[1], // \"Lifestyle\"\n      slug: \"lifestyle\", \n      color: \"bg-kyn-caramel-500\", \n      icon: <Sparkles size={20} />,\n      desc: \"Refined daily routines and personal digital sophistication.\" \n    },\n    { \n      name: WORLDS[2], // \"Tools\"\n      slug: \"tools\", \n      color: \"bg-kyn-slate-500\", \n      icon: <Compass size={20} />,\n      desc: \"High-performance clarity for your professional projects.\" \n    },\n  ];\n\n  return (\n    <main className=\"relative flex min-h-[90vh] flex-col items-center justify-center px-gutter py-12 md:py-24 overflow-hidden\">\n      \n      {/* Atmospheric Background Element */}\n      <div className=\"absolute top-1/2 left-1/2 -z-10 h-[500px] w-[500px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-kyn-green-50/30 blur-[120px]\" />\n\n      {/* Brand Header */}\n      <header className=\"text-center animate-in fade-in slide-in-from-top-4 duration-1000\">\n        <div className=\"mb-6 flex justify-center\">\n          <div className=\"inline-flex items-center gap-2 rounded-full bg-white border border-border px-4 py-1.5 shadow-sm\">\n            <Globe size={14} className=\"text-kyn-green-500 animate-spin-slow\" />\n            <span className=\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-text-secondary\">\n              Central Hub Active\n            </span>\n          </div>\n        </div>\n\n        <h1 className=\"font-brand text-5xl font-bold tracking-tight text-kyn-slate-900 md:text-7xl lg:text-8xl\">\n          Kynar <span className=\"text-text-secondary font-medium italic\">Universe</span>\n        </h1>\n        \n        <p className=\"mt-8 mx-auto max-w-lg text-lg text-text-secondary font-ui leading-relaxed md:text-xl\">\n          A calm digital ecosystem for useful tools that help you \n          <span className=\"text-kyn-slate-900 font-medium\"> organise, reflect, and create.</span>\n        </p>\n      </header>\n\n      {/* World Selection Grid */}\n      <nav className=\"mt-16 w-full max-w-5xl animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-200\">\n        <div className=\"grid gap-6 md:grid-cols-3\">\n          {worlds.map((world) => (\n            <Link \n              key={world.slug} \n              href={`/${world.slug}`}\n              className=\"group relative flex flex-col items-start rounded-3xl border border-border bg-white p-8 text-left transition-all hover:border-kyn-green-400/50 hover:shadow-kynar-soft active:scale-[0.97]\"\n            >\n              <div className={`mb-6 flex h-10 w-10 items-center justify-center rounded-xl ${world.color} text-white shadow-lg shadow-current/10 group-hover:scale-110 transition-transform`}>\n                {world.icon}\n              </div>\n              \n              <h3 className=\"font-brand text-2xl font-bold text-kyn-slate-900\">\n                {world.name}\n              </h3>\n              \n              <p className=\"mt-3 font-ui text-sm leading-relaxed text-text-secondary\">\n                {world.desc}\n              </p>\n              \n              <div className=\"mt-8 flex items-center gap-2 text-[11px] font-bold uppercase tracking-widest text-kyn-slate-400 group-hover:text-kyn-green-600 transition-colors\">\n                Explore World \n                <ArrowRight size={14} className=\"transition-transform group-hover:translate-x-1\" />\n              </div>\n            </Link>\n          ))}\n        </div>\n      </nav>\n\n      {/* Secondary Discovery */}\n      <footer className=\"mt-20 flex flex-col items-center gap-6 animate-in fade-in duration-1000 delay-500\">\n        <div className=\"h-px w-12 bg-border\" />\n        <Link \n          href=\"/store\" \n          className=\"group flex items-center gap-3 font-brand text-sm font-bold uppercase tracking-[0.25em] text-text-secondary hover:text-kyn-green-600 transition-colors\"\n        >\n          Browse the Marketplace\n          <span className=\"h-px w-0 bg-kyn-green-600 transition-all group-hover:w-8\" />\n        </Link>\n      </footer>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/api/webhooks/lemon-squeezy/route.ts": {
    "text": "import { NextResponse } from 'next/server';\nimport { headers } from 'next/headers';\nimport crypto from 'crypto';\nimport { createClient } from '@/lib/supabase/server';\nimport type { Json } from '@/lib/supabase/types';\n\ninterface LemonSqueezyPayload {\n  meta: { event_name: string };\n  data: {\n    id: string;\n    attributes: {\n      custom_data?: {\n        user_id?: string;\n        product_id?: string;\n      };\n    };\n  };\n}\n\nconst WEBHOOK_SECRET = process.env.LEMONSQUEEZY_WEBHOOK_SECRET || '';\n\nexport async function POST(req: Request) {\n  const rawBody = await req.text();\n  const headerList = await headers();\n  const signature = headerList.get('x-signature') || '';\n\n  const hmac = crypto.createHmac('sha256', WEBHOOK_SECRET);\n  const digest = hmac.update(rawBody).digest('hex');\n\n  if (signature !== digest) {\n    return NextResponse.json({ error: 'Invalid signature' }, { status: 401 });\n  }\n\n  const payload = JSON.parse(rawBody) as LemonSqueezyPayload;\n  const eventId = `${payload.meta.event_name}_${payload.data.id}`;\n  const eventName = payload.meta.event_name;\n  \n  const supabase = await createClient();\n\n  // BYPASS: Casting the query to 'any' allows the build to pass \n  // when the local types.ts is missing these new tables.\n  const { data: existingEvent } = await (supabase\n    .from('webhook_events')\n    .select('id')\n    .eq('event_id', eventId)\n    .maybeSingle() as any);\n\n  if (existingEvent) {\n    return NextResponse.json({ message: 'Event already processed' }, { status: 200 });\n  }\n\n  // LOG EVENT\n  await (supabase.from('webhook_events').insert({\n    event_id: eventId,\n    event_name: eventName,\n    payload: payload as unknown as Json,\n    status: 'pending'\n  }) as any);\n\n  if (eventName === 'order_created') {\n    try {\n      const { user_id: userId, product_id: productId } = payload.data.attributes.custom_data || {};\n      if (!userId || !productId) throw new Error(\"Missing custom_data\");\n\n      // FULFILLMENT\n      const { error: fulfillmentError } = await (supabase\n        .from('user_library')\n        .insert({\n          user_id: userId,\n          product_id: productId,\n          order_id: payload.data.id,\n          source: 'lemon-squeezy',\n          status: 'active',\n          acquired_at: new Date().toISOString()\n        }) as any);\n\n      if (fulfillmentError) throw fulfillmentError;\n\n      await (supabase\n        .from('webhook_events')\n        .update({ status: 'processed', updated_at: new Date().toISOString() })\n        .eq('event_id', eventId) as any);\n\n    } catch (err: any) {\n      console.error(`[Webhook Critical] ${eventId}:`, err.message);\n      \n      await (supabase\n        .from('webhook_events')\n        .update({ \n          status: 'failed', \n          error_message: err.message, \n          updated_at: new Date().toISOString() \n        })\n        .eq('event_id', eventId) as any);\n\n      return NextResponse.json({ error: 'Fulfillment failed' }, { status: 500 });\n    }\n  }\n\n  return NextResponse.json({ received: true }, { status: 200 });\n}\n",
    "embedding": null
  },
  "./app/api/download/[id]/route.ts": {
    "text": "import { createClient } from \"@/lib/supabase/server\";\nimport { NextResponse } from \"next/server\";\nimport { Product } from \"@/lib/supabase/types\";\n\ninterface LibraryJoin {\n  product_id: string;\n  products: Product | null;\n}\n\nexport async function GET(_req: Request, { params }: { params: Promise<{ id: string }> }) {\n  const { id: productId } = await params;\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) return new NextResponse(\"Unauthorized\", { status: 401 });\n\n  const { data, error } = await supabase\n    .from(\"user_library\")\n    .select(`product_id, products (*)`)\n    .eq(\"user_id\", user.id)\n    .eq(\"product_id\", productId)\n    .maybeSingle() as unknown as { data: LibraryJoin | null; error: any };\n\n  if (error || !data?.products?.download_path) return new NextResponse(\"Forbidden\", { status: 403 });\n\n  const { data: signedUrl } = await supabase.storage\n    .from(\"vault\")\n    .createSignedUrl(data.products.download_path, 60);\n\n  return NextResponse.redirect(signedUrl?.signedUrl || '');\n}\n",
    "embedding": null
  },
  "./app/library/layout.tsx": {
    "text": "/* KYNAR UNIVERSE: Library Layout (v1.2) app/library/layout.tsx */\n\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { PresenceBar } from \"@/components/layout/PresenceBar\";\nimport { ShieldCheck } from \"lucide-react\";\n\ninterface LibraryLayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function LibraryLayout({ children }: LibraryLayoutProps) {\n  return (\n    <div className=\"relative flex min-h-screen flex-col bg-canvas selection:bg-kyn-green-100\">\n      \n      {/* Auth Context Bar: Global Identity */}\n      <PresenceBar />\n\n      {/* Secure Handrail: Primary Navigation Context */}\n      <nav \n        className=\"sticky top-0 z-40 w-full border-b border-border bg-canvas/80 backdrop-blur-xl\"\n        aria-label=\"Library Navigation\"\n      >\n        <div className=\"mx-auto max-w-screen-xl px-gutter\">\n          <div className=\"flex h-14 items-center justify-between md:h-20\">\n            <Breadcrumbs \n              paths={[\n                { label: \"Universe Hub\", href: \"/\" },\n                { label: \"The Vault\", href: \"/library\" }\n              ]} \n            />\n            \n            <div className=\"hidden md:flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-text-secondary\">\n              <ShieldCheck size={14} className=\"text-kyn-green-500\" />\n              Secure Vault Access\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      <main className=\"relative z-10 flex-1 overflow-x-hidden pb-safe-bottom\">\n        {children}\n      </main>\n\n      {/* Library Background Pattern: Fixed context indicator */}\n      <div \n        className=\"pointer-events-none fixed inset-0 z-0 opacity-[0.03]\" \n        aria-hidden=\"true\"\n        style={{ \n          backgroundImage: `url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231A241B' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")`,\n        }}\n      />\n    </div>\n  );\n}\n",
    "embedding": null
  },
  "./app/library/page.tsx": {
    "text": "import { Metadata } from \"next\";\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { redirect } from \"next/navigation\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Download, BookOpen, ShieldCheck, Clock, ChevronRight } from \"lucide-react\";\nimport { UserLibrary } from \"@/lib/supabase/types\";\nimport { RealtimeListener } from \"@/components/layout/RealtimeListener\";\n\nexport const metadata: Metadata = {\n  title: \"The Vault | Your Collection\",\n  description: \"A permanent archive of your acquired digital assets.\",\n};\n\nexport default async function LibraryPage() {\n  const supabase = await createClient();\n  \n  const { data: { user: authUser } } = await supabase.auth.getUser();\n  if (!authUser) redirect(\"/auth/login?return_to=/library\");\n  \n  // RLS (Phase 02) now secures this query automatically\n  const { data: rawItems, error } = await (supabase\n    .from('user_library')\n    .select(`\n      id,\n      acquired_at,\n      status,\n      product_id,\n      product:products (\n        id,\n        title,\n        short_description,\n        world,\n        slug,\n        preview_image \n      )\n    `)\n    .eq('user_id', authUser.id)\n    .order('acquired_at', { ascending: false }) as any);\n  \n  if (error) {\n    console.error(\"[Vault] Sync error:\", error.message);\n  }\n  \n  const items = (rawItems || []).map((item: any) => ({\n    ...item,\n    product: item.product || {}\n  })) as UserLibrary[];\n  \n  return (\n    <div className=\"max-w-screen-xl mx-auto px-gutter\">\n      {/* PHASE 03: The Bridge */}\n      <RealtimeListener userId={authUser.id} />\n\n      <header className=\"py-16 md:py-24\">\n        <h1 className=\"font-brand text-4xl font-bold text-kyn-slate-900 tracking-tight md:text-6xl\">\n          Your Collection\n        </h1>\n        <p className=\"font-ui text-base text-text-secondary mt-6 max-w-md\">\n          Your permanent archive. Verified assets, secured for life.\n        </p>\n      </header>\n\n      <section className=\"pb-24\">\n        {items.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center py-32 text-center border border-dashed border-border rounded-[2.5rem] bg-surface/50\">\n            <ShieldCheck size={40} className=\"text-kyn-slate-200 mb-8\" strokeWidth={1} />\n            <h2 className=\"font-brand text-xl font-bold text-text-primary\">The Vault is Quiet</h2>\n            <p className=\"font-ui text-sm text-text-secondary mt-3 mb-10\">\n              You haven&apos;t added any technical assets to your universe yet.\n            </p>\n            <Link href=\"/store\" className=\"button-primary group\">\n              Explore Hub\n              <ChevronRight size={16} className=\"ml-2 transition-transform group-hover:translate-x-1\" />\n            </Link>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10\">\n            {items.map((item) => (\n              <article \n                key={item.id} \n                className=\"group flex flex-col bg-white border border-border rounded-[2rem] overflow-hidden hover:shadow-kynar-deep transition-all duration-700 animate-in fade-in slide-in-from-bottom-4\"\n              >\n                <div className=\"aspect-[16/10] bg-kyn-slate-50 relative overflow-hidden\">\n                  {item.product?.preview_image ? (\n                    <Image \n                      src={item.product.preview_image} \n                      alt={item.product.title || \"Asset\"}\n                      fill\n                      sizes=\"(max-width: 768px) 100vw, 33vw\"\n                      className=\"object-cover group-hover:scale-105 transition-transform duration-1000\"\n                    />\n                  ) : (\n                    <div className=\"absolute inset-0 flex items-center justify-center text-kyn-slate-100\">\n                      <ShieldCheck size={64} strokeWidth={0.5} />\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"p-8 flex-1 flex flex-col\">\n                  <div className=\"flex items-center gap-2 mb-4\">\n                    <Clock size={12} className=\"text-kyn-green-600\" />\n                    <span className=\"text-[10px] font-bold text-kyn-slate-400 uppercase tracking-widest\">\n                      Index Date: {item.acquired_at ? new Date(item.acquired_at).toLocaleDateString() : 'N/A'}\n                    </span>\n                  </div>\n                  \n                  <h3 className=\"font-brand text-2xl font-bold text-kyn-slate-900 mb-3\">\n                    {item.product?.title || \"Unknown Asset\"}\n                  </h3>\n                  \n                  <div className=\"mt-auto space-y-4\">\n                    <Link \n                      href={`/api/download/${item.product_id}`}\n                      className=\"flex items-center justify-center gap-3 w-full bg-kyn-slate-900 py-4 rounded-2xl text-white font-brand text-xs font-bold uppercase tracking-widest hover:bg-black transition-all\"\n                    >\n                      <Download size={16} />\n                      Access Assets\n                    </Link>\n                    \n                    <Link\n                      href={`/guides/${item.product?.slug}`}\n                      className=\"flex items-center justify-center gap-2 w-full py-2 font-brand text-[10px] font-black text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors uppercase tracking-[0.2em]\"\n                    >\n                      <BookOpen size={14} />\n                      Technical Guide\n                    </Link>\n                  </div>\n                </div>\n              </article>\n            ))}\n          </div>\n        )}\n      </section>\n    </div>\n  );\n}\n",
    "embedding": null
  },
  "./app/guides/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Briefings Archive (v1.6)\n * Role: Central repository for all world intelligence.\n * Fully aligned with canonical types.ts and Next.js 15.\n */\n\nimport { Metadata } from \"next\";\nimport Link from \"next/link\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { Compass, Clock, ArrowRight } from \"lucide-react\";\nimport { Guide } from \"@/lib/supabase/types\";\n\nexport const metadata: Metadata = {\n  title: \"Briefings | Kynar Universe Intelligence\",\n  description: \"Explore the technical and narrative architecture of the Kynar Universe.\",\n};\n\nexport default async function GuidesPage() {\n  const supabase = await createClient();\n  \n  /**\n   * Data Retrieval: Server-Side\n   * Using explicit casting to Guide[] for alignment with types.ts\n   */\n  const { data, error } = await supabase\n    .from(\"guides\")\n    .select(\"*\")\n    .eq(\"is_published\", true) // Ensuring only public intelligence is visible\n    .order(\"created_at\", { ascending: false });\n  \n  if (error) {\n    console.error(\"[Briefings] Fetch failure:\", error.message);\n  }\n  \n  const guides = (data as Guide[]) ?? [];\n  \n  const breadcrumbPaths = [\n    { label: \"Universe\", href: \"/\" },\n    { label: \"Briefings\", href: \"/guides\" },\n  ];\n  \n  return (\n    <main className=\"min-h-screen bg-canvas pb-32\">\n      {/* Handrail: Navigation */}\n      <nav className=\"border-b border-kyn-slate-50 bg-white/50 backdrop-blur-md px-gutter\">\n        <div className=\"mx-auto max-w-screen-xl flex h-14 items-center\">\n          <Breadcrumbs paths={breadcrumbPaths} />\n        </div>\n      </nav>\n\n      <section className=\"mx-auto max-w-screen-xl px-gutter pt-12 md:pt-20\">\n        {/* Header: Narrative Context */}\n        <header className=\"max-w-screen-md mb-16 animate-in fade-in slide-in-from-bottom-4 duration-700\">\n          <h1 className=\"font-brand text-4xl font-bold tracking-tight text-kyn-slate-900 md:text-6xl\">\n            Intelligence Briefings\n          </h1>\n          <p className=\"mt-6 font-ui text-base leading-relaxed text-text-secondary md:text-lg\">\n            A collection of technical frameworks, world-building records, and operational guides designed to ground your digital experience.\n          </p>\n        </header>\n\n        {/* The Archive Grid */}\n        {guides.length > 0 ? (\n          <div className=\"grid grid-cols-1 gap-y-10 md:grid-cols-2 md:gap-x-12 lg:grid-cols-3\">\n            {guides.map((guide, index) => (\n              <Link\n                key={guide.id}\n                href={`/guides/${guide.slug}`}\n                className=\"group flex flex-col animate-in fade-in slide-in-from-bottom-6 duration-1000 fill-mode-both\"\n                style={{ animationDelay: `${index * 100}ms` }}\n              >\n                {/* Visual Anchor */}\n                <div className=\"relative aspect-[16/9] w-full overflow-hidden rounded-3xl bg-surface border border-kyn-slate-100 transition-all duration-500 group-hover:shadow-kynar-soft group-hover:border-kyn-slate-200\">\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-kyn-slate-50 to-white text-kyn-slate-200\">\n                    <Compass\n                      size={48}\n                      strokeWidth={1}\n                      className=\"transition-transform duration-700 group-hover:rotate-12 group-hover:scale-110\"\n                    />\n                  </div>\n\n                  {/* Category Badge */}\n                  <div className=\"absolute left-4 top-4 rounded-full bg-white/90 backdrop-blur-sm px-3 py-1 text-[10px] font-bold uppercase tracking-widest text-kyn-slate-900 shadow-sm\">\n                    {guide.category}\n                  </div>\n                </div>\n\n                {/* Metadata & Title */}\n                <div className=\"mt-6 flex flex-col flex-1\">\n                  <div className=\"flex items-center gap-3 font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\">\n                    <span className=\"flex items-center gap-1\">\n                      <Clock size={12} className=\"text-kyn-green-600\" />\n                      {guide.read_time_minutes ?? 5} Min Read\n                    </span>\n                    <span>â€¢</span>\n                    <span>\n                      {guide.created_at \n                        ? new Date(guide.created_at).toLocaleDateString(\"en-GB\", {\n                            month: \"short\",\n                            year: \"numeric\",\n                          })\n                        : \"Recent\"}\n                    </span>\n                  </div>\n\n                  <h3 className=\"mt-3 font-brand text-xl font-bold text-kyn-slate-900 group-hover:text-black transition-colors\">\n                    {guide.title}\n                  </h3>\n\n                  <p className=\"mt-3 font-ui text-sm leading-relaxed text-text-secondary line-clamp-2\">\n                    {guide.excerpt ??\n                      \"Technical briefing and narrative exploration regarding this sector of the Kynar Universe.\"}\n                  </p>\n\n                  <div className=\"mt-auto pt-6 flex items-center gap-2 font-brand text-xs font-bold uppercase tracking-widest text-kyn-slate-900\">\n                    Explore Briefing\n                    <ArrowRight\n                      size={14}\n                      className=\"transition-transform group-hover:translate-x-1\"\n                    />\n                  </div>\n                </div>\n              </Link>\n            ))}\n          </div>\n        ) : (\n          /* Reassured Empty State */\n          <div className=\"rounded-[2.5rem] bg-surface border border-dashed border-kyn-slate-200 py-32 text-center\">\n            <div className=\"mx-auto flex h-16 w-16 items-center justify-center rounded-2xl bg-kyn-slate-50 text-kyn-slate-300\">\n              <Compass size={32} />\n            </div>\n            <p className=\"mt-6 font-brand text-sm font-bold text-kyn-slate-900\">\n              Archive Currently Indexing\n            </p>\n            <p className=\"mt-2 font-ui text-xs text-kyn-slate-400\">\n              Briefings will appear here as they are cleared for release.\n            </p>\n          </div>\n        )}\n      </section>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/guides/[slug]/loading.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Guide Briefing Skeleton (v2.0)\n * Role: Editorial Reassured State.\n * Alignment: Next.js 15 Partial Prerendering (PPR) & Canonical Design System.\n */\n\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { cn } from \"@/lib/utils\";\n\nexport default function GuideLoading() {\n  // Staggered animation utility to prevent a \"flashing\" wall of content\n  const pulseClass = \"animate-pulse bg-kyn-slate-100/80\";\n\n  return (\n    <article className=\"min-h-screen bg-canvas pb-32 animate-in fade-in duration-500 ease-out\">\n      <div className=\"max-w-screen-md mx-auto px-gutter\">\n        \n        {/* Navigation Handrail */}\n        <div className=\"py-6\">\n          <Breadcrumbs\n            paths={[\n              { label: \"Universe\", href: \"/\" },\n              { label: \"Briefings\", href: \"/guides\" },\n            ]}\n          />\n        </div>\n\n        <header className=\"py-12 md:py-24\">\n          {/* Metadata Chips: Category & Time */}\n          <div className=\"flex items-center gap-4 mb-10\">\n            <div className={cn(\"h-8 w-24 rounded-full\", pulseClass)} />\n            <div className={cn(\"h-4 w-16 rounded-full\", pulseClass)} />\n          </div>\n\n          {/* Headline Skeleton: Narrative Establishment */}\n          <div className=\"space-y-4 mb-12\">\n            <div className={cn(\"h-12 w-full rounded-xl\", pulseClass)} />\n            <div className={cn(\"h-12 w-3/4 rounded-xl\", pulseClass)} />\n          </div>\n\n          {/* Authority Bar: Verified Source Placeholder */}\n          <div className=\"flex items-center gap-5 py-10 border-y border-kyn-slate-50\">\n            <div className={cn(\"h-14 w-14 rounded-2xl\", pulseClass)} />\n            <div className=\"flex-1 space-y-3\">\n              <div className={cn(\"h-4 w-40 rounded\", pulseClass)} />\n              <div className={cn(\"h-3 w-28 rounded opacity-50\", pulseClass)} />\n            </div>\n          </div>\n        </header>\n\n        {/* Narrative Core Skeleton: Content Blocks */}\n        <div className=\"space-y-12 pt-6\">\n          <div className=\"space-y-4\">\n            <div className={cn(\"h-4 w-full rounded\", pulseClass)} />\n            <div className={cn(\"h-4 w-full rounded\", pulseClass)} />\n            <div className={cn(\"h-4 w-11/12 rounded\", pulseClass)} />\n            <div className={cn(\"h-4 w-4/5 rounded\", pulseClass)} />\n          </div>\n\n          {/* Media Placeholder: Hero Asset simulation */}\n          <div\n            className={cn(\n              \"aspect-video w-full rounded-[2.5rem] bg-kyn-slate-50 border border-kyn-slate-100/50\",\n              pulseClass\n            )}\n          />\n\n          <div className=\"space-y-4\">\n            <div className={cn(\"h-4 w-full rounded\", pulseClass)} />\n            <div className={cn(\"h-4 w-full rounded\", pulseClass)} />\n            <div className={cn(\"h-4 w-2/3 rounded\", pulseClass)} />\n          </div>\n        </div>\n      </div>\n    </article>\n  );\n}\n",
    "embedding": null
  },
  "./app/guides/[slug]/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Guide Vessel (v2.0)\n * Role: Premium intelligence briefing.\n * Fully aligned with canonical types.ts, Next.js 15 Async Params, and casting protocols.\n */\n\nimport { Metadata } from \"next\";\nimport { notFound } from \"next/navigation\";\nimport Link from \"next/link\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { ReadingProgressBar } from \"@/components/guides/ReadingProgressBar\";\nimport { Clock, ArrowLeft, ShieldCheck, Share2 } from \"lucide-react\";\nimport { Guide } from \"@/lib/supabase/types\";\n\ninterface GuidePageProps {\n  params: Promise<{ slug: string }>;\n}\n\nexport async function generateMetadata(\n  { params }: GuidePageProps\n): Promise<Metadata> {\n  const { slug } = await params;\n  const supabase = await createClient();\n\n  const { data } = await supabase\n    .from(\"guides\")\n    .select(\"title, excerpt\")\n    .eq(\"slug\", slug)\n    .single();\n\n  const guide = data as Pick<Guide, \"title\" | \"excerpt\"> | null;\n\n  if (!guide) {\n    return {\n      title: \"Briefing Not Found | Kynar Intelligence\",\n    };\n  }\n\n  return {\n    title: `${guide.title} | Kynar Intelligence`,\n    description:\n      guide.excerpt ??\n      \"Official intelligence briefing from the Kynar Universe archive.\",\n  };\n}\n\nexport default async function GuidePage({ params }: GuidePageProps) {\n  const { slug } = await params;\n  const supabase = await createClient();\n\n  const { data, error } = await supabase\n    .from(\"guides\")\n    .select(\"*\")\n    .eq(\"slug\", slug)\n    .single();\n\n  if (error || !data) notFound();\n\n  // Explicitly cast to the Guide type from our canonical types.ts\n  const guide = data as Guide;\n  const displayAuthor = guide.author || \"Kynar Universe\";\n\n  const breadcrumbPaths = [\n    { label: \"Universe\", href: \"/\" },\n    { label: \"Briefings\", href: \"/guides\" },\n    { label: guide.title, href: `/guides/${guide.slug}` },\n  ];\n\n  return (\n    <main className=\"min-h-screen bg-canvas pb-32 selection:bg-kyn-green-100/50\">\n      {/* Handrail: Structural Context */}\n      <nav className=\"sticky top-0 z-40 border-b border-kyn-slate-50 bg-canvas/80 backdrop-blur-xl px-gutter\">\n        <div className=\"mx-auto max-w-screen-md flex h-14 items-center justify-between\">\n          <Breadcrumbs paths={breadcrumbPaths} />\n          <button\n            type=\"button\"\n            className=\"text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors p-2 -mr-2\"\n            aria-label=\"Share briefing\"\n          >\n            <Share2 size={18} />\n          </button>\n        </div>\n      </nav>\n\n      <article className=\"mx-auto max-w-screen-md px-gutter animate-in fade-in slide-in-from-bottom-4 duration-1000\">\n        {/* Header: Narrative Establishment */}\n        <header className=\"py-12 md:py-24\">\n          <div className=\"flex items-center gap-4 mb-10 text-[10px] font-bold uppercase tracking-[0.25em] text-kyn-slate-400\">\n            <span className=\"rounded-full border border-kyn-slate-100 bg-white px-3.5 py-2 text-kyn-slate-900 shadow-sm\">\n              {guide.category}\n            </span>\n            <span className=\"flex items-center gap-1.5\">\n              <Clock size={12} className=\"text-kyn-green-600\" />\n              {guide.read_time_minutes ?? 5} Min Read\n            </span>\n          </div>\n\n          <h1 className=\"font-brand text-4xl font-bold tracking-tight text-kyn-slate-900 md:text-6xl lg:text-7xl leading-[1.05]\">\n            {guide.title}\n          </h1>\n\n          {/* Authority Anchor */}\n          <div className=\"mt-12 flex items-center gap-5 border-y border-kyn-slate-50 py-10\">\n            <div className=\"flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-kyn-slate-900 font-brand text-lg font-bold text-white shadow-xl\">\n              {displayAuthor[0]}\n            </div>\n            <div>\n              <p className=\"font-brand text-sm font-bold uppercase tracking-wider text-kyn-slate-900\">\n                {displayAuthor}\n              </p>\n              <div className=\"mt-1 flex items-center gap-2 font-ui text-xs text-kyn-slate-400\">\n                <ShieldCheck size={14} className=\"text-kyn-green-600\" />\n                <span>Verified Intelligence Source</span>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        {/* Content: Markdown Render Layer */}\n        <section\n          className=\"prose prose-slate prose-base md:prose-lg max-w-none\n            prose-headings:font-brand prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-kyn-slate-900\n            prose-p:font-ui prose-p:leading-[1.8] prose-p:text-text-secondary prose-p:mb-8\n            prose-strong:text-kyn-slate-900 prose-a:text-kyn-green-700 prose-a:font-bold prose-a:no-underline hover:prose-a:underline\n            prose-img:rounded-3xl prose-img:shadow-2xl prose-img:border prose-img:border-kyn-slate-100\n            prose-blockquote:border-l-kyn-green-500 prose-blockquote:bg-kyn-slate-50/50 prose-blockquote:py-2 prose-blockquote:px-6 prose-blockquote:rounded-r-2xl\"\n        >\n          <div\n            dangerouslySetInnerHTML={{\n              __html: guide.content ?? \"\",\n            }}\n          />\n        </section>\n\n        {/* Exit: Return to Discovery */}\n        <footer className=\"mt-32 rounded-[2.5rem] bg-surface border border-kyn-slate-100 p-10 md:p-16 text-center\">\n          <blockquote className=\"font-brand text-xl md:text-2xl font-medium text-kyn-slate-900 mb-12 italic leading-relaxed\">\n            &quot;True professional mastery begins with the acquisition of quiet knowledge.&quot;\n          </blockquote>\n\n          <Link\n            href=\"/guides\"\n            className=\"group inline-flex items-center gap-3 rounded-2xl bg-kyn-slate-900 px-10 py-5 font-brand text-sm font-bold text-white transition-all active:scale-[0.97] shadow-xl hover:bg-black\"\n          >\n            <ArrowLeft size={18} className=\"transition-transform group-hover:-translate-x-1\" />\n            Back to Briefings\n          </Link>\n        </footer>\n      </article>\n\n      {/* Persistence: Visual Progress Feedback */}\n      <ReadingProgressBar />\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(worlds)/lifestyle/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: World Landing (Lifestyle) v2.0\n * Fully aligned with canonical types.ts and Supabase v2.\n */\n\nimport { Metadata } from \"next\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { ProductCard } from \"@/components/marketplace/ProductCard\";\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { Sparkles, Wind, Sun, Coffee } from \"lucide-react\";\nimport { Product } from \"@/lib/supabase/types\";\n\nexport const metadata: Metadata = {\n  title: \"Lifestyle World | Kynar Universe\",\n  description: \"Curated tools for elegant living and personal digital sophistication.\",\n};\n\nexport default async function LifestyleWorldPage() {\n  const supabase = await createClient();\n  \n  // 1. Fetching Warm Data (Server-Side)\n  // Aligned with Supabase v2 casting and the canonical 'Lifestyle' enum value\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"world\", \"Lifestyle\")\n    .eq(\"is_published\", true)\n    .order(\"created_at\", { ascending: false });\n  \n  if (error) {\n    console.error(\"[Lifestyle World] Fetch failure:\", error.message);\n  }\n  \n  // Strongly type products using the alias from types.ts\n  const products = (data as Product[]) ?? [];\n  \n  const breadcrumbPaths = [\n    { label: \"Universe Hub\", href: \"/\" },\n    { label: \"Lifestyle\", href: \"/lifestyle\" },\n  ];\n  \n  return (\n    <main className=\"min-h-screen bg-canvas pb-safe-bottom animate-in fade-in duration-700\">\n      {/* Handrail: Structural Context */}\n      <div className=\"px-gutter pt-6\">\n        <Breadcrumbs paths={breadcrumbPaths} />\n      </div>\n\n      {/* Narrative Hero: Personal Sanctuary Management */}\n      <header className=\"px-gutter pt-16 pb-20 text-center md:pt-28 md:pb-32\">\n        <div className=\"mx-auto max-w-3xl\">\n          <div className=\"mb-10 flex justify-center\">\n            <div className=\"relative group\">\n              <div className=\"flex h-20 w-20 items-center justify-center rounded-full bg-kyn-caramel-50 border border-kyn-caramel-100 text-kyn-caramel-600 shadow-kynar-soft transition-all duration-500 group-hover:rotate-12\">\n                <Wind size={32} strokeWidth={1.5} />\n              </div>\n              <div className=\"absolute -right-1 -top-1 flex h-7 w-7 items-center justify-center rounded-full bg-white border border-border text-kyn-caramel-500 shadow-sm\">\n                <Sun size={14} />\n              </div>\n            </div>\n          </div>\n          \n          <h1 className=\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl italic\">\n            Lifestyle World\n          </h1>\n          <p className=\"mt-8 font-ui text-lg leading-relaxed text-text-secondary md:text-xl\">\n            A sector dedicated to the rituals of focus and well-being. Tools for \n            those who treat their digital habits as an art form.\n          </p>\n        </div>\n      </header>\n\n      {/* Grid Controls */}\n      <section className=\"px-gutter\">\n        <div className=\"mx-auto max-w-screen-xl\">\n          <div className=\"mb-10 flex items-center justify-between border-b border-border pb-6\">\n            <div className=\"flex items-center gap-3 text-kyn-caramel-600\">\n              <Coffee size={18} strokeWidth={2} />\n              <h2 className=\"font-brand text-sm font-bold uppercase tracking-[0.2em] text-text-primary\">\n                The Selection\n              </h2>\n            </div>\n            <span className=\"font-ui text-[11px] font-bold uppercase tracking-widest text-text-secondary\">\n              {products.length} Objects Harmonized\n            </span>\n          </div>\n\n          {/* Product Matrix */}\n          {products.length > 0 ? (\n            <div className=\"grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3\">\n              {products.map((product) => (\n                <ProductCard key={product.id} product={product} />\n              ))}\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center py-32 text-center rounded-[2.5rem] border-2 border-dashed border-kyn-caramel-100 bg-kyn-caramel-50/20\">\n              <Sparkles className=\"mb-4 text-kyn-caramel-300\" size={32} strokeWidth={1} />\n              <p className=\"font-ui text-sm text-text-secondary italic\">\n                The Lifestyle sector is currently being refined.<br />\n                New arrivals are being harmonized.\n              </p>\n            </div>\n          )}\n        </div>\n      </section>\n\n      {/* Philosophy: The Choice of Removal */}\n      <footer className=\"mt-40 bg-kyn-caramel-50/30 border-t border-kyn-caramel-100 px-gutter py-24\">\n        <div className=\"mx-auto max-w-2xl text-center\">\n          <h3 className=\"font-brand text-2xl font-bold text-text-primary italic\">\n            &quot;Sophistication is found in what we choose to remove.&quot;\n          </h3>\n          <p className=\"mt-6 font-ui text-base leading-loose text-text-secondary\">\n            In the Lifestyle World, we prioritize digital objects that offer \n            mental clarity and aesthetic joy. No clutter. No subscriptions. \n            Just permanent, beautiful utility.\n          </p>\n        </div>\n      </footer>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(worlds)/tools/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: World Landing (Tools) v2.0\n * Fully aligned with canonical types.ts and Supabase v2.\n */\n\nimport { Metadata } from \"next\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { ProductCard } from \"@/components/marketplace/ProductCard\";\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { Cpu, Zap, Hammer, ShieldCheck } from \"lucide-react\";\nimport { Product } from \"@/lib/supabase/types\";\n\nexport const metadata: Metadata = {\n  title: \"Tools World | Kynar Technical Hub\",\n  description: \"High-performance digital assets engineered for speed and reliability.\",\n};\n\nexport default async function ToolsWorldPage() {\n  const supabase = await createClient();\n  \n  // 1. Data Retrieval with explicit casting for Supabase v2\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"world\", \"Tools\")\n    .eq(\"is_published\", true)\n    .order(\"created_at\", { ascending: false });\n  \n  if (error) {\n    console.error(\"[Tools World] Database Error:\", error.message);\n  }\n  \n  // Strongly type products using the alias from types.ts\n  const products = (data as Product[]) ?? [];\n  \n  const breadcrumbPaths = [\n    { label: \"Universe Hub\", href: \"/\" },\n    { label: \"Tools Sector\", href: \"/tools\" },\n  ];\n  \n  return (\n    <main className=\"min-h-screen bg-canvas pb-safe-bottom animate-in fade-in duration-700\">\n      {/* Handrail: Structural Context */}\n      <div className=\"px-gutter pt-6\">\n        <Breadcrumbs paths={breadcrumbPaths} />\n      </div>\n\n      {/* Narrative Hero: Technical Identity */}\n      <header className=\"px-gutter pt-16 pb-20 text-center md:pt-28 md:pb-32\">\n        <div className=\"mx-auto max-w-3xl\">\n          <div className=\"mb-10 flex justify-center\">\n            <div className=\"relative group\">\n              <div className=\"flex h-20 w-20 items-center justify-center rounded-full bg-kyn-slate-900 text-white shadow-2xl transition-all duration-500 group-hover:scale-105\">\n                <Cpu size={32} strokeWidth={1.5} className=\"animate-pulse\" />\n              </div>\n              <div className=\"absolute -right-1 -top-1 flex h-7 w-7 items-center justify-center rounded-full bg-kyn-green-500 text-white shadow-sm border-2 border-canvas\">\n                <Zap size={12} fill=\"currentColor\" />\n              </div>\n            </div>\n          </div>\n          \n          <h1 className=\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl uppercase\">\n            Tools World\n          </h1>\n          <p className=\"mt-8 font-ui text-lg leading-relaxed text-text-secondary md:text-xl\">\n            A technical sector for high-leverage components. Engineered for \n            professionals who require architectural stability in their digital stack.\n          </p>\n        </div>\n      </header>\n\n      {/* Product Matrix */}\n      <section className=\"px-gutter\">\n        <div className=\"mx-auto max-w-screen-xl\">\n          <div className=\"mb-10 flex items-center justify-between border-b border-border pb-6\">\n            <div className=\"flex items-center gap-3\">\n              <Hammer size={18} className=\"text-kyn-slate-400\" />\n              <h2 className=\"font-brand text-sm font-bold uppercase tracking-[0.2em] text-text-primary\">\n                Technical Repository\n              </h2>\n            </div>\n            <span className=\"font-ui text-[11px] font-bold uppercase tracking-widest text-text-secondary\">\n              {products.length} Assets Indexed\n            </span>\n          </div>\n\n          {products.length > 0 ? (\n            <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n              {products.map((product) => (\n                <ProductCard key={product.id} product={product} />\n              ))}\n            </div>\n          ) : (\n            <div className=\"py-24 text-center border-2 border-dashed border-border rounded-[2rem] bg-surface/50\">\n              <p className=\"font-ui text-sm text-kyn-slate-400 italic\">\n                The technical repository is currently being indexed.\n              </p>\n            </div>\n          )}\n        </div>\n      </section>\n\n      {/* Standards Footer */}\n      <footer className=\"mt-40 px-gutter py-24 bg-kyn-slate-900 text-white text-center rounded-t-[3rem] shadow-2xl\">\n        <div className=\"max-w-2xl mx-auto\">\n          <ShieldCheck className=\"mx-auto mb-8 text-kyn-green-400\" size={32} strokeWidth={1} />\n          <h3 className=\"font-brand text-2xl font-bold uppercase tracking-widest\">Kynar Standards</h3>\n          <p className=\"mt-6 font-ui text-sm text-kyn-slate-400 leading-relaxed max-w-md mx-auto italic\">\n            &quot;Performance is the baseline. Autonomy is the goal.&quot;\n          </p>\n        </div>\n      </footer>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(worlds)/home/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: World Landing (Home) v2.0\n * Fully aligned with canonical types.ts and Supabase v2.\n */\n\nimport { Metadata } from \"next\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { ProductCard } from \"@/components/marketplace/ProductCard\";\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { Home as HomeIcon, Sparkles, ShieldCheck, Leaf } from \"lucide-react\";\nimport { Product } from \"@/lib/supabase/types\";\n\nexport const metadata: Metadata = {\n  title: \"Home World | Kynar Universe\",\n  description: \"Curated tools for domestic order and personal sanctuary management.\",\n};\n\nexport default async function HomeWorldPage() {\n  const supabase = await createClient();\n  \n  // 1. Fetching Grounded Data\n  // Note: .from<Product> is a legacy pattern; we select and cast for modern Supabase-js v2 clarity\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"world\", \"Home\")\n    .eq(\"is_published\", true)\n    .order(\"created_at\", { ascending: false });\n  \n  if (error) {\n    console.error(\"[HomeWorld] Database Fetch Error:\", error.message);\n  }\n  \n  // Strongly type products using the alias from types.ts\n  const products = (data as Product[]) ?? [];\n  \n  const breadcrumbPaths = [\n    { label: \"Universe Hub\", href: \"/\" },\n    { label: \"Home World\", href: \"/home\" },\n  ];\n  \n  return (\n    <main className=\"min-h-screen bg-canvas pb-safe-bottom animate-in fade-in duration-700\">\n      {/* Handrail: Top-level navigation context */}\n      <div className=\"px-gutter pt-6\">\n        <Breadcrumbs paths={breadcrumbPaths} />\n      </div>\n\n      {/* Narrative Hero: Focused Sector Identity */}\n      <header className=\"px-gutter pt-16 pb-20 text-center md:pt-28 md:pb-32\">\n        <div className=\"mx-auto max-w-3xl\">\n          <div className=\"mb-10 flex justify-center\">\n            <div className=\"relative\">\n              <div className=\"flex h-20 w-20 items-center justify-center rounded-full bg-kyn-green-50 border border-kyn-green-100 text-kyn-green-600 shadow-kynar-soft transition-transform hover:scale-105 duration-500\">\n                <HomeIcon size={32} strokeWidth={1.5} />\n              </div>\n              <div className=\"absolute -right-1 -top-1 flex h-7 w-7 items-center justify-center rounded-full bg-white border border-border text-kyn-green-500 shadow-sm\">\n                <Leaf size={14} />\n              </div>\n            </div>\n          </div>\n          \n          <h1 className=\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl\">\n            The Home World\n          </h1>\n          <p className=\"mt-8 font-ui text-lg leading-relaxed text-text-secondary md:text-xl\">\n            A curated sector for the architecture of daily life. From domestic \n            inventory to family legacy planningâ€”tools built for permanence.\n          </p>\n        </div>\n      </header>\n\n      {/* Grid Controls */}\n      <section className=\"px-gutter\">\n        <div className=\"mx-auto max-w-screen-xl\">\n          <div className=\"mb-10 flex items-center justify-between border-b border-border pb-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-2 w-2 rounded-full bg-kyn-green-500 animate-pulse\" />\n              <h2 className=\"font-brand text-sm font-bold uppercase tracking-[0.2em] text-text-primary\">\n                The Collection\n              </h2>\n            </div>\n            <span className=\"font-ui text-[11px] font-bold uppercase tracking-widest text-text-secondary\">\n              {products.length} Assets Available\n            </span>\n          </div>\n\n          {/* Optimized Product Matrix */}\n          {products.length > 0 ? (\n            <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n              {products.map((product) => (\n                <ProductCard key={product.id} product={product} />\n              ))}\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center py-32 text-center rounded-[2rem] border-2 border-dashed border-border bg-surface/40\">\n              <Sparkles className=\"mb-4 text-kyn-slate-300\" size={32} strokeWidth={1} />\n              <p className=\"font-ui text-sm text-text-secondary\">\n                The Home World is currently being harmonized.<br />\n                New additions arriving soon.\n              </p>\n            </div>\n          )}\n        </div>\n      </section>\n\n      {/* World Philosophy Footer */}\n      <footer className=\"mt-40 bg-surface border-t border-border px-gutter py-24\">\n        <div className=\"mx-auto max-w-2xl text-center\">\n          <div className=\"mb-8 inline-flex h-12 w-12 items-center justify-center rounded-full bg-white border border-border text-kyn-green-600 shadow-sm\">\n            <ShieldCheck size={20} />\n          </div>\n          <h3 className=\"font-brand text-2xl font-bold text-text-primary\">The Kynar Promise</h3>\n          <blockquote className=\"mt-6 font-ui text-base leading-loose text-text-secondary italic\">\n            &quot;We believe the digital foundation of your home should be as stable as \n            the physical one. Every tool here is selected for its lack of noise \n            and its commitment to your long-term autonomy.&quot;\n          </blockquote>\n        </div>\n      </footer>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/auth/actions.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Unified Auth Actions (v1.2.1)\n * Fix: Removed unused 'origin' variable to satisfy TypeScript build.\n */\n\n\"use server\";\n\nimport { createClient } from \"@/lib/supabase/server\";\nimport { redirect } from \"next/navigation\";\n\nexport async function login(formData: FormData) {\n  const supabase = await createClient();\n  const email = formData.get(\"email\") as string;\n  const password = formData.get(\"password\") as string;\n\n  // We don't need 'origin' here unless we are doing complex dynamic callbacks\n  const { error } = await supabase.auth.signInWithPassword({ email, password });\n\n  if (error) {\n    return redirect(`?error=${encodeURIComponent(error.message)}`);\n  }\n\n  return redirect(\"/library\");\n}\n\nexport async function signup(formData: FormData) {\n  const supabase = await createClient();\n  const email = formData.get(\"email\") as string;\n  const password = formData.get(\"password\") as string;\n\n  const { error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}/auth/callback`,\n    },\n  });\n\n  if (error) {\n    return redirect(`?error=${encodeURIComponent(error.message)}`);\n  }\n\n  return redirect(`?message=${encodeURIComponent(\"Check your email to confirm registration.\")}`);\n}\n\nexport async function logout() {\n  const supabase = await createClient();\n  await supabase.auth.signOut();\n  return redirect(\"/\");\n}\n",
    "embedding": null
  },
  "./app/auth/login/page.tsx": {
    "text": "\"use client\";\n \n/**\n * KYNAR UNIVERSE: Authentication Gateway (v1.1)\n * Role: Entry point for protected sectors (Library & Account).\n * Features: Error/Success messaging & dynamic loading states.\n */\n\nimport Link from \"next/link\";\nimport { Suspense } from \"react\";\nimport { useFormStatus } from \"react-dom\";\nimport { Compass, ShieldCheck, ArrowRight, Loader2 } from \"lucide-react\";\nimport { login } from \"../actions\";\nimport { AuthMessage } from \"@/components/auth/AuthMessage\";\n\nexport default function LoginPage() {\n  return (\n    <main className=\"relative min-h-[80vh] flex items-center justify-center px-gutter py-20\">\n      {/* Background Glow */}\n      <div className=\"absolute top-1/2 left-1/2 -z-10 h-[400px] w-[400px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-kyn-green-50/50 blur-[100px]\" />\n\n      <div className=\"w-full max-w-md\">\n        {/* Brand Identity */}\n        <div className=\"text-center mb-10\">\n          <div className=\"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-kyn-slate-900 text-white mb-6\">\n            <Compass size={24} />\n          </div>\n          <h1 className=\"font-brand text-3xl font-bold text-kyn-slate-900 tracking-tight\">\n            Access Portal\n          </h1>\n          <p className=\"mt-2 font-ui text-sm text-text-secondary\">\n            Enter your credentials to access the Vault.\n          </p>\n        </div>\n\n        {/* Login Card */}\n        <div className=\"bg-white border border-border rounded-[2rem] p-8 shadow-kynar-soft\">\n          \n          {/* Feedback Messages (Error/Success) */}\n          <Suspense fallback={<div className=\"h-10 mb-6 bg-surface animate-pulse rounded-xl\" />}>\n            <AuthMessage />\n          </Suspense>\n\n          <form action={login} className=\"space-y-6\">\n            <div>\n              <label className=\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-2\">\n                Email Address\n              </label>\n              <input \n                name=\"email\"\n                type=\"email\"\n                required\n                placeholder=\"identity@kynar.uk\"\n                className=\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:outline-none focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all\"\n              />\n            </div>\n\n            <div>\n              <div className=\"flex justify-between items-center mb-2\">\n                <label className=\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\">\n                  Access Key\n                </label>\n              </div>\n              <input \n                name=\"password\"\n                type=\"password\"\n                required\n                placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                className=\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:outline-none focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all\"\n              />\n            </div>\n\n            <SubmitButton />\n          </form>\n\n          <div className=\"mt-8 pt-6 border-t border-border flex flex-col gap-4 text-center\">\n            <p className=\"font-ui text-xs text-text-secondary\">\n              Don&apos;t have an identity record? \n              <Link href=\"/auth/signup\" className=\"ml-1 text-kyn-slate-900 font-bold hover:text-kyn-green-600 transition-colors\">\n                Register here\n              </Link>\n            </p>\n          </div>\n        </div>\n\n        {/* Security Footnote */}\n        <div className=\"mt-8 flex items-center justify-center gap-2 text-kyn-slate-400\">\n          <ShieldCheck size={14} />\n          <span className=\"font-ui text-[10px] font-bold uppercase tracking-widest\">\n            End-to-End Encryption Active\n          </span>\n        </div>\n      </div>\n    </main>\n  );\n}\n\n/**\n * Sub-component to handle loading state via useFormStatus\n */\nfunction SubmitButton() {\n  const { pending } = useFormStatus();\n\n  return (\n    <button \n      type=\"submit\"\n      disabled={pending}\n      className=\"group w-full flex items-center justify-center gap-2 py-4 bg-kyn-slate-900 text-white font-brand font-bold rounded-xl hover:bg-kyn-slate-800 transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed\"\n    >\n      {pending ? (\n        <>\n          <Loader2 size={18} className=\"animate-spin\" />\n          Authenticating...\n        </>\n      ) : (\n        <>\n          Initialize Session\n          <ArrowRight size={16} className=\"group-hover:translate-x-1 transition-transform\" />\n        </>\n      )}\n    </button>\n  );\n}\n",
    "embedding": null
  },
  "./app/auth/callback/route.ts": {
    "text": "/**\n * KYNAR UNIVERSE: Identity Resolution (v2.1)\n * Role: Exchanging the temporary PKCE code for a persistent user session.\n * Fully aligned with Next.js 16 and Production URL resolution.\n */\n\nimport { NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function GET(request: Request) {\n  const { searchParams, origin } = new URL(request.url);\n  const code = searchParams.get('code');\n  const next = searchParams.get('next') ?? '/library';\n  /**\n   * Production URL Resolution\n   * Ensuring redirects function across local, preview (Netlify), and production.\n   */\n  const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || \n                  process.env.URL || \n                  origin;\n  if (code) {\n    const supabase = await createClient();\n    // Exchange the PKCE code for a session\n    const { error } = await supabase.auth.exchangeCodeForSession(code);\n    if (!error) {\n      // Identity confirmed. Constructing absolute path for the Vault.\n      const target = new URL(next, siteUrl);\n      \n      // We use a 303 See Other redirect to ensure a GET request is used on the next hop\n      return NextResponse.redirect(target.toString(), 303);\n    }\n    \n    console.error(\"[Auth Callback] Exchange Error:\", error.message);\n  }\n\n  // Fallback: If code is missing or exchange fails, return to logic with context\n  const fallback = new URL('/auth/login?error=link-invalid', siteUrl);\n  return NextResponse.redirect(fallback.toString(), 303);\n}\n",
    "embedding": null
  },
  "./app/auth/signup/page.tsx": {
    "text": "\"use client\";\n /**\n * KYNAR UNIVERSE: Identity Registration (v1.1)\n * Role: Creating new records in the Universe.\n * Features: Error/Success messaging & dynamic loading states via useFormStatus.\n */\n\nimport Link from \"next/link\";\nimport { Suspense } from \"react\";\nimport { useFormStatus } from \"react-dom\";\nimport { Compass, ArrowRight, Loader2 } from \"lucide-react\";\nimport { signup } from \"../actions\";\nimport { AuthMessage } from \"@/components/auth/AuthMessage\";\n\nexport default function SignupPage() {\n  return (\n    <main className=\"relative min-h-[80vh] flex items-center justify-center px-gutter py-20\">\n      {/* Background Glow */}\n      <div className=\"absolute top-1/2 left-1/2 -z-10 h-[400px] w-[400px] -translate-x-1/2 -translate-y-1/2 rounded-full bg-kyn-caramel-50/50 blur-[100px]\" />\n\n      <div className=\"w-full max-w-md\">\n        {/* Brand Identity */}\n        <div className=\"text-center mb-10\">\n          <div className=\"inline-flex h-12 w-12 items-center justify-center rounded-2xl bg-kyn-slate-900 text-white mb-6\">\n            <Compass size={24} />\n          </div>\n          <h1 className=\"font-brand text-3xl font-bold text-kyn-slate-900 tracking-tight\">\n            Create Identity\n          </h1>\n          <p className=\"mt-2 font-ui text-sm text-text-secondary\">\n            Begin your journey in the Kynar ecosystem.\n          </p>\n        </div>\n\n        {/* Signup Card */}\n        <div className=\"bg-white border border-border rounded-[2rem] p-8 shadow-kynar-soft\">\n          \n          {/* Feedback Messages (Error/Success) */}\n          <Suspense fallback={<div className=\"h-10 mb-6 bg-surface animate-pulse rounded-xl\" />}>\n            <AuthMessage />\n          </Suspense>\n\n          <form action={signup} className=\"space-y-6\">\n            <div>\n              <label className=\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-2\">\n                Email Address\n              </label>\n              <input \n                name=\"email\" \n                type=\"email\" \n                required \n                placeholder=\"identity@kynar.uk\" \n                className=\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all outline-none\" \n              />\n            </div>\n\n            <div>\n              <label className=\"block font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 mb-2\">\n                Access Key (Password)\n              </label>\n              <input \n                name=\"password\" \n                type=\"password\" \n                required \n                placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\" \n                className=\"w-full px-4 py-3 rounded-xl border border-border bg-surface font-ui text-sm focus:ring-2 focus:ring-kyn-green-500/20 focus:border-kyn-green-500 transition-all outline-none\" \n              />\n            </div>\n\n            <SubmitButton />\n          </form>\n\n          <div className=\"mt-8 pt-6 border-t border-border text-center\">\n            <p className=\"font-ui text-xs text-text-secondary\">\n              Already have an identity? \n              <Link href=\"/auth/login\" className=\"ml-1 text-kyn-slate-900 font-bold hover:text-kyn-green-600 transition-colors\">\n                Login here\n              </Link>\n            </p>\n          </div>\n        </div>\n      </div>\n    </main>\n  );\n}\n\n/**\n * Sub-component to handle loading state via useFormStatus\n */\nfunction SubmitButton() {\n  const { pending } = useFormStatus();\n\n  return (\n    <button \n      type=\"submit\" \n      disabled={pending}\n      className=\"group w-full flex items-center justify-center gap-2 py-4 bg-kyn-slate-900 text-white font-brand font-bold rounded-xl hover:bg-kyn-slate-800 transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed\"\n    >\n      {pending ? (\n        <>\n          <Loader2 size={18} className=\"animate-spin\" />\n          Registering...\n        </>\n      ) : (\n        <>\n          Register Identity\n          <ArrowRight size={16} className=\"group-hover:translate-x-1 transition-transform\" />\n        </>\n      )}\n    </button>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/layout.tsx": {
    "text": "/* KYNAR UNIVERSE: Marketplace Layout (v1.6) app/(marketplace)layout.tsx */\n\n\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\n\ninterface MarketplaceLayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function MarketplaceLayout({ children }: MarketplaceLayoutProps) {\n  return (\n    <div className=\"relative flex min-h-screen flex-col bg-canvas selection:bg-kyn-green-100\">\n      \n      {/* Transactional Handrail */}\n      <nav \n        className=\"sticky top-0 z-40 w-full border-b border-kyn-slate-50 bg-canvas/80 backdrop-blur-xl\"\n        aria-label=\"Marketplace Navigation\"\n      >\n        <div className=\"mx-auto max-w-screen-xl px-gutter\">\n          <div className=\"flex h-14 items-center md:h-20\">\n            <Breadcrumbs \n              paths={[\n                { label: \"Universe Hub\", href: \"/\" },\n                { label: \"Marketplace\", href: \"/store\" }\n              ]} \n            />\n          </div>\n        </div>\n      </nav>\n\n      <main className=\"flex-1 overflow-x-hidden\">\n        <div className=\"animate-in fade-in duration-500\">\n          {children}\n        </div>\n      </main>\n\n      {/* Mobile Fade */}\n      <aside className=\"pointer-events-none fixed bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-canvas to-transparent md:hidden z-30\" />\n    </div>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/checkout/loading.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Checkout Loading (v1.5)\n * Role: The \"Calm Bridge\" - Reassured transition to external gateway.\n * Aligned with: UX Canon Section 1 (Reassured State) & Design System Section 11.\n */\n\nimport { ShieldCheck, Lock } from \"lucide-react\";\n\nexport default function CheckoutLoading() {\n  return (\n    <main className=\"flex min-h-[80vh] flex-col items-center justify-center px-gutter text-center animate-in fade-in duration-500\">\n      \n      {/* Structural Loading Anchor - Design System Section 11 */}\n      <div className=\"relative mb-12 flex items-center justify-center\">\n        {/* Outer Atmospheric Ring */}\n        <div className=\"h-24 w-24 rounded-full border border-kyn-slate-100/50 bg-surface shadow-kynar-soft\" />\n        \n        {/* Active Processing Ring */}\n        <div className=\"absolute h-24 w-24 animate-spin rounded-full border-2 border-transparent border-t-kyn-green-600\" />\n        \n        {/* Core Security Identifier */}\n        <div className=\"absolute flex h-12 w-12 items-center justify-center rounded-full bg-kyn-slate-900 text-white shadow-lg\">\n          <Lock size={18} strokeWidth={2.5} />\n        </div>\n      </div>\n      \n      {/* Narrative Reassurance */}\n      <div className=\"max-w-xs space-y-4\">\n        <h2 className=\"font-brand text-2xl font-bold tracking-tight text-kyn-slate-900 md:text-3xl\">\n          Securing your <br /> <span className=\"italic\">connection.</span>\n        </h2>\n        <p className=\"font-ui text-sm leading-relaxed text-text-secondary md:text-base\">\n          Please wait a moment while we prepare your secure handoff to the vault gateway.\n        </p>\n      </div>\n\n      {/* Security Status Bar - Design System Section 19.3 */}\n      <div className=\"mt-16 flex flex-col items-center gap-6\">\n        <div className=\"flex items-center gap-2.5 rounded-full bg-white border border-border px-5 py-2.5 shadow-sm\">\n          <span className=\"relative flex h-2 w-2\">\n            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-kyn-green-400 opacity-75\"></span>\n            <span className=\"relative inline-flex rounded-full h-2 w-2 bg-kyn-green-500\"></span>\n          </span>\n          <span className=\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-500\">\n            Encrypted Handoff Active\n          </span>\n        </div>\n\n        <div className=\"flex items-center gap-2 text-kyn-slate-300\">\n          <ShieldCheck size={14} />\n          <span className=\"font-ui text-[9px] uppercase tracking-widest\">\n            PCI-DSS Level 1 Compliant\n          </span>\n        </div>\n      </div>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/checkout/page.tsx": {
    "text": "import { redirect } from \"next/navigation\";\nimport { generateCheckoutUrl } from \"@/lib/lemon-squeezy/checkout\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Product } from \"@/lib/supabase/types\";\n\ninterface CheckoutPageProps {\n  searchParams: Promise<{ items?: string }>;\n}\n\nexport default async function CheckoutPage({\n  searchParams,\n}: CheckoutPageProps) {\n  // 1. Resolve searchParams before accessing keys (Next.js 15+ Requirement)\n  const params = await searchParams;\n  const rawItems = params.items;\n\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    redirect(\"/auth/login?return_to=/cart\");\n  }\n\n  if (!rawItems) redirect(\"/cart\");\n\n  let productIds: string[] = [];\n  try {\n    productIds = JSON.parse(decodeURIComponent(rawItems));\n  } catch (e) {\n    console.error(\"Selection Parse Error:\", e);\n    redirect(\"/cart?error=invalid_selection\");\n  }\n\n  // 2. Fetch products - Keep 'as any' specifically for the query chain to pass linting\n  const { data: products, error } = await (supabase\n    .from(\"products\")\n    .select(\"id, title, price_id, slug, lemon_squeezy_id\")\n    .in(\"id\", productIds) as any);\n\n  if (error || !products || products.length === 0) {\n    console.error(\"Verification Error:\", error);\n    redirect(\"/cart?error=verification_failed\");\n  }\n\n  const checkoutUrl = await generateCheckoutUrl({\n    products: products as Product[],\n    userId: user.id,\n    userEmail: user.email ?? \"\",\n  });\n\n  if (checkoutUrl) {\n    redirect(checkoutUrl);\n  } else {\n    redirect(\"/cart?error=gateway_timeout\");\n  }\n\n  return (\n    <main className=\"flex min-h-[85vh] w-full flex-col items-center justify-center px-gutter bg-canvas text-center\">\n      <div className=\"max-w-xs animate-in fade-in slide-in-from-bottom-8 duration-1000\">\n        <h1 className=\"font-brand text-2xl font-bold tracking-tight text-kyn-slate-900 uppercase\">\n          Preparing Acquisition\n        </h1>\n        <p className=\"mt-4 font-ui text-[11px] uppercase tracking-[0.2em] leading-relaxed text-kyn-slate-400\">\n          Initializing secure checkout for your vault selection.\n        </p>\n      </div>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/checkout/success/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Acquisition Success (v1.6)\n * Role: Post-purchase \"Vault Opening\" experience.\n */\n\nimport Link from \"next/link\";\nimport { ShieldCheck, Library } from \"lucide-react\";\nimport { CelebrationTrigger } from \"@/components/marketplace/CelebrationTrigger\";\n\nexport default function CheckoutSuccessPage() {\n  return (\n    <main className=\"min-h-[90vh] flex flex-col items-center justify-center bg-canvas px-gutter\">\n      {/* This runs on the client once the page mounts */}\n      <CelebrationTrigger />\n\n      <div className=\"max-w-md w-full text-center space-y-8 animate-in fade-in slide-in-from-bottom-10 duration-1000\">\n        <div className=\"mx-auto h-24 w-24 rounded-[2rem] bg-kyn-green-500/10 flex items-center justify-center text-kyn-green-600\">\n          <ShieldCheck size={48} strokeWidth={1.5} />\n        </div>\n\n        <div className=\"space-y-4\">\n          <h1 className=\"font-brand text-4xl font-bold text-kyn-slate-900 tracking-tight\">\n            Acquisition Secured\n          </h1>\n          <p className=\"font-ui text-base text-text-secondary leading-relaxed\">\n            Your technical assets have been successfully registered to your identity. \n            The Kynar Vault is now synchronized.\n          </p>\n        </div>\n\n        <div className=\"flex flex-col gap-4 pt-4\">\n          <Link \n            href=\"/library\" \n            className=\"flex items-center justify-center gap-3 w-full py-5 bg-kyn-slate-900 text-white rounded-2xl font-brand text-sm font-black uppercase tracking-widest hover:bg-black transition-all active:scale-[0.98]\"\n          >\n            <Library size={18} />\n            Enter My Library\n          </Link>\n          \n          <Link \n            href=\"/\" \n            className=\"font-brand text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\"\n          >\n            Return to Hub\n          </Link>\n        </div>\n      </div>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/checkout/error/page.tsx": {
    "text": "\"use client\";\n\n/**\n * KYNAR UNIVERSE: Checkout Error (v1.5)\n * Role: Grounded recovery and technical reassurance.\n * Alignment: UX Canon Section 1 (Reassured State) & Design System 3.3.\n */\n\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { MoveLeft, RefreshCw, LifeBuoy, AlertCircle } from \"lucide-react\";\n\nexport default function CheckoutErrorPage() {\n  const router = useRouter();\n  const [mounted, setMounted] = useState(false);\n\n  // 1. Prevent Hydration Mismatch for Client-Only Logic\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  if (!mounted) return null;\n\n  return (\n    <main className=\"flex min-h-[85vh] flex-col items-center justify-center px-gutter text-center selection:bg-kyn-caramel-100\">\n      \n      {/* Visual Anchor: Caramel Alert Palette (Design System 3.3) */}\n      <div className=\"animate-in fade-in zoom-in-95 duration-700 ease-out flex flex-col items-center\">\n        <div className=\"relative mb-10\">\n          <div className=\"flex h-24 w-24 items-center justify-center rounded-full bg-kyn-caramel-50 border border-kyn-caramel-100 shadow-kynar-soft\">\n            <div className=\"flex h-14 w-14 items-center justify-center rounded-full bg-white text-kyn-caramel-600 shadow-sm\">\n              <LifeBuoy className=\"h-7 w-7 animate-spin-slow\" strokeWidth={1.5} />\n            </div>\n          </div>\n          <div className=\"absolute -right-1 -top-1 rounded-full bg-white p-2 shadow-sm border border-border\">\n            <AlertCircle size={16} className=\"text-kyn-caramel-500\" />\n          </div>\n        </div>\n\n        <header className=\"max-w-md space-y-6\">\n          <h1 className=\"font-brand text-3xl font-bold tracking-tight text-kyn-slate-900 md:text-5xl\">\n            Connection <span className=\"italic\">Interrupted.</span>\n          </h1>\n          <p className=\"font-ui text-base leading-relaxed text-text-secondary px-4 md:text-lg\">\n            We couldn&apos;t establish a secure link to the gateway. Your selection remains safely stored in your vault.\n          </p>\n        </header>\n\n        {/* Action Zone: Tactical Recovery Actions */}\n        <div className=\"mt-12 flex w-full max-w-sm flex-col gap-4\">\n          <button \n            onClick={() => router.refresh()}\n            className=\"group flex items-center justify-center gap-3 rounded-2xl bg-kyn-slate-900 py-5 font-brand text-base font-bold text-white transition-all hover:bg-black active:scale-[0.97] shadow-xl\"\n          >\n            <RefreshCw className=\"h-5 w-5 transition-transform group-hover:rotate-180 duration-700\" />\n            Try Connection Again\n          </button>\n\n          <Link \n            href=\"/cart\"\n            className=\"flex items-center justify-center gap-3 rounded-2xl border border-border bg-white py-5 font-brand text-base font-bold text-kyn-slate-900 transition-all hover:bg-surface active:scale-[0.97]\"\n          >\n            <MoveLeft className=\"h-4 w-4\" />\n            Back to Selection\n          </Link>\n        </div>\n\n        {/* Technical Metadata: Troubleshooting Layer */}\n        <footer className=\"mt-24 flex flex-col items-center gap-4\">\n          <div className=\"h-px w-10 bg-border\" />\n          <div className=\"space-y-1\">\n            <p className=\"font-ui text-[10px] font-bold uppercase tracking-[0.3em] text-kyn-slate-400\">\n              System Status: Pending Re-entry\n            </p>\n            <p className=\"font-ui text-[9px] text-kyn-caramel-600/60 uppercase tracking-widest\">\n              Error Hash: KY-GATEWAY-01-SECURE\n            </p>\n          </div>\n        </footer>\n      </div>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/products/[slug]/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Product Page (v2.2)\n * Final Build Fix: Applied type-casting to Supabase queries to bypass \n * the 'never' type error in Next.js 16/Turbopack production builds.\n */\n\nimport { notFound } from \"next/navigation\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { Metadata } from \"next\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { getPriceFromId } from \"@/lib/marketplace/pricing\"; \nimport { formatGBP } from \"@/lib/utils\"; \nimport { AddToCartButton } from \"@/components/marketplace/AddToCartButton\";\nimport { Product } from \"@/lib/supabase/types\";\nimport { ShieldCheck, Download, Zap, Landmark } from \"lucide-react\";\n\ninterface ProductPageProps {\n  params: Promise<{ slug: string }>;\n}\n\n/**\n * SEO: Dynamic Metadata Generation\n * Using 'as any' on the query to prevent the 'Property title does not exist on type never' \n * error during the Netlify build process.\n */\nexport async function generateMetadata(\n  { params }: ProductPageProps\n): Promise<Metadata> {\n  const { slug } = await params;\n  const supabase = await createClient();\n\n  // FIX: Force type to avoid 'never' inference during build\n  const { data: product } = await (supabase\n    .from(\"products\")\n    .select(\"title, short_description\")\n    .eq(\"slug\", slug)\n    .maybeSingle() as any);\n\n  return {\n    title: product?.title\n      ? `${product.title} | Kynar Universe`\n      : \"Product | Hub\",\n    description:\n      product?.short_description ?? \"Explore this digital asset in the Kynar Universe.\",\n  };\n}\n\nexport default async function ProductPage({ params }: ProductPageProps) {\n  const { slug } = await params;\n  const supabase = await createClient();\n\n  // Parallel fetch for Product and Auth state\n  // FIX: Applied 'as any' to ensure the build doesn't crash on type-checking\n  const [\n    { data: productData },\n    { data: authData },\n  ] = await Promise.all([\n    (supabase\n      .from(\"products\")\n      .select(\"*\")\n      .eq(\"slug\", slug)\n      .single() as any),\n    supabase.auth.getUser(),\n  ]);\n\n  if (!productData) notFound();\n\n  const product = productData as Product;\n  const user = authData?.user;\n\n  // Ownership Check for the Vault\n  const { data: ownership } = user\n    ? await (supabase\n        .from(\"user_library\")\n        .select(\"id\")\n        .eq(\"user_id\", user.id)\n        .eq(\"product_id\", product.id)\n        .maybeSingle() as any)\n    : { data: null };\n\n  const price = getPriceFromId(product.price_id);\n\n  const breadcrumbPaths = [\n    { label: \"The Hub\", href: \"/store\" },\n    {\n      label: product.world || \"Universal\",\n      href: `/store?world=${product.world}`,\n    },\n    {\n      label: product.title,\n      href: `/products/${product.slug}`,\n    },\n  ];\n\n  return (\n    <main className=\"min-h-screen bg-canvas pb-32 animate-in fade-in duration-1000\">\n      <div className=\"max-w-screen-xl mx-auto px-gutter pt-8\">\n        <Breadcrumbs paths={breadcrumbPaths} />\n      </div>\n\n      <section className=\"max-w-screen-xl mx-auto px-gutter mt-8 lg:mt-16\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20\">\n          \n          {/* Left Column: Visuals and Technical Content */}\n          <div className=\"lg:col-span-7 space-y-8\">\n            <div className=\"group relative aspect-[16/10] w-full overflow-hidden rounded-3xl border border-border bg-surface shadow-kynar-soft\">\n              <Image\n                src={product.preview_image || \"/assets/placeholder.jpg\"}\n                alt={product.title}\n                fill\n                priority\n                className=\"object-cover transition-transform duration-700 group-hover:scale-105\"\n              />\n            </div>\n\n            <div className=\"hidden lg:block\">\n              <h2 className=\"font-brand text-2xl font-bold text-kyn-slate-900 mb-6\">\n                Technical Architecture\n              </h2>\n              <div\n                className=\"prose prose-slate max-w-none font-ui text-text-secondary leading-relaxed\"\n                dangerouslySetInnerHTML={{\n                  __html: product.description || \"\",\n                }}\n              />\n            </div>\n          </div>\n\n          {/* Right Column: Transactional Sticky Sidebar */}\n          <div className=\"lg:col-span-5\">\n            <div className=\"sticky top-24 space-y-8\">\n              <div>\n                <span className=\"font-ui text-[10px] font-bold uppercase tracking-[0.3em] text-kyn-slate-400\">\n                  Sector: {product.world || \"Universal\"}\n                </span>\n                <h1 className=\"font-brand mt-4 text-4xl font-bold tracking-tight text-kyn-slate-900 md:text-5xl\">\n                  {product.title}\n                </h1>\n              </div>\n\n              <div className=\"rounded-2xl border border-border bg-surface p-8 shadow-kynar-soft transition-all hover:shadow-kynar-deep\">\n                <div className=\"flex items-center justify-between mb-8\">\n                  <div>\n                    <p className=\"font-ui text-[10px] font-bold uppercase tracking-wider text-kyn-slate-400\">\n                      Fixed Value\n                    </p>\n                    <p className=\"font-brand text-3xl font-bold text-kyn-slate-900\">\n                      {price === 0 ? \"Complimentary\" : formatGBP(price)}\n                    </p>\n                  </div>\n                  <Zap size={24} className=\"text-kyn-green-600\" fill=\"currentColor\" />\n                </div>\n\n                {ownership ? (\n                  <Link\n                    href=\"/library\"\n                    className=\"flex w-full items-center justify-center gap-3 rounded-xl bg-kyn-green-600 py-4 font-brand text-sm font-bold text-white hover:bg-kyn-green-700 transition-all active:scale-[0.98]\"\n                  >\n                    <Landmark size={18} />\n                    In Your Vault\n                  </Link>\n                ) : (\n                  <AddToCartButton product={product} />\n                )}\n\n                <div className=\"mt-6 flex items-center gap-3 text-[11px] font-ui text-text-secondary\">\n                  <ShieldCheck size={14} className=\"text-kyn-green-500\" />\n                  <span>Verified Asset. One-time acquisition.</span>\n                </div>\n              </div>\n\n              {/* Format Tags (Notion, PDF, etc) */}\n              {Array.isArray(product.file_types) && product.file_types.length > 0 && (\n                <div className=\"space-y-4 pt-4\">\n                  <h3 className=\"font-brand text-xs font-bold uppercase tracking-widest text-kyn-slate-900\">\n                    Format Integrity\n                  </h3>\n                  <ul className=\"grid grid-cols-2 gap-3\">\n                    {(product.file_types as string[]).map((ft) => (\n                      <li key={ft} className=\"flex items-center gap-2 px-3 py-2 rounded-lg bg-white border border-border font-ui text-[11px] text-kyn-slate-600\">\n                        <Download size={12} className=\"text-kyn-slate-400\" />\n                        {ft}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </section>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/cart/page.tsx": {
    "text": "/* KYNAR UNIVERSE: app/(marketplace)/cart/page.tsx */\n\n\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport Link from \"next/link\";\nimport { Trash2, ArrowRight, ShoppingBag, ChevronLeft } from \"lucide-react\";\nimport { useCartItems, useCartActions } from \"@/lib/cart/store\";\nimport { getPriceFromId } from \"@/lib/marketplace/pricing\";\nimport { formatGBP, hapticFeedback } from \"@/lib/utils\";\n\nexport default function CartPage() {\n  const [mounted, setMounted] = useState(false);\n  \n  const { items, count, isEmpty } = useCartItems();\n  const { removeItem, clearCart } = useCartActions();\n\n  // 1. Prevent Hydration Mismatch\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // 2. Calculate totals safe from SSR mismatch & undefined pricing\n  const totalPrice = mounted \n    ? items.reduce((sum, item) => {\n        const price = getPriceFromId(item.price_id);\n        return sum + (price ?? 0);\n      }, 0)\n    : 0;\n\n  // Loading State / SSR Placeholder\n  if (!mounted) {\n    return (\n      <div className=\"mx-auto max-w-2xl px-gutter py-24\">\n        <div className=\"h-8 w-48 animate-pulse rounded-lg bg-surface mb-8\" />\n        <div className=\"space-y-4\">\n          {[1, 2].map((i) => (\n            <div key={i} className=\"h-24 w-full animate-pulse rounded-2xl bg-surface\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  // Empty State\n  if (isEmpty) {\n    return (\n      <div className=\"flex min-h-[70vh] flex-col items-center justify-center px-gutter text-center animate-in fade-in duration-700\">\n        <div className=\"mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-surface text-kyn-slate-200\">\n          <ShoppingBag size={32} />\n        </div>\n        <h1 className=\"font-brand text-xl font-bold text-kyn-slate-900 uppercase tracking-widest\">Selection Empty</h1>\n        <p className=\"mt-2 font-ui text-[11px] uppercase tracking-[0.2em] text-kyn-slate-400\">Your vault awaits new additions.</p>\n        <Link \n          href=\"/store\" \n          className=\"mt-10 rounded-xl bg-kyn-slate-900 px-10 py-4 font-brand text-[10px] font-black uppercase tracking-[0.2em] text-white transition-all active:scale-95 shadow-xl shadow-kyn-slate-900/10\"\n        >\n          Explore Store\n        </Link>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"mx-auto max-w-2xl px-gutter py-12 pb-48 animate-in fade-in slide-in-from-bottom-4 duration-1000\">\n      {/* Header */}\n      <header className=\"mb-12 flex items-end justify-between\">\n        <div>\n          <Link href=\"/store\" className=\"group mb-4 flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400 hover:text-kyn-slate-900 transition-colors\">\n            <ChevronLeft size={14} className=\"transition-transform group-hover:-translate-x-1\" />\n            Continue Browsing\n          </Link>\n          <h1 className=\"font-brand text-sm font-black uppercase tracking-[0.3em] text-kyn-slate-900\">\n            Selection Terminal\n          </h1>\n        </div>\n        <button \n          onClick={() => { hapticFeedback('medium'); clearCart(); }}\n          className=\"text-[10px] font-bold uppercase tracking-widest text-red-400 hover:text-red-600 transition-colors\"\n        >\n          Reset All\n        </button>\n      </header>\n\n      {/* Item List */}\n      <div className=\"space-y-3\">\n        {items.map((product) => {\n          const price = getPriceFromId(product.price_id) ?? 0;\n          \n          return (\n            <div \n              key={product.id} \n              className=\"group flex items-center gap-6 rounded-3xl border border-border bg-white p-5 transition-all hover:border-kyn-slate-200 hover:shadow-kynar-soft\"\n            >\n              <div className=\"flex-1 min-w-0\">\n                <span className=\"font-ui text-[9px] font-bold uppercase tracking-[0.25em] text-kyn-slate-400\">\n                  {product.world}\n                </span>\n                <h3 className=\"truncate font-brand text-lg font-bold text-kyn-slate-900 mt-0.5\">\n                  {product.title}\n                </h3>\n              </div>\n\n              <div className=\"flex items-center gap-6\">\n                <p className=\"font-brand text-sm font-bold text-kyn-slate-900\">\n                  {price === 0 ? \"Free\" : formatGBP(price)}\n                </p>\n                <button \n                  onClick={() => { hapticFeedback('light'); removeItem(product.id); }}\n                  className=\"p-2 text-kyn-slate-200 hover:text-red-500 transition-colors\"\n                  aria-label=\"Remove item\"\n                >\n                  <Trash2 size={18} />\n                </button>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Checkout Summary Footer */}\n      <footer className=\"fixed bottom-24 left-0 z-40 w-full px-gutter md:bottom-12\">\n        <div className=\"mx-auto max-w-2xl rounded-[2.5rem] bg-kyn-slate-900 p-8 shadow-2xl shadow-kyn-slate-900/20 text-white\">\n          <div className=\"mb-6 flex items-center justify-between border-b border-white/10 pb-6\">\n            <div>\n              <p className=\"text-[10px] font-bold uppercase tracking-[0.2em] text-white/40 mb-1\">Total Commitment</p>\n              <p className=\"font-brand text-3xl font-bold\">{formatGBP(totalPrice)}</p>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-[10px] font-bold uppercase tracking-[0.2em] text-white/40 mb-1\">Units</p>\n              <p className=\"font-brand text-3xl font-bold\">{count}</p>\n            </div>\n          </div>\n          \n          <button \n            onClick={() => hapticFeedback('success')}\n            className=\"group flex w-full items-center justify-center gap-4 rounded-2xl bg-kyn-green-500 py-5 font-brand text-xs font-black uppercase tracking-[0.2em] text-white transition-all hover:bg-kyn-green-600 active:scale-[0.98] shadow-lg shadow-kyn-green-500/20\"\n          >\n            Initiate Acquisition\n            <ArrowRight size={18} className=\"transition-transform group-hover:translate-x-1\" />\n          </button>\n        </div>\n      </footer>\n    </div>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/store/loading.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: The Hub Loading State (v1.6)\n * Role: A \"Calm\" bridge that eliminates layout shift (CLS).\n * Design: High-fidelity skeletons matching the ProductCard anatomy.\n */\n\nexport default function StoreLoading() {\n  const skeletons = Array.from({ length: 6 });\n\n  return (\n    <main className=\"min-h-screen bg-canvas pb-32\">\n      {/* Header Skeleton */}\n      <header className=\"py-16 md:py-24 text-center border-b border-border bg-surface/30 px-gutter\">\n        <div className=\"max-w-3xl mx-auto flex flex-col items-center space-y-6\">\n          <div className=\"h-10 w-48 md:h-14 md:w-64 animate-pulse rounded-xl bg-kyn-slate-200/60\" />\n          <div className=\"space-y-3 w-full flex flex-col items-center px-4\">\n            <div className=\"h-3 w-full max-w-lg animate-pulse rounded-full bg-kyn-slate-100\" />\n            <div className=\"h-3 w-3/4 max-w-sm animate-pulse rounded-full bg-kyn-slate-100/60\" />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-screen-xl mx-auto px-gutter pt-20\">\n        <div className=\"grid grid-cols-1 gap-y-12 gap-x-8 sm:grid-cols-2 lg:grid-cols-3\">\n          {skeletons.map((_, i) => (\n            <div \n              key={i} \n              className=\"overflow-hidden rounded-[2rem] border border-border bg-white\"\n            >\n              {/* Aspect Ratio Box (16:10) */}\n              <div className=\"aspect-[16/10] w-full animate-pulse bg-kyn-slate-100\" />\n              \n              <div className=\"p-8 space-y-6\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-start\">\n                    <div className=\"h-6 w-2/3 animate-pulse rounded-lg bg-kyn-slate-200/70\" />\n                    <div className=\"h-6 w-12 animate-pulse rounded-lg bg-kyn-slate-200/50\" />\n                  </div>\n                  <div className=\"h-3 w-full animate-pulse rounded-md bg-kyn-slate-100\" />\n                  <div className=\"h-3 w-4/5 animate-pulse rounded-md bg-kyn-slate-100/60\" />\n                </div>\n\n                <div className=\"flex justify-between items-center pt-2\">\n                  <div className=\"flex gap-2\">\n                    <div className=\"h-4 w-10 animate-pulse rounded bg-kyn-slate-100\" />\n                    <div className=\"h-4 w-10 animate-pulse rounded bg-kyn-slate-100\" />\n                  </div>\n                  <div className=\"h-10 w-24 animate-pulse rounded-xl bg-kyn-slate-900/10\" />\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/(marketplace)/store/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: The Marketplace Hub (v2.3)\n * Fix: Resolved Async searchParams for Next.js 15+ and Netlify build.\n */\n\nimport { createClient } from \"@/lib/supabase/server\";\nimport { ProductCard } from \"@/components/marketplace/ProductCard\";\nimport { FilterBar } from \"@/components/marketplace/FilterBar\";\nimport { Product, World, WORLDS } from \"@/lib/supabase/types\";\nimport { Box, Sparkles } from \"lucide-react\";\n\ninterface StorePageProps {\n  searchParams: Promise<{ world?: string; sort?: string }>;\n}\n\nexport default async function StorePage({ searchParams }: StorePageProps) {\n  // 1. Properly await searchParams for Next.js 15 production build\n  const params = await searchParams;\n  \n  // 2. Validate the world against the constant for runtime safety\n  const activeWorld = params.world as World | undefined;\n  \n  const supabase = await createClient();\n  \n  let query = supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"is_published\", true);\n  \n  // 3. World validation using type-casting for Postgres Enum compatibility\n  if (activeWorld && (WORLDS as unknown as string[]).includes(activeWorld)) {\n    query = query.eq(\"world\", activeWorld as string);\n  }\n  \n  const { data: products, error } = await query.order(\"created_at\", { ascending: false });\n  \n  if (error || !products) {\n    return (\n      <div className=\"flex min-h-[50vh] items-center justify-center font-ui text-[10px] font-bold uppercase tracking-widest text-kyn-slate-400\">\n        Connection to the hub interrupted. Please refresh.\n      </div>\n    );\n  }\n  \n  return (\n    <main className=\"pb-32\">\n      <header className=\"relative overflow-hidden border-b border-border bg-surface/50 py-16 md:py-24 px-gutter\">\n        <div className=\"relative z-10 mx-auto max-w-3xl text-center\">\n          <div className=\"mb-6 inline-flex items-center gap-2 rounded-full bg-white border border-border px-4 py-1.5 font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-500 shadow-sm\">\n            <Sparkles size={12} className=\"text-kyn-green-500\" />\n            Permanent Acquisitions\n          </div>\n          <h1 className=\"font-brand text-4xl font-bold tracking-tight text-text-primary md:text-6xl\">\n            The Hub\n          </h1>\n          <p className=\"mt-6 font-ui text-base md:text-lg text-text-secondary leading-relaxed\">\n            A curated collection of permanent digital assets. <br className=\"hidden md:block\" />\n            Designed for a grounded life, secured for the long term.\n          </p>\n        </div>\n      </header>\n\n      <div className=\"max-w-screen-xl mx-auto px-gutter\">\n        {/* Filter Bar Zone */}\n        <div className=\"sticky top-14 md:top-20 z-30 py-6 bg-canvas/90 backdrop-blur-md mb-8 border-b border-border/50\">\n          <FilterBar currentWorld={activeWorld ?? \"All\"} />\n        </div>\n\n        {/* Product Grid */}\n        {products.length > 0 ? (\n          <div className=\"grid grid-cols-1 gap-y-12 gap-x-8 sm:grid-cols-2 lg:grid-cols-3 animate-in fade-in duration-1000\">\n            {products.map((product: Product) => (\n              <ProductCard key={product.id} product={product} />\n            ))}\n          </div>\n        ) : (\n          <div className=\"flex flex-col items-center justify-center py-32 text-center rounded-[2.5rem] border border-dashed border-border bg-surface/50\">\n            <Box size={32} className=\"text-kyn-slate-200 mb-4\" />\n            <h2 className=\"font-brand text-lg font-bold text-text-primary uppercase tracking-widest\">Sector Empty</h2>\n            <p className=\"mt-2 font-ui text-[11px] uppercase tracking-[0.2em] text-kyn-slate-400\">No products found in this world yet.</p>\n          </div>\n        )}\n      </div>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/account/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Account Dashboard (v2.3)\n * Evolution: Added Auth Guarding and Type-Safe Layout\n */\n\nimport Link from \"next/link\";\nimport { redirect } from \"next/navigation\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport { logout } from \"../auth/actions\";\n\nexport default async function AccountPage() {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  // If no session exists, bounce to login\n  if (!user) redirect(\"/auth/login?return_to=/account\");\n\n  return (\n    <main className=\"max-w-screen-xl mx-auto px-gutter py-20\">\n      <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-6 mb-12\">\n        <div>\n          <h1 className=\"font-brand text-4xl font-bold text-kyn-slate-900 tracking-tight\">Your Account</h1>\n          <p className=\"mt-2 text-text-secondary font-ui max-w-sm\">\n            Manage your presence and verified credentials in the Kynar Universe.\n          </p>\n        </div>\n        \n        <form action={logout}>\n          <button \n            type=\"submit\" \n            className=\"px-6 py-3 border border-red-100 text-red-600 rounded-2xl hover:bg-red-50 font-brand text-xs font-bold uppercase tracking-widest transition-all active:scale-95\"\n          >\n            Terminate Session\n          </button>\n        </form>\n      </div>\n\n      <div className=\"grid gap-6\">\n        <Link \n          href=\"/account/settings\" \n          className=\"group p-8 border border-border rounded-[2.5rem] hover:border-kyn-green-500 transition-all duration-500 bg-white shadow-kynar-soft hover:shadow-kynar-deep\"\n        >\n          <h2 className=\"font-brand text-xl font-bold group-hover:text-kyn-green-600 transition-colors\">Identity Settings â†’</h2>\n          <p className=\"text-text-secondary text-sm mt-2 font-ui\">Update your security protocols and profile details.</p>\n        </Link>\n      </div>\n    </main>\n  );\n}\n",
    "embedding": null
  },
  "./app/account/settings/page.tsx": {
    "text": "/**\n * KYNAR UNIVERSE: Settings Page (v2.4)\n * Evolution: Strict Schema Alignment & Build Error Resolution\n */\n\nimport { getUserProfile } from \"@/lib/supabase/helpers\";\nimport { SettingsForm } from \"@/components/account/SettingsForm\";\nimport { Breadcrumbs } from \"@/components/layout/Breadcrumbs\";\nimport { ShieldCheck, Info } from \"lucide-react\";\nimport { User, Profile } from \"@/lib/supabase/types\"; \nimport { redirect } from \"next/navigation\";\nimport { createClient } from \"@/lib/supabase/server\";\n\nexport default async function SettingsPage() {\n  const supabase = await createClient();\n  const { data: { user: authUser } } = await supabase.auth.getUser();\n  \n  if (!authUser) redirect(\"/auth/login\");\n\n  // Create a clean User object for the form\n  const user: User = {\n    id: authUser.id,\n    email: authUser.email\n  };\n\n  // Fetch the real profile from the DB\n  const fetchedProfile = await getUserProfile();\n  \n  /**\n   * EVOLUTION: Strict Type Alignment\n   * 1. Removed 'avatar_url' (not in types.ts)\n   * 2. Added 'is_admin' (required by types.ts)\n   */\n  const profile: Profile = fetchedProfile ?? {\n    id: authUser.id,\n    email: authUser.email ?? \"\",\n    full_name: \"\",\n    is_admin: false,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString()\n  };\n  \n  const breadcrumbPaths = [\n    { label: \"Account\", href: \"/account\" },\n    { label: \"Settings\", href: \"/account/settings\" },\n  ];\n  \n  return (\n    <main className=\"mx-auto max-w-2xl pb-32 animate-in fade-in duration-700 ease-out\">\n      <div className=\"px-gutter pt-8\">\n        <Breadcrumbs paths={breadcrumbPaths} />\n      </div>\n\n      <header className=\"px-gutter py-12 md:py-20\">\n        <h1 className=\"font-brand text-3xl font-bold tracking-tight text-text-primary md:text-4xl\">\n          Account Settings\n        </h1>\n        <p className=\"font-ui mt-3 text-base text-text-secondary leading-relaxed max-w-md\">\n          Maintain your identity and digital preferences within the Kynar Universe.\n        </p>\n      </header>\n\n      <section className=\"px-gutter\">\n        <div className=\"rounded-[2rem] border border-border bg-white p-6 md:p-10 shadow-kynar-soft\">\n          {/* FIXED: Passing both props to resolve TS2741 build error */}\n          <SettingsForm user={user} profile={profile} />\n        </div>\n\n        <div className=\"mt-12 border-t border-border pt-8 text-center\">\n          <div className=\"flex justify-center mb-4 text-kyn-slate-300\">\n            <ShieldCheck size={24} strokeWidth={1} />\n          </div>\n          <p className=\"font-ui text-[10px] font-bold uppercase tracking-[0.2em] text-kyn-slate-400\">\n            Digital Autonomy Support\n          </p>\n          <a\n            href=\"mailto:support@kynaruniverse.com\"\n            className=\"mt-4 inline-block font-brand text-sm font-bold text-kyn-slate-900 underline underline-offset-8 decoration-kyn-green-200 hover:decoration-kyn-green-500 transition-all\"\n          >\n            support@kynaruniverse.com\n          </a>\n        </div>\n      </section>\n\n      <section className=\"mt-12 px-gutter\">\n        <div className=\"flex gap-4 p-6 rounded-2xl bg-kyn-green-50/30 border border-kyn-green-100/50\">\n          <div className=\"shrink-0 text-kyn-green-600\">\n            <Info size={20} />\n          </div>\n          <p className=\"font-ui text-[13px] leading-relaxed text-kyn-green-900/70\">\n            Your session is secured via <strong>PKCE encryption</strong>. Your identity data is encrypted at rest and never shared with third-party trackers.\n          </p>\n        </div>\n      </section>\n    </main>\n  );\n}\n",
    "embedding": null
  }
}
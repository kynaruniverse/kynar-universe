[build]
# MAXIMUM ERROR VISIBILITY: Run all type checks, linting, and build regardless of failures
command = "npm run types:soft; npm run types:full; npm run types:soft; npm run lint:soft; npm run lint:full; npm run build"
publish = ".next"

[build.environment]
NODE_VERSION = "22"
NPM_CONFIG_LEGACY_PEER_DEPS = "true"
NEXT_USE_RSC_WORKERS = "true"

# -----------------------------
# Security Headers
# -----------------------------
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "same-origin"
Content-Security-Policy = """
default-src 'self';
script-src 'self' 'unsafe-inline' 'unsafe-eval';
connect-src 'self' *.supabase.co wss://*.supabase.co https://api.lemonsqueezy.com;
img-src 'self' data: *.supabase.co lemonsqueezy.imgix.net;
style-src 'self' 'unsafe-inline';
font-src 'self' data:;
"""

[[headers]]
for = "/_next/static/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"
<!DOCTYPE html>
<html lang="en" data-mode="dark" data-theme="hub">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Loading Protocol... | Kynar Universe</title>
  
  <link rel="stylesheet" href="assets/phosphor.css">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/components.css">
  
  <style>
    .prose {
      max-width: 65ch;
      margin: 0 auto;
      font-size: 1.1rem;
      line-height: 1.8;
      color: var(--text-body);
    }
    .prose h2 {
      color: var(--text-main);
      margin-top: var(--space-xl);
      margin-bottom: var(--space-sm);
    }
    .prose p {
      margin-bottom: var(--space-md);
    }
    .meta-bar {
      display: flex;
      gap: var(--space-md);
      font-size: 0.9rem;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border-subtle);
      padding-bottom: var(--space-lg);
      margin-bottom: var(--space-xl);
    }
  </style>
</head>

<body>
  <a href="#main-content" class="skip-link">Skip to Content</a>
  <div id="search-mount"></div>
  <header id="app-header" class="glass-header"></header>

  <main id="main-content" class="container" style="padding-top: var(--space-xl); min-height: 80vh;">
    
    <div id="guide-app" class="animate-enter">
      <div class="stack-lg" style="max-width: 700px; margin: 0 auto;">
        <div class="skeleton text-skeleton" style="height: 40px; width: 80%;"></div>
        <div class="skeleton text-skeleton" style="width: 40%;"></div>
        <div class="skeleton card-skeleton" style="height: 400px; margin-top: 2rem;"></div>
      </div>
    </div>

  </main>
  
  <footer id="app-footer" style="margin-top: var(--space-section);"></footer>

  <script type="module" src="js/app.js"></script>
  <script type="module" src="js/header.js"></script> 
  <script type="module" src="js/search.js"></script>
  <script type="module" src="js/footer.js"></script>

  <script type="module">
    import { getGuideById } from './js/data.js';

    document.addEventListener('DOMContentLoaded', () => {
      initGuide();
    });

    function initGuide() {
      const params = new URLSearchParams(window.location.search);
      const guideId = params.get('guide');

      if (!guideId) {
        window.location.href = '404.html';
        return;
      }

      const guide = getGuideById(guideId);

      if (!guide) {
        document.getElementById('guide-app').innerHTML = `
          <div style="text-align: center; padding: 4rem;">
            <h1 class="text-h2">Record Not Found</h1>
            <a href="pages/hub/index.html" class="btn-secondary">Return to Hub</a>
          </div>
        `;
        return;
      }

      document.title = `${guide.title} | Kynar Universe`;
      renderGuide(guide);
    }

    function renderGuide(guide) {
      const container = document.getElementById('guide-app');
      
      container.innerHTML = `
        <div style="max-width: 720px; margin: 0 auto;">
          
          <div class="breadcrumb" style="justify-content: center; margin-bottom: var(--space-lg);">
            <a href="index.html">Universe</a>
            <i class="ph ph-caret-right"></i>
            <a href="pages/hub/index.html">The Hub</a>
            <i class="ph ph-caret-right"></i>
            <span>Protocol</span>
          </div>

          <div style="text-align: center; margin-bottom: var(--space-md);">
            <span class="tag" data-variant="hub">${guide.date}</span>
            <h1 class="text-h1" style="margin-top: var(--space-sm);">${guide.title}</h1>
          </div>

          <div class="meta-bar" style="justify-content: center;">
            <span style="display: flex; align-items: center; gap: 6px;">
              <i class="ph ph-clock"></i> ${guide.readTime}
            </span>
            <span style="display: flex; align-items: center; gap: 6px;">
               <i class="ph ph-check-circle"></i> Verified
            </span>
          </div>

          <article class="prose">
            ${guide.content}
          </article>

          <div style="margin-top: var(--space-section); padding-top: var(--space-lg); border-top: 1px solid var(--border-subtle); text-align: center;">
            <p class="text-lore">"End of Protocol."</p>
            <div style="margin-top: var(--space-md);">
              <a href="pages/hub/index.html" class="btn-secondary">Back to Library</a>
            </div>
          </div>

        </div>
      `;
      
      if(window.initMotionSystem) window.initMotionSystem();
    }
  </script>
</body>
</html>

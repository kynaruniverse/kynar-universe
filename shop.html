<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8" />
    <meta 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" 
      name="viewport" 
    />
    
    <title>The Marketplace | Kynar Studio</title>
    
    <link href="styles.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <meta content="website" property="og:type">
    <meta content="https://www.kynaruniverse.co.uk/" property="og:url">
    <meta content="Kynar Studio | Digital Marketplace" property="og:title">
    <meta content="Premium digital assets for the creative elite. Explore the shop." property="og:description">
    <meta content="https://www.kynaruniverse.co.uk/assets/images/og-preview.webp" property="og:image">
    
    <meta content="summary_large_image" name="twitter:card">
    <meta content="The Marketplace | Kynar Studio" name="twitter:title">
    <meta content="Premium digital assets for the creative elite." name="twitter:description">
    <meta content="https://www.kynaruniverse.co.uk/assets/images/og-preview.webp" name="twitter:image">
  </head>

  <body>

    <header class="app-header" id="global-header"></header>

    <main class="container">
      
      <div 
        class="reveal-up" 
        style="margin-top: 40px"
      >
        <span 
          style="
            color: var(--accent-gold); 
            font-size: 0.8rem; 
            font-weight: 800; 
            letter-spacing: 0.2em; 
            text-transform: uppercase; 
          "
        >
          Curated Shop
        </span>
        <h1>The Marketplace</h1>
        <p style="margin-top: 10px;">High-fidelity assets for digital creators.</p>
      </div>

      <nav class="filter-bar reveal-up" id="filterContainer">
        <button class="filter-chip active" data-cat="all">All Assets</button>
        <button class="filter-chip" data-cat="personal">Life & Flow</button>
        <button class="filter-chip" data-cat="work">Business & Growth</button>
        <button class="filter-chip" data-cat="creative">Content & Style</button>
        <button class="filter-chip" data-cat="education">Learning & Dev</button>
      </nav>

      <div class="gallery-grid" id="productGrid"></div>
      
      <div class="empty-state" id="emptyState"></div>

    </main>

    <footer id="global-footer"></footer>
    
    <div id="productModal" class="nav-overlay" style="justify-content: center; padding: 20px;">
  <div class="product-card" style="max-width: 800px; width: 100%; grid-template-columns: 1fr; position: relative;">
    <button id="closeModal" class="nav-icon" style="position: absolute; top: 20px; right: 20px;">âœ•</button>
    <div id="modalContent">
      </div>
    
    <script type="module">
      import { VAULT } from './vault.js';

      // #region [ 1. INITIALIZATION ]
      const grid = document.getElementById('productGrid');
      const emptyState = document.getElementById('emptyState');
      // #endregion

      // #region [ 2. RENDERERS ]

      /**
       * Renders the product grid based on the selected category filter.
       */
      async function renderGallery(filter = 'all') {
        grid.style.opacity = '0'; 
        
        requestAnimationFrame(() => {
          const filtered = filter === 'all' ? VAULT : VAULT.filter(p => p.category === filter);
          
          if (filtered.length === 0) {
            emptyState.style.display = 'block';
            emptyState.innerHTML = `<h3>No assets found.</h3>`;
            grid.innerHTML = '';
          } else {
            emptyState.style.display = 'none';
            // NEW HORIZONTAL LAYOUT IMPLEMENTATION
            grid.innerHTML = filtered.map((p, i) => `
              <article class="product-card reveal-up" style="transition-delay: ${i * 0.05}s">
                
                <div class="card-left">
                  <div class="card-image" style="background: ${p.accentColor || 'var(--pastel-sage)'};">
                    <img src="${p.image}" alt="${p.title}" class="product-img" onload="this.style.opacity='1'">
                  </div>
                  <span class="card-price">${p.price}</span>
                </div>

                <div class="card-right">
                  <h3 class="card-title">${p.title}</h3>
                  <p class="card-subtitle">${p.shortDesc}</p>
                  
                  <div class="tag-container">
                    <span class="horizontal-tag">${p.tag}</span>
                    <span class="horizontal-tag">${p.category}</span> 
                  </div>

                  <p class="card-description">
                    ${p.longDesc || 'Premium digital asset engineered for high-fidelity performance.'}
                    <span class="read-more-link" onclick="openProductModal('${p.id}')">Read More</span>                  </p>

                  <div class="card-actions">
                    <a href="product.html?id=${p.id}" class="btn-details">View Details</a>
                    <button id="add-btn-${p.id}" onclick="saveToShop('${p.id}')" class="btn-add">Add To Cart</button>
                  </div>
                </div>

              </article>`).join('');
          }

          grid.style.opacity = '1';
          document.querySelectorAll('.reveal-up').forEach(el => el.classList.add('reveal-visible'));
        });
      }
      // #endregion

      // #region [ 3. INTERACTION LOGIC ]
      
            // Event: Close Modal
      const closeBtn = document.getElementById('closeModal');
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          document.getElementById('productModal').classList.remove('active');
        });
      }


      // Event: Filter Click
      document.getElementById('filterContainer').addEventListener('click', (e) => {
        const chip = e.target.closest('.filter-chip');
        if (chip) {
          document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          renderGallery(chip.dataset.cat);
        }
      });

      // Event: Page Load
      window.addEventListener('load', () => {
        renderGallery('all');
      });

      // #endregion

    </script>

    
    <script defer src="ui-core.js"></script>

  </div>
</div>

  </body>
</html>

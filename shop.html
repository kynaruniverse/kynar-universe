<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8" />
    <meta 
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" 
      name="viewport" 
    />
    
    <title>The Marketplace | Kynar Studio</title>
    
    <link href="styles.css" rel="stylesheet" />
    
    <script>
      (function() {
        const savedTheme = localStorage.getItem("kynar_theme");
        if (savedTheme === "dark" || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add("dark-mode");
        }
      })();
    </script>

    <script defer src="ui-core.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <meta content="website" property="og:type">
    <meta content="https://www.kynaruniverse.co.uk/" property="og:url">
    <meta content="The Marketplace | Kynar Studio" property="og:title">
    <meta content="Premium digital assets for the creative elite." property="og:description">
    <meta content="https://www.kynaruniverse.co.uk/assets/images/og-preview.webp" property="og:image">
  </head>

  <body>

    <header class="app-header" id="global-header"></header>

    <main class="container">
      
      <div class="reveal-up" style="margin-top: 40px">
        <span class="text-accent text-upper text-bold text-sm" style="letter-spacing: 0.2em;">Curated Shop</span>
        <h1>The Marketplace</h1>
        <p style="margin-top: 10px;">High-fidelity assets for digital creators.</p>
      </div>

      <nav class="flex-wrap gap-sm reveal-up" id="filterContainer" style="margin: 40px 0;">
        <button class="btn btn--primary active" data-cat="all">All Assets</button>
        <button class="btn btn--ghost" data-cat="personal">Life & Flow</button>
        <button class="btn btn--ghost" data-cat="work">Business & Growth</button>
        <button class="btn btn--ghost" data-cat="creative">Content & Style</button>
        <button class="btn btn--ghost" data-cat="education">Learning & Dev</button>
      </nav>

      <div id="shop-grid" style="display: grid; gap: 32px; grid-template-columns: 1fr;"></div>
      
      <div id="emptyState" style="display: none; text-align: center; padding: 60px; opacity: 0.6;">
        <div style="font-size: 3rem; margin-bottom: 20px;">ðŸ”­</div>
        <h3 class="text-display">Signal Lost</h3>
        <p>No assets found in this frequency.</p>
      </div>

    </main>

    <footer id="global-footer"></footer>
    
    <div id="productModal" class="nav-overlay flex-center" style="padding: 20px; display: none;">
      <div class="card" style="max-width: 800px; width: 100%; grid-template-columns: 1fr; position: relative; padding: 40px;">
        <button id="closeModal" class="nav-icon" style="position: absolute; top: 20px; right: 20px;">âœ•</button>
        <div id="modalContent"></div>
      </div>
    </div>

    <script type="module">
      import { VAULT } from './vault.js';
      import { renderCard } from './components/ProductCard.js';
      import { EventBus, EVENTS } from './core/events.js';

      // 1. DOM Elements
      const grid = document.getElementById('shop-grid');
      const emptyState = document.getElementById('emptyState');
      const filterBtns = document.querySelectorAll('#filterContainer button');

      // 2. The Render Engine
      function renderGrid(category = 'all') {
        // Reset Visuals
        grid.style.opacity = '0';
        
        requestAnimationFrame(() => {
          // Filter Data
          const filtered = category === 'all' 
            ? VAULT 
            : VAULT.filter(p => p.category.toLowerCase() === category.toLowerCase());

          // Handle Empty State
          if (filtered.length === 0) {
            emptyState.style.display = 'block';
            grid.innerHTML = '';
          } else {
            emptyState.style.display = 'none';
            // RENDER: Use the imported Component Module
            grid.innerHTML = filtered.map(p => renderCard(p)).join('');
          }

          // Trigger Animations
          grid.style.opacity = '1';
          setTimeout(() => {
            document.querySelectorAll('.reveal-up').forEach(el => el.classList.add('reveal-visible'));
          }, 50);
        });
      }

      // 3. Initialization
      document.addEventListener('DOMContentLoaded', () => {
        // Check URL Params
        const params = new URLSearchParams(window.location.search);
        const cat = params.get('cat') || 'all';
        
        // Set Active Button
        updateActiveButton(cat);
        
        // Initial Render
        renderGrid(cat);
      });

      // 4. Interaction Logic
      document.getElementById('filterContainer').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        
        const category = btn.dataset.cat;
        updateActiveButton(category);
        renderGrid(category);
      });

      function updateActiveButton(category) {
        filterBtns.forEach(btn => {
          if (btn.dataset.cat === category) {
            btn.classList.add('active', 'btn--primary');
            btn.classList.remove('btn--ghost');
          } else {
            btn.classList.remove('active', 'btn--primary');
            btn.classList.add('btn--ghost');
          }
        });
      }
    </script>

  </body>
</html>
